<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="ÂºπÂπïËßÜÈ¢ëÁΩëÁ´ôÁ¨îËÆ∞ Maven Â§öÊ®°ÂùóÈ°πÁõÆÁöÑ POM Êñá‰ª∂ÈÖçÁΩÆËØ¶Ëß£ Ëøô‰∏™Êñá‰ª∂ÊòØ‰∏Ä‰∏™ Maven ÁöÑ POM (Project Object Model) Êñá‰ª∂ÔºåÂÆÉÊòØ Maven È°πÁõÆÁöÑÊ†∏ÂøÉÈÖçÁΩÆÊñá‰ª∂ÔºåÁî®‰∫éÂÆö‰πâÈ°πÁõÆÁöÑÁªìÊûÑ„ÄÅ‰æùËµñÂÖ≥Á≥ª„ÄÅÊûÑÂª∫ÈÖçÁΩÆÁ≠â‰ø°ÊÅØ„ÄÇ‰∏ãÈù¢ÊòØÂØπËøô‰∏™Êñá‰ª∂‰∏≠ÂêÑ‰∏™ÈÉ®ÂàÜÁöÑËØ¶ÁªÜËß£ÈáäÔºö\n">
<title>MyFirstBlog</title>

<link rel='canonical' href='http://localhost:1313/p/myfirstblog/'>

<link rel="stylesheet" href="/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css"><meta property='og:title' content="MyFirstBlog">
<meta property='og:description' content="ÂºπÂπïËßÜÈ¢ëÁΩëÁ´ôÁ¨îËÆ∞ Maven Â§öÊ®°ÂùóÈ°πÁõÆÁöÑ POM Êñá‰ª∂ÈÖçÁΩÆËØ¶Ëß£ Ëøô‰∏™Êñá‰ª∂ÊòØ‰∏Ä‰∏™ Maven ÁöÑ POM (Project Object Model) Êñá‰ª∂ÔºåÂÆÉÊòØ Maven È°πÁõÆÁöÑÊ†∏ÂøÉÈÖçÁΩÆÊñá‰ª∂ÔºåÁî®‰∫éÂÆö‰πâÈ°πÁõÆÁöÑÁªìÊûÑ„ÄÅ‰æùËµñÂÖ≥Á≥ª„ÄÅÊûÑÂª∫ÈÖçÁΩÆÁ≠â‰ø°ÊÅØ„ÄÇ‰∏ãÈù¢ÊòØÂØπËøô‰∏™Êñá‰ª∂‰∏≠ÂêÑ‰∏™ÈÉ®ÂàÜÁöÑËØ¶ÁªÜËß£ÈáäÔºö\n">
<meta property='og:url' content='http://localhost:1313/p/myfirstblog/'>
<meta property='og:site_name' content='P'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-11-15T17:19:37&#43;08:00'/><meta property='article:modified_time' content='2024-11-15T17:19:37&#43;08:00'/>
<meta name="twitter:title" content="MyFirstBlog">
<meta name="twitter:description" content="ÂºπÂπïËßÜÈ¢ëÁΩëÁ´ôÁ¨îËÆ∞ Maven Â§öÊ®°ÂùóÈ°πÁõÆÁöÑ POM Êñá‰ª∂ÈÖçÁΩÆËØ¶Ëß£ Ëøô‰∏™Êñá‰ª∂ÊòØ‰∏Ä‰∏™ Maven ÁöÑ POM (Project Object Model) Êñá‰ª∂ÔºåÂÆÉÊòØ Maven È°πÁõÆÁöÑÊ†∏ÂøÉÈÖçÁΩÆÊñá‰ª∂ÔºåÁî®‰∫éÂÆö‰πâÈ°πÁõÆÁöÑÁªìÊûÑ„ÄÅ‰æùËµñÂÖ≥Á≥ª„ÄÅÊûÑÂª∫ÈÖçÁΩÆÁ≠â‰ø°ÊÅØ„ÄÇ‰∏ãÈù¢ÊòØÂØπËøô‰∏™Êñá‰ª∂‰∏≠ÂêÑ‰∏™ÈÉ®ÂàÜÁöÑËØ¶ÁªÜËß£ÈáäÔºö\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_321bcca034d8ea60.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ü§°</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">P</a></h1>
            <h2 class="site-description">‰øùÂÆâÂÜçÂ∞±‰∏ö.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/Pupil770'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#maven-Â§öÊ®°ÂùóÈ°πÁõÆÁöÑ-pom-Êñá‰ª∂ÈÖçÁΩÆËØ¶Ëß£">Maven Â§öÊ®°ÂùóÈ°πÁõÆÁöÑ POM Êñá‰ª∂ÈÖçÁΩÆËØ¶Ëß£</a>
      <ol>
        <li><a href="#1Âü∫Êú¨ÈÖçÁΩÆ">1.Âü∫Êú¨ÈÖçÁΩÆ</a></li>
        <li><a href="#2-Áà∂È°πÁõÆÁªßÊâø">2. Áà∂È°πÁõÆÁªßÊâø</a></li>
        <li><a href="#3-Ê®°ÂùóÂÆö‰πâ">3. Ê®°ÂùóÂÆö‰πâ</a></li>
        <li><a href="#4-ÂÖ®Â±ÄÂ±ûÊÄß">4. ÂÖ®Â±ÄÂ±ûÊÄß</a></li>
        <li><a href="#5-‰æùËµñÁÆ°ÁêÜ">5. ‰æùËµñÁÆ°ÁêÜ</a></li>
        <li><a href="#6-ÂÖ≥ÈîÆ‰æùËµñËØ¥Êòé">6. ÂÖ≥ÈîÆ‰æùËµñËØ¥Êòé</a></li>
        <li><a href="#7-Êñá‰ª∂ÁöÑ‰ΩúÁî®">7. Êñá‰ª∂ÁöÑ‰ΩúÁî®</a>
          <ol>
            <li><a href="#Ë°•ÂÖÖËØ¥Êòé">Ë°•ÂÖÖËØ¥Êòé</a></li>
            <li><a href="#1-commons-ioapache-commons-io">1. commons-ioÔºàApache Commons IOÔºâ</a></li>
            <li><a href="#2-commons-codecapache-commons-codec">2. commons-codecÔºàApache Commons CodecÔºâ</a></li>
            <li><a href="#3-commons-lang3apache-commons-lang3">3. commons-lang3ÔºàApache Commons Lang3Ôºâ</a></li>
            <li><a href="#4-aspectjweaveraspectj-Â∫ì">4. aspectjweaverÔºàAspectJ Â∫ìÔºâ</a></li>
            <li><a href="#‰∏∫‰ªÄ‰πàÈúÄË¶ÅËøô‰∫õÂ∫ì">‰∏∫‰ªÄ‰πàÈúÄË¶ÅËøô‰∫õÂ∫ìÔºü</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#applicationyml-Êñá‰ª∂‰ΩúÁî®‰∏éÂ∏∏ËßÅÈÖçÁΩÆÈ°πËØ¶Ëß£">application.yml Êñá‰ª∂‰ΩúÁî®‰∏éÂ∏∏ËßÅÈÖçÁΩÆÈ°πËØ¶Ëß£</a>
      <ol>
        <li><a href="#1-ÊúçÂä°Âô®ÈÖçÁΩÆserver">1. ÊúçÂä°Âô®ÈÖçÁΩÆÔºàserverÔºâ</a></li>
        <li><a href="#2-Êñá‰ª∂‰∏ä‰º†ÈÖçÁΩÆspringservletmultipart">2. Êñá‰ª∂‰∏ä‰º†ÈÖçÁΩÆÔºàspring.servlet.multipartÔºâ</a></li>
        <li><a href="#3-Â∫îÁî®ÂêçÁß∞springapplicationname">3. Â∫îÁî®ÂêçÁß∞Ôºàspring.application.nameÔºâ</a></li>
        <li><a href="#4-Êï∞ÊçÆÂ∫ìÈÖçÁΩÆspringdatasource">4. Êï∞ÊçÆÂ∫ìÈÖçÁΩÆÔºàspring.datasourceÔºâ</a></li>
        <li><a href="#5-redis-ÈÖçÁΩÆspringredis">5. Redis ÈÖçÁΩÆÔºàspring.redisÔºâ</a></li>
        <li><a href="#6-mybatis-ÈÖçÁΩÆmybatis">6. MyBatis ÈÖçÁΩÆÔºàmybatisÔºâ</a></li>
        <li><a href="#7-Ëá™ÂÆö‰πâÈÖçÁΩÆprojectlogadmin">7. Ëá™ÂÆö‰πâÈÖçÁΩÆÔºàproject„ÄÅlog„ÄÅadminÔºâ</a></li>
        <li><a href="#ÊÄªÁªì">ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#hikaricp-‰ªãÁªç">HikariCP ‰ªãÁªç</a>
      <ol>
        <li><a href="#1-‰∏∫‰ªÄ‰πàÈÄâÊã©-hikaricp">1. ‰∏∫‰ªÄ‰πàÈÄâÊã© HikariCPÔºü</a></li>
        <li><a href="#2-hikaricp-Ê†∏ÂøÉÈÖçÁΩÆÂèÇÊï∞">2. HikariCP Ê†∏ÂøÉÈÖçÁΩÆÂèÇÊï∞</a>
          <ol>
            <li><a href="#ÂÖ≥ÈîÆÂèÇÊï∞ËØ¥Êòé">ÂÖ≥ÈîÆÂèÇÊï∞ËØ¥Êòé</a></li>
          </ol>
        </li>
        <li><a href="#3-hikaricp-ÁöÑ‰ºòÂäø">3. HikariCP ÁöÑ‰ºòÂäø</a></li>
        <li><a href="#4-Â∏∏ËßÅÈóÆÈ¢ò">4. Â∏∏ËßÅÈóÆÈ¢ò</a></li>
        <li><a href="#5-ÊÄªÁªì">5. ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#jdbc-ËøûÊé•Ê±†connection-poolËØ¶Ëß£">JDBC ËøûÊé•Ê±†ÔºàConnection PoolÔºâËØ¶Ëß£</a>
      <ol>
        <li><a href="#1-‰∏∫‰ªÄ‰πàÈúÄË¶ÅËøûÊé•Ê±†">1. ‰∏∫‰ªÄ‰πàÈúÄË¶ÅËøûÊé•Ê±†Ôºü</a></li>
        <li><a href="#2-ËøûÊé•Ê±†ÁöÑÊ†∏ÂøÉÂ∑•‰ΩúÂéüÁêÜ">2. ËøûÊé•Ê±†ÁöÑÊ†∏ÂøÉÂ∑•‰ΩúÂéüÁêÜ</a></li>
        <li><a href="#3-Â∏∏ËßÅ-jdbc-ËøûÊé•Ê±†ÂØπÊØî">3. Â∏∏ËßÅ JDBC ËøûÊé•Ê±†ÂØπÊØî</a></li>
        <li><a href="#4-‰ª£Á†ÅÁ§∫‰æãspring-boot--hikaricp">4. ‰ª£Á†ÅÁ§∫‰æãÔºàSpring Boot + HikariCPÔºâ</a></li>
        <li><a href="#5-ÊÄªÁªì-1">5. ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#springboot-ÂêØÂä®Á±ªeasylivewebrunapplication-ËØ¶Ëß£">SpringBoot ÂêØÂä®Á±ª‚Äî‚ÄîEasyLiveWebRunApplication ËØ¶Ëß£</a>
      <ol>
        <li><a href="#1-springbootapplication">1. @SpringBootApplication</a></li>
        <li><a href="#2-mapperscan">2. @MapperScan</a></li>
        <li><a href="#3-enabletransactionmanagement">3. @EnableTransactionManagement</a></li>
        <li><a href="#4-enablescheduling">4. @EnableScheduling</a></li>
        <li><a href="#5-main-ÊñπÊ≥ï">5. main ÊñπÊ≥ï</a></li>
        <li><a href="#6-ÊéíÈô§Ëá™Âä®ÈÖçÁΩÆÊú™‰ΩøÁî®‰ΩÜÈúÄÊ≥®ÊÑè">6. ÊéíÈô§Ëá™Âä®ÈÖçÁΩÆÔºàÊú™‰ΩøÁî®‰ΩÜÈúÄÊ≥®ÊÑèÔºâ</a></li>
        <li><a href="#ÊÄªÁªìÊ†∏ÂøÉÂäüËÉΩ">ÊÄªÁªìÔºöÊ†∏ÂøÉÂäüËÉΩ</a>
          <ol>
            <li><a href="#Ë°•ÂÖÖËØ¥Êòé-1">Ë°•ÂÖÖËØ¥Êòé</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#httpservletrequesthttpservletresponsehttpsession-‰ªãÁªç">HttpServletRequest„ÄÅHttpServletResponse„ÄÅHttpSession ‰ªãÁªç</a>
      <ol>
        <li><a href="#1-httpservletrequestËØ∑Ê±ÇÂØπË±°">1. HttpServletRequestÔºàËØ∑Ê±ÇÂØπË±°Ôºâ</a></li>
        <li><a href="#2-httpservletresponseÂìçÂ∫îÂØπË±°">2. HttpServletResponseÔºàÂìçÂ∫îÂØπË±°Ôºâ</a></li>
        <li><a href="#3-httpsession‰ºöËØùÂØπË±°">3. HttpSessionÔºà‰ºöËØùÂØπË±°Ôºâ</a></li>
        <li><a href="#4-‰∏âËÄÖÁöÑÂÖ≥Á≥ª">4. ‰∏âËÄÖÁöÑÂÖ≥Á≥ª</a></li>
        <li><a href="#5-Âú®-spring-mvc-‰∏≠ÁöÑÁÆÄÂåñÁî®Ê≥ï">5. Âú® Spring MVC ‰∏≠ÁöÑÁÆÄÂåñÁî®Ê≥ï</a></li>
        <li><a href="#6-ÊÄªÁªì">6. ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#Ëé∑Âèñ-httpservletrequest-ÂØπË±°ÁöÑ‰∏§ÁßçÊñπÂºè">Ëé∑Âèñ HttpServletRequest ÂØπË±°ÁöÑ‰∏§ÁßçÊñπÂºè</a>
      <ol>
        <li><a href="#1-ÈÄöËøáÊñπÊ≥ïÂèÇÊï∞Áõ¥Êé•Ê≥®ÂÖ•spring-mvc-Êé®Ëçê">1. ÈÄöËøáÊñπÊ≥ïÂèÇÊï∞Áõ¥Êé•Ê≥®ÂÖ•ÔºàSpring MVC Êé®ËçêÔºâ</a></li>
        <li><a href="#2-ÈÄöËøá-requestcontextholder-Â∑•ÂÖ∑Á±ªËé∑Âèñ">2. ÈÄöËøá RequestContextHolder Â∑•ÂÖ∑Á±ªËé∑Âèñ</a></li>
      </ol>
    </li>
    <li><a href="#tokenuserinfodto-‰∏≠-jsonignoreproperties-Âíå-serializable-ÁöÑ‰ΩúÁî®">TokenUserInfoDto ‰∏≠ @JsonIgnoreProperties Âíå Serializable ÁöÑ‰ΩúÁî®</a>
      <ol>
        <li><a href="#1-jsonignorepropertiesignoreunknown--true">1. @JsonIgnoreProperties(ignoreUnknown = true)</a></li>
        <li><a href="#2-implements-serializable">2. implements Serializable</a></li>
        <li><a href="#3-ÂÖ∂‰ªñ‰ª£Á†ÅËØ¥Êòé">3. ÂÖ∂‰ªñ‰ª£Á†ÅËØ¥Êòé</a></li>
        <li><a href="#ÊÄªÁªì-1">ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#ÊúçÂä°Á´ØÊìç‰Ωú-cookie-ÁöÑÂÆåÊï¥ÊµÅÁ®ãÁªìÂêàÊ°à‰æãËß£Êûê">ÊúçÂä°Á´ØÊìç‰Ωú Cookie ÁöÑÂÆåÊï¥ÊµÅÁ®ãÔºàÁªìÂêàÊ°à‰æãËß£ÊûêÔºâ</a>
      <ol>
        <li><a href="#1-‰ª£Á†ÅÈÄêË°åËß£Êûê">1. ‰ª£Á†ÅÈÄêË°åËß£Êûê</a></li>
        <li><a href="#2-ÂÖ≥ÈîÆÊìç‰ΩúËØ¥Êòé">2. ÂÖ≥ÈîÆÊìç‰ΩúËØ¥Êòé</a></li>
        <li><a href="#3-ÂÆåÊï¥Ê°à‰æãÂú∫ÊôØ">3. ÂÆåÊï¥Ê°à‰æãÂú∫ÊôØ</a></li>
        <li><a href="#4-ÊµèËßàÂô®‰∏éÊúçÂä°Âô®ÁöÑ‰∫§‰∫íÊµÅÁ®ã">4. ÊµèËßàÂô®‰∏éÊúçÂä°Âô®ÁöÑ‰∫§‰∫íÊµÅÁ®ã</a></li>
        <li><a href="#5-ÂÖ≥ÈîÆÊ≥®ÊÑè‰∫ãÈ°π">5. ÂÖ≥ÈîÆÊ≥®ÊÑè‰∫ãÈ°π</a></li>
        <li><a href="#6-ÊÄªÁªì-1">6. ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#appinterceptor-Âíå-webappconfigurer-Âü∫‰∫é-token-ÁöÑËØ∑Ê±ÇÊã¶Êà™È™åËØÅÊú∫Âà∂">AppInterceptor Âíå WebAppConfigurer Âü∫‰∫é Token ÁöÑËØ∑Ê±ÇÊã¶Êà™È™åËØÅÊú∫Âà∂</a>
      <ol>
        <li><a href="#1-appinterceptorÊ†∏ÂøÉÊã¶Êà™Âô®Á±ª">1. AppInterceptorÔºàÊ†∏ÂøÉÊã¶Êà™Âô®Á±ªÔºâ</a></li>
        <li><a href="#2-webappconfigurerÊã¶Êà™Âô®ÈÖçÁΩÆÁ±ª">2. WebAppConfigurerÔºàÊã¶Êà™Âô®ÈÖçÁΩÆÁ±ªÔºâ</a></li>
        <li><a href="#3-Âçè‰ΩúÊµÅÁ®ã">3. Âçè‰ΩúÊµÅÁ®ã</a></li>
        <li><a href="#4-ËÆæËÆ°‰∫ÆÁÇπ">4. ËÆæËÆ°‰∫ÆÁÇπ</a></li>
        <li><a href="#5-ÂÖ∏ÂûãÂ∫îÁî®Âú∫ÊôØ">5. ÂÖ∏ÂûãÂ∫îÁî®Âú∫ÊôØ</a></li>
        <li><a href="#ÊÄªÁªì-2">ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#‰∏∫‰ªÄ‰πàÊñá‰ª∂ËØ∑Ê±ÇÂíåÂÖ∂‰ªñËØ∑Ê±ÇÂàÜÂºÄÂ§ÑÁêÜ-token-ÁöÑËé∑ÂèñÊñπÂºè">‰∏∫‰ªÄ‰πàÊñá‰ª∂ËØ∑Ê±ÇÂíåÂÖ∂‰ªñËØ∑Ê±ÇÂàÜÂºÄÂ§ÑÁêÜ Token ÁöÑËé∑ÂèñÊñπÂºèÔºü</a>
      <ol>
        <li><a href="#1-ÊäÄÊúØÈôêÂà∂ÊµèËßàÂô®ÂØπÊñá‰ª∂ËØ∑Ê±ÇÁöÑ-header-Â§ÑÁêÜ">1. ÊäÄÊúØÈôêÂà∂ÔºöÊµèËßàÂô®ÂØπÊñá‰ª∂ËØ∑Ê±ÇÁöÑ Header Â§ÑÁêÜ</a></li>
        <li><a href="#2-ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÁ§∫‰æã">2. ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÁ§∫‰æã</a></li>
      </ol>
    </li>
    <li><a href="#savecategory-ÊñπÊ≥ï‰∏≠ÁöÑ-if-Âà§Êñ≠ÂØπÂ∫îÂ¢ûÂä†Âíå‰øÆÊîπËØ¶Ëß£">saveCategory ÊñπÊ≥ï‰∏≠ÁöÑ if Âà§Êñ≠ÔºàÂØπÂ∫îÂ¢ûÂä†Âíå‰øÆÊîπÔºâËØ¶Ëß£</a>
      <ol>
        <li><a href="#1-Âà§Êñ≠Êù°‰ª∂ÂàÜËß£">1. Âà§Êñ≠Êù°‰ª∂ÂàÜËß£</a></li>
        <li><a href="#2-Âú∫ÊôØ1Êñ∞Â¢ûÂàÜÁ±ªÊó∂ÁöÑÊ£ÄÊü•">2. Âú∫ÊôØ1ÔºöÊñ∞Â¢ûÂàÜÁ±ªÊó∂ÁöÑÊ£ÄÊü•</a></li>
        <li><a href="#3-Âú∫ÊôØ2‰øÆÊîπÂàÜÁ±ªÊó∂ÁöÑÊ£ÄÊü•">3. Âú∫ÊôØ2Ôºö‰øÆÊîπÂàÜÁ±ªÊó∂ÁöÑÊ£ÄÊü•</a></li>
        <li><a href="#4-‰∏∫‰ªÄ‰πàÈúÄË¶Å‰∏§‰∏™Âú∫ÊôØÂàÜÂºÄÂà§Êñ≠">4. ‰∏∫‰ªÄ‰πàÈúÄË¶Å‰∏§‰∏™Âú∫ÊôØÂàÜÂºÄÂà§Êñ≠Ôºü</a></li>
        <li><a href="#5-ÈÄªËæë‰ºòÂåñÂª∫ËÆÆ">5. ÈÄªËæë‰ºòÂåñÂª∫ËÆÆ</a></li>
        <li><a href="#6-ÊÄªÁªì-2">6. ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#filetransfertonew-filefilepath-‰ª£Á†ÅËß£Êûê">file.transferTo(new File(filePath)) ‰ª£Á†ÅËß£Êûê</a>
      <ol>
        <li><a href="#ËØ¶ÁªÜÊâßË°åÊµÅÁ®ã">ËØ¶ÁªÜÊâßË°åÊµÅÁ®ã</a></li>
        <li><a href="#ÂÖ≥ÈîÆÊ≥®ÊÑè‰∫ãÈ°π">ÂÖ≥ÈîÆÊ≥®ÊÑè‰∫ãÈ°π</a></li>
        <li><a href="#Á§∫‰æãÂÆåÊï¥ÂÆâÂÖ®Áâà‰ª£Á†Å">Á§∫‰æãÔºöÂÆåÊï¥ÂÆâÂÖ®Áâà‰ª£Á†Å</a></li>
        <li><a href="#Â∏∏ËßÅÈóÆÈ¢òËß£Á≠î">Â∏∏ËßÅÈóÆÈ¢òËß£Á≠î</a></li>
      </ol>
    </li>
    <li><a href="#ÂàÜÁâá‰∏ä‰º†ËßÜÈ¢ëÊñá‰ª∂-uploadvideo-ÊñπÊ≥ïËØ¶Ëß£">ÂàÜÁâá‰∏ä‰º†ËßÜÈ¢ëÊñá‰ª∂ uploadVideo ÊñπÊ≥ïËØ¶Ëß£</a>
      <ol>
        <li><a href="#1-ÊñπÊ≥ïÁ≠æÂêç">1. ÊñπÊ≥ïÁ≠æÂêç</a></li>
        <li><a href="#2-Áî®Êà∑Ë∫´‰ªΩÈ™åËØÅ">2. Áî®Êà∑Ë∫´‰ªΩÈ™åËØÅ</a></li>
        <li><a href="#3-Ê£ÄÊü•‰∏ä‰º†‰ªªÂä°ÊòØÂê¶Â≠òÂú®">3. Ê£ÄÊü•‰∏ä‰º†‰ªªÂä°ÊòØÂê¶Â≠òÂú®</a></li>
        <li><a href="#4-Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞èÈôêÂà∂">4. Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞èÈôêÂà∂</a></li>
        <li><a href="#5-Ê£ÄÊü•ÂàÜÁâáÂ∫èÂè∑ÂêàÊ≥ïÊÄß">5. Ê£ÄÊü•ÂàÜÁâáÂ∫èÂè∑ÂêàÊ≥ïÊÄß</a></li>
        <li><a href="#6-‰øùÂ≠òÂàÜÁâáÊñá‰ª∂">6. ‰øùÂ≠òÂàÜÁâáÊñá‰ª∂</a></li>
        <li><a href="#7-Êõ¥Êñ∞‰∏ä‰º†ËøõÂ∫¶">7. Êõ¥Êñ∞‰∏ä‰º†ËøõÂ∫¶</a></li>
        <li><a href="#8-ËøîÂõûÊàêÂäüÂìçÂ∫î">8. ËøîÂõûÊàêÂäüÂìçÂ∫î</a></li>
        <li><a href="#ÂÆåÊï¥ÊµÅÁ®ãÊÄªÁªì">ÂÆåÊï¥ÊµÅÁ®ãÊÄªÁªì</a></li>
        <li><a href="#‰ºòÂåñÂª∫ËÆÆ">‰ºòÂåñÂª∫ËÆÆ</a></li>
      </ol>
    </li>
    <li><a href="#savevideoinfo-ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê">saveVideoInfo ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê</a>
      <ol>
        <li><a href="#1-ÊñπÊ≥ïÊ¶ÇËø∞">1. ÊñπÊ≥ïÊ¶ÇËø∞</a></li>
        <li><a href="#2-ÂàÜpÊï∞Ê†°È™å">2. ÂàÜPÊï∞Ê†°È™å</a></li>
        <li><a href="#3-ËßÜÈ¢ëidÂ≠òÂú®ÊÄßÊ†°È™å">3. ËßÜÈ¢ëIDÂ≠òÂú®ÊÄßÊ†°È™å</a></li>
        <li><a href="#4-ÂàùÂßãÂåñÂèòÈáè">4. ÂàùÂßãÂåñÂèòÈáè</a></li>
        <li><a href="#5-Êñ∞Â¢ûËßÜÈ¢ëÈÄªËæë">5. Êñ∞Â¢ûËßÜÈ¢ëÈÄªËæë</a></li>
        <li><a href="#6-Êõ¥Êñ∞ËßÜÈ¢ëÈÄªËæë">6. Êõ¥Êñ∞ËßÜÈ¢ëÈÄªËæë</a></li>
        <li><a href="#7-Â§ÑÁêÜÂæÖÂà†Èô§Êñá‰ª∂">7. Â§ÑÁêÜÂæÖÂà†Èô§Êñá‰ª∂</a></li>
        <li><a href="#8-Â§ÑÁêÜÊñá‰ª∂Á¥¢ÂºïÂíåÊñ∞Â¢ûÊñá‰ª∂">8. Â§ÑÁêÜÊñá‰ª∂Á¥¢ÂºïÂíåÊñ∞Â¢ûÊñá‰ª∂</a></li>
        <li><a href="#9-Â§ÑÁêÜÊñ∞Â¢ûÊñá‰ª∂‰º†Ëæì">9. Â§ÑÁêÜÊñ∞Â¢ûÊñá‰ª∂‰º†Ëæì</a></li>
        <li><a href="#ÊñπÊ≥ïÊÄªÁªì">ÊñπÊ≥ïÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#savevideoinfo-ÊñπÊ≥ï‰∏≠-stream-ÁöÑËØ¶ÁªÜÁî®Ê≥ïËß£Êûê">saveVideoInfo ÊñπÊ≥ï‰∏≠ stream() ÁöÑËØ¶ÁªÜÁî®Ê≥ïËß£Êûê</a>
      <ol>
        <li><a href="#1-Â∞Ü‰∏ä‰º†Êñá‰ª∂ÂàóË°®ËΩ¨‰∏∫-map">1. Â∞Ü‰∏ä‰º†Êñá‰ª∂ÂàóË°®ËΩ¨‰∏∫ Map</a></li>
        <li><a href="#2-Á≠õÈÄâÊñ∞Â¢ûÊñá‰ª∂">2. Á≠õÈÄâÊñ∞Â¢ûÊñá‰ª∂</a></li>
        <li><a href="#3-ÊèêÂèñÂæÖÂà†Èô§Êñá‰ª∂ÁöÑ-id-ÂàóË°®">3. ÊèêÂèñÂæÖÂà†Èô§Êñá‰ª∂ÁöÑ ID ÂàóË°®</a></li>
        <li><a href="#4-ÊèêÂèñÂæÖÂà†Èô§Êñá‰ª∂ÁöÑË∑ØÂæÑÂàóË°®">4. ÊèêÂèñÂæÖÂà†Èô§Êñá‰ª∂ÁöÑË∑ØÂæÑÂàóË°®</a></li>
        <li><a href="#stream-api-Ê†∏ÂøÉÊ¶ÇÂøµÊÄªÁªì">Stream API Ê†∏ÂøÉÊ¶ÇÂøµÊÄªÁªì</a></li>
        <li><a href="#‰∏∫‰ªÄ‰πà‰ΩøÁî®-stream-api">‰∏∫‰ªÄ‰πà‰ΩøÁî® Stream APIÔºü</a></li>
        <li><a href="#ÊÄßËÉΩËÄÉËôë">ÊÄßËÉΩËÄÉËôë</a></li>
        <li><a href="#ÂÆåÊï¥ÊµÅÁ®ãÁ§∫‰æã">ÂÆåÊï¥ÊµÅÁ®ãÁ§∫‰æã</a></li>
      </ol>
    </li>
    <li><a href="#mybatis-ÊâπÈáèÊèíÂÖ•ÊàñÊõ¥Êñ∞ËØ≠Âè•-insertorupdatebatch-Ëß£Êûê">MyBatis ÊâπÈáèÊèíÂÖ•ÊàñÊõ¥Êñ∞ËØ≠Âè• insertOrUpdateBatch Ëß£Êûê</a>
      <ol>
        <li><a href="#1-Âü∫Êú¨ÁªìÊûÑ">1. Âü∫Êú¨ÁªìÊûÑ</a></li>
        <li><a href="#2-ÊèíÂÖ•ÈÉ®ÂàÜËØ¶Ëß£">2. ÊèíÂÖ•ÈÉ®ÂàÜËØ¶Ëß£</a></li>
        <li><a href="#3-ÂÜ≤Á™ÅÊõ¥Êñ∞ÈÉ®ÂàÜËØ¶Ëß£">3. ÂÜ≤Á™ÅÊõ¥Êñ∞ÈÉ®ÂàÜËØ¶Ëß£</a></li>
        <li><a href="#4-ÂÆåÊï¥ÈÄªËæëÊµÅÁ®ã">4. ÂÆåÊï¥ÈÄªËæëÊµÅÁ®ã</a></li>
        <li><a href="#5-ÂÆûÈôÖÊâßË°åÁ§∫‰æã">5. ÂÆûÈôÖÊâßË°åÁ§∫‰æã</a></li>
        <li><a href="#6-ËÆæËÆ°ËÄÉËôë">6. ËÆæËÆ°ËÄÉËôë</a></li>
        <li><a href="#7-‰ΩøÁî®Âú∫ÊôØ">7. ‰ΩøÁî®Âú∫ÊôØ</a></li>
        <li><a href="#8-Ê≥®ÊÑè‰∫ãÈ°π">8. Ê≥®ÊÑè‰∫ãÈ°π</a></li>
      </ol>
    </li>
    <li><a href="#transfervideofile-ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê">transferVideoFile ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê</a>
      <ol>
        <li><a href="#ÊñπÊ≥ïÊ¶ÇËø∞">ÊñπÊ≥ïÊ¶ÇËø∞</a></li>
        <li><a href="#1-ÂàùÂßãÂåñ‰∏éÂáÜÂ§á">1. ÂàùÂßãÂåñ‰∏éÂáÜÂ§á</a></li>
        <li><a href="#2-Êñá‰ª∂ËΩ¨Áßª‰∏éÂ§ÑÁêÜ">2. Êñá‰ª∂ËΩ¨Áßª‰∏éÂ§ÑÁêÜ</a></li>
        <li><a href="#3-Ëé∑ÂèñËßÜÈ¢ë‰ø°ÊÅØ">3. Ëé∑ÂèñËßÜÈ¢ë‰ø°ÊÅØ</a></li>
        <li><a href="#4-ÂºÇÂ∏∏Â§ÑÁêÜ">4. ÂºÇÂ∏∏Â§ÑÁêÜ</a></li>
        <li><a href="#5-Áä∂ÊÄÅÊõ¥Êñ∞‰∏éÊ£ÄÊü•">5. Áä∂ÊÄÅÊõ¥Êñ∞‰∏éÊ£ÄÊü•</a></li>
        <li><a href="#Áä∂ÊÄÅÊûö‰∏æËØ¥Êòé">Áä∂ÊÄÅÊûö‰∏æËØ¥Êòé</a></li>
        <li><a href="#ÊñπÊ≥ïÊµÅÁ®ãÂõæ">ÊñπÊ≥ïÊµÅÁ®ãÂõæ</a></li>
        <li><a href="#ÂÖ≥ÈîÆÁÇπÊÄªÁªì">ÂÖ≥ÈîÆÁÇπÊÄªÁªì</a></li>
        <li><a href="#‰ºòÂåñÁÇπ">‰ºòÂåñÁÇπ</a></li>
      </ol>
    </li>
    <li><a href="#convertvideo2ts-Âíå-union-ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê">convertVideo2Ts Âíå union ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê</a>
      <ol>
        <li><a href="#1-convertvideo2ts-ÊñπÊ≥ïËß£Êûê">1. convertVideo2Ts ÊñπÊ≥ïËß£Êûê</a></li>
        <li><a href="#2-union-ÊñπÊ≥ïËß£Êûê">2. union ÊñπÊ≥ïËß£Êûê</a></li>
        <li><a href="#3-‰∏§‰∏™ÊñπÊ≥ïÁöÑÂçè‰ΩúÂÖ≥Á≥ª">3. ‰∏§‰∏™ÊñπÊ≥ïÁöÑÂçè‰ΩúÂÖ≥Á≥ª</a></li>
        <li><a href="#4-ËÆæËÆ°ËÄÉËôë">4. ËÆæËÆ°ËÄÉËôë</a></li>
        <li><a href="#5-ÂÖ∏Âûã‰ΩøÁî®Âú∫ÊôØ">5. ÂÖ∏Âûã‰ΩøÁî®Âú∫ÊôØ</a></li>
        <li><a href="#6-ÊΩúÂú®‰ºòÂåñÁÇπ">6. ÊΩúÂú®‰ºòÂåñÁÇπ</a></li>
      </ol>
    </li>
    <li><a href="#auditvideo-ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê">auditVideo ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê</a>
      <ol>
        <li><a href="#1-ÊñπÊ≥ïÊ¶ÇËø∞-1">1. ÊñπÊ≥ïÊ¶ÇËø∞</a></li>
        <li><a href="#2-ÊñπÊ≥ïÊµÅÁ®ãËØ¶Ëß£">2. ÊñπÊ≥ïÊµÅÁ®ãËØ¶Ëß£</a>
          <ol>
            <li><a href="#21-Áä∂ÊÄÅÈ™åËØÅ">2.1 Áä∂ÊÄÅÈ™åËØÅ</a></li>
            <li><a href="#22-Êõ¥Êñ∞ËßÜÈ¢ëÁä∂ÊÄÅÂ∏¶Êù°‰ª∂">2.2 Êõ¥Êñ∞ËßÜÈ¢ëÁä∂ÊÄÅÔºàÂ∏¶Êù°‰ª∂Ôºâ</a></li>
            <li><a href="#23-Êõ¥Êñ∞ÂÖ≥ËÅîÊñá‰ª∂Áä∂ÊÄÅ">2.3 Êõ¥Êñ∞ÂÖ≥ËÅîÊñá‰ª∂Áä∂ÊÄÅ</a></li>
            <li><a href="#24-Â§ÑÁêÜÂÆ°Ê†∏‰∏çÈÄöËøáÊÉÖÂÜµ">2.4 Â§ÑÁêÜÂÆ°Ê†∏‰∏çÈÄöËøáÊÉÖÂÜµ</a></li>
            <li><a href="#25-È¶ñÊ¨°ÂèëÂ∏ÉÂ•ñÂä±ÁßØÂàÜ">2.5 È¶ñÊ¨°ÂèëÂ∏ÉÂ•ñÂä±ÁßØÂàÜ</a></li>
            <li><a href="#26-ÂêåÊ≠•Êï∞ÊçÆÂà∞Ê≠£ÂºèË°®">2.6 ÂêåÊ≠•Êï∞ÊçÆÂà∞Ê≠£ÂºèË°®</a></li>
            <li><a href="#27-Ê∏ÖÁêÜÂæÖÂà†Èô§Êñá‰ª∂">2.7 Ê∏ÖÁêÜÂæÖÂà†Èô§Êñá‰ª∂</a></li>
            <li><a href="#28-ÂêåÊ≠•Âà∞ÊêúÁ¥¢ÂºïÊìé">2.8 ÂêåÊ≠•Âà∞ÊêúÁ¥¢ÂºïÊìé</a></li>
          </ol>
        </li>
        <li><a href="#3-Áä∂ÊÄÅÊú∫ËÆæËÆ°">3. Áä∂ÊÄÅÊú∫ËÆæËÆ°</a></li>
        <li><a href="#4-Êï∞ÊçÆË°®ËÆæËÆ°ÂàÜÊûê">4. Êï∞ÊçÆË°®ËÆæËÆ°ÂàÜÊûê</a></li>
        <li><a href="#5-ÂºÇÂ∏∏Â§ÑÁêÜËÆæËÆ°">5. ÂºÇÂ∏∏Â§ÑÁêÜËÆæËÆ°</a></li>
        <li><a href="#6-ÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ">6. ÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ</a></li>
        <li><a href="#7-ÊÄªÁªì">7. ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#mysql‰∏≠left-join‰∏éinner-joinÁöÑ‰ΩøÁî®Âú∫ÊôØ">MySQL‰∏≠LEFT JOIN‰∏éINNER JOINÁöÑ‰ΩøÁî®Âú∫ÊôØ</a>
      <ol>
        <li><a href="#Ê†∏ÂøÉÂå∫Âà´">Ê†∏ÂøÉÂå∫Âà´</a></li>
        <li><a href="#inner-joinÂÜÖËøûÊé•‰ΩøÁî®Âú∫ÊôØ">INNER JOINÔºàÂÜÖËøûÊé•Ôºâ‰ΩøÁî®Âú∫ÊôØ</a>
          <ol>
            <li><a href="#1-ÈúÄË¶Å‰∏•Ê†ºÂåπÈÖçÂÖ≥Á≥ªÁöÑÊü•ËØ¢">1. ÈúÄË¶Å‰∏•Ê†ºÂåπÈÖçÂÖ≥Á≥ªÁöÑÊü•ËØ¢</a></li>
            <li><a href="#2-Â§öË°®ÂÖ≥ËÅî‰∏îÈúÄË¶ÅÊâÄÊúâË°®ÈÉΩÊúâÂåπÈÖç">2. Â§öË°®ÂÖ≥ËÅî‰∏îÈúÄË¶ÅÊâÄÊúâË°®ÈÉΩÊúâÂåπÈÖç</a></li>
            <li><a href="#3-ÊÄßËÉΩ‰ºòÂÖàÁöÑÊü•ËØ¢">3. ÊÄßËÉΩ‰ºòÂÖàÁöÑÊü•ËØ¢</a></li>
          </ol>
        </li>
        <li><a href="#left-joinÂ∑¶ËøûÊé•‰ΩøÁî®Âú∫ÊôØ">LEFT JOINÔºàÂ∑¶ËøûÊé•Ôºâ‰ΩøÁî®Âú∫ÊôØ</a>
          <ol>
            <li><a href="#1-ÈúÄË¶ÅÂåÖÂê´Â∑¶Ë°®ÊâÄÊúâËÆ∞ÂΩïÁöÑÊü•ËØ¢">1. ÈúÄË¶ÅÂåÖÂê´Â∑¶Ë°®ÊâÄÊúâËÆ∞ÂΩïÁöÑÊü•ËØ¢</a></li>
            <li><a href="#2-Ê£ÄÊµãÁº∫Â§±Êï∞ÊçÆÁöÑÊü•ËØ¢">2. Ê£ÄÊµãÁº∫Â§±Êï∞ÊçÆÁöÑÊü•ËØ¢</a></li>
            <li><a href="#3-ÂàÜÁ∫ßÊï∞ÊçÆÊü•ËØ¢">3. ÂàÜÁ∫ßÊï∞ÊçÆÊü•ËØ¢</a></li>
          </ol>
        </li>
        <li><a href="#ÈÄâÊã©‰æùÊçÆ">ÈÄâÊã©‰æùÊçÆ</a></li>
        <li><a href="#ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ">ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ</a></li>
        <li><a href="#ÂÆûÈôÖÊ°à‰æãÂØπÊØî">ÂÆûÈôÖÊ°à‰æãÂØπÊØî</a></li>
        <li><a href="#ÊÄªÁªì-3">ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#Ë∑®Á≥ªÁªü‰∫ãÂä°Â§ÑÁêÜÁ≠ñÁï•">Ë∑®Á≥ªÁªü‰∫ãÂä°Â§ÑÁêÜÁ≠ñÁï•</a>
      <ol>
        <li><a href="#ÊâßË°åÈ°∫Â∫èÂª∫ËÆÆÂÖàÊú¨Âú∞ÂêéËøúÁ®ã">ÊâßË°åÈ°∫Â∫èÂª∫ËÆÆÔºöÂÖàÊú¨Âú∞ÂêéËøúÁ®ã</a></li>
        <li><a href="#Ë∂ÖÊó∂Â§ÑÁêÜÊñπÊ°à">Ë∂ÖÊó∂Â§ÑÁêÜÊñπÊ°à</a>
          <ol>
            <li><a href="#1-Êú¨Âú∞‰∫ãÂä°ÂºÇÊ≠•ÈÄöÁü•Êé®Ëçê">1. Êú¨Âú∞‰∫ãÂä°+ÂºÇÊ≠•ÈÄöÁü•ÔºàÊé®ËçêÔºâ</a></li>
            <li><a href="#2-‰∏§Èò∂ÊÆµÊèê‰∫§Ê®°Âºè">2. ‰∏§Èò∂ÊÆµÊèê‰∫§Ê®°Âºè</a></li>
          </ol>
        </li>
        <li><a href="#Ë∂ÖÊó∂ÂÖ∑‰ΩìÂ§ÑÁêÜÁ≠ñÁï•">Ë∂ÖÊó∂ÂÖ∑‰ΩìÂ§ÑÁêÜÁ≠ñÁï•</a>
          <ol>
            <li><a href="#1-Áü≠Ë∂ÖÊó∂Âø´ÈÄüÂ§±Ë¥•">1. Áü≠Ë∂ÖÊó∂+Âø´ÈÄüÂ§±Ë¥•</a></li>
            <li><a href="#2-ÈáçËØïÊú∫Âà∂">2. ÈáçËØïÊú∫Âà∂</a></li>
            <li><a href="#3-Ë°•ÂÅø‰∫ãÂä°">3. Ë°•ÂÅø‰∫ãÂä°</a></li>
          </ol>
        </li>
        <li><a href="#Êû∂ÊûÑËÆæËÆ°Âª∫ËÆÆ">Êû∂ÊûÑËÆæËÆ°Âª∫ËÆÆ</a>
          <ol>
            <li><a href="#ÊúÄÁªà‰∏ÄËá¥ÊÄßÊ®°Âºè">ÊúÄÁªà‰∏ÄËá¥ÊÄßÊ®°Âºè</a></li>
            <li><a href="#ÊúçÂä°ÈôçÁ∫ßÊñπÊ°à">ÊúçÂä°ÈôçÁ∫ßÊñπÊ°à</a></li>
            <li><a href="#ÁõëÊéßÊåáÊ†á">ÁõëÊéßÊåáÊ†á</a></li>
          </ol>
        </li>
        <li><a href="#ÂÜ≥Á≠ñÊµÅÁ®ãÂõæ">ÂÜ≥Á≠ñÊµÅÁ®ãÂõæ</a></li>
        <li><a href="#ÊÄªÁªìÂª∫ËÆÆ">ÊÄªÁªìÂª∫ËÆÆ</a></li>
      </ol>
    </li>
    <li><a href="#ÂÖ≥‰∫éspring‰∫ãÂä°ÂÜÖÈÉ®Ë∞ÉÁî®ÁöÑÈóÆÈ¢ò">ÂÖ≥‰∫éSpring‰∫ãÂä°ÂÜÖÈÉ®Ë∞ÉÁî®ÁöÑÈóÆÈ¢ò</a>
      <ol>
        <li>
          <ol>
            <li><a href="#1-ÊñπÊ≥ïÂÜÖÈÉ®Ë∞ÉÁî®ÊúÄÂ∏∏ËßÅ">1. ÊñπÊ≥ïÂÜÖÈÉ®Ë∞ÉÁî®ÔºàÊúÄÂ∏∏ËßÅÔºâ</a></li>
            <li><a href="#2-‰∫ãÂä°ÊñπÊ≥ï‰∏çÊòØpublic">2. ‰∫ãÂä°ÊñπÊ≥ï‰∏çÊòØpublic</a></li>
            <li><a href="#3-ÂºÇÂ∏∏Ë¢´ÊçïËé∑Êú™ÊäõÂá∫">3. ÂºÇÂ∏∏Ë¢´ÊçïËé∑Êú™ÊäõÂá∫</a></li>
            <li><a href="#4-ÂºÇÂ∏∏Á±ªÂûã‰∏çÂåπÈÖç">4. ÂºÇÂ∏∏Á±ªÂûã‰∏çÂåπÈÖç</a></li>
            <li><a href="#5-Â§öÁ∫øÁ®ãË∞ÉÁî®">5. Â§öÁ∫øÁ®ãË∞ÉÁî®</a></li>
            <li><a href="#6-Êï∞ÊçÆÂ∫ìÂºïÊìé‰∏çÊîØÊåÅ‰∫ãÂä°">6. Êï∞ÊçÆÂ∫ìÂºïÊìé‰∏çÊîØÊåÅ‰∫ãÂä°</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#ËßÜÈ¢ëÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°Á≥ªÁªüÂÆûÁé∞ËØ¶Ëß£">ËßÜÈ¢ëÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°Á≥ªÁªüÂÆûÁé∞ËØ¶Ëß£</a>
      <ol>
        <li><a href="#1-Á≥ªÁªüÊû∂ÊûÑÊ¶ÇËø∞">1. Á≥ªÁªüÊû∂ÊûÑÊ¶ÇËø∞</a></li>
        <li><a href="#2-Ê†∏ÂøÉÂÆûÁé∞ÁªÜËäÇ">2. Ê†∏ÂøÉÂÆûÁé∞ÁªÜËäÇ</a>
          <ol>
            <li><a href="#21-Êï∞ÊçÆÁªìÊûÑËÆæËÆ°">2.1 Êï∞ÊçÆÁªìÊûÑËÆæËÆ°</a></li>
            <li><a href="#22-ÂøÉË∑≥‰∏äÊä•ÊµÅÁ®ã">2.2 ÂøÉË∑≥‰∏äÊä•ÊµÅÁ®ã</a></li>
            <li><a href="#23-ËøáÊúüÁõëÂê¨Êú∫Âà∂">2.3 ËøáÊúüÁõëÂê¨Êú∫Âà∂</a></li>
            <li><a href="#24-ËÆ°Êï∞ÈÄíÂáèÈÄªËæë">2.4 ËÆ°Êï∞ÈÄíÂáèÈÄªËæë</a></li>
          </ol>
        </li>
        <li><a href="#3-ÂÖ≥ÈîÆËÆæËÆ°ÂéüÁêÜ">3. ÂÖ≥ÈîÆËÆæËÆ°ÂéüÁêÜ</a></li>
        <li><a href="#4-Á≥ªÁªü‰ºòÂäø">4. Á≥ªÁªü‰ºòÂäø</a></li>
        <li><a href="#5-ÊΩúÂú®‰ºòÂåñÊñπÂêë">5. ÊΩúÂú®‰ºòÂåñÊñπÂêë</a></li>
      </ol>
    </li>
    <li><a href="#websocketÂèäÂÖ∂Âú®Âú®Á∫ø‰∫∫Êï∞ÁªüËÆ°‰∏≠ÁöÑÂ∫îÁî®">WebSocketÂèäÂÖ∂Âú®Âú®Á∫ø‰∫∫Êï∞ÁªüËÆ°‰∏≠ÁöÑÂ∫îÁî®</a>
      <ol>
        <li><a href="#1-websocket-Âü∫Á°Ä‰ªãÁªç">1. WebSocket Âü∫Á°Ä‰ªãÁªç</a></li>
        <li><a href="#2-Âü∫‰∫é-websocket-ÁöÑÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ÂÆûÁé∞">2. Âü∫‰∫é WebSocket ÁöÑÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ÂÆûÁé∞</a>
          <ol>
            <li><a href="#21-ÊúçÂä°Á´ØÂÆûÁé∞spring-boot">2.1 ÊúçÂä°Á´ØÂÆûÁé∞ÔºàSpring BootÔºâ</a></li>
            <li><a href="#22-ÂÆ¢Êà∑Á´ØÂÆûÁé∞javascript">2.2 ÂÆ¢Êà∑Á´ØÂÆûÁé∞ÔºàJavaScriptÔºâ</a></li>
            <li><a href="#23-ÂøÉË∑≥Êú∫Âà∂">2.3 ÂøÉË∑≥Êú∫Âà∂</a></li>
          </ol>
        </li>
        <li><a href="#3-ÊñπÊ°à‰ºòÂäøÂàÜÊûê">3. ÊñπÊ°à‰ºòÂäøÂàÜÊûê</a></li>
        <li><a href="#4-ÈÄÇÁî®Âú∫ÊôØÂª∫ËÆÆ">4. ÈÄÇÁî®Âú∫ÊôØÂª∫ËÆÆ</a></li>
      </ol>
    </li>
    <li><a href="#netty‰∏éËßÜÈ¢ëÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ÁöÑÁªìÂêà">Netty‰∏éËßÜÈ¢ëÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ÁöÑÁªìÂêà</a>
      <ol>
        <li><a href="#1-nettyÂü∫Á°Ä‰ªãÁªç">1. NettyÂü∫Á°Ä‰ªãÁªç</a></li>
        <li><a href="#2-‰∏∫‰ªÄ‰πàÁî®nettyÂÆûÁé∞Âú®Á∫ø‰∫∫Êï∞ÁªüËÆ°">2. ‰∏∫‰ªÄ‰πàÁî®NettyÂÆûÁé∞Âú®Á∫ø‰∫∫Êï∞ÁªüËÆ°Ôºü</a></li>
        <li><a href="#3-Âü∫‰∫énettyÁöÑÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ËÆæËÆ°">3. Âü∫‰∫éNettyÁöÑÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ËÆæËÆ°</a>
          <ol>
            <li><a href="#31-Á≥ªÁªüÊû∂ÊûÑ">3.1 Á≥ªÁªüÊû∂ÊûÑ</a></li>
            <li><a href="#32-Ê†∏ÂøÉÁªÑ‰ª∂ÂÆûÁé∞">3.2 Ê†∏ÂøÉÁªÑ‰ª∂ÂÆûÁé∞</a></li>
          </ol>
        </li>
        <li><a href="#4-‰∏é‰º†ÁªüÊñπÊ°àÁöÑÂØπÊØî">4. ‰∏é‰º†ÁªüÊñπÊ°àÁöÑÂØπÊØî</a></li>
        <li><a href="#5-ÈÄÇÁî®Âú∫ÊôØÂª∫ËÆÆ">5. ÈÄÇÁî®Âú∫ÊôØÂª∫ËÆÆ</a></li>
      </ol>
    </li>
    <li><a href="#netty‰∏éwebsocketÁöÑÂÖ≥Á≥ªÂèäÂú®ÂÆûÊó∂ÁªüËÆ°‰∏≠ÁöÑÂ∫îÁî®">Netty‰∏éWebSocketÁöÑÂÖ≥Á≥ªÂèäÂú®ÂÆûÊó∂ÁªüËÆ°‰∏≠ÁöÑÂ∫îÁî®</a>
      <ol>
        <li><a href="#1-netty‰∏éwebsocketÁöÑÂü∫Á°ÄÂÖ≥Á≥ª">1. Netty‰∏éWebSocketÁöÑÂü∫Á°ÄÂÖ≥Á≥ª</a></li>
        <li><a href="#2-ÊäÄÊúØÊ†àÁªÑÂêàÂéüÁêÜ">2. ÊäÄÊúØÊ†àÁªÑÂêàÂéüÁêÜ</a></li>
        <li><a href="#3-Âú®ËßÜÈ¢ëÂú®Á∫øÁªüËÆ°‰∏≠ÁöÑËÅîÂêàÂÆûÁé∞">3. Âú®ËßÜÈ¢ëÂú®Á∫øÁªüËÆ°‰∏≠ÁöÑËÅîÂêàÂÆûÁé∞</a></li>
        <li><a href="#4-ÂÖ∏ÂûãÊ∂àÊÅØÊµÅÁ®ã">4. ÂÖ∏ÂûãÊ∂àÊÅØÊµÅÁ®ã</a></li>
        <li><a href="#5-‰ºòÂåñÁÇπ">5. ‰ºòÂåñÁÇπ</a></li>
      </ol>
    </li>
    <li><a href="#ËßÜÈ¢ëÂà†Èô§ÊñπÊ≥ïËØ¶Ëß£">ËßÜÈ¢ëÂà†Èô§ÊñπÊ≥ïËØ¶Ëß£</a>
      <ol>
        <li><a href="#1-ÊñπÊ≥ïÊï¥‰ΩìÂäüËÉΩ">1. ÊñπÊ≥ïÊï¥‰ΩìÂäüËÉΩ</a></li>
        <li><a href="#2-ÂºÇÊ≠•Á∫øÁ®ãÊ±†ÈÉ®ÂàÜËØ¶Ëß£">2. ÂºÇÊ≠•Á∫øÁ®ãÊ±†ÈÉ®ÂàÜËØ¶Ëß£</a>
          <ol>
            <li><a href="#21-Á∫øÁ®ãÊ±†ÂàùÂßãÂåñ">2.1 Á∫øÁ®ãÊ±†ÂàùÂßãÂåñ</a></li>
            <li><a href="#22-ÂºÇÊ≠•‰ªªÂä°ÊâßË°åÈÄªËæë">2.2 ÂºÇÊ≠•‰ªªÂä°ÊâßË°åÈÄªËæë</a></li>
            <li><a href="#23-ÂºÇÊ≠•‰ªªÂä°ÂÖ∑‰ΩìÊìç‰Ωú">2.3 ÂºÇÊ≠•‰ªªÂä°ÂÖ∑‰ΩìÊìç‰Ωú</a></li>
          </ol>
        </li>
        <li><a href="#3-ÂºÇÊ≠•ËÆæËÆ°‰ºòÁº∫ÁÇπÂàÜÊûê">3. ÂºÇÊ≠•ËÆæËÆ°‰ºòÁº∫ÁÇπÂàÜÊûê</a></li>
        <li><a href="#4-ÊîπËøõÂª∫ËÆÆ">4. ÊîπËøõÂª∫ËÆÆ</a></li>
        <li><a href="#5-ÊÄªÁªì-2">5. ÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#ÂºÇÊ≠•Á∫øÁ®ãÊ±†Âèä-executorserviceexecute-ËØ¶Ëß£">ÂºÇÊ≠•Á∫øÁ®ãÊ±†Âèä executorService.execute ËØ¶Ëß£</a>
      <ol>
        <li><a href="#‰∏ÄÂºÇÊ≠•Á∫øÁ®ãÊ±†Âü∫Á°Ä">‰∏Ä„ÄÅÂºÇÊ≠•Á∫øÁ®ãÊ±†Âü∫Á°Ä</a>
          <ol>
            <li><a href="#1-Á∫øÁ®ãÊ±†Ê†∏ÂøÉÊ¶ÇÂøµ">1. Á∫øÁ®ãÊ±†Ê†∏ÂøÉÊ¶ÇÂøµ</a></li>
            <li><a href="#2-Á∫øÁ®ãÊ±†ÂÖ≥ÈîÆÂèÇÊï∞">2. Á∫øÁ®ãÊ±†ÂÖ≥ÈîÆÂèÇÊï∞</a></li>
            <li><a href="#3-Á∫øÁ®ãÊ±†Â∑•‰ΩúÊµÅÁ®ã">3. Á∫øÁ®ãÊ±†Â∑•‰ΩúÊµÅÁ®ã</a></li>
          </ol>
        </li>
        <li><a href="#‰∫åexecutorserviceexecute-ÊñπÊ≥ïËØ¶Ëß£">‰∫å„ÄÅexecutorService.execute ÊñπÊ≥ïËØ¶Ëß£</a>
          <ol>
            <li><a href="#1-ÊñπÊ≥ïÁ≠æÂêç-1">1. ÊñπÊ≥ïÁ≠æÂêç</a></li>
            <li><a href="#2-Ê†∏ÂøÉÁâπÁÇπ">2. Ê†∏ÂøÉÁâπÁÇπ</a></li>
            <li><a href="#3-ÊâßË°åÊµÅÁ®ã‰∏éÁ§∫‰æã">3. ÊâßË°åÊµÅÁ®ã‰∏éÁ§∫‰æã</a></li>
            <li><a href="#4-execute-‰∏é-submit-Âå∫Âà´">4. execute ‰∏é submit Âå∫Âà´</a></li>
          </ol>
        </li>
        <li><a href="#‰∏âÁ∫øÁ®ãÊ±†ÈÖçÁΩÆ‰ºòÂåñÂª∫ËÆÆ">‰∏â„ÄÅÁ∫øÁ®ãÊ±†ÈÖçÁΩÆ‰ºòÂåñÂª∫ËÆÆ</a>
          <ol>
            <li><a href="#1-ÂΩìÂâçÂÆûÁé∞ÁöÑÊΩúÂú®ÈóÆÈ¢ò">1. ÂΩìÂâçÂÆûÁé∞ÁöÑÊΩúÂú®ÈóÆÈ¢ò</a></li>
            <li><a href="#2-Êé®ËçêÊîπËøõÊñπÊ°à">2. Êé®ËçêÊîπËøõÊñπÊ°à</a></li>
          </ol>
        </li>
        <li><a href="#ÂõõÂºÇÂ∏∏Â§ÑÁêÜÊú∫Âà∂">Âõõ„ÄÅÂºÇÂ∏∏Â§ÑÁêÜÊú∫Âà∂</a>
          <ol>
            <li><a href="#1-ÂΩìÂâçÂÆûÁé∞ÁöÑÂºÇÂ∏∏Â§ÑÁêÜ">1. ÂΩìÂâçÂÆûÁé∞ÁöÑÂºÇÂ∏∏Â§ÑÁêÜ</a></li>
            <li><a href="#2-Â¢ûÂº∫ÂûãÂºÇÂ∏∏Â§ÑÁêÜÊñπÊ°à">2. Â¢ûÂº∫ÂûãÂºÇÂ∏∏Â§ÑÁêÜÊñπÊ°à</a></li>
          </ol>
        </li>
        <li><a href="#‰∫îÊÄßËÉΩÁõëÊéßÂª∫ËÆÆ">‰∫î„ÄÅÊÄßËÉΩÁõëÊéßÂª∫ËÆÆ</a>
          <ol>
            <li><a href="#1-Ê∑ªÂä†Á∫øÁ®ãÊ±†ÁõëÊéß">1. Ê∑ªÂä†Á∫øÁ®ãÊ±†ÁõëÊéß</a></li>
          </ol>
        </li>
        <li><a href="#ÂÖ≠ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÂàÜÊûê">ÂÖ≠„ÄÅÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÂàÜÊûê</a></li>
        <li><a href="#‰∏ÉÊÄªÁªì">‰∏É„ÄÅÊÄªÁªì</a></li>
      </ol>
    </li>
    <li><a href="#elasticsearchÊêúÁ¥¢ÁªÑ‰ª∂ËØ¶Ëß£">ElasticsearchÊêúÁ¥¢ÁªÑ‰ª∂ËØ¶Ëß£</a>
      <ol>
        <li><a href="#‰∏ÄelasticsearchÂü∫Á°Ä‰ªãÁªç">‰∏Ä„ÄÅElasticsearchÂü∫Á°Ä‰ªãÁªç</a></li>
        <li><a href="#‰∫åÁªÑ‰ª∂ÈÖçÁΩÆËß£Êûê">‰∫å„ÄÅÁªÑ‰ª∂ÈÖçÁΩÆËß£Êûê</a></li>
        <li><a href="#‰∏âÊ†∏ÂøÉÊñπÊ≥ïËØ¶Ëß£">‰∏â„ÄÅÊ†∏ÂøÉÊñπÊ≥ïËØ¶Ëß£</a>
          <ol>
            <li><a href="#1-Á¥¢ÂºïÂàùÂßãÂåñÊñπÊ≥ï-createindex">1. Á¥¢ÂºïÂàùÂßãÂåñÊñπÊ≥ï createIndex()</a></li>
            <li><a href="#2-ÊñáÊ°£Êìç‰ΩúÊñπÊ≥ï">2. ÊñáÊ°£Êìç‰ΩúÊñπÊ≥ï</a></li>
            <li><a href="#3-ÊêúÁ¥¢ÊñπÊ≥ï-search">3. ÊêúÁ¥¢ÊñπÊ≥ï search()</a></li>
          </ol>
        </li>
        <li><a href="#ÂõõËÆæËÆ°‰∫ÆÁÇπÂàÜÊûê">Âõõ„ÄÅËÆæËÆ°‰∫ÆÁÇπÂàÜÊûê</a></li>
        <li><a href="#‰∫îÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ">‰∫î„ÄÅÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ</a></li>
        <li><a href="#ÂÖ≠ÂàùÂßãÂåñÊµÅÁ®ãinitrun">ÂÖ≠„ÄÅÂàùÂßãÂåñÊµÅÁ®ãÔºàInitRunÔºâ</a></li>
      </ol>
    </li>
    <li><a href="#javaÂèçÂ∞ÑÊú∫Âà∂ÂèäÂÖ∂Âú®‰ª£Á†Å‰∏≠ÁöÑÂ∫îÁî®">JavaÂèçÂ∞ÑÊú∫Âà∂ÂèäÂÖ∂Âú®‰ª£Á†Å‰∏≠ÁöÑÂ∫îÁî®</a>
      <ol>
        <li><a href="#‰∏ÄÂèçÂ∞ÑÂü∫Á°ÄÊ¶ÇÂøµ">‰∏Ä„ÄÅÂèçÂ∞ÑÂü∫Á°ÄÊ¶ÇÂøµ</a></li>
        <li><a href="#‰∫å‰ª£Á†Å‰∏≠ÁöÑÂèçÂ∞ÑËß£Êûê">‰∫å„ÄÅ‰ª£Á†Å‰∏≠ÁöÑÂèçÂ∞ÑËß£Êûê</a></li>
        <li><a href="#‰∏âÂèçÂ∞ÑÂú®Ê≠§Â§ÑÁöÑÂÖ∑‰Ωì‰ΩúÁî®">‰∏â„ÄÅÂèçÂ∞ÑÂú®Ê≠§Â§ÑÁöÑÂÖ∑‰Ωì‰ΩúÁî®</a></li>
        <li><a href="#ÂõõÂèçÂ∞ÑÁöÑÂ∑•‰ΩúÊµÅÁ®ã">Âõõ„ÄÅÂèçÂ∞ÑÁöÑÂ∑•‰ΩúÊµÅÁ®ã</a></li>
        <li><a href="#‰∫îÂèçÂ∞ÑÁöÑ‰ºòÁº∫ÁÇπ">‰∫î„ÄÅÂèçÂ∞ÑÁöÑ‰ºòÁº∫ÁÇπ</a></li>
        <li><a href="#ÂÖ≠ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ">ÂÖ≠„ÄÅÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ</a></li>
        <li><a href="#‰∏ÉÂú®Ê≠§Âú∫ÊôØ‰∏ãÁöÑÂøÖË¶ÅÊÄßÂàÜÊûê">‰∏É„ÄÅÂú®Ê≠§Âú∫ÊôØ‰∏ãÁöÑÂøÖË¶ÅÊÄßÂàÜÊûê</a></li>
        <li><a href="#ÂÖ´ÂÆåÊï¥ÊµÅÁ®ãÁ§∫‰æã">ÂÖ´„ÄÅÂÆåÊï¥ÊµÅÁ®ãÁ§∫‰æã</a></li>
      </ol>
    </li>
    <li><a href="#aopÈù¢ÂêëÂàáÈù¢ÁºñÁ®ãÂü∫Á°ÄËØ¶Ëß£">AOPÔºàÈù¢ÂêëÂàáÈù¢ÁºñÁ®ãÔºâÂü∫Á°ÄËØ¶Ëß£</a>
      <ol>
        <li><a href="#‰∏ÄaopÊ†∏ÂøÉÊ¶ÇÂøµ">‰∏Ä„ÄÅAOPÊ†∏ÂøÉÊ¶ÇÂøµ</a></li>
        <li><a href="#‰∫åspring-aopÂÆûÁé∞Êú∫Âà∂">‰∫å„ÄÅSpring AOPÂÆûÁé∞Êú∫Âà∂</a>
          <ol>
            <li><a href="#1-‰ª£ÁêÜÊ®°Âºè">1. ‰ª£ÁêÜÊ®°Âºè</a></li>
            <li><a href="#2-ÈÄöÁü•Á±ªÂûã">2. ÈÄöÁü•Á±ªÂûã</a></li>
          </ol>
        </li>
        <li><a href="#‰∏âspring-aopÂÆûÊàò">‰∏â„ÄÅSpring AOPÂÆûÊàò</a>
          <ol>
            <li><a href="#1-Âü∫Êú¨ÈÖçÁΩÆ">1. Âü∫Êú¨ÈÖçÁΩÆ</a></li>
            <li><a href="#2-ÂàáÈù¢ÂÆö‰πâÁ§∫‰æã">2. ÂàáÈù¢ÂÆö‰πâÁ§∫‰æã</a></li>
          </ol>
        </li>
        <li><a href="#ÂõõÂàáÁÇπË°®ËææÂºèËØ≠Ê≥ï">Âõõ„ÄÅÂàáÁÇπË°®ËææÂºèËØ≠Ê≥ï</a>
          <ol>
            <li><a href="#1-Âü∫Êú¨ËØ≠Ê≥ï">1. Âü∫Êú¨ËØ≠Ê≥ï</a></li>
            <li><a href="#2-Â∏∏Áî®Ë°®ËææÂºèÁ§∫‰æã">2. Â∏∏Áî®Ë°®ËææÂºèÁ§∫‰æã</a></li>
          </ol>
        </li>
        <li><a href="#‰∫îËé∑Âèñ‰∏ä‰∏ãÊñá‰ø°ÊÅØ">‰∫î„ÄÅËé∑Âèñ‰∏ä‰∏ãÊñá‰ø°ÊÅØ</a>
          <ol>
            <li><a href="#1-ÊñπÊ≥ï‰ø°ÊÅØËé∑Âèñ">1. ÊñπÊ≥ï‰ø°ÊÅØËé∑Âèñ</a></li>
            <li><a href="#2-ËøîÂõûÂÄºËé∑Âèñ">2. ËøîÂõûÂÄºËé∑Âèñ</a></li>
            <li><a href="#3-ÂºÇÂ∏∏Ëé∑Âèñ">3. ÂºÇÂ∏∏Ëé∑Âèñ</a></li>
          </ol>
        </li>
        <li><a href="#ÂÖ≠aopÂ∫îÁî®Âú∫ÊôØ">ÂÖ≠„ÄÅAOPÂ∫îÁî®Âú∫ÊôØ</a></li>
        <li><a href="#‰∏Éspring-aop‰∏éaspectjÂØπÊØî">‰∏É„ÄÅSpring AOP‰∏éAspectJÂØπÊØî</a></li>
        <li><a href="#ÂÖ´ÊúÄ‰Ω≥ÂÆûË∑µÂª∫ËÆÆ">ÂÖ´„ÄÅÊúÄ‰Ω≥ÂÆûË∑µÂª∫ËÆÆ</a></li>
        <li><a href="#‰πùÂÆåÊï¥Á§∫‰æãÊñπÊ≥ïÁ∫ßÊùÉÈôêÊéßÂà∂">‰πù„ÄÅÂÆåÊï¥Á§∫‰æãÔºöÊñπÊ≥ïÁ∫ßÊùÉÈôêÊéßÂà∂</a></li>
      </ol>
    </li>
    <li><a href="#‰ΩøÁî®aopÂÆûÁé∞ÁôªÂΩïÊ†°È™å">‰ΩøÁî®AOPÂÆûÁé∞ÁôªÂΩïÊ†°È™å</a>
      <ol>
        <li><a href="#‰∏ÄaopÂü∫Á°ÄÊ¶ÇÂøµ">‰∏Ä„ÄÅAOPÂü∫Á°ÄÊ¶ÇÂøµ</a></li>
        <li><a href="#‰∫åÁôªÂΩïÊ†°È™åÂÆûÁé∞ËØ¶Ëß£">‰∫å„ÄÅÁôªÂΩïÊ†°È™åÂÆûÁé∞ËØ¶Ëß£</a>
          <ol>
            <li><a href="#1-ÂÆö‰πâÊ≥®Ëß£Ê†áËÆ∞ÈúÄË¶ÅÊã¶Êà™ÁöÑÊñπÊ≥ï">1. ÂÆö‰πâÊ≥®Ëß£ÔºàÊ†áËÆ∞ÈúÄË¶ÅÊã¶Êà™ÁöÑÊñπÊ≥ïÔºâ</a></li>
            <li><a href="#2-ÂÆûÁé∞ÂàáÈù¢ÈÄªËæë">2. ÂÆûÁé∞ÂàáÈù¢ÈÄªËæë</a></li>
            <li><a href="#3-‰∏öÂä°ÊñπÊ≥ïÂ∫îÁî®">3. ‰∏öÂä°ÊñπÊ≥ïÂ∫îÁî®</a></li>
          </ol>
        </li>
        <li><a href="#‰∏âÊâßË°åÊµÅÁ®ãÂàÜÊûê">‰∏â„ÄÅÊâßË°åÊµÅÁ®ãÂàÜÊûê</a></li>
        <li><a href="#ÂõõËÆæËÆ°‰ºòÂäøÂàÜÊûê">Âõõ„ÄÅËÆæËÆ°‰ºòÂäøÂàÜÊûê</a></li>
        <li><a href="#‰∫îÊâ©Â±ïÂ∫îÁî®Âú∫ÊôØ">‰∫î„ÄÅÊâ©Â±ïÂ∫îÁî®Âú∫ÊôØ</a></li>
        <li><a href="#ÂÖ≠ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ-1">ÂÖ≠„ÄÅÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ</a></li>
        <li><a href="#‰∏ÉÂ∏∏ËßÅÈóÆÈ¢òËß£ÂÜ≥ÊñπÊ°à">‰∏É„ÄÅÂ∏∏ËßÅÈóÆÈ¢òËß£ÂÜ≥ÊñπÊ°à</a></li>
      </ol>
    </li>
    <li><a href="#ÁôªÂΩïÊ†°È™åÁöÑÂ§öÁßçÂÆûÁé∞ÊñπÂºè">ÁôªÂΩïÊ†°È™åÁöÑÂ§öÁßçÂÆûÁé∞ÊñπÂºè</a>
      <ol>
        <li><a href="#1-Êã¶Êà™Âô®interceptorÂÆûÁé∞">1. Êã¶Êà™Âô®(Interceptor)ÂÆûÁé∞</a></li>
        <li><a href="#2-ËøáÊª§Âô®filterÂÆûÁé∞">2. ËøáÊª§Âô®(Filter)ÂÆûÁé∞</a></li>
        <li><a href="#3-spring-securityÊ°ÜÊû∂">3. Spring SecurityÊ°ÜÊû∂</a></li>
        <li><a href="#4-ÁΩëÂÖ≥Â±ÇÁªü‰∏ÄÊ†°È™å">4. ÁΩëÂÖ≥Â±ÇÁªü‰∏ÄÊ†°È™å</a></li>
        <li><a href="#5-ÊñπÊ≥ïÂèÇÊï∞Ëß£ÊûêÂô®">5. ÊñπÊ≥ïÂèÇÊï∞Ëß£ÊûêÂô®</a></li>
        <li><a href="#6-ÂØπÊØîÊÄªÁªì">6. ÂØπÊØîÊÄªÁªì</a></li>
        <li><a href="#7-ÈÄâÊã©Âª∫ËÆÆ">7. ÈÄâÊã©Âª∫ËÆÆ</a></li>
      </ol>
    </li>
    <li><a href="#jwtÂÆûÁé∞ÁôªÂΩïÊ†°È™åÁöÑÂÆåÊï¥ÊñπÊ°à">JWTÂÆûÁé∞ÁôªÂΩïÊ†°È™åÁöÑÂÆåÊï¥ÊñπÊ°à</a>
      <ol>
        <li><a href="#‰∏ÄjwtÂü∫Á°ÄÊ¶ÇÂøµ">‰∏Ä„ÄÅJWTÂü∫Á°ÄÊ¶ÇÂøµ</a>
          <ol>
            <li><a href="#1-jwtÁªÑÊàêÁªìÊûÑ">1. JWTÁªÑÊàêÁªìÊûÑ</a></li>
            <li><a href="#2-Â∑•‰ΩúÊµÅÁ®ã">2. Â∑•‰ΩúÊµÅÁ®ã</a></li>
          </ol>
        </li>
        <li><a href="#‰∫åspring-bootÂÆûÁé∞ÊñπÊ°à">‰∫å„ÄÅSpring BootÂÆûÁé∞ÊñπÊ°à</a>
          <ol>
            <li><a href="#1-Ê∑ªÂä†‰æùËµñ">1. Ê∑ªÂä†‰æùËµñ</a></li>
            <li><a href="#2-jwtÂ∑•ÂÖ∑Á±ª">2. JWTÂ∑•ÂÖ∑Á±ª</a></li>
            <li><a href="#3-ÁôªÂΩïÊé•Âè£ÂÆûÁé∞">3. ÁôªÂΩïÊé•Âè£ÂÆûÁé∞</a></li>
            <li><a href="#4-jwtÊ†°È™åËøáÊª§Âô®">4. JWTÊ†°È™åËøáÊª§Âô®</a></li>
            <li><a href="#5-ÂÆâÂÖ®ÈÖçÁΩÆ">5. ÂÆâÂÖ®ÈÖçÁΩÆ</a></li>
          </ol>
        </li>
        <li><a href="#‰∏âÂÆ¢Êà∑Á´Ø‰ΩøÁî®ÊñπÂºè">‰∏â„ÄÅÂÆ¢Êà∑Á´Ø‰ΩøÁî®ÊñπÂºè</a>
          <ol>
            <li><a href="#1-ÁôªÂΩïËé∑Âèñtoken">1. ÁôªÂΩïËé∑Âèñtoken</a></li>
            <li><a href="#2-ËÆøÈóÆÂèó‰øùÊä§api">2. ËÆøÈóÆÂèó‰øùÊä§API</a></li>
          </ol>
        </li>
        <li><a href="#ÂõõÈ´òÁ∫ßÂäüËÉΩÂÆûÁé∞">Âõõ„ÄÅÈ´òÁ∫ßÂäüËÉΩÂÆûÁé∞</a></li>
        <li><a href="#‰∫îÂÆâÂÖ®ÊúÄ‰Ω≥ÂÆûË∑µ">‰∫î„ÄÅÂÆâÂÖ®ÊúÄ‰Ω≥ÂÆûË∑µ</a></li>
        <li><a href="#ÂÖ≠‰∏éÂÖ∂‰ªñÊñπÊ°àÁöÑÂØπÊØî">ÂÖ≠„ÄÅ‰∏éÂÖ∂‰ªñÊñπÊ°àÁöÑÂØπÊØî</a></li>
      </ol>
    </li>
    <li><a href="#ÈÄöËøáaopÂÆûÁé∞Ê∂àÊÅØÈÄöÁü•">ÈÄöËøáAOPÂÆûÁé∞Ê∂àÊÅØÈÄöÁü•</a>
      <ol>
        <li><a href="#‰∏ÄÊï¥‰ΩìËÆæËÆ°ÊÄùË∑Ø">‰∏Ä„ÄÅÊï¥‰ΩìËÆæËÆ°ÊÄùË∑Ø</a></li>
        <li><a href="#‰∫åÊ†∏ÂøÉÁªÑ‰ª∂ËØ¶Ëß£">‰∫å„ÄÅÊ†∏ÂøÉÁªÑ‰ª∂ËØ¶Ëß£</a>
          <ol>
            <li><a href="#1-Ëá™ÂÆö‰πâÊ≥®Ëß£-recordusermessage">1. Ëá™ÂÆö‰πâÊ≥®Ëß£ @RecordUserMessage</a></li>
            <li><a href="#2-aopÂàáÈù¢ÂÆûÁé∞-usermessageoperationaspect">2. AOPÂàáÈù¢ÂÆûÁé∞ UserMessageOperationAspect</a></li>
            <li><a href="#3-Áî®Êà∑‰ø°ÊÅØËé∑Âèñ">3. Áî®Êà∑‰ø°ÊÅØËé∑Âèñ</a></li>
          </ol>
        </li>
        <li><a href="#‰∏âÂ∑•‰ΩúÊµÅÁ®ãÂàÜÊûê">‰∏â„ÄÅÂ∑•‰ΩúÊµÅÁ®ãÂàÜÊûê</a></li>
        <li><a href="#ÂõõÂÖ≥ÈîÆÂÆûÁé∞ÁªÜËäÇ">Âõõ„ÄÅÂÖ≥ÈîÆÂÆûÁé∞ÁªÜËäÇ</a>
          <ol>
            <li><a href="#1-ÂèÇÊï∞ÂêçÂåπÈÖçÊú∫Âà∂">1. ÂèÇÊï∞ÂêçÂåπÈÖçÊú∫Âà∂</a></li>
            <li><a href="#2-Ê∂àÊÅØÁ±ªÂûãÂä®ÊÄÅÂà§Êñ≠">2. Ê∂àÊÅØÁ±ªÂûãÂä®ÊÄÅÂà§Êñ≠</a></li>
            <li><a href="#3-ÂºÇÂ∏∏Â§ÑÁêÜÁ≠ñÁï•">3. ÂºÇÂ∏∏Â§ÑÁêÜÁ≠ñÁï•</a></li>
          </ol>
        </li>
        <li><a href="#‰∫î‰ΩøÁî®Á§∫‰æã">‰∫î„ÄÅ‰ΩøÁî®Á§∫‰æã</a>
          <ol>
            <li><a href="#1-Âü∫Á°ÄÁî®Ê≥ï">1. Âü∫Á°ÄÁî®Ê≥ï</a></li>
            <li><a href="#2-Â∏¶ÂèÇÊï∞Ëá™Âä®ÊèêÂèñ">2. Â∏¶ÂèÇÊï∞Ëá™Âä®ÊèêÂèñ</a></li>
          </ol>
        </li>
        <li><a href="#ÂÖ≠ËÆæËÆ°‰ºòÂäø">ÂÖ≠„ÄÅËÆæËÆ°‰ºòÂäø</a></li>
        <li><a href="#‰∏ÉÊΩúÂú®‰ºòÂåñÊñπÂêë">‰∏É„ÄÅÊΩúÂú®‰ºòÂåñÊñπÂêë</a></li>
        <li><a href="#ÂÖ´‰∏éÂÖ∂‰ªñÊñπÊ°àÁöÑÂØπÊØî">ÂÖ´„ÄÅ‰∏éÂÖ∂‰ªñÊñπÊ°àÁöÑÂØπÊØî</a></li>
      </ol>
    </li>
    <li><a href="#ÂÆûÊàòaopÊó∂ÈúÄË¶ÅÈáçÁÇπÂÖ≥Ê≥®ÁöÑÊñπÈù¢">ÂÆûÊàòAOPÊó∂ÈúÄË¶ÅÈáçÁÇπÂÖ≥Ê≥®ÁöÑÊñπÈù¢</a>
      <ol>
        <li><a href="#‰∏ÄÂàáÈù¢ËÆæËÆ°‰∏éÂÆûÁé∞Ë¶ÅÁÇπ">‰∏Ä„ÄÅÂàáÈù¢ËÆæËÆ°‰∏éÂÆûÁé∞Ë¶ÅÁÇπ</a></li>
        <li><a href="#‰∫åÂèÇÊï∞Â§ÑÁêÜÂÖ≥ÈîÆÁÇπ">‰∫å„ÄÅÂèÇÊï∞Â§ÑÁêÜÂÖ≥ÈîÆÁÇπ</a></li>
        <li><a href="#‰∏âÂºÇÂ∏∏Â§ÑÁêÜÁ≠ñÁï•">‰∏â„ÄÅÂºÇÂ∏∏Â§ÑÁêÜÁ≠ñÁï•</a></li>
        <li><a href="#ÂõõÊÄßËÉΩ‰ºòÂåñÊñπÂêë">Âõõ„ÄÅÊÄßËÉΩ‰ºòÂåñÊñπÂêë</a></li>
        <li><a href="#‰∫îÂÆâÂÖ®Ê≥®ÊÑè‰∫ãÈ°π">‰∫î„ÄÅÂÆâÂÖ®Ê≥®ÊÑè‰∫ãÈ°π</a></li>
        <li><a href="#ÂÖ≠ÂèØÁª¥Êä§ÊÄßËÆæËÆ°">ÂÖ≠„ÄÅÂèØÁª¥Êä§ÊÄßËÆæËÆ°</a></li>
        <li><a href="#‰∏É‰∏éÂÖ∂‰ªñÁªÑ‰ª∂ÁöÑÂçè‰Ωú">‰∏É„ÄÅ‰∏éÂÖ∂‰ªñÁªÑ‰ª∂ÁöÑÂçè‰Ωú</a></li>
        <li><a href="#ÂÖ´ÊµãËØïÁõ∏ÂÖ≥Âª∫ËÆÆ">ÂÖ´„ÄÅÊµãËØïÁõ∏ÂÖ≥Âª∫ËÆÆ</a></li>
        <li><a href="#‰πùÊÇ®ÁöÑÂÆûÁé∞‰∫ÆÁÇπ">‰πù„ÄÅÊÇ®ÁöÑÂÆûÁé∞‰∫ÆÁÇπ</a></li>
        <li><a href="#ÂçÅÊÄªÁªì-checklist">ÂçÅ„ÄÅÊÄªÁªì Checklist</a></li>
      </ol>
    </li>
    <li><a href="#ÂÆöÊó∂‰ªªÂä°-ÊØèÊó•Êï∞ÊçÆÁªüËÆ°Âíå‰∏¥Êó∂Êñá‰ª∂Ê∏ÖÁêÜ">ÂÆöÊó∂‰ªªÂä°-ÊØèÊó•Êï∞ÊçÆÁªüËÆ°Âíå‰∏¥Êó∂Êñá‰ª∂Ê∏ÖÁêÜ</a>
      <ol>
        <li><a href="#‰∏ÄÁ≥ªÁªüÂäüËÉΩÊ¶ÇËø∞">‰∏Ä„ÄÅÁ≥ªÁªüÂäüËÉΩÊ¶ÇËø∞</a></li>
        <li><a href="#‰∫åÊØèÊó•Êï∞ÊçÆÁªüËÆ°‰ªªÂä°-statisticsdata">‰∫å„ÄÅÊØèÊó•Êï∞ÊçÆÁªüËÆ°‰ªªÂä° statisticsData()</a>
          <ol>
            <li><a href="#‰ª£Á†ÅÁªìÊûÑ‰∏éËÅöÂêàÈÄªËæëËß£Êûê">‰ª£Á†ÅÁªìÊûÑ‰∏éËÅöÂêàÈÄªËæëËß£Êûê</a></li>
          </ol>
        </li>
        <li><a href="#‰∏â‰∏¥Êó∂Êñá‰ª∂Ê∏ÖÁêÜ‰ªªÂä°-deltempfile">‰∏â„ÄÅ‰∏¥Êó∂Êñá‰ª∂Ê∏ÖÁêÜ‰ªªÂä° delTempFile()</a></li>
        <li><a href="#ÂõõÊû∂ÊûÑËÆæËÆ°‰∫ÆÁÇπ">Âõõ„ÄÅÊû∂ÊûÑËÆæËÆ°‰∫ÆÁÇπ</a></li>
        <li><a href="#‰∫îÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ-1">‰∫î„ÄÅÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ</a></li>
      </ol>
    </li>
    <li><a href="#gateway-Ë∑ØÁî±ÂàÜÈÖç‰∏éÊé•Âè£Ë∞ÉÁî®Êú∫Âà∂">Gateway Ë∑ØÁî±ÂàÜÈÖç‰∏éÊé•Âè£Ë∞ÉÁî®Êú∫Âà∂</a>
      <ol>
        <li><a href="#‰∏Ägateway-Ë∑ØÁî±ÂàÜÈÖçÂéüÁêÜ">‰∏Ä„ÄÅGateway Ë∑ØÁî±ÂàÜÈÖçÂéüÁêÜ</a></li>
        <li><a href="#‰∫åÊé•Âè£ËÆøÈóÆË∑ØÂæÑÂ∑ÆÂºÇËß£Êûê">‰∫å„ÄÅÊé•Âè£ËÆøÈóÆË∑ØÂæÑÂ∑ÆÂºÇËß£Êûê</a></li>
        <li><a href="#‰∏âË¥üËΩΩÂùáË°°ÂÆû‰æãÊºîÁ§∫">‰∏â„ÄÅË¥üËΩΩÂùáË°°ÂÆû‰æãÊºîÁ§∫</a></li>
        <li><a href="#ÂõõÂÆåÊï¥Ë∞ÉÁî®ÈìæË∑ØÁ§∫‰æã">Âõõ„ÄÅÂÆåÊï¥Ë∞ÉÁî®ÈìæË∑ØÁ§∫‰æã</a></li>
        <li><a href="#‰∫îÁΩëÂÖ≥Â∑•‰ΩúÂéüÁêÜ">‰∫î„ÄÅÁΩëÂÖ≥Â∑•‰ΩúÂéüÁêÜ</a></li>
      </ol>
    </li>
    <li><a href="#adminfilter-ËØ¶ÁªÜËß£Êûê">AdminFilter ËØ¶ÁªÜËß£Êûê</a>
      <ol>
        <li><a href="#‰∏ÄÁ±ªÂÆö‰πâ‰∏éÂü∫Á°ÄÁªìÊûÑ">‰∏Ä„ÄÅÁ±ªÂÆö‰πâ‰∏éÂü∫Á°ÄÁªìÊûÑ</a></li>
        <li><a href="#‰∫åÂ∏∏ÈáèÂÆö‰πâ">‰∫å„ÄÅÂ∏∏ÈáèÂÆö‰πâ</a></li>
        <li><a href="#‰∏âÊ†∏ÂøÉËøáÊª§ÈÄªËæëapplyÊñπÊ≥ï">‰∏â„ÄÅÊ†∏ÂøÉËøáÊª§ÈÄªËæëÔºàapplyÊñπÊ≥ïÔºâ</a>
          <ol>
            <li><a href="#1-Ë∑ØÂæÑÂà§Êñ≠‰∏é-token-ÊèêÂèñ">1. Ë∑ØÂæÑÂà§Êñ≠‰∏é Token ÊèêÂèñ</a></li>
            <li><a href="#2-token-Ê†°È™å">2. Token Ê†°È™å</a></li>
          </ol>
        </li>
        <li><a href="#Âõõtoken-ÊèêÂèñÊñπÊ≥ï">Âõõ„ÄÅToken ÊèêÂèñÊñπÊ≥ï</a></li>
        <li><a href="#‰∫îËÆæËÆ°ÊÄùÊÉ≥‰∏é‰ΩøÁî®Âú∫ÊôØ">‰∫î„ÄÅËÆæËÆ°ÊÄùÊÉ≥‰∏é‰ΩøÁî®Âú∫ÊôØ</a>
          <ol>
            <li><a href="#ÂÖ∏Âûã‰ΩøÁî®Âú∫ÊôØ">ÂÖ∏Âûã‰ΩøÁî®Âú∫ÊôØ</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#‰ΩøÁî®seataËß£ÂÜ≥ÂàÜÂ∏ÉÂºè‰∫ãÂä°ÈóÆÈ¢ò">‰ΩøÁî®SeataËß£ÂÜ≥ÂàÜÂ∏ÉÂºè‰∫ãÂä°ÈóÆÈ¢ò</a>
      <ol>
        <li><a href="#‰∏Ä‰∏∫‰ªÄ‰πàtransactionalÂú®Ë∑®ÊúçÂä°Ë∞ÉÁî®Êó∂‰∏çÁîüÊïà">‰∏Ä„ÄÅ‰∏∫‰ªÄ‰πà@TransactionalÂú®Ë∑®ÊúçÂä°Ë∞ÉÁî®Êó∂‰∏çÁîüÊïà</a></li>
        <li><a href="#‰∫åseataËß£ÂÜ≥ÊñπÊ°àÂÖ®ÊµÅÁ®ã">‰∫å„ÄÅSeataËß£ÂÜ≥ÊñπÊ°àÂÖ®ÊµÅÁ®ã</a></li>
        <li><a href="#‰∏âÈ™åËØÅ‰∏éÊéíÊü•ÊäÄÂ∑ß">‰∏â„ÄÅÈ™åËØÅ‰∏éÊéíÊü•ÊäÄÂ∑ß</a></li>
        <li><a href="#ÂõõÁîüÊ¥ªÂåñÊÄªÁªì">Âõõ„ÄÅÁîüÊ¥ªÂåñÊÄªÁªì</a></li>
        <li><a href="#‰∫îÂÖ∏Âûã‰ª£Á†ÅÁ§∫‰æã">‰∫î„ÄÅÂÖ∏Âûã‰ª£Á†ÅÁ§∫‰æã</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/myfirstblog/">MyFirstBlog</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Nov 15, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 91 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="ÂºπÂπïËßÜÈ¢ëÁΩëÁ´ôÁ¨îËÆ∞">ÂºπÂπïËßÜÈ¢ëÁΩëÁ´ôÁ¨îËÆ∞
</h1><h2 id="maven-Â§öÊ®°ÂùóÈ°πÁõÆÁöÑ-pom-Êñá‰ª∂ÈÖçÁΩÆËØ¶Ëß£">Maven Â§öÊ®°ÂùóÈ°πÁõÆÁöÑ POM Êñá‰ª∂ÈÖçÁΩÆËØ¶Ëß£
</h2><p>Ëøô‰∏™Êñá‰ª∂ÊòØ‰∏Ä‰∏™ Maven ÁöÑ POM (Project Object Model) Êñá‰ª∂ÔºåÂÆÉÊòØ Maven È°πÁõÆÁöÑÊ†∏ÂøÉÈÖçÁΩÆÊñá‰ª∂ÔºåÁî®‰∫éÂÆö‰πâÈ°πÁõÆÁöÑÁªìÊûÑ„ÄÅ‰æùËµñÂÖ≥Á≥ª„ÄÅÊûÑÂª∫ÈÖçÁΩÆÁ≠â‰ø°ÊÅØ„ÄÇ‰∏ãÈù¢ÊòØÂØπËøô‰∏™Êñá‰ª∂‰∏≠ÂêÑ‰∏™ÈÉ®ÂàÜÁöÑËØ¶ÁªÜËß£ÈáäÔºö</p>
<h3 id="1Âü∫Êú¨ÈÖçÁΩÆ">1.Âü∫Êú¨ÈÖçÁΩÆ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">project</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span class="err">...</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">modelVersion</span><span class="p">&gt;</span>4.0.0<span class="p">&lt;/</span><span class="nt">modelVersion</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">groupId</span><span class="p">&gt;</span>com.easylive<span class="p">&lt;/</span><span class="nt">groupId</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">artifactId</span><span class="p">&gt;</span>easylive<span class="p">&lt;/</span><span class="nt">artifactId</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">version</span><span class="p">&gt;</span>1.0<span class="p">&lt;/</span><span class="nt">version</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">packaging</span><span class="p">&gt;</span>pom<span class="p">&lt;/</span><span class="nt">packaging</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚Ä¢ modelVersion: ÊåáÂÆö POM Ê®°ÂûãÁöÑÁâàÊú¨ÔºàÂõ∫ÂÆö‰∏∫ 4.0.0Ôºâ„ÄÇ<br>
‚Ä¢ groupId: È°πÁõÆÁöÑÁªÑÁªáÊ†áËØÜÔºàÈÄöÂ∏∏ÊòØÂÖ¨Âè∏ÊàñÁªÑÁªáÁöÑÂüüÂêçÂèçËΩ¨ÔºåÂ¶Ç com.easyliveÔºâ„ÄÇ<br>
‚Ä¢ artifactId: È°πÁõÆÁöÑÂîØ‰∏ÄÊ†áËØÜÁ¨¶ÔºàÂ¶Ç easyliveÔºâ„ÄÇ<br>
‚Ä¢ version: È°πÁõÆÁöÑÁâàÊú¨Âè∑ÔºàÂ¶Ç 1.0Ôºâ„ÄÇ<br>
‚Ä¢ packaging: È°πÁõÆÁöÑÊâìÂåÖÁ±ªÂûãÔºåËøôÈáåÊòØ pomÔºåË°®Á§∫ËøôÊòØ‰∏Ä‰∏™Â§öÊ®°ÂùóÈ°πÁõÆÁöÑÁà∂ POM„ÄÇ<br></p>
<h3 id="2-Áà∂È°πÁõÆÁªßÊâø">2. Áà∂È°πÁõÆÁªßÊâø
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;parent&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>2.7.18<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;relativePath/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/parent&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁªßÊâø Spring Boot ÁöÑÁà∂ POMÔºåÊèê‰æõ‰∫ÜÈªòËÆ§ÁöÑ‰æùËµñÁÆ°ÁêÜ„ÄÅÊèí‰ª∂ÈÖçÁΩÆÁ≠â„ÄÇ</li>
<li>relativePath ‰∏∫Á©∫Ë°®Á§∫‰ªéÊú¨Âú∞‰ªìÂ∫ìÊàñËøúÁ®ã‰ªìÂ∫ìÊü•ÊâæÁà∂ POM„ÄÇ</li>
</ul>
<h3 id="3-Ê®°ÂùóÂÆö‰πâ">3. Ê®°ÂùóÂÆö‰πâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;modules&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;module&gt;</span>easylive-common<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;module&gt;</span>easylive-admin<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;module&gt;</span>easylive-web<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/modules&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÆö‰πâÂ≠êÊ®°ÂùóÔºàÂ§öÊ®°ÂùóÈ°πÁõÆÔºâÔºö
<ul>
<li>easylive-common: ÂÖ¨ÂÖ±Ê®°ÂùóÔºàÂ¶ÇÂ∑•ÂÖ∑Á±ª„ÄÅÈÄöÁî®ÈÖçÁΩÆÔºâ„ÄÇ</li>
<li>easylive-admin: ÂêéÂè∞ÁÆ°ÁêÜÊ®°Âùó„ÄÇ</li>
<li>easylive-web: ÂâçÁ´ØÊàñ API Ê®°Âùó„ÄÇ</li>
</ul>
</li>
</ul>
<h3 id="4-ÂÖ®Â±ÄÂ±ûÊÄß">4. ÂÖ®Â±ÄÂ±ûÊÄß
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;skipTests&gt;</span>true<span class="nt">&lt;/skipTests&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- ‰æùËµñÁâàÊú¨Âè∑ --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;springboot.version&gt;</span>2.7.18<span class="nt">&lt;/springboot.version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mybatis.version&gt;</span>1.3.2<span class="nt">&lt;/mybatis.version&gt;</span>
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/properties&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁºñÁ†ÅÂíå JDK ÁâàÊú¨ÔºöÊåáÂÆöÊ∫êÁ†ÅÁºñÁ†Å‰∏∫ UTF-8ÔºåÁºñËØë‰ΩøÁî® JDK 1.8„ÄÇ</li>
<li>Ë∑≥ËøáÊµãËØïÔºöskipTests=true Ë°®Á§∫ÊûÑÂª∫Êó∂Ë∑≥ËøáÂçïÂÖÉÊµãËØï„ÄÇ</li>
<li>‰æùËµñÁâàÊú¨Âè∑ÔºöÈõÜ‰∏≠ÁÆ°ÁêÜÊâÄÊúâ‰æùËµñÁöÑÁâàÊú¨Âè∑Ôºå‰æø‰∫éÁªü‰∏ÄÂçáÁ∫ß„ÄÇ</li>
</ul>
<h3 id="5-‰æùËµñÁÆ°ÁêÜ">5. ‰æùËµñÁÆ°ÁêÜ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependencyManagement&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>${springboot.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;exclusions&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;exclusion&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/exclusion&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/exclusions&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        ...
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencyManagement&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩúÁî®ÔºöÁªü‰∏ÄÁÆ°ÁêÜÂ≠êÊ®°ÂùóÁöÑ‰æùËµñÁâàÊú¨ÔºåÈÅøÂÖçÁâàÊú¨ÂÜ≤Á™Å„ÄÇ</li>
<li>ÁâπÁÇπÔºö
<ul>
<li>Â≠êÊ®°Âùó‰ΩøÁî®Êó∂Êó†ÈúÄÊåáÂÆöÁâàÊú¨Âè∑ÔºàÁªßÊâøÁà∂ POM ÁöÑÁâàÊú¨Ôºâ„ÄÇ</li>
<li>ÂèØ‰ª•ÈÄöËøá <code>&lt;exclusions&gt;</code> ÊéíÈô§‰º†ÈÄíÊÄß‰æùËµñÔºàÂ¶ÇÊéíÈô§ÈªòËÆ§ÁöÑ Logback Êó•ÂøóÂ∫ìÔºâ„ÄÇ</li>
</ul>
</li>
</ul>
<h3 id="6-ÂÖ≥ÈîÆ‰æùËµñËØ¥Êòé">6. ÂÖ≥ÈîÆ‰æùËµñËØ¥Êòé
</h3><ul>
<li><strong>Spring Boot Starter Web</strong>ÔºöÊèê‰æõ Web ÂºÄÂèëÊîØÊåÅÔºàÂ¶Ç Spring MVCÔºâ„ÄÇ</li>
<li><strong>MyBatis Starter</strong>ÔºöÈõÜÊàê MyBatis Âíå Spring Boot„ÄÇ</li>
<li><strong>MySQL Connector</strong>ÔºöMySQL Êï∞ÊçÆÂ∫ìÈ©±Âä®„ÄÇ</li>
<li><strong>Logback</strong>ÔºöÊó•ÂøóÊ°ÜÊû∂„ÄÇ</li>
<li><strong>Lombok</strong>ÔºöÁÆÄÂåñ Java ‰ª£Á†ÅÔºàÂ¶ÇËá™Âä®ÁîüÊàê Getter/SetterÔºâ„ÄÇ</li>
<li><strong>Fastjson</strong>ÔºöÈòøÈáåÂ∑¥Â∑¥ÁöÑ JSON Â§ÑÁêÜÂ∫ì„ÄÇ</li>
<li><strong>Apache Commons</strong>ÔºöÂ∏∏Áî®Â∑•ÂÖ∑Â∫ìÔºàÂ¶Ç commons-lang3„ÄÅcommons-ioÔºâ„ÄÇ</li>
<li><strong>Elasticsearch</strong>ÔºöÂÖ®ÊñáÊêúÁ¥¢ÂºïÊìéÊîØÊåÅ„ÄÇ</li>
<li><strong>Easy Captcha</strong>ÔºöÈ™åËØÅÁ†ÅÁîüÊàêÂ∫ì„ÄÇ</li>
</ul>
<h3 id="7-Êñá‰ª∂ÁöÑ‰ΩúÁî®">7. Êñá‰ª∂ÁöÑ‰ΩúÁî®
</h3><ul>
<li>Â§öÊ®°ÂùóÁÆ°ÁêÜÔºöÈÄöËøá <code>&lt;modules&gt;</code> ÂÆö‰πâÂ≠êÊ®°ÂùóÔºåÁªü‰∏ÄÊûÑÂª∫„ÄÇ</li>
<li>‰æùËµñÁâàÊú¨ÊéßÂà∂ÔºöÈÄöËøá <code>&lt;dependencyManagement&gt;</code> ÈõÜ‰∏≠ÁÆ°ÁêÜ‰æùËµñÁâàÊú¨„ÄÇ</li>
<li>ÁªßÊâø Spring Boot ÈªòËÆ§ÈÖçÁΩÆÔºöÁÆÄÂåñ Spring Boot È°πÁõÆÁöÑÈÖçÁΩÆÔºàÂ¶ÇÊèí‰ª∂„ÄÅÈªòËÆ§‰æùËµñÔºâ„ÄÇ</li>
<li>Áªü‰∏ÄÊûÑÂª∫ËßÑËåÉÔºöÊåáÂÆö JDK ÁâàÊú¨„ÄÅÁºñÁ†ÅÁ≠âÂÖ®Â±ÄÈÖçÁΩÆ„ÄÇ</li>
</ul>
<h4 id="Ë°•ÂÖÖËØ¥Êòé">Ë°•ÂÖÖËØ¥Êòé
</h4><ul>
<li>Â≠êÊ®°ÂùóÁöÑ POM Êñá‰ª∂‰ºöÁªßÊâøÁà∂ POM ÁöÑÈÖçÁΩÆÔºåÊó†ÈúÄÈáçÂ§çÂÆö‰πâÁâàÊú¨Âè∑„ÄÇ</li>
<li>ÂÆûÈôÖ‰æùËµñÈúÄË¶ÅÂ≠êÊ®°ÂùóÊòæÂºèÂ£∞ÊòéÔºàÁà∂ POM ‰ªÖÁÆ°ÁêÜÁâàÊú¨Ôºâ„ÄÇ</li>
<li>Â¶ÇÊûúÊüê‰∏™Â≠êÊ®°ÂùóÈúÄË¶ÅÁâπÊÆäÈÖçÁΩÆÔºåÂèØ‰ª•Âú®ÂÖ∂ POM ‰∏≠Ë¶ÜÁõñÁà∂ POM ÁöÑËÆæÁΩÆ„ÄÇ</li>
</ul>
<p>Ëøô‰∏™Êñá‰ª∂ÊòØÈ°πÁõÆÁöÑÊ†∏ÂøÉÈÖçÁΩÆÔºåÁ°Æ‰øù‰∫Ü‰æùËµñ‰∏ÄËá¥ÊÄßÂíåÊûÑÂª∫Ê†áÂáÜÂåñ„ÄÇÂ∏∏Áî®‰æùËµñÂ∫ìËØ¶ÁªÜËØ¥ÊòéÔºö</p>
<h4 id="1-commons-ioapache-commons-io">1. commons-ioÔºàApache Commons IOÔºâ
</h4><p><strong>‰ΩúÁî®</strong>ÔºöÊèê‰æõÊõ¥Âº∫Â§ß„ÄÅÊòìÁî®ÁöÑ I/OÔºàËæìÂÖ•/ËæìÂá∫ÔºâÊìç‰ΩúÂ∑•ÂÖ∑Á±ª„ÄÇ<br>
<strong>ÂÖ∏ÂûãÁî®ÈÄî</strong>Ôºö</p>
<ul>
<li>Êñá‰ª∂/ÁõÆÂΩïÁöÑÂ§çÂà∂„ÄÅÂà†Èô§„ÄÅÁßªÂä®ÔºàFileUtilsÔºâ„ÄÇ</li>
<li>ÊµÅÔºàStreamÔºâÁöÑÈ´òÊïàËØªÂÜôÔºàIOUtilsÔºâ„ÄÇ</li>
<li>Êñá‰ª∂ÁõëÊéßÔºàÂ¶Ç FileAlterationMonitorÔºâ„ÄÇ</li>
</ul>
<p><strong>Á§∫‰æã‰ª£Á†Å</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.commons.io.FileUtils</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Â§çÂà∂Êñá‰ª∂</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">FileUtils</span><span class="p">.</span><span class="na">copyFile</span><span class="p">(</span><span class="n">srcFile</span><span class="p">,</span><span class="w"> </span><span class="n">destFile</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπ‰∏∫Â≠óÁ¨¶‰∏≤</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FileUtils</span><span class="p">.</span><span class="na">readFileToString</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;UTF-8&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÁâàÊú¨ËØ¥Êòé</strong>Ôºö</p>
<ul>
<li>ÂΩìÂâç POM ‰∏≠ÁâàÊú¨‰∏∫ 2.5ÔºàËæÉÊóßÔºåÊúÄÊñ∞Áâà‰∏∫ 2.15.1Ôºâ„ÄÇ</li>
</ul>
<h4 id="2-commons-codecapache-commons-codec">2. commons-codecÔºàApache Commons CodecÔºâ
</h4><p><strong>‰ΩúÁî®</strong>ÔºöÊèê‰æõÂ∏∏ËßÅÁöÑÁºñÁ†Å/Ëß£Á†ÅÂ∑•ÂÖ∑ÔºåÂ¶Ç Base64„ÄÅMD5„ÄÅSHA Á≠â„ÄÇ<br>
<strong>ÂÖ∏ÂûãÁî®ÈÄî</strong>Ôºö</p>
<ul>
<li>Âä†ÂØÜÂìàÂ∏åÔºàDigestUtils.md5Hex()Ôºâ„ÄÇ</li>
<li>Base64 ÁºñÁ†Å/Ëß£Á†ÅÔºàBase64.encodeBase64String()Ôºâ„ÄÇ</li>
<li>URL ÁºñÁ†Å/Ëß£Á†Å„ÄÇ</li>
</ul>
<p><strong>Á§∫‰æã‰ª£Á†Å</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.commons.codec.digest.DigestUtils</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÁîüÊàê MD5 ÂìàÂ∏å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">md5Hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DigestUtils</span><span class="p">.</span><span class="na">md5Hex</span><span class="p">(</span><span class="s">&#34;HelloWorld&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÁâàÊú¨ËØ¥Êòé</strong>Ôºö</p>
<ul>
<li>ÂΩìÂâç POM ‰∏≠ÁâàÊú¨‰∏∫ 1.9ÔºàËæÉÊóßÔºåÊúÄÊñ∞Áâà‰∏∫ 1.16.1Ôºâ„ÄÇ</li>
</ul>
<h4 id="3-commons-lang3apache-commons-lang3">3. commons-lang3ÔºàApache Commons Lang3Ôºâ
</h4><p><strong>‰ΩúÁî®</strong>ÔºöÊâ©Â±ï Java Ê†áÂáÜÂ∫ìÁöÑÂ∑•ÂÖ∑Á±ªÔºåÂ∞§ÂÖ∂ÊòØ java.lang ÂåÖÁöÑÂ¢ûÂº∫„ÄÇ<br>
<strong>ÂÖ∏ÂûãÁî®ÈÄî</strong>Ôºö</p>
<ul>
<li>Â≠óÁ¨¶‰∏≤Â§ÑÁêÜÔºàStringUtils.isEmpty()Ôºâ„ÄÇ</li>
<li>Êï∞ÁªÑ/ÂØπË±°Êìç‰ΩúÔºàArrayUtils, ObjectUtilsÔºâ„ÄÇ</li>
<li>Êó•ÊúüÊ†ºÂºèÂåñÔºàDateUtilsÔºâ„ÄÇ</li>
<li>ÈöèÊú∫Êï∞ÁîüÊàêÔºàRandomStringUtilsÔºâ„ÄÇ</li>
</ul>
<p><strong>Á§∫‰æã‰ª£Á†Å</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.commons.lang3.StringUtils</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ê£ÄÊü•Â≠óÁ¨¶‰∏≤ÊòØÂê¶‰∏∫Á©∫ÔºàÂåÖÊã¨ null ÂíåÁ©∫Â≠óÁ¨¶‰∏≤Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">boolean</span><span class="w"> </span><span class="n">isEmpty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">str</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÁâàÊú¨ËØ¥Êòé</strong>Ôºö</p>
<ul>
<li>ÂΩìÂâç POM ‰∏≠ÁâàÊú¨‰∏∫ 3.4ÔºàËæÉÊóßÔºåÊúÄÊñ∞Áâà‰∏∫ 3.14.0Ôºâ„ÄÇ</li>
</ul>
<h4 id="4-aspectjweaveraspectj-Â∫ì">4. aspectjweaverÔºàAspectJ Â∫ìÔºâ
</h4><p><strong>‰ΩúÁî®</strong>ÔºöÊîØÊåÅÈù¢ÂêëÂàáÈù¢ÁºñÁ®ãÔºàAOPÔºâÔºåÁî®‰∫éËß£ËÄ¶Ê®™ÂàáÂÖ≥Ê≥®ÁÇπÔºàÂ¶ÇÊó•Âøó„ÄÅ‰∫ãÂä°Ôºâ„ÄÇ<br>
<strong>ÂÖ∏ÂûãÁî®ÈÄî</strong>Ôºö</p>
<ul>
<li>ÈÖçÂêà Spring AOP ÂÆûÁé∞ÊñπÊ≥ïÊã¶Êà™„ÄÇ</li>
<li>ÂÆö‰πâÂàáÈù¢Ôºà@AspectÔºâ„ÄÅÂàáÂÖ•ÁÇπÔºà@PointcutÔºâ„ÄÅÈÄöÁü•Ôºà@Before, @After Á≠âÔºâ„ÄÇ</li>
</ul>
<p><strong>Á§∫‰æã‰ª£Á†Å</strong>Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.aspectj.lang.annotation.Aspect</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.aspectj.lang.annotation.Before</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Aspect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LoggingAspect</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Before</span><span class="p">(</span><span class="s">&#34;execution(* com.example.service.*.*(..))&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">logBefore</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;ÊñπÊ≥ïÊâßË°åÂâçËÆ∞ÂΩïÊó•Âøó&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÁâàÊú¨ËØ¥Êòé</strong>Ôºö</p>
<ul>
<li>ÂΩìÂâç POM ‰∏≠ÁâàÊú¨‰∏∫ 1.9.3ÔºàËæÉÊóßÔºåÊúÄÊñ∞Áâà‰∏∫ 1.9.20Ôºâ„ÄÇ</li>
</ul>
<h4 id="‰∏∫‰ªÄ‰πàÈúÄË¶ÅËøô‰∫õÂ∫ì">‰∏∫‰ªÄ‰πàÈúÄË¶ÅËøô‰∫õÂ∫ìÔºü
</h4><ul>
<li>ÈÅøÂÖçÈáçÂ§çÈÄ†ËΩÆÂ≠êÔºöÊèê‰æõÁé∞ÊàêÁöÑÂ∑•ÂÖ∑ÊñπÊ≥ïÔºåÂáèÂ∞ëÊâãÂÜôÈÄöÁî®‰ª£Á†Å„ÄÇ</li>
<li>Ê†áÂáÜÂåñÔºöApache Âíå Eclipse Áª¥Êä§ÁöÑÂ∫ìÔºåÁ®≥ÂÆöÊÄßÂíåÊÄßËÉΩÊúâ‰øùÈöú„ÄÇ</li>
<li>‰∏é Spring ÁîüÊÄÅÈõÜÊàêÔºöÂ¶Ç aspectjweaver ÊòØ Spring AOP ÁöÑÂ∫ïÂ±Ç‰æùËµñ„ÄÇ</li>
</ul>
<h2 id="applicationyml-Êñá‰ª∂‰ΩúÁî®‰∏éÂ∏∏ËßÅÈÖçÁΩÆÈ°πËØ¶Ëß£">application.yml Êñá‰ª∂‰ΩúÁî®‰∏éÂ∏∏ËßÅÈÖçÁΩÆÈ°πËØ¶Ëß£
</h2><p>application.yml Êñá‰ª∂ÊòØ Spring Boot Â∫îÁî®ÁöÑÊ†∏ÂøÉÈÖçÁΩÆÊñá‰ª∂ÔºåÈááÁî® YAML Ê†ºÂºèÔºåÁî®‰∫éÂÆö‰πâÂ∫îÁî®Á®ãÂ∫èÁöÑÂêÑÁßçÈÖçÁΩÆÂèÇÊï∞„ÄÇ‰ª•‰∏ãÊòØÂêÑ‰∏™ÈÖçÁΩÆÈ°πÁöÑËØ¶ÁªÜËØ¥ÊòéÔºö</p>
<h3 id="1-ÊúçÂä°Âô®ÈÖçÁΩÆserver">1. ÊúçÂä°Âô®ÈÖçÁΩÆÔºàserverÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">7070</span><span class="w">                     </span><span class="c"># ÊúçÂä°Âô®Á´ØÂè£Âè∑ÔºàÈªòËÆ§8080ÔºåËøôÈáåËÆæ‰∏∫7070Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">servlet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">context-path</span><span class="p">:</span><span class="w"> </span><span class="l">/admin        </span><span class="w"> </span><span class="c"># Â∫îÁî®‰∏ä‰∏ãÊñáË∑ØÂæÑÔºàËÆøÈóÆË∑ØÂæÑÈúÄÂä† `/admin`ÔºåÂ¶Ç `http://localhost:7070/admin`Ôºâ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>port: ÊåáÂÆöÂ∫îÁî®ËøêË°åÁöÑÁ´ØÂè£Âè∑ÔºàÈªòËÆ§ 8080ÔºåËøôÈáåÊîπ‰∏∫ 7070Ôºâ„ÄÇ</li>
<li>context-path: ËÆæÁΩÆÂ∫îÁî®ÁöÑÊ†πË∑ØÂæÑÔºàÂ¶Ç /adminÔºâÔºåÊâÄÊúâËØ∑Ê±ÇÈÉΩÈúÄË¶ÅÂä†‰∏äËøô‰∏™ÂâçÁºÄ„ÄÇ</li>
</ul>
<h3 id="2-Êñá‰ª∂‰∏ä‰º†ÈÖçÁΩÆspringservletmultipart">2. Êñá‰ª∂‰∏ä‰º†ÈÖçÁΩÆÔºàspring.servlet.multipartÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">servlet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">multipart</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">max-file-size</span><span class="p">:</span><span class="w"> </span><span class="l">10MB       </span><span class="w"> </span><span class="c"># Âçï‰∏™Êñá‰ª∂ÊúÄÂ§ßÂ§ßÂ∞èÔºàÈªòËÆ§1MBÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">max-request-size</span><span class="p">:</span><span class="w"> </span><span class="l">15MB    </span><span class="w"> </span><span class="c"># Êï¥‰∏™ËØ∑Ê±ÇÁöÑÊúÄÂ§ßÂ§ßÂ∞èÔºàÈªòËÆ§10MBÔºâ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>max-file-size: ÈôêÂà∂Âçï‰∏™‰∏ä‰º†Êñá‰ª∂ÁöÑÂ§ßÂ∞èÔºàÂ¶Ç 10MBÔºâ„ÄÇ</li>
<li>max-request-size: ÈôêÂà∂Êï¥‰∏™ HTTP ËØ∑Ê±ÇÔºàÂèØËÉΩÂåÖÂê´Â§ö‰∏™Êñá‰ª∂ÔºâÁöÑÊúÄÂ§ßÂ§ßÂ∞èÔºàÂ¶Ç 15MBÔºâ„ÄÇ</li>
</ul>
<h3 id="3-Â∫îÁî®ÂêçÁß∞springapplicationname">3. Â∫îÁî®ÂêçÁß∞Ôºàspring.application.nameÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">easylive-admin        </span><span class="w"> </span><span class="c"># Â∫îÁî®ÂêçÁß∞ÔºàÁî®‰∫éÊúçÂä°ÂèëÁé∞„ÄÅÊó•ÂøóÊ†áËÆ∞Á≠âÔºâ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Áî®‰∫éÊ†áËØÜÂΩìÂâçÂ∫îÁî®ÔºàÂ¶ÇÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑÊúçÂä°ÂêçÔºâ„ÄÇ</li>
</ul>
<h3 id="4-Êï∞ÊçÆÂ∫ìÈÖçÁΩÆspringdatasource">4. Êï∞ÊçÆÂ∫ìÈÖçÁΩÆÔºàspring.datasourceÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://127.0.0.1:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root              </span><span class="w"> </span><span class="c"># Êï∞ÊçÆÂ∫ìÁî®Êà∑Âêç</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">root              </span><span class="w"> </span><span class="c"># Êï∞ÊçÆÂ∫ìÂØÜÁ†Å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driver-class-name</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver </span><span class="w"> </span><span class="c"># MySQL JDBC È©±Âä®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hikari</span><span class="p">:</span><span class="w">                      </span><span class="c"># HikariCP ËøûÊé•Ê±†ÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">pool-name</span><span class="p">:</span><span class="w"> </span><span class="l">HikariCPDatasource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">minimum-idle</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">            </span><span class="c"># ÊúÄÂ∞èÁ©∫Èó≤ËøûÊé•Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maximum-pool-size</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">      </span><span class="c"># ÊúÄÂ§ßËøûÊé•Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">idle-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">180000</span><span class="w">       </span><span class="c"># Á©∫Èó≤ËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥ÔºàÊØ´ÁßíÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">max-lifetime</span><span class="p">:</span><span class="w"> </span><span class="m">1800000</span><span class="w">      </span><span class="c"># ËøûÊé•ÊúÄÂ§ßÂ≠òÊ¥ªÊó∂Èó¥ÔºàÊØ´ÁßíÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">connection-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">30000</span><span class="w">  </span><span class="c"># ËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥ÔºàÊØ´ÁßíÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">connection-test-query</span><span class="p">:</span><span class="w"> </span><span class="l">SELECT 1 </span><span class="w"> </span><span class="c"># ËøûÊé•ÊµãËØïSQL</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>url: MySQL Êï∞ÊçÆÂ∫ìËøûÊé•Âú∞ÂùÄÔºåÂåÖÂê´ serverTimezone„ÄÅÁºñÁ†Å„ÄÅËá™Âä®ÈáçËøûÁ≠âÂèÇÊï∞„ÄÇ</li>
<li>hikari: HikariCP ÊòØ Spring Boot ÈªòËÆ§ÁöÑÈ´òÊÄßËÉΩÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†ÔºåËøôÈáåÈÖçÁΩÆ‰∫ÜËøûÊé•Ê±†ÂèÇÊï∞„ÄÇ</li>
</ul>
<h3 id="5-redis-ÈÖçÁΩÆspringredis">5. Redis ÈÖçÁΩÆÔºàspring.redisÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">                  </span><span class="c"># Redis Êï∞ÊçÆÂ∫ìÁ¥¢ÂºïÔºàÈªòËÆ§0Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">              </span><span class="c"># Redis ÊúçÂä°Âô®Âú∞ÂùÄ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">6379</span><span class="w">                   </span><span class="c"># Redis Á´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">jedis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">pool</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max-active</span><span class="p">:</span><span class="w"> </span><span class="m">20</span><span class="w">           </span><span class="c"># ÊúÄÂ§ßÊ¥ªË∑ÉËøûÊé•Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max-wait</span><span class="p">:</span><span class="w"> </span>-<span class="m">1</span><span class="w">             </span><span class="c"># ÊúÄÂ§ßÁ≠âÂæÖÊó∂Èó¥Ôºà-1Ë°®Á§∫Êó†ÈôêÁ≠âÂæÖÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max-idle</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">             </span><span class="c"># ÊúÄÂ§ßÁ©∫Èó≤ËøûÊé•Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">min-idle</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">              </span><span class="c"># ÊúÄÂ∞èÁ©∫Èó≤ËøûÊé•Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="m">2000</span><span class="w">                </span><span class="c"># ËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥ÔºàÊØ´ÁßíÔºâ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÈÖçÁΩÆ Redis ËøûÊé•‰ø°ÊÅØÔºå‰ΩøÁî® Jedis ‰Ωú‰∏∫ÂÆ¢Êà∑Á´Ø„ÄÇ</li>
</ul>
<h3 id="6-mybatis-ÈÖçÁΩÆmybatis">6. MyBatis ÈÖçÁΩÆÔºàmybatisÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">mybatis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">map-underscore-to-camel-case</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">  </span><span class="c"># Êï∞ÊçÆÂ∫ìÂ≠óÊÆµ‰∏ãÂàíÁ∫øËΩ¨È©ºÂ≥∞ÂëΩÂêçÔºàÂ¶Ç `user_name` ‚Üí `userName`Ôºâ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>map-underscore-to-camel-case: Ëá™Âä®Â∞ÜÊï∞ÊçÆÂ∫ìÁöÑ snake_case Â≠óÊÆµÂêçÊò†Â∞Ñ‰∏∫ Java ÁöÑ camelCase Â±ûÊÄßÂêç„ÄÇ</li>
</ul>
<h3 id="7-Ëá™ÂÆö‰πâÈÖçÁΩÆprojectlogadmin">7. Ëá™ÂÆö‰πâÈÖçÁΩÆÔºàproject„ÄÅlog„ÄÅadminÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">project</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">folder</span><span class="p">:</span><span class="w"> </span><span class="l">D:/work-webser/myapps/easylive </span><span class="w"> </span><span class="c"># Ëá™ÂÆö‰πâÈ°πÁõÆÊñá‰ª∂Â≠òÂÇ®Ë∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">log</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">root</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l">debug                 </span><span class="w"> </span><span class="c"># Êó•ÂøóÁ∫ßÂà´Ôºàdebug„ÄÅinfo„ÄÅwarn„ÄÅerrorÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">admin</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">account</span><span class="p">:</span><span class="w"> </span><span class="l">admin                 </span><span class="w"> </span><span class="c"># ÁÆ°ÁêÜÂëòË¥¶Âè∑</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">admin123             </span><span class="w"> </span><span class="c"># ÁÆ°ÁêÜÂëòÂØÜÁ†Å</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>project.folder: Ëá™ÂÆö‰πâÊñá‰ª∂Â≠òÂÇ®Ë∑ØÂæÑÔºàÂ¶Ç‰∏ä‰º†ÁöÑÊñá‰ª∂Â≠òÊîæ‰ΩçÁΩÆÔºâ„ÄÇ</li>
<li>log.root.level: ËÆæÁΩÆÊó•ÂøóÁ∫ßÂà´Ôºàdebug ‰ºöÊâìÂç∞Êõ¥ËØ¶ÁªÜÁöÑÊó•ÂøóÔºâ„ÄÇ</li>
<li>admin.account/password: ÂèØËÉΩÊòØÁî®‰∫éÂêéÂè∞ÁÆ°ÁêÜÁöÑÈªòËÆ§Ë¥¶Âè∑ÂØÜÁ†Å„ÄÇ</li>
</ul>
<h3 id="ÊÄªÁªì">ÊÄªÁªì
</h3><p>application.yml Êñá‰ª∂ÂèØ‰ª•Ê†πÊçÆÂÆûÈôÖ‰∏öÂä°ÈúÄÊ±ÇÔºåÁÅµÊ¥ªÊâ©Â±ïÂíåÂÆöÂà∂„ÄÇÂ∏∏ËßÅÈÖçÁΩÆËøòÂåÖÊã¨ÂÆâÂÖ®ÔºàsecurityÔºâ„ÄÅÁ¨¨‰∏âÊñπÊúçÂä°ÔºàÂ¶ÇÁü≠‰ø°„ÄÅÊîØ‰ªòÔºâ„ÄÅËá™ÂÆö‰πâÂèÇÊï∞Á≠â„ÄÇÈÄöËøáÈõÜ‰∏≠ÁÆ°ÁêÜËøô‰∫õÈÖçÁΩÆÔºåÂèØ‰ª•ËÆ© Spring Boot È°πÁõÆÊõ¥Êòì‰∫éÁª¥Êä§ÂíåÈÉ®ÁΩ≤„ÄÇ</p>
<h2 id="hikaricp-‰ªãÁªç">HikariCP ‰ªãÁªç
</h2><p>HikariCP ÊòØÁõÆÂâç Java ÁîüÊÄÅ‰∏≠ÊúÄÂø´„ÄÅÊúÄËΩªÈáèÁ∫ßÁöÑÈ´òÊÄßËÉΩ JDBC ËøûÊé•Ê±†ÔºåË¢´ Spring Boot 2.x ÂèäÊõ¥È´òÁâàÊú¨ÈÄâ‰∏∫ÈªòËÆ§Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†„ÄÇÂÆÉÁöÑÂêçÂ≠óÊù•Ê∫ê‰∫éÊó•ËØ≠&quot;ÂÖâ&quot;ÔºàHikariÔºâÔºåÊÑè‰∏∫&quot;Âø´ÈÄü„ÄÅÈ´òÊïà&quot;„ÄÇ</p>
<h3 id="1-‰∏∫‰ªÄ‰πàÈÄâÊã©-hikaricp">1. ‰∏∫‰ªÄ‰πàÈÄâÊã© HikariCPÔºü
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÁâπÊÄß</th>
          <th>ËØ¥Êòé</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÊûÅÈ´òÊÄßËÉΩ</td>
          <td>ÊØî‰º†ÁªüÁöÑ C3P0„ÄÅTomcat JDBC„ÄÅDBCP Âø´ÂæàÂ§ö</td>
      </tr>
      <tr>
          <td>ËΩªÈáèÁ∫ß</td>
          <td>‰ª£Á†ÅÁ≤æÁÆÄÔºàÁ∫¶ 130KBÔºâÔºåÊó†È¢ùÂ§ñ‰æùËµñ</td>
      </tr>
      <tr>
          <td>Èõ∂ÂºÄÈîÄ</td>
          <td>‰ºòÂåñ‰∫ÜÂ≠óËäÇÁ†ÅÔºåÂáèÂ∞ë JVM ÂûÉÂúæÂõûÊî∂ÂéãÂäõ</td>
      </tr>
      <tr>
          <td>Ëá™Âä®‰ºòÂåñ</td>
          <td>Êô∫ËÉΩË∞ÉÊï¥ËøûÊé•Ê±†Â§ßÂ∞èÔºåÈÅøÂÖçËµÑÊ∫êÊµ™Ë¥π</td>
      </tr>
      <tr>
          <td>ÂÅ•Â∫∑Ê£ÄÊü•</td>
          <td>Ëá™Âä®Ê£ÄÊµãÂ§±ÊïàËøûÊé•ÔºåÈÅøÂÖçÂ∫îÁî®Âõ†Êï∞ÊçÆÂ∫ìÈóÆÈ¢òÂ¥©Ê∫É</td>
      </tr>
      <tr>
          <td>Spring Boot ÈªòËÆ§</td>
          <td>Êó†ÈúÄÈ¢ùÂ§ñÈÖçÁΩÆÔºåÂºÄÁÆ±Âç≥Áî®</td>
      </tr>
  </tbody>
</table></div>
<h3 id="2-hikaricp-Ê†∏ÂøÉÈÖçÁΩÆÂèÇÊï∞">2. HikariCP Ê†∏ÂøÉÈÖçÁΩÆÂèÇÊï∞
</h3><p>Âú®‰Ω†ÁöÑ application.yml ‰∏≠ÔºåHikariCP ÁöÑÈÖçÁΩÆÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hikari</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">pool-name</span><span class="p">:</span><span class="w"> </span><span class="l">HikariCPDatasource  </span><span class="w"> </span><span class="c"># ËøûÊé•Ê±†ÂêçÁß∞ÔºàÁî®‰∫éÁõëÊéßÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">minimum-idle</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">                 </span><span class="c"># ÊúÄÂ∞èÁ©∫Èó≤ËøûÊé•Êï∞ÔºàÈªòËÆ§Á≠â‰∫é maximum-pool-sizeÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maximum-pool-size</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">           </span><span class="c"># ÊúÄÂ§ßËøûÊé•Êï∞ÔºàÊé®ËçêÂÄºÔºöCPUÊ†∏ÂøÉÊï∞ * 2 + 1Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">idle-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">180000</span><span class="w">            </span><span class="c"># Á©∫Èó≤ËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥ÔºàÊØ´ÁßíÔºåÈªòËÆ§ 60000Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">max-lifetime</span><span class="p">:</span><span class="w"> </span><span class="m">1800000</span><span class="w">           </span><span class="c"># ËøûÊé•ÊúÄÂ§ßÂ≠òÊ¥ªÊó∂Èó¥ÔºàÊØ´ÁßíÔºåÈªòËÆ§ 1800000Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">auto-commit</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">               </span><span class="c"># ÊòØÂê¶Ëá™Âä®Êèê‰∫§‰∫ãÂä°ÔºàÈªòËÆ§ trueÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">connection-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">30000</span><span class="w">       </span><span class="c"># ËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥ÔºàÊØ´ÁßíÔºåÈªòËÆ§ 30000Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">connection-test-query</span><span class="p">:</span><span class="w"> </span><span class="l">SELECT 1</span><span class="w"> </span><span class="c"># ËøûÊé•ÊµãËØï SQLÔºàÁî®‰∫éÊ£ÄÊü•ËøûÊé•ÊòØÂê¶ÊúâÊïàÔºâ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ÂÖ≥ÈîÆÂèÇÊï∞ËØ¥Êòé">ÂÖ≥ÈîÆÂèÇÊï∞ËØ¥Êòé
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÂèÇÊï∞</th>
          <th>Êé®ËçêÂÄº</th>
          <th>‰ΩúÁî®</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>maximum-pool-size</td>
          <td>CPUÊ†∏ÂøÉÊï∞ * 2 + 1</td>
          <td>ÈÅøÂÖçËøûÊé•Êï∞ËøáÂ§öÂØºËá¥Êï∞ÊçÆÂ∫ìÊÄßËÉΩ‰∏ãÈôç</td>
      </tr>
      <tr>
          <td>minimum-idle</td>
          <td>‚â§ maximum-pool-size</td>
          <td>‰øùÊåÅÁöÑÊúÄÂ∞èÁ©∫Èó≤ËøûÊé•Êï∞ÔºàÈªòËÆ§Á≠â‰∫éÊúÄÂ§ßÂÄºÔºâ</td>
      </tr>
      <tr>
          <td>idle-timeout</td>
          <td>60000Ôºà1ÂàÜÈíüÔºâ</td>
          <td>Á©∫Èó≤ËøûÊé•Ë∂ÖËøáÊ≠§Êó∂Èó¥‰ºöË¢´ÂõûÊî∂</td>
      </tr>
      <tr>
          <td>max-lifetime</td>
          <td>1800000Ôºà30ÂàÜÈíüÔºâ</td>
          <td>ËøûÊé•ÊúÄÂ§ßÂ≠òÊ¥ªÊó∂Èó¥ÔºåÈÅøÂÖçÈïøÊó∂Èó¥Âç†Áî®</td>
      </tr>
      <tr>
          <td>connection-timeout</td>
          <td>30000Ôºà30ÁßíÔºâ</td>
          <td>Ëé∑ÂèñËøûÊé•ÁöÑË∂ÖÊó∂Êó∂Èó¥ÔºåË∂ÖÊó∂ÊäõÂºÇÂ∏∏</td>
      </tr>
      <tr>
          <td>connection-test-query</td>
          <td>SELECT 1</td>
          <td>Ê£ÄÊü•ËøûÊé•ÊòØÂê¶ÊúâÊïàÁöÑ SQLÔºàMySQL ÂèØÁî®Ôºâ</td>
      </tr>
  </tbody>
</table></div>
<h3 id="3-hikaricp-ÁöÑ‰ºòÂäø">3. HikariCP ÁöÑ‰ºòÂäø
</h3><p><strong>(1) ÊÄßËÉΩÊûÅËá¥‰ºòÂåñ</strong></p>
<ul>
<li>Êó†ÈîÅÂπ∂ÂèëÔºöÈááÁî® ConcurrentBag Êï∞ÊçÆÁªìÊûÑÔºåÂáèÂ∞ëÈîÅÁ´û‰∫â„ÄÇ</li>
<li>Â≠óËäÇÁ†Å‰ºòÂåñÔºöÂáèÂ∞ë JVM ÊñπÊ≥ïË∞ÉÁî®ÂºÄÈîÄ„ÄÇ</li>
<li>Êô∫ËÉΩÁºìÂ≠òÔºöÂ§çÁî® PreparedStatementÔºåÂáèÂ∞ë SQL Ëß£ÊûêÊó∂Èó¥„ÄÇ</li>
</ul>
<p><strong>(2) Ëá™Âä®Áª¥Êä§ËøûÊé•ÂÅ•Â∫∑</strong></p>
<ul>
<li>ÂøÉË∑≥Ê£ÄÊµãÔºöÂÆöÊúüÊ£ÄÊü•ËøûÊé•ÊòØÂê¶ÊúâÊïàÔºåÈÅøÂÖç‰ΩøÁî®Â∑≤Êñ≠ÂºÄÁöÑËøûÊé•„ÄÇ</li>
<li>Âø´ÈÄüÂ§±Ë¥•ÔºöÂ¶ÇÊûúÊï∞ÊçÆÂ∫ìÂÆïÊú∫ÔºåHikariCP ‰ºöÁ´ãÂç≥ÊäõÂá∫ÂºÇÂ∏∏ÔºåËÄå‰∏çÊòØÊó†ÈôêÁ≠âÂæÖ„ÄÇ</li>
</ul>
<p><strong>(3) ‰∏é Spring Boot ÂÆåÁæéÈõÜÊàê</strong></p>
<ul>
<li>Spring Boot 2.x ÈªòËÆ§‰ΩøÁî® HikariCPÔºåÂè™ÈúÄÈÖçÁΩÆ spring.datasource.hikari.* Âç≥ÂèØ„ÄÇ</li>
</ul>
<h3 id="4-Â∏∏ËßÅÈóÆÈ¢ò">4. Â∏∏ËßÅÈóÆÈ¢ò
</h3><p><strong>Q1: HikariCP Âíå Druid Âì™‰∏™Êõ¥Â•ΩÔºü</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÂØπÊØîÈ°π</th>
          <th>HikariCP</th>
          <th>Druid</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÊÄßËÉΩ</td>
          <td>‚ö° Êõ¥Âø´</td>
          <td>Á®çÊÖ¢</td>
      </tr>
      <tr>
          <td>ÂäüËÉΩ</td>
          <td>Âü∫Á°ÄËøûÊé•Ê±†</td>
          <td>Â∏¶ÁõëÊéß„ÄÅSQL Èò≤ÁÅ´Â¢ôÁ≠â</td>
      </tr>
      <tr>
          <td>ÈÄÇÁî®Âú∫ÊôØ</td>
          <td>È´òÊÄßËÉΩÈúÄÊ±Ç</td>
          <td>ÈúÄË¶ÅÁõëÊéßÂíåÊâ©Â±ïÂäüËÉΩ</td>
      </tr>
  </tbody>
</table></div>
<p><strong>Êé®ËçêÈÄâÊã©Ôºö</strong></p>
<ul>
<li>Â¶ÇÊûúÂè™ÈúÄË¶ÅÈ´òÊÄßËÉΩËøûÊé•Ê±† ‚Üí HikariCPÔºàÈªòËÆ§Êé®ËçêÔºâ„ÄÇ</li>
<li>Â¶ÇÊûúÈúÄË¶ÅÁõëÊéß„ÄÅSQL Èò≤Ê≥®ÂÖ• ‚Üí Druid„ÄÇ</li>
</ul>
<p><strong>Q2: Â¶Ç‰ΩïÁõëÊéß HikariCPÔºü</strong></p>
<p>ÂèØ‰ª•ÈÄöËøá Spring Boot Actuator Êàñ JMX ÁõëÊéßËøûÊé•Ê±†Áä∂ÊÄÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">management</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">endpoints</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">web</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">exposure</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">health,metrics,hikaricp</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ËÆøÈóÆ http://localhost:7070/actuator/hikaricp Êü•ÁúãËøûÊé•Ê±†Áä∂ÊÄÅ„ÄÇ</p>
<h3 id="5-ÊÄªÁªì">5. ÊÄªÁªì
</h3><ul>
<li>HikariCP ÊòØ Spring Boot ÈªòËÆ§ÁöÑÈ´òÊÄßËÉΩËøûÊé•Ê±†ÔºåÈÄÇÂêàÁªùÂ§ßÂ§öÊï∞Âú∫ÊôØ„ÄÇ</li>
<li>ÂÖ≥ÈîÆÈÖçÁΩÆÔºömaximum-pool-size„ÄÅminimum-idle„ÄÅconnection-timeout„ÄÇ</li>
<li>‰ºòÂäøÔºöÈÄüÂ∫¶Âø´„ÄÅËΩªÈáèÁ∫ß„ÄÅËá™Âä®Áª¥Êä§ËøûÊé•ÂÅ•Â∫∑„ÄÇ</li>
<li>ÁõëÊéßÔºöÂèØÈÄöËøá Actuator Êàñ JMX Êü•ÁúãÁä∂ÊÄÅ„ÄÇ</li>
</ul>
<p>Â¶ÇÊûú‰Ω†ÁöÑÂ∫îÁî®‰∏çÈúÄË¶Å Druid ÁöÑÈ¢ùÂ§ñÂäüËÉΩÔºåHikariCP ÊòØÊúÄ‰Ω≥ÈÄâÊã©ÔºÅ</p>
<h2 id="jdbc-ËøûÊé•Ê±†connection-poolËØ¶Ëß£">JDBC ËøûÊé•Ê±†ÔºàConnection PoolÔºâËØ¶Ëß£
</h2><p>JDBCÔºàJava Database ConnectivityÔºâÊòØ Java ËøûÊé•Êï∞ÊçÆÂ∫ìÁöÑÊ†áÂáÜ APIÔºåËÄå JDBC ËøûÊé•Ê±†ÊòØ‰∏ÄÁßçÊï∞ÊçÆÂ∫ìËøûÊé•ÁÆ°ÁêÜÊäÄÊúØÔºåÁî®‰∫éÈ´òÊïàÂ§çÁî®Êï∞ÊçÆÂ∫ìËøûÊé•ÔºåÈÅøÂÖçÈ¢ëÁπÅÂàõÂª∫ÂíåÈîÄÊØÅËøûÊé•Â∏¶Êù•ÁöÑÊÄßËÉΩÂºÄÈîÄ„ÄÇ</p>
<h3 id="1-‰∏∫‰ªÄ‰πàÈúÄË¶ÅËøûÊé•Ê±†">1. ‰∏∫‰ªÄ‰πàÈúÄË¶ÅËøûÊé•Ê±†Ôºü
</h3><p><strong>Ôºà1ÔºâÁõ¥Êé• JDBC ÁöÑÈóÆÈ¢ò</strong></p>
<p>Â¶ÇÊûúÊØèÊ¨°ËÆøÈóÆÊï∞ÊçÆÂ∫ìÈÉΩÁõ¥Êé•ÂàõÂª∫Êñ∞ËøûÊé•Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ‰º†ÁªüÊñπÂºèÔºöÊØèÊ¨°Êìç‰ΩúÊï∞ÊçÆÂ∫ìÈÉΩÊñ∞Âª∫ËøûÊé•Ôºà‰ΩéÊïàÔºÅÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÊâßË°åSQL...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">conn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"> </span><span class="c1">// ÂÖ≥Èó≠ËøûÊé•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Áº∫ÁÇπÔºö</strong></p>
<ul>
<li>È¢ëÁπÅÂàõÂª∫/ÂÖ≥Èó≠ËøûÊé•Ê∂àËÄóÂ§ßÈáèËµÑÊ∫êÔºàTCP ‰∏âÊ¨°Êè°Êâã„ÄÅÊï∞ÊçÆÂ∫ìËÆ§ËØÅÁ≠âÔºâ„ÄÇ</li>
<li>È´òÂπ∂ÂèëÊó∂ÔºåÊï∞ÊçÆÂ∫ìÂèØËÉΩÂõ†ËøûÊé•Êï∞ËøáÂ§öËÄåÂ¥©Ê∫É„ÄÇ</li>
</ul>
<p><strong>Ôºà2ÔºâËøûÊé•Ê±†ÁöÑËß£ÂÜ≥ÊñπÊ°à</strong></p>
<p>ËøûÊé•Ê±†È¢ÑÂÖàÂàõÂª∫‰∏ÄÊâπËøûÊé•ÔºåÂ∫îÁî®ÈúÄË¶ÅÊó∂Áõ¥Êé•‰ªéÊ±†‰∏≠Ëé∑ÂèñÔºåÁî®ÂÆåÂΩíËøòÔºàËÄå‰∏çÊòØÂÖ≥Èó≠ÔºâÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ‰ΩøÁî®ËøûÊé•Ê±†ÔºàÈ´òÊïàÔºÅÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">();</span><span class="w"> </span><span class="c1">// ‰ªéÊ±†‰∏≠Ëé∑Âèñ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÊâßË°åSQL...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">conn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"> </span><span class="c1">// ÂÆûÈôÖÊòØÂΩíËøòÂà∞ËøûÊé•Ê±†ÔºåÂπ∂ÈùûÁúüÊ≠£ÂÖ≥Èó≠</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>‰ºòÁÇπÔºö</strong></p>
<ul>
<li>Â§çÁî®ËøûÊé•ÔºåÈÅøÂÖçÈáçÂ§çÂàõÂª∫ÁöÑÂºÄÈîÄ„ÄÇ</li>
<li>ÊéßÂà∂ÊúÄÂ§ßËøûÊé•Êï∞ÔºåÈò≤Ê≠¢Êï∞ÊçÆÂ∫ìËøáËΩΩ„ÄÇ</li>
<li>ÊîØÊåÅÂÅ•Â∫∑Ê£ÄÊü•ÔºåËá™Âä®ÂâîÈô§Â§±ÊïàËøûÊé•„ÄÇ</li>
</ul>
<h3 id="2-ËøûÊé•Ê±†ÁöÑÊ†∏ÂøÉÂ∑•‰ΩúÂéüÁêÜ">2. ËøûÊé•Ê±†ÁöÑÊ†∏ÂøÉÂ∑•‰ΩúÂéüÁêÜ
</h3><p><strong>Ôºà1ÔºâÂàùÂßãÂåñÈò∂ÊÆµ</strong></p>
<ul>
<li>ÂêØÂä®Êó∂ÂàõÂª∫‰∏ÄÂÆöÊï∞ÈáèÁöÑËøûÊé•ÔºàÂ¶Ç minimum-idle=5ÔºâÔºåÊîæÂÖ•Ê±†‰∏≠Â§áÁî®„ÄÇ</li>
</ul>
<p><strong>Ôºà2ÔºâËøêË°åÈò∂ÊÆµ</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Ê≠•È™§</th>
          <th>ËØ¥Êòé</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Â∫îÁî®ËØ∑Ê±ÇËøûÊé•</td>
          <td>‰ªéÊ±†‰∏≠ÂàÜÈÖç‰∏Ä‰∏™Á©∫Èó≤ËøûÊé•</td>
      </tr>
      <tr>
          <td>ÊâßË°å SQL</td>
          <td>‰ΩøÁî®ËøûÊé•Êìç‰ΩúÊï∞ÊçÆÂ∫ì</td>
      </tr>
      <tr>
          <td>ÂΩíËøòËøûÊé•</td>
          <td>Ë∞ÉÁî® conn.close()ÔºåËøûÊé•ÂõûÂà∞Ê±†‰∏≠ÔºàÊú™ÁúüÊ≠£ÂÖ≥Èó≠Ôºâ</td>
      </tr>
  </tbody>
</table></div>
<p><strong>Ôºà3ÔºâËøûÊé•ÁÆ°ÁêÜ</strong></p>
<ul>
<li>Á©∫Èó≤Ë∂ÖÊó∂ÔºöÈïøÊó∂Èó¥Êú™‰ΩøÁî®ÁöÑËøûÊé•‰ºöË¢´ÂõûÊî∂Ôºàidle-timeoutÔºâ„ÄÇ</li>
<li>ÊúÄÂ§ßÁîüÂëΩÂë®ÊúüÔºöËøûÊé•Ë∂ÖËøáÂ≠òÊ¥ªÊó∂Èó¥Ôºàmax-lifetimeÔºâ‰ºöË¢´ÈîÄÊØÅÂπ∂Êñ∞Âª∫„ÄÇ</li>
<li>ÂÅ•Â∫∑Ê£ÄÊü•ÔºöÂÆöÊúüÁî® SELECT 1 ÊµãËØïËøûÊé•ÊòØÂê¶ÊúâÊïà„ÄÇ</li>
</ul>
<h3 id="3-Â∏∏ËßÅ-jdbc-ËøûÊé•Ê±†ÂØπÊØî">3. Â∏∏ËßÅ JDBC ËøûÊé•Ê±†ÂØπÊØî
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ËøûÊé•Ê±†</th>
          <th>ÁâπÁÇπ</th>
          <th>ÈÄÇÁî®Âú∫ÊôØ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>HikariCP</td>
          <td>ÈÄüÂ∫¶ÊúÄÂø´„ÄÅËΩªÈáèÁ∫ß</td>
          <td>Spring Boot ÈªòËÆ§ÔºåÈ´òÊÄßËÉΩÈúÄÊ±Ç</td>
      </tr>
      <tr>
          <td>Druid</td>
          <td>Â∏¶ÁõëÊéß„ÄÅÈò≤ SQL Ê≥®ÂÖ•</td>
          <td>ÈúÄË¶ÅÁõëÊéßÂíåÊâ©Â±ïÂäüËÉΩ</td>
      </tr>
      <tr>
          <td>Tomcat JDBC</td>
          <td>ËΩªÈáèÁ∫ß</td>
          <td>ÂµåÂÖ•Âºè Tomcat Â∫îÁî®</td>
      </tr>
      <tr>
          <td>C3P0</td>
          <td>ËÄÅÁâåËøûÊé•Ê±†ÔºåÁ®≥ÂÆöÊÄßÈ´ò</td>
          <td>‰º†ÁªüÈ°πÁõÆÔºàÂ∑≤ÈÄêÊ∏êË¢´Âèñ‰ª£Ôºâ</td>
      </tr>
  </tbody>
</table></div>
<h3 id="4-‰ª£Á†ÅÁ§∫‰æãspring-boot--hikaricp">4. ‰ª£Á†ÅÁ§∫‰æãÔºàSpring Boot + HikariCPÔºâ
</h3><p><strong>Ôºà1Ôºâapplication.yml ÈÖçÁΩÆ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://localhost:3306/test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="m">123456</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hikari</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maximum-pool-size</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">connection-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">30000</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ôºà2ÔºâJava ‰ª£Á†Å‰ΩøÁî®</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span><span class="w"> </span><span class="c1">// Ëá™Âä®Ê≥®ÂÖ• HikariCP Êï∞ÊçÆÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">queryData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">();</span><span class="w"> </span><span class="c1">// ‰ªéÊ±†‰∏≠Ëé∑Âèñ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="n">Statement</span><span class="w"> </span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&#34;SELECT * FROM users&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// Ê≠§Â§ÑËá™Âä®Ë∞ÉÁî® conn.close()ÔºåËøûÊé•ÂΩíËøòÂà∞Ê±†‰∏≠</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-ÊÄªÁªì-1">5. ÊÄªÁªì
</h3><ul>
<li>JDBC ËøûÊé•Ê±†ÊòØÊï∞ÊçÆÂ∫ìËøûÊé•ÁöÑÁºìÂ≠òÊ±†ÔºåÊ†∏ÂøÉÁõÆÊ†áÊòØÂ§çÁî®ËøûÊé•„ÄÅÊèêÂçáÊÄßËÉΩ„ÄÇ</li>
<li>HikariCP ÊòØÁõÆÂâçÊúÄÂø´ÁöÑËøûÊé•Ê±†ÔºåÈÄÇÂêàÂ§ßÂ§öÊï∞ Java Â∫îÁî®„ÄÇ</li>
<li>ÂÖ≥ÈîÆÈÖçÁΩÆÔºömaximum-pool-size„ÄÅidle-timeout„ÄÅconnection-timeout„ÄÇ</li>
</ul>
<h2 id="springboot-ÂêØÂä®Á±ªeasylivewebrunapplication-ËØ¶Ëß£">SpringBoot ÂêØÂä®Á±ª‚Äî‚ÄîEasyLiveWebRunApplication ËØ¶Ëß£
</h2><p>ËøôÊÆµ‰ª£Á†ÅÊòØ Spring Boot Â∫îÁî®ÁöÑ‰∏ªÂêØÂä®Á±ªÔºåÂåÖÂê´‰∫ÜÂ§ö‰∏™ÂÖ≥ÈîÆÊ≥®Ëß£ÔºåÁî®‰∫éÈÖçÁΩÆÂíåÂêØÂä®Êï¥‰∏™Â∫îÁî®Á®ãÂ∫è„ÄÇ‰ª•‰∏ãÊòØÂêÑ‰∏™ÈÉ®ÂàÜÁöÑËØ¶ÁªÜËß£ÊûêÔºö</p>
<h3 id="1-springbootapplication">1. @SpringBootApplication
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="p">(</span><span class="n">scanBasePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#34;com.easylive&#34;</span><span class="p">})</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩúÁî®ÔºöÊ†áËÆ∞ËØ•Á±ª‰∏∫ Spring Boot Â∫îÁî®ÁöÑÂÖ•Âè£ÔºåÊï¥Âêà‰∫Ü‰ª•‰∏ã 3 ‰∏™Ê†∏ÂøÉÊ≥®Ëß£Ôºö
<ul>
<li>@SpringBootConfigurationÔºöÊ†áËØÜËøôÊòØ‰∏Ä‰∏™ Spring Boot ÈÖçÁΩÆÁ±ª„ÄÇ</li>
<li>@EnableAutoConfigurationÔºöÂêØÁî® Spring Boot ÁöÑËá™Âä®ÈÖçÁΩÆÔºàÂ¶ÇËá™Âä®ÈÖçÁΩÆÊï∞ÊçÆÊ∫ê„ÄÅWeb MVC Á≠âÔºâ„ÄÇ</li>
<li>@ComponentScanÔºöÊâ´ÊèèÊåáÂÆöÂåÖÔºàcom.easyliveÔºâ‰∏ãÁöÑÁªÑ‰ª∂Ôºà@Controller„ÄÅ@Service„ÄÅ@Repository Á≠âÔºâ„ÄÇ</li>
</ul>
</li>
<li>ÂèÇÊï∞Ôºö
<ul>
<li>scanBasePackagesÔºöÊòæÂºèÊåáÂÆöÊâ´ÊèèÁöÑÂåÖË∑ØÂæÑÔºàË¶ÜÁõñÈªòËÆ§Êâ´ÊèèÂΩìÂâçÂåÖÂèäÂÖ∂Â≠êÂåÖÔºâ„ÄÇ</li>
</ul>
</li>
</ul>
<h3 id="2-mapperscan">2. @MapperScan
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@MapperScan</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#34;com.easylive.mappers&#34;</span><span class="p">})</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩúÁî®ÔºöÂëäËØâ MyBatis Êâ´ÊèèÊåáÂÆöÂåÖÔºàcom.easylive.mappersÔºâ‰∏ãÁöÑ Mapper Êé•Âè£ÔºåÂπ∂Ëá™Âä®ÁîüÊàêÂÖ∂ÂÆûÁé∞Á±ªÔºàÊó†ÈúÄÊâãÂä®ÂÜôÂÆûÁé∞Ôºâ„ÄÇ</li>
<li>ËÉåÊôØÔºöMyBatis ÈúÄË¶ÅÂ∞ÜÊé•Âè£‰∏é XML/SQL Êò†Â∞ÑÊñá‰ª∂ÂÖ≥ËÅîÔºåÊ≠§Ê≥®Ëß£ÁúÅÂéª‰∫ÜÈÄê‰∏™Ê∑ªÂä† @Mapper Ê≥®Ëß£ÁöÑÈ∫ªÁÉ¶„ÄÇ</li>
</ul>
<h3 id="3-enabletransactionmanagement">3. @EnableTransactionManagement
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableTransactionManagement</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩúÁî®ÔºöÂêØÁî® Spring ÁöÑÂ£∞ÊòéÂºè‰∫ãÂä°ÁÆ°ÁêÜÔºàÂü∫‰∫é @Transactional Ê≥®Ëß£Ôºâ„ÄÇ</li>
<li>ÊïàÊûúÔºö
<ul>
<li>ÊñπÊ≥ïÊàñÁ±ª‰∏äÊ∑ªÂä† @Transactional ÂêéÔºåSpring ‰ºöËá™Âä®ÁÆ°ÁêÜÊï∞ÊçÆÂ∫ì‰∫ãÂä°ÔºàÂ¶ÇÊèê‰∫§„ÄÅÂõûÊªöÔºâ„ÄÇ</li>
<li>ÈªòËÆ§‰ΩøÁî® JDBC Êàñ JPA ÁöÑ‰∫ãÂä°ÁÆ°ÁêÜÂô®„ÄÇ</li>
</ul>
</li>
</ul>
<h3 id="4-enablescheduling">4. @EnableScheduling
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableScheduling</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩúÁî®ÔºöÂêØÁî® Spring ÁöÑÂÆöÊó∂‰ªªÂä°ÂäüËÉΩ„ÄÇ</li>
<li>Áî®Ê≥ïÔºöÂú®ÊñπÊ≥ï‰∏äÊ∑ªÂä† @Scheduled(cron=&ldquo;0 * * * * ?&rdquo;) Âç≥ÂèØÂÆö‰πâÂÆöÊó∂‰ªªÂä°ÔºàÂ¶ÇÊØèÂ§©ÂáåÊô®ÊâßË°åÊï∞ÊçÆÁªüËÆ°Ôºâ„ÄÇ</li>
</ul>
<h3 id="5-main-ÊñπÊ≥ï">5. main ÊñπÊ≥ï
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">EasyLiveWebRunApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩúÁî®ÔºöÂêØÂä® Spring Boot Â∫îÁî®ÁöÑÂÖ•Âè£ÊñπÊ≥ï„ÄÇ</li>
<li>ÊµÅÁ®ãÔºö
<ol>
<li>ÂàùÂßãÂåñ Spring ÂÆπÂô®„ÄÇ</li>
<li>Âä†ËΩΩËá™Âä®ÈÖçÁΩÆÔºàÂ¶Ç Web ÊúçÂä°Âô®„ÄÅÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†Á≠âÔºâ„ÄÇ</li>
<li>Êâ´ÊèèÂπ∂Ê≥®ÂÜåÊâÄÊúâ Spring ÁªÑ‰ª∂ÔºàÂ¶Ç Controller„ÄÅServiceÔºâ„ÄÇ</li>
</ol>
</li>
</ul>
<h3 id="6-ÊéíÈô§Ëá™Âä®ÈÖçÁΩÆÊú™‰ΩøÁî®‰ΩÜÈúÄÊ≥®ÊÑè">6. ÊéíÈô§Ëá™Âä®ÈÖçÁΩÆÔºàÊú™‰ΩøÁî®‰ΩÜÈúÄÊ≥®ÊÑèÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Á§∫‰æãÔºöÊéíÈô§Êï∞ÊçÆÊ∫êËá™Âä®ÈÖçÁΩÆÔºàÂ§öÊï∞ÊçÆÊ∫êÂú∫ÊôØÂèØËÉΩÈúÄË¶ÅÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SpringBootApplication</span><span class="p">(</span><span class="n">exclude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">DataSourceAutoConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">})</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Áî®ÈÄîÔºöÂ¶ÇÊûúÂ∫îÁî®‰∏çÈúÄË¶ÅÊï∞ÊçÆÂ∫ìÔºàÊàñÈúÄËá™ÂÆö‰πâÊï∞ÊçÆÊ∫êÔºâÔºåÂèØÈÄöËøá exclude Á¶ÅÁî® Spring Boot ÁöÑÈªòËÆ§ÈÖçÁΩÆ„ÄÇ</li>
</ul>
<h3 id="ÊÄªÁªìÊ†∏ÂøÉÂäüËÉΩ">ÊÄªÁªìÔºöÊ†∏ÂøÉÂäüËÉΩ
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Ê≥®Ëß£/‰ª£Á†Å</th>
          <th>‰ΩúÁî®</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>@SpringBootApplication</td>
          <td>ÂêØÂä®Ëá™Âä®ÈÖçÁΩÆ + ÁªÑ‰ª∂Êâ´Êèè</td>
      </tr>
      <tr>
          <td>@MapperScan</td>
          <td>Ëá™Âä®Ê≥®ÂÜå MyBatis Mapper Êé•Âè£</td>
      </tr>
      <tr>
          <td>@EnableTransactionManagement</td>
          <td>ÂêØÁî®‰∫ãÂä°ÁÆ°ÁêÜ</td>
      </tr>
      <tr>
          <td>@EnableScheduling</td>
          <td>ÂêØÁî®ÂÆöÊó∂‰ªªÂä°</td>
      </tr>
      <tr>
          <td>main()</td>
          <td>ÂêØÂä® Spring Boot Â∫îÁî®</td>
      </tr>
  </tbody>
</table></div>
<h4 id="Ë°•ÂÖÖËØ¥Êòé-1">Ë°•ÂÖÖËØ¥Êòé
</h4><ul>
<li>ÂåÖÊâ´ÊèèËåÉÂõ¥ÔºöscanBasePackages Á°Æ‰øùÊâ´ÊèèÊï¥‰∏™È°πÁõÆÔºàËÄå‰∏ç‰ªÖÊòØÂΩìÂâçÂåÖÔºâ„ÄÇ</li>
<li>MyBatis ÈõÜÊàêÔºö@MapperScan ÈúÄÈÖçÂêà mybatis-spring-boot-starter ‰æùËµñ‰ΩøÁî®„ÄÇ</li>
<li>‰∫ãÂä°ÊéßÂà∂ÔºöÂú® Service Â±ÇÊñπÊ≥ïÊ∑ªÂä† @Transactional Âç≥ÂèØÂÆûÁé∞‰∫ãÂä°ÔºàÂ¶ÇÂõûÊªöÂºÇÂ∏∏Êìç‰ΩúÔºâ„ÄÇ</li>
</ul>
<p>Ëøô‰∏™ÂêØÂä®Á±ªÊòØ Spring Boot Â∫îÁî®ÁöÑ&quot;Â§ßËÑë&quot;ÔºåÈÄöËøáÊ≥®Ëß£È©±Âä®‰∫ÜÊï¥‰∏™Ê°ÜÊû∂ÁöÑÂçè‰ΩúËøêË°å„ÄÇ</p>
<h2 id="httpservletrequesthttpservletresponsehttpsession-‰ªãÁªç">HttpServletRequest„ÄÅHttpServletResponse„ÄÅHttpSession ‰ªãÁªç
</h2><p>Ëøô‰∏â‰∏™ÊòØ Java Web ÂºÄÂèëÔºàServlet/JSPÔºâÁöÑÊ†∏ÂøÉÊé•Âè£ÔºåÁî®‰∫éÂ§ÑÁêÜ HTTP ËØ∑Ê±ÇÂíåÂìçÂ∫î‰ª•ÂèäÁî®Êà∑‰ºöËØùÁÆ°ÁêÜ„ÄÇÂú® Spring MVCÔºà@ControllerÔºâ‰∏≠‰πüË¢´ÂπøÊ≥õ‰ΩøÁî®„ÄÇ</p>
<h3 id="1-httpservletrequestËØ∑Ê±ÇÂØπË±°">1. HttpServletRequestÔºàËØ∑Ê±ÇÂØπË±°Ôºâ
</h3><p><strong>‰ΩúÁî®</strong></p>
<ul>
<li>Â∞ÅË£ÖÂÆ¢Êà∑Á´ØÔºàÊµèËßàÂô®ÔºâÂèëÈÄÅÁöÑ HTTP ËØ∑Ê±Ç‰ø°ÊÅØÔºåÂåÖÊã¨Ôºö
<ul>
<li>ËØ∑Ê±ÇÂèÇÊï∞ÔºàGET/POSTÔºâ</li>
<li>ËØ∑Ê±ÇÂ§¥ÔºàHeadersÔºâ</li>
<li>‰ºöËØùÔºàSessionÔºâ</li>
<li>ÂÆ¢Êà∑Á´Ø‰ø°ÊÅØÔºàIP„ÄÅUser-AgentÔºâ</li>
</ul>
</li>
</ul>
<p><strong>Â∏∏Áî®ÊñπÊ≥ï</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÊñπÊ≥ï</th>
          <th>ËØ¥Êòé</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>String getParameter(&ldquo;name&rdquo;)</td>
          <td>Ëé∑ÂèñËØ∑Ê±ÇÂèÇÊï∞ÔºàÂ¶Ç ?id=123 ÊàñË°®Âçï POST Êï∞ÊçÆÔºâ</td>
      </tr>
      <tr>
          <td>String[] getParameterValues(&ldquo;name&rdquo;)</td>
          <td>Ëé∑ÂèñÂ§çÈÄâÊ°ÜÁ≠âÂêåÂêçÂèÇÊï∞ÔºàËøîÂõûÊï∞ÁªÑÔºâ</td>
      </tr>
      <tr>
          <td>String getHeader(&ldquo;User-Agent&rdquo;)</td>
          <td>Ëé∑ÂèñËØ∑Ê±ÇÂ§¥‰ø°ÊÅØ</td>
      </tr>
      <tr>
          <td>String getMethod()</td>
          <td>Ëé∑ÂèñËØ∑Ê±ÇÊñπÊ≥ïÔºàGET/POST/PUT/DELETEÔºâ</td>
      </tr>
      <tr>
          <td>String getRequestURI()</td>
          <td>Ëé∑ÂèñËØ∑Ê±ÇË∑ØÂæÑÔºàÂ¶Ç /user/loginÔºâ</td>
      </tr>
      <tr>
          <td>Cookie[] getCookies()</td>
          <td>Ëé∑ÂèñÂÆ¢Êà∑Á´ØÂèëÈÄÅÁöÑ Cookie</td>
      </tr>
      <tr>
          <td>HttpSession getSession()</td>
          <td>Ëé∑ÂèñÊàñÂàõÂª∫‰ºöËØùÔºàSessionÔºâ</td>
      </tr>
      <tr>
          <td>String getRemoteAddr()</td>
          <td>Ëé∑ÂèñÂÆ¢Êà∑Á´Ø IP Âú∞ÂùÄ</td>
      </tr>
  </tbody>
</table></div>
<p><strong>‰ª£Á†ÅÁ§∫‰æã</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getUser</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Ëé∑ÂèñÂèÇÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getRemoteAddr</span><span class="p">();</span><span class="w"> </span><span class="c1">// Ëé∑ÂèñÂÆ¢Êà∑Á´ØIP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;User: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;, IP: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ip</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="2-httpservletresponseÂìçÂ∫îÂØπË±°">2. HttpServletResponseÔºàÂìçÂ∫îÂØπË±°Ôºâ
</h3><p><strong>‰ΩúÁî®</strong></p>
<ul>
<li>Â∞ÅË£ÖÊúçÂä°Âô®ËøîÂõûÁªôÂÆ¢Êà∑Á´ØÁöÑ HTTP ÂìçÂ∫î‰ø°ÊÅØÔºåÂåÖÊã¨Ôºö
<ul>
<li>ËÆæÁΩÆÂìçÂ∫îÁä∂ÊÄÅÁ†ÅÔºà200/404/500Ôºâ</li>
<li>Ê∑ªÂä†ÂìçÂ∫îÂ§¥ÔºàHeadersÔºâ</li>
<li>ÂÜôÂÖ•ÂìçÂ∫î‰ΩìÔºàHTML/JSONÔºâ</li>
<li>ÈáçÂÆöÂêëÊàñËΩ¨Âèë</li>
</ul>
</li>
</ul>
<p><strong>Â∏∏Áî®ÊñπÊ≥ï</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÊñπÊ≥ï</th>
          <th>ËØ¥Êòé</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>void setStatus(200)</td>
          <td>ËÆæÁΩÆ HTTP Áä∂ÊÄÅÁ†ÅÔºàÂ¶Ç 404„ÄÅ500Ôºâ</td>
      </tr>
      <tr>
          <td>void setContentType(&ldquo;text/html&rdquo;)</td>
          <td>ËÆæÁΩÆÂìçÂ∫îÂÜÖÂÆπÁ±ªÂûãÔºàÂ¶Ç application/jsonÔºâ</td>
      </tr>
      <tr>
          <td>PrintWriter getWriter()</td>
          <td>Ëé∑ÂèñËæìÂá∫ÊµÅÔºåÂêëÂÆ¢Êà∑Á´ØÂèëÈÄÅÊñáÊú¨ÔºàHTML/JSONÔºâ</td>
      </tr>
      <tr>
          <td>void sendRedirect(&quot;/new-url&quot;)</td>
          <td>ÈáçÂÆöÂêëÂà∞Êñ∞Âú∞ÂùÄÔºà302 Ë∑≥ËΩ¨Ôºâ</td>
      </tr>
      <tr>
          <td>void addCookie(Cookie cookie)</td>
          <td>ÂêëÂÆ¢Êà∑Á´ØÊ∑ªÂä† Cookie</td>
      </tr>
      <tr>
          <td>void setHeader(&ldquo;Cache-Control&rdquo;, &ldquo;no-cache&rdquo;)</td>
          <td>ËÆæÁΩÆÂìçÂ∫îÂ§¥</td>
      </tr>
  </tbody>
</table></div>
<p><strong>‰ª£Á†ÅÁ§∫‰æã</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sayHello</span><span class="p">(</span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="s">&#34;text/html&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">write</span><span class="p">(</span><span class="s">&#34;&lt;h1&gt;Hello World!&lt;/h1&gt;&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/redirect&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">redirect</span><span class="p">(</span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">sendRedirect</span><span class="p">(</span><span class="s">&#34;https://example.com&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// ÈáçÂÆöÂêë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="3-httpsession‰ºöËØùÂØπË±°">3. HttpSessionÔºà‰ºöËØùÂØπË±°Ôºâ
</h3><p><strong>‰ΩúÁî®</strong></p>
<ul>
<li>Áî®‰∫éÂú®Â§öÊ¨° HTTP ËØ∑Ê±ÇÈó¥Â≠òÂÇ®Áî®Êà∑Êï∞ÊçÆÔºàÂ¶ÇÁôªÂΩïÁä∂ÊÄÅ„ÄÅË¥≠Áâ©ËΩ¶‰ø°ÊÅØÔºâ„ÄÇ</li>
<li>Âü∫‰∫é CookieÔºàJSESSIONIDÔºâÊàñ URL ÈáçÂÜôÂÆûÁé∞‰ºöËØùË∑üË∏™„ÄÇ</li>
</ul>
<p><strong>Â∏∏Áî®ÊñπÊ≥ï</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÊñπÊ≥ï</th>
          <th>ËØ¥Êòé</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>void setAttribute(&ldquo;key&rdquo;, value)</td>
          <td>Â≠òÂÇ®‰ºöËØùÊï∞ÊçÆ</td>
      </tr>
      <tr>
          <td>Object getAttribute(&ldquo;key&rdquo;)</td>
          <td>Ëé∑Âèñ‰ºöËØùÊï∞ÊçÆ</td>
      </tr>
      <tr>
          <td>void removeAttribute(&ldquo;key&rdquo;)</td>
          <td>Âà†Èô§‰ºöËØùÊï∞ÊçÆ</td>
      </tr>
      <tr>
          <td>void invalidate()</td>
          <td>ÈîÄÊØÅÂΩìÂâç‰ºöËØùÔºàÁî®Êà∑Ê≥®ÈîÄÔºâ</td>
      </tr>
      <tr>
          <td>String getId()</td>
          <td>Ëé∑Âèñ‰ºöËØù ID</td>
      </tr>
      <tr>
          <td>long getCreationTime()</td>
          <td>Ëé∑Âèñ‰ºöËØùÂàõÂª∫Êó∂Èó¥</td>
      </tr>
  </tbody>
</table></div>
<p><strong>‰ª£Á†ÅÁ§∫‰æã</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÁôªÂΩïÊó∂Â≠òÂÇ®Áî®Êà∑‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/login&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">HttpSession</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getSession</span><span class="p">();</span><span class="w"> </span><span class="c1">// Ëé∑ÂèñÊàñÂàõÂª∫Session</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">session</span><span class="p">.</span><span class="na">setAttribute</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">);</span><span class="w"> </span><span class="c1">// Â≠òÂÇ®Áî®Êà∑‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Login success!&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ëé∑Âèñ‰ºöËØùÊï∞ÊçÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/profile&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">profile</span><span class="p">(</span><span class="n">HttpSession</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">getAttribute</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Current user: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">user</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ê≥®ÈîÄ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/logout&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">logout</span><span class="p">(</span><span class="n">HttpSession</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">session</span><span class="p">.</span><span class="na">invalidate</span><span class="p">();</span><span class="w"> </span><span class="c1">// ÈîÄÊØÅ‰ºöËØù</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Logged out!&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="4-‰∏âËÄÖÁöÑÂÖ≥Á≥ª">4. ‰∏âËÄÖÁöÑÂÖ≥Á≥ª
</h3><p><strong>ËØ∑Ê±ÇÊµÅÁ®ãÔºö</strong></p>
<ul>
<li>ÊµèËßàÂô®ÂèëÈÄÅËØ∑Ê±Ç ‚Üí HttpServletRequest Êé•Êî∂Êï∞ÊçÆ„ÄÇ</li>
<li>ÊúçÂä°Âô®Â§ÑÁêÜËØ∑Ê±Ç ‚Üí ‰ΩøÁî® HttpSession Â≠òÂÇ®Áî®Êà∑Áä∂ÊÄÅ„ÄÇ</li>
<li>ÊúçÂä°Âô®ËøîÂõûÂìçÂ∫î ‚Üí HttpServletResponse ËæìÂá∫ÁªìÊûú„ÄÇ</li>
</ul>
<p><strong>ÂÖ∏ÂûãÂú∫ÊôØÔºö</strong></p>
<ul>
<li>ÁôªÂΩïËÆ§ËØÅÔºöÈÄöËøá Session ‰øùÂ≠òÁî®Êà∑ÁôªÂΩïÁä∂ÊÄÅ„ÄÇ</li>
<li>Ë°®ÂçïÊèê‰∫§ÔºöÈÄöËøá Request Ëé∑ÂèñÂèÇÊï∞ÔºåÈÄöËøá Response ËøîÂõûÁªìÊûú„ÄÇ</li>
<li>ÊùÉÈôêÊéßÂà∂ÔºöÊ£ÄÊü• Session ‰∏≠ÊòØÂê¶Â≠òÂú®Áî®Êà∑‰ø°ÊÅØ„ÄÇ</li>
</ul>
<hr>
<h3 id="5-Âú®-spring-mvc-‰∏≠ÁöÑÁÆÄÂåñÁî®Ê≥ï">5. Âú® Spring MVC ‰∏≠ÁöÑÁÆÄÂåñÁî®Ê≥ï
</h3><p>Spring Êèê‰æõ‰∫ÜÊõ¥ÁÆÄÊ¥ÅÁöÑÊõø‰ª£ÊñπÂºèÔºàÂ∫ïÂ±Ç‰ªç‰æùËµñËøô‰∏â‰∏™ÂØπË±°ÔºâÔºö</p>
<p><strong>(1) Áõ¥Êé•Ê≥®ÂÖ•</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/example&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">example</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">param</span><span class="p">,</span><span class="w">   </span><span class="c1">// Êõø‰ª£ request.getParameter()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@CookieValue</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cookie</span><span class="p">,</span><span class="w">   </span><span class="c1">// Êõø‰ª£ request.getCookies()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">HttpSession</span><span class="w"> </span><span class="n">session</span><span class="w">           </span><span class="c1">// Áõ¥Êé•Ê≥®ÂÖ• Session</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">session</span><span class="p">.</span><span class="na">setAttribute</span><span class="p">(</span><span class="s">&#34;key&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;value&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;OK&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>(2) ‰ΩøÁî® @ModelAttribute ÁªëÂÆöÂØπË±°</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">addUser</span><span class="p">(</span><span class="nd">@ModelAttribute</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ëá™Âä®Â∞ÜËØ∑Ê±ÇÂèÇÊï∞ÁªëÂÆöÂà∞ User ÂØπË±°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Saved: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="6-ÊÄªÁªì">6. ÊÄªÁªì
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÂØπË±°</th>
          <th>‰ΩúÁî®</th>
          <th>ÂÖ∏ÂûãÁî®ÈÄî</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>HttpServletRequest</td>
          <td>Â∞ÅË£ÖÂÆ¢Êà∑Á´ØËØ∑Ê±Ç</td>
          <td>Ëé∑ÂèñÂèÇÊï∞„ÄÅËØ∑Ê±ÇÂ§¥„ÄÅÂÆ¢Êà∑Á´Ø‰ø°ÊÅØ</td>
      </tr>
      <tr>
          <td>HttpServletResponse</td>
          <td>Â∞ÅË£ÖÊúçÂä°Âô®ÂìçÂ∫î</td>
          <td>ËÆæÁΩÆÁä∂ÊÄÅÁ†Å„ÄÅËøîÂõûÊï∞ÊçÆ„ÄÅÈáçÂÆöÂêë</td>
      </tr>
      <tr>
          <td>HttpSession</td>
          <td>Ë∑®ËØ∑Ê±ÇÂ≠òÂÇ®Áî®Êà∑Êï∞ÊçÆ</td>
          <td>ÁôªÂΩïÁä∂ÊÄÅ„ÄÅË¥≠Áâ©ËΩ¶„ÄÅÁî®Êà∑ÂÅèÂ•Ω</td>
      </tr>
  </tbody>
</table></div>
<p>ÊéåÊè°Ëøô‰∏â‰∏™ÂØπË±°ÊòØ Java Web ÂºÄÂèëÁöÑÂü∫Á°ÄÔºåÊó†ËÆ∫ÊòØ‰º†Áªü Servlet ËøòÊòØ Spring MVC ÈÉΩÁ¶ª‰∏çÂºÄÂÆÉ‰ª¨ÔºÅ</p>
<h2 id="Ëé∑Âèñ-httpservletrequest-ÂØπË±°ÁöÑ‰∏§ÁßçÊñπÂºè">Ëé∑Âèñ HttpServletRequest ÂØπË±°ÁöÑ‰∏§ÁßçÊñπÂºè
</h2><p>Âú® Spring Web ÂºÄÂèë‰∏≠ÔºåËé∑Âèñ request ÂØπË±°‰∏ªË¶ÅÊúâ‰∏§ÁßçÂ∏∏Áî®ÊñπÂºèÔºö</p>
<h3 id="1-ÈÄöËøáÊñπÊ≥ïÂèÇÊï∞Áõ¥Êé•Ê≥®ÂÖ•spring-mvc-Êé®Ëçê">1. ÈÄöËøáÊñπÊ≥ïÂèÇÊï∞Áõ¥Êé•Ê≥®ÂÖ•ÔºàSpring MVC Êé®ËçêÔºâ
</h3><p>Âú® Controller ÊñπÊ≥ï‰∏≠Áõ¥Êé•Â£∞Êòé HttpServletRequest ÂèÇÊï∞ÔºåSpring ‰ºöËá™Âä®Ê≥®ÂÖ•ÂΩìÂâçËØ∑Ê±ÇÁöÑ request ÂØπË±°Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/example&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">example</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Param: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">param</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>‰ºòÁÇπÔºö</strong> ÁÆÄÂçïÁõ¥Êé•ÔºåÊó†ÈúÄÊâãÂä®Â§ÑÁêÜ„ÄÇ</p>
<hr>
<h3 id="2-ÈÄöËøá-requestcontextholder-Â∑•ÂÖ∑Á±ªËé∑Âèñ">2. ÈÄöËøá RequestContextHolder Â∑•ÂÖ∑Á±ªËé∑Âèñ
</h3><p>Âú®‰ªª‰ΩïÂú∞ÊñπÔºàÂ¶Ç Service Â±Ç„ÄÅÂ∑•ÂÖ∑Á±ªÔºâÈÄöËøá Spring ÁöÑ RequestContextHolder ÈùôÊÄÅÊñπÊ≥ïËé∑ÂèñÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.context.request.RequestContextHolder</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.context.request.ServletRequestAttributes</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyUtils</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">logRequest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">((</span><span class="n">ServletRequestAttributes</span><span class="p">)</span><span class="w"> </span><span class="n">RequestContextHolder</span><span class="p">.</span><span class="na">getRequestAttributes</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">getRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Request URI: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>‰æãÂ¶ÇÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span><span class="w"> </span><span class="n">TokenUserInfoDto</span><span class="w"> </span><span class="nf">getTokenUserInfoDto</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">ServletRequestAttributes</span><span class="p">)</span><span class="w"> </span><span class="n">RequestContextHolder</span><span class="p">.</span><span class="na">getRequestAttributes</span><span class="p">()).</span><span class="na">getRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TOKEN_WEB</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getTokenInfo</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÈÄÇÁî®Âú∫ÊôØÔºö</strong> Èùû Controller Â±ÇÔºàÂ¶Ç Service„ÄÅAOP„ÄÅÂ∑•ÂÖ∑Á±ªÔºâÈúÄË¶ÅËé∑Âèñ request Êó∂„ÄÇ</p>
<h2 id="tokenuserinfodto-‰∏≠-jsonignoreproperties-Âíå-serializable-ÁöÑ‰ΩúÁî®">TokenUserInfoDto ‰∏≠ @JsonIgnoreProperties Âíå Serializable ÁöÑ‰ΩúÁî®
</h2><p>ËøôÊÆµ‰ª£Á†ÅÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Âêç‰∏∫ TokenUserInfoDto ÁöÑ DTOÔºàÊï∞ÊçÆ‰º†ËæìÂØπË±°ÔºâÔºåÁî®‰∫éÂ∞ÅË£ÖÁî®Êà∑‰ª§Áâå‰ø°ÊÅØ„ÄÇ‰ª•‰∏ãÊòØÂØπ @JsonIgnoreProperties Âíå Serializable Êé•Âè£‰ΩúÁî®ÁöÑËØ¶ÁªÜËß£ÈáäÔºö</p>
<h3 id="1-jsonignorepropertiesignoreunknown--true">1. @JsonIgnoreProperties(ignoreUnknown = true)
</h3><p><strong>‰ΩúÁî®</strong></p>
<ul>
<li>ËøôÊòØ Jackson Â∫ìÊèê‰æõÁöÑÊ≥®Ëß£ÔºåÁî®‰∫éÊéßÂà∂ JSON Â∫èÂàóÂåñ/ÂèçÂ∫èÂàóÂåñÊó∂ÁöÑË°å‰∏∫„ÄÇ</li>
<li>ignoreUnknown = true Ë°®Á§∫ÔºöÂΩì JSON Â≠óÁ¨¶‰∏≤‰∏≠ÂåÖÂê´ DTO Á±ª‰∏≠Ê≤°ÊúâÁöÑÂ≠óÊÆµÊó∂ÔºåÂøΩÁï•Ëøô‰∫õÂ≠óÊÆµËÄå‰∏çÊä•Èîô„ÄÇ</li>
</ul>
<p><strong>‰∏∫‰ªÄ‰πàÈúÄË¶ÅÂÆÉÔºü</strong></p>
<ul>
<li>Âú∫ÊôØÔºöÂ¶ÇÊûúÂêéÁ´ØÊé•Êî∂ÁöÑ JSON Êï∞ÊçÆÊØî DTO ÁöÑÂ≠óÊÆµÂ§öÔºà‰æãÂ¶ÇÂâçÁ´Ø‰º†‰∫Ü extraFieldÔºå‰ΩÜ DTO Êú™ÂÆö‰πâËØ•Â≠óÊÆµÔºâÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ã Jackson ‰ºöÊäõÂá∫ UnrecognizedPropertyException„ÄÇ</li>
<li>Ëß£ÂÜ≥ÔºöÊ∑ªÂä†Ê≠§Ê≥®Ëß£ÂêéÔºåÂ§ö‰ΩôÁöÑÂ≠óÊÆµ‰ºöË¢´ÈùôÈªòÂøΩÁï•ÔºåÁ°Æ‰øùÂèçÂ∫èÂàóÂåñ‰∏ç‰ºöÂõ†Â≠óÊÆµ‰∏çÂåπÈÖçËÄåÂ§±Ë¥•„ÄÇ</li>
</ul>
<p><strong>Á§∫‰æã</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// JSON Êï∞ÊçÆÔºàÂåÖÂê´ DTO ‰∏≠Ê≤°ÊúâÁöÑÂ≠óÊÆµ &#34;age&#34;Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;{\&#34;userId\&#34;:\&#34;123\&#34;, \&#34;nickName\&#34;:\&#34;Alice\&#34;, \&#34;age\&#34;:25}&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÂèçÂ∫èÂàóÂåñÊó∂Ôºå&#34;age&#34; ‰ºöË¢´ÂøΩÁï•Ôºå‰∏ç‰ºöÊä•Èîô</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">TokenUserInfoDto</span><span class="w"> </span><span class="n">dto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">readValue</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="w"> </span><span class="n">TokenUserInfoDto</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="2-implements-serializable">2. implements Serializable
</h3><p><strong>‰ΩúÁî®</strong></p>
<ul>
<li>Ê†áËÆ∞ËØ•Á±ª‰∏∫ÂèØÂ∫èÂàóÂåñÁöÑÔºåË°®Á§∫ËØ•Á±ªÁöÑÂØπË±°ÂèØ‰ª•Ë¢´ËΩ¨Êç¢‰∏∫Â≠óËäÇÊµÅÔºà‰æãÂ¶ÇÂ≠òÂÇ®Âà∞Êñá‰ª∂„ÄÅÈÄöËøáÁΩëÁªú‰º†ËæìÊàñÂ≠òÂÖ• Redis Á≠âÁºìÂ≠òÔºâ„ÄÇ</li>
<li>ÈúÄË¶ÅÂÆö‰πâ‰∏Ä‰∏™ serialVersionUID Â≠óÊÆµ‰Ωú‰∏∫ÁâàÊú¨ÊéßÂà∂Ê†áËØÜÁ¨¶„ÄÇ</li>
</ul>
<p><strong>‰∏∫‰ªÄ‰πàÈúÄË¶ÅÂÆÉÔºü</strong></p>
<ul>
<li>ÁΩëÁªú‰º†ËæìÔºöÂú® RPCÔºàÂ¶Ç DubboÔºâÊàñÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÂØπË±°ÈúÄË¶ÅË∑® JVM ‰º†ËæìÔºåÂøÖÈ°ªÂÆûÁé∞ Serializable„ÄÇ</li>
<li>ÊåÅ‰πÖÂåñÂ≠òÂÇ®ÔºöÂ∞ÜÂØπË±°‰øùÂ≠òÂà∞Á£ÅÁõòÊàñÊï∞ÊçÆÂ∫ìÔºàÂ¶Ç Redis ÁöÑ value ÈúÄË¶ÅÂÆûÁé∞Â∫èÂàóÂåñÔºâ„ÄÇ</li>
<li>ÂÖºÂÆπÊÄßÔºöserialVersionUID Áî®‰∫éÈ™åËØÅÂ∫èÂàóÂåñÂíåÂèçÂ∫èÂàóÂåñÁöÑÁ±ªÊòØÂê¶ÂÖºÂÆπÔºàÂ¶ÇÊûúÁ±ªÁªìÊûÑÂèòÊõ¥‰ΩÜÊú™Êõ¥Êñ∞ UIDÔºå‰ºöÊäõÂá∫ InvalidClassExceptionÔºâ„ÄÇ</li>
</ul>
<p><strong>Á§∫‰æã</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Â∫èÂàóÂåñÂØπË±°Âà∞Â≠óËäÇÊï∞ÁªÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ByteArrayOutputStream</span><span class="w"> </span><span class="n">bos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayOutputStream</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ObjectOutputStream</span><span class="w"> </span><span class="n">oos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectOutputStream</span><span class="p">(</span><span class="n">bos</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">oos</span><span class="p">.</span><span class="na">writeObject</span><span class="p">(</span><span class="n">dto</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bos</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ‰ªéÂ≠óËäÇÊï∞ÁªÑÂèçÂ∫èÂàóÂåñ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ByteArrayInputStream</span><span class="w"> </span><span class="n">bis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayInputStream</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ObjectInputStream</span><span class="w"> </span><span class="n">ois</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectInputStream</span><span class="p">(</span><span class="n">bis</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">TokenUserInfoDto</span><span class="w"> </span><span class="n">deserializedDto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TokenUserInfoDto</span><span class="p">)</span><span class="w"> </span><span class="n">ois</span><span class="p">.</span><span class="na">readObject</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="3-ÂÖ∂‰ªñ‰ª£Á†ÅËØ¥Êòé">3. ÂÖ∂‰ªñ‰ª£Á†ÅËØ¥Êòé
</h3><ul>
<li>Â≠óÊÆµÂê´‰πâÔºö
<ul>
<li>userIdÔºöÁî®Êà∑ÂîØ‰∏ÄÊ†áËØÜ„ÄÇ</li>
<li>nickNameÔºöÁî®Êà∑ÊòµÁß∞„ÄÇ</li>
<li>avatarÔºöÁî®Êà∑Â§¥ÂÉè URL„ÄÇ</li>
<li>expireAtÔºö‰ª§ÁâåËøáÊúüÊó∂Èó¥ÔºàÊó∂Èó¥Êà≥Ôºâ„ÄÇ</li>
<li>tokenÔºöÁî®Êà∑ËÆ§ËØÅ‰ª§ÁâåÔºàÂ¶Ç JWTÔºâ„ÄÇ</li>
</ul>
</li>
<li>Getter/SetterÔºöÊèê‰æõÊ†áÂáÜÁöÑ Java Bean ÊñπÊ≥ïÔºå‰æø‰∫éÊ°ÜÊû∂ÔºàÂ¶Ç Spring„ÄÅJacksonÔºâÈÄöËøáÂèçÂ∞ÑËÆøÈóÆÂ≠óÊÆµ„ÄÇ</li>
</ul>
<hr>
<h3 id="ÊÄªÁªì-1">ÊÄªÁªì
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÁâπÊÄß</th>
          <th>‰ΩúÁî®</th>
          <th>‰ΩøÁî®Âú∫ÊôØ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>@JsonIgnoreProperties(ignoreUnknown = true)</td>
          <td>ÂøΩÁï• JSON ‰∏≠ÁöÑÊú™Áü•Â≠óÊÆµ</td>
          <td>Èò≤Ê≠¢ÂâçÁ´ØÂ§ö‰º†Â≠óÊÆµÂØºËá¥ÂèçÂ∫èÂàóÂåñÂ§±Ë¥•</td>
      </tr>
      <tr>
          <td>implements Serializable</td>
          <td>ÊîØÊåÅÂØπË±°Â∫èÂàóÂåñ</td>
          <td>ÁΩëÁªú‰º†Ëæì„ÄÅÁºìÂ≠òÂ≠òÂÇ®„ÄÅRPC Ë∞ÉÁî®</td>
      </tr>
      <tr>
          <td>serialVersionUID</td>
          <td>ÁâàÊú¨ÊéßÂà∂</td>
          <td>Á°Æ‰øùÂ∫èÂàóÂåñÂÖºÂÆπÊÄß</td>
      </tr>
  </tbody>
</table></div>
<p><strong>ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÔºö</strong></p>
<ul>
<li>ËØ• DTO ÂèØËÉΩÁî®‰∫éÁî®Êà∑ÁôªÂΩïÂêéËøîÂõûÁöÑ‰ª§Áâå‰ø°ÊÅØÔºàÈÄöËøá JSON ÂìçÂ∫îÁªôÂâçÁ´ØÔºâ„ÄÇ</li>
<li>‰πüÂèØËÉΩË¢´Â∫èÂàóÂåñÂêéÂ≠òÂÖ• RedisÔºà‰Ωú‰∏∫ÁºìÂ≠òÊàñÂàÜÂ∏ÉÂºè‰ºöËØùÔºâ„ÄÇ</li>
</ul>
<h2 id="ÊúçÂä°Á´ØÊìç‰Ωú-cookie-ÁöÑÂÆåÊï¥ÊµÅÁ®ãÁªìÂêàÊ°à‰æãËß£Êûê">ÊúçÂä°Á´ØÊìç‰Ωú Cookie ÁöÑÂÆåÊï¥ÊµÅÁ®ãÔºàÁªìÂêàÊ°à‰æãËß£ÊûêÔºâ
</h2><p>‰ª•‰∏ãÈÄöËøá saveToken2Cookie ÊñπÊ≥ïËØ¥ÊòéÊúçÂä°Á´ØÂ¶Ç‰ΩïÈÄöËøá HttpServletResponse Êìç‰Ωú CookieÔºåÂπ∂ÈôÑ‰∏äÂÆåÊï¥Ê°à‰æãÂíåÂÖ≥ÈîÆÁÇπËß£Êûê„ÄÇ</p>
<h3 id="1-‰ª£Á†ÅÈÄêË°åËß£Êûê">1. ‰ª£Á†ÅÈÄêË°åËß£Êûê
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveToken2Cookie</span><span class="p">(</span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ Cookie ÂØπË±°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Cookie</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cookie</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TOKEN_WEB</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. ËÆæÁΩÆ Cookie ËøáÊúüÊó∂Èó¥Ôºà7Â§©Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">cookie</span><span class="p">.</span><span class="na">setMaxAge</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TIME_SECONDS_DAY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">7</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3. ËÆæÁΩÆ Cookie ÁöÑÁîüÊïàË∑ØÂæÑÔºàÊ†πË∑ØÂæÑÔºåÂÖ®Á´ôÊúâÊïàÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">cookie</span><span class="p">.</span><span class="na">setPath</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 4. Â∞Ü Cookie Ê∑ªÂä†Âà∞ÂìçÂ∫î‰∏≠ÔºàÈÄöËøá Set-Cookie Â§¥ÂèëÁªôÊµèËßàÂô®Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">addCookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-ÂÖ≥ÈîÆÊìç‰ΩúËØ¥Êòé">2. ÂÖ≥ÈîÆÊìç‰ΩúËØ¥Êòé
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Êìç‰Ωú</th>
          <th>‰ΩúÁî®</th>
          <th>ÂØπÂ∫î HTTP ÂçèËÆÆË°å‰∏∫</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>new Cookie(name, value)</td>
          <td>ÂàõÂª∫ Cookie</td>
          <td>Êó†Ôºà‰ªÖÂÜÖÂ≠òÂØπË±°Ôºâ</td>
      </tr>
      <tr>
          <td>setMaxAge(seconds)</td>
          <td>ËÆæÁΩÆ Cookie ÊúâÊïàÊúü</td>
          <td>Set-Cookie: token=abc; Max-Age=604800</td>
      </tr>
      <tr>
          <td>setPath(&quot;/&quot;)</td>
          <td>ËÆæÁΩÆ Cookie ÁöÑ‰ΩúÁî®Ë∑ØÂæÑ</td>
          <td>Set-Cookie: token=abc; Path=/</td>
      </tr>
      <tr>
          <td>response.addCookie()</td>
          <td>Â∞Ü Cookie ÂÜôÂÖ•ÂìçÂ∫î</td>
          <td>ÊµèËßàÂô®Êî∂Âà∞ÂêéËá™Âä®‰øùÂ≠ò</td>
      </tr>
  </tbody>
</table></div>
<h3 id="3-ÂÆåÊï¥Ê°à‰æãÂú∫ÊôØ">3. ÂÆåÊï¥Ê°à‰æãÂú∫ÊôØ
</h3><p><strong>Âú∫ÊôØÊèèËø∞</strong></p>
<ul>
<li>ÈúÄÊ±ÇÔºöÁî®Êà∑ÁôªÂΩïÊàêÂäüÂêéÔºåÊúçÂä°Á´ØÁîüÊàê‰∏Ä‰∏™Ë∫´‰ªΩ‰ª§ÁâåÔºàTokenÔºâÔºåÂπ∂ÈÄöËøá Cookie Ëá™Âä®‰øùÂ≠òÂà∞ÊµèËßàÂô®„ÄÇ</li>
<li>ÊäÄÊúØÂÆûÁé∞ÔºöË∞ÉÁî® saveToken2Cookie ÊñπÊ≥ï„ÄÇ</li>
</ul>
<p><strong>‰ª£Á†ÅÁ§∫‰æãÔºàSpring MVC ControllerÔºâ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/login&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. È™åËØÅÁî®Êà∑ÂêçÂØÜÁ†ÅÔºà‰º™‰ª£Á†ÅÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">checkLogin</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isValid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;ÁôªÂΩïÂ§±Ë¥•&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. ÁîüÊàê TokenÔºà‰º™‰ª£Á†ÅÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwtUtil</span><span class="p">.</span><span class="na">generateToken</span><span class="p">(</span><span class="n">username</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3. Â∞Ü Token ‰øùÂ≠òÂà∞ CookieÔºàÂÖ≥ÈîÆÊìç‰ΩúÔºÅÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">saveToken2Cookie</span><span class="p">(</span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;ÁôªÂΩïÊàêÂäü&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Â§çÁî®‰πãÂâçÁöÑ Cookie Êìç‰ΩúÊñπÊ≥ï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveToken2Cookie</span><span class="p">(</span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Cookie</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cookie</span><span class="p">(</span><span class="s">&#34;AUTH_TOKEN&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">cookie</span><span class="p">.</span><span class="na">setMaxAge</span><span class="p">(</span><span class="n">7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">60</span><span class="p">);</span><span class="w"> </span><span class="c1">// 7Â§©ÊúâÊïàÊúü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">cookie</span><span class="p">.</span><span class="na">setPath</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// ÂÖ®Á´ôÊúâÊïà</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">cookie</span><span class="p">.</span><span class="na">setHttpOnly</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// Èò≤Ê≠¢ XSS ÊîªÂáªÔºàÂèØÈÄâÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">addCookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-ÊµèËßàÂô®‰∏éÊúçÂä°Âô®ÁöÑ‰∫§‰∫íÊµÅÁ®ã">4. ÊµèËßàÂô®‰∏éÊúçÂä°Âô®ÁöÑ‰∫§‰∫íÊµÅÁ®ã
</h3><p><strong>ËØ∑Ê±ÇÁôªÂΩïÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">POST /login HTTP/1.1
</span></span><span class="line"><span class="cl">Content-Type: application/x-www-form-urlencoded
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">username=admin&amp;password=123456
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÊúçÂä°Á´ØÂìçÂ∫îÔºàËÆæÁΩÆ CookieÔºâÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">Set-Cookie: AUTH_TOKEN=xyz123; Max-Age=604800; Path=/; HttpOnly
</span></span><span class="line"><span class="cl">Content-Type: text/html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ÁôªÂΩïÊàêÂäü
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂêéÁª≠ËØ∑Ê±ÇÔºàÊµèËßàÂô®Ëá™Âä®Êê∫Â∏¶ CookieÔºâÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET /profile HTTP/1.1
</span></span><span class="line"><span class="cl">Cookie: AUTH_TOKEN=xyz123
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-ÂÖ≥ÈîÆÊ≥®ÊÑè‰∫ãÈ°π">5. ÂÖ≥ÈîÆÊ≥®ÊÑè‰∫ãÈ°π
</h3><p><strong>(1) Cookie ÂÆâÂÖ®ÊÄß</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÈÖçÁΩÆ</th>
          <th>‰ΩúÁî®</th>
          <th>Êé®ËçêÂÄº</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>setHttpOnly(true)</td>
          <td>Á¶ÅÊ≠¢ JavaScript ËØªÂèñ Cookie</td>
          <td>ÂøÖÈ°ªÂêØÁî®</td>
      </tr>
      <tr>
          <td>setSecure(true)</td>
          <td>‰ªÖÈÄöËøá HTTPS ‰º†Ëæì</td>
          <td>Áîü‰∫ßÁéØÂ¢ÉÂêØÁî®</td>
      </tr>
      <tr>
          <td>setDomain(&ldquo;example.com&rdquo;)</td>
          <td>ÈôêÂà∂ Cookie ÁöÑ‰ΩúÁî®ÂüüÂêç</td>
          <td>ÊåâÈúÄËÆæÁΩÆ</td>
      </tr>
  </tbody>
</table></div>
<p><strong>(2) ÂÖ∂‰ªñÂ∏∏ËßÅÊìç‰Ωú</strong></p>
<ul>
<li>Âà†Èô§ CookieÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Cookie</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cookie</span><span class="p">(</span><span class="s">&#34;AUTH_TOKEN&#34;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cookie</span><span class="p">.</span><span class="na">setMaxAge</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Á´ãÂç≥ËøáÊúü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">response</span><span class="p">.</span><span class="na">addCookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ËØªÂèñÂÆ¢Êà∑Á´Ø CookieÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Cookie</span><span class="o">[]</span><span class="w"> </span><span class="n">cookies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getCookies</span><span class="p">();</span><span class="w"> </span><span class="c1">// ‰ªé HttpServletRequest Ëé∑Âèñ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-ÊÄªÁªì-1">6. ÊÄªÁªì
</h3><ul>
<li>ÊúçÂä°Á´ØÊìç‰Ωú Cookie ÁöÑÊ†∏ÂøÉÊ≠•È™§Ôºö
<ol>
<li>ÂàõÂª∫ <code>Cookie</code> ÂØπË±° ‚Üí 2. ËÆæÁΩÆÂ±ûÊÄß ‚Üí 3. ÈÄöËøá <code>response.addCookie()</code> ‰∏ãÂèë„ÄÇ</li>
</ol>
</li>
<li><strong>ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ</strong>ÔºöÁî®Êà∑ËÆ§ËØÅÔºàTokenÔºâ„ÄÅ‰ºöËØùÁÆ°ÁêÜ„ÄÅ‰∏™ÊÄßÂåñËÆæÁΩÆÁ≠â„ÄÇ</li>
<li><strong>ÂÆâÂÖ®Âª∫ËÆÆ</strong>ÔºöÂßãÁªàÂêØÁî® HttpOnly Âíå SecureÔºàHTTPS ÁéØÂ¢É‰∏ãÔºâ„ÄÇ</li>
</ul>
<p>ÈÄöËøáËøôÁßçÊñπÂºèÔºåÊúçÂä°Á´ØÂèØ‰ª•ËΩªÊùæÁÆ°ÁêÜÊµèËßàÂô®Á´ØÁöÑÊåÅ‰πÖÂåñÊï∞ÊçÆÔºÅ</p>
<hr>
<h2 id="appinterceptor-Âíå-webappconfigurer-Âü∫‰∫é-token-ÁöÑËØ∑Ê±ÇÊã¶Êà™È™åËØÅÊú∫Âà∂">AppInterceptor Âíå WebAppConfigurer Âü∫‰∫é Token ÁöÑËØ∑Ê±ÇÊã¶Êà™È™åËØÅÊú∫Âà∂
</h2><p>Ëøô‰∏§‰∏™Á±ªÂÖ±ÂêåÂÆûÁé∞‰∫Ü‰∏Ä‰∏™Âü∫‰∫é Token ÁöÑËØ∑Ê±ÇÊã¶Êà™È™åËØÅÊú∫Âà∂Ôºå‰∏ªË¶ÅÁî®‰∫éÁî®Êà∑Ë∫´‰ªΩËÆ§ËØÅÂíåÊùÉÈôêÊéßÂà∂„ÄÇ‰ª•‰∏ãÊòØËØ¶ÁªÜËß£ÊûêÔºö</p>
<h3 id="1-appinterceptorÊ†∏ÂøÉÊã¶Êà™Âô®Á±ª">1. AppInterceptorÔºàÊ†∏ÂøÉÊã¶Êà™Âô®Á±ªÔºâ
</h3><p><strong>Á±ª‰ΩúÁî®</strong></p>
<ul>
<li>ÂÆûÁé∞ HandlerInterceptor Êé•Âè£ÔºåÂØπÁ¨¶ÂêàÊù°‰ª∂ÁöÑËØ∑Ê±ÇËøõË°åÊã¶Êà™„ÄÇ</li>
<li>‰∏ªË¶ÅÂäüËÉΩÔºöÈ™åËØÅËØ∑Ê±Ç‰∏≠ÁöÑ Token ÊòØÂê¶ÊúâÊïàÔºà‰ªé Header Êàñ Cookie Ëé∑ÂèñÔºâÔºåÊó†ÊïàÂàôÊãíÁªùËÆøÈóÆ„ÄÇ</li>
</ul>
<p><strong>ÂÖ≥ÈîÆ‰ª£Á†ÅËß£Êûê</strong></p>
<p>(1) ÊàêÂëòÂèòÈáè</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">URL_ACCOUNT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;/account&#34;</span><span class="p">;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">URL_FILE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;/file&#34;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩúÁî®ÔºöÂÆö‰πâ‰∏çÈúÄË¶Å Token È™åËØÅÁöÑÁôΩÂêçÂçïË∑ØÂæÑÔºàÂ¶ÇÁôªÂΩï„ÄÅÊñá‰ª∂ÂÖ¨ÂºÄËÆøÈóÆÔºâ„ÄÇ</li>
</ul>
<p>(2) preHandle() ÊñπÊ≥ïÔºàÊ†∏ÂøÉÈÄªËæëÔºâ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">preHandle</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. Ê£ÄÊü• handler ÊòØÂê¶ÊúâÊïà</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// Áõ¥Êé•ÊãíÁªù</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. Âè™Â§ÑÁêÜ HandlerMethod Á±ªÂûãËØ∑Ê±ÇÔºàÂ¶Ç @Controller Êàñ @RestController ÂÆö‰πâÁöÑÂ§ÑÁêÜÂô®ÊñπÊ≥ï,Spring ÁÆ°ÁêÜÁöÑÊéßÂà∂Âô®ÊñπÊ≥ïÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">handler</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">HandlerMethod</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// ÂÖ∂‰ªñÁ±ªÂûãÔºàÂ¶ÇÈùôÊÄÅËµÑÊ∫êÔºâÁõ¥Êé•ÊîæË°å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3. ÁôΩÂêçÂçïË∑ØÂæÑÊîæË°å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="n">URL_ACCOUNT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Â¶ÇÁôªÂΩïÊé•Âè£Êó†ÈúÄ Token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 4. Ëé∑Âèñ TokenÔºà‰ºòÂÖà‰ªé HeaderÔºåÊñá‰ª∂ËØ∑Ê±Ç‰ªé CookieÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TOKEN_ADMIN</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="n">URL_FILE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTokenFromCookie</span><span class="p">(</span><span class="n">request</span><span class="p">);</span><span class="w"> </span><span class="c1">// Êñá‰ª∂ËØ∑Ê±ÇÁâπÊÆäÂ§ÑÁêÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 5. Token ‰∏∫Á©∫ÊàñÊó†ÊïàÊó∂ÊäõÂá∫ÂºÇÂ∏∏</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringTools</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">token</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_901</span><span class="p">);</span><span class="w"> </span><span class="c1">// Token Áº∫Â§±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">sessionObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getTokenInfo4Admin</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">sessionObj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_901</span><span class="p">);</span><span class="w"> </span><span class="c1">// Token Êó†Êïà</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// È™åËØÅÈÄöËøá</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>(3) getTokenFromCookie() ÊñπÊ≥ï</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTokenFromCookie</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Cookie</span><span class="o">[]</span><span class="w"> </span><span class="n">cookies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getCookies</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cookies</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Cookie</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">cookies</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cookie</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TOKEN_ADMIN</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">cookie</span><span class="p">.</span><span class="na">getValue</span><span class="p">();</span><span class="w"> </span><span class="c1">// ËøîÂõûÂåπÈÖçÁöÑ Token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩúÁî®Ôºö‰ªé Cookie ‰∏≠ÊèêÂèñ TokenÔºàÁî®‰∫éÊñá‰ª∂ËØ∑Ê±ÇÁ≠âÁâπÊÆäÂú∫ÊôØÔºâ„ÄÇ</li>
</ul>
<p>(4) ÂÖ∂‰ªñÊñπÊ≥ï</p>
<ul>
<li>postHandle() Âíå afterCompletion()ÔºöÁ©∫ÂÆûÁé∞ÔºåÁî®‰∫éÊã¶Êà™ÂêéÂ§ÑÁêÜÔºàÂ¶ÇÊó•ÂøóËÆ∞ÂΩïÔºâÔºåÂΩìÂâçÊú™‰ΩøÁî®„ÄÇ</li>
</ul>
<hr>
<h3 id="2-webappconfigurerÊã¶Êà™Âô®ÈÖçÁΩÆÁ±ª">2. WebAppConfigurerÔºàÊã¶Êà™Âô®ÈÖçÁΩÆÁ±ªÔºâ
</h3><p><strong>Á±ª‰ΩúÁî®</strong></p>
<ul>
<li>ÂÆûÁé∞ WebMvcConfigurer Êé•Âè£ÔºåÊ≥®ÂÜåÊã¶Êà™Âô®Âπ∂ÈÖçÁΩÆÊã¶Êà™ËßÑÂàô„ÄÇ</li>
<li>Ê†∏ÂøÉÂäüËÉΩÔºöÂ∞Ü AppInterceptor Â∫îÁî®Âà∞ÊâÄÊúâËØ∑Ê±ÇË∑ØÂæÑÔºà/**Ôºâ„ÄÇ</li>
</ul>
<p><strong>ÂÖ≥ÈîÆ‰ª£Á†ÅËß£Êûê</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebAppConfigurer</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AppInterceptor</span><span class="w"> </span><span class="n">appInterceptor</span><span class="p">;</span><span class="w"> </span><span class="c1">// Ê≥®ÂÖ•Êã¶Êà™Âô®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addInterceptors</span><span class="p">(</span><span class="n">InterceptorRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">addInterceptor</span><span class="p">(</span><span class="n">appInterceptor</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="p">.</span><span class="na">addPathPatterns</span><span class="p">(</span><span class="s">&#34;/**&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Êã¶Êà™ÊâÄÊúâË∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>addPathPatterns(&quot;/<strong>&quot;)ÔºöË°®Á§∫Êã¶Êà™ÊâÄÊúâËØ∑Ê±ÇÔºàÂèØÈÄöËøá excludePathPatterns() ÊéíÈô§ÁâπÂÆöË∑ØÂæÑÔºåÂ¶Ç /api/public/</strong>Ôºâ„ÄÇ</li>
</ul>
<hr>
<h3 id="3-Âçè‰ΩúÊµÅÁ®ã">3. Âçè‰ΩúÊµÅÁ®ã
</h3><ul>
<li>ËØ∑Ê±ÇÂà∞Ëææ Spring MVC ‚Üí ÂÖàÁªèËøá WebAppConfigurer Ê≥®ÂÜåÁöÑ AppInterceptor„ÄÇ</li>
<li>Êã¶Êà™Âô®È™åËØÅÈÄªËæëÔºö
<ul>
<li>ÁôΩÂêçÂçïÊîæË°åÔºöÂ¶Ç /account/login Áõ¥Êé•ÈÄöËøá„ÄÇ</li>
<li>Token Ê£ÄÊü•Ôºö
<ul>
<li>ÊôÆÈÄöËØ∑Ê±Ç‰ªé Header ÁöÑ TOKEN_ADMIN Ëé∑Âèñ Token„ÄÇ</li>
<li>Êñá‰ª∂ËØ∑Ê±ÇÔºà/file/**Ôºâ‰ªé Cookie Ëé∑Âèñ Token„ÄÇ</li>
</ul>
</li>
<li>Redis È™åËØÅÔºöÊ£ÄÊü• Token ÊòØÂê¶ÊúâÊïàÔºàÂ¶ÇÊòØÂê¶ËøáÊúüÊàñË¢´Ë∏¢Âá∫Ôºâ„ÄÇ</li>
</ul>
</li>
<li>È™åËØÅÁªìÊûúÂ§ÑÁêÜÔºö
<ul>
<li>ÊàêÂäüÔºöÁªßÁª≠ÊâßË°åÂêéÁª≠Êã¶Êà™Âô®Êàñ Controller„ÄÇ</li>
<li>Â§±Ë¥•ÔºöÊäõÂá∫ BusinessExceptionÔºàÊúÄÁªà‰ºöË¢´ÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜÂô®ËΩ¨Êç¢‰∏∫ÈîôËØØÂìçÂ∫îÔºâ„ÄÇ</li>
</ul>
</li>
</ul>
<hr>
<h3 id="4-ËÆæËÆ°‰∫ÆÁÇπ">4. ËÆæËÆ°‰∫ÆÁÇπ
</h3><ul>
<li>ÁÅµÊ¥ª Token Ëé∑ÂèñÔºöÊîØÊåÅ Header Âíå Cookie ‰∏§ÁßçÊñπÂºèÔºåÈÄÇÂ∫î‰∏çÂêåÂú∫ÊôØÔºàÂ¶Ç API Ë∞ÉÁî®ÂíåÊµèËßàÂô®Êñá‰ª∂‰∏ãËΩΩÔºâ„ÄÇ</li>
<li>ÁôΩÂêçÂçïÊú∫Âà∂ÔºöÂÖ¨ÂºÄÊé•Âè£ÔºàÂ¶ÇÁôªÂΩïÔºâÊó†ÈúÄ TokenÔºåÈÅøÂÖçÂæ™ÁéØÈ™åËØÅ„ÄÇ</li>
<li>Redis ÈõÜ‰∏≠ÁÆ°ÁêÜÔºöToken Áä∂ÊÄÅÔºàÂ¶ÇÊúâÊïàÊúü„ÄÅÂº∫Âà∂Â§±ÊïàÔºâÁî± Redis ÊéßÂà∂ÔºåÂÆûÁé∞ÂàÜÂ∏ÉÂºè‰ºöËØù„ÄÇ</li>
</ul>
<hr>
<h3 id="5-ÂÖ∏ÂûãÂ∫îÁî®Âú∫ÊôØ">5. ÂÖ∏ÂûãÂ∫îÁî®Âú∫ÊôØ
</h3><ul>
<li>Áî®Êà∑ÁôªÂΩïÊÄÅÊ†°È™åÔºöËÆøÈóÆ /admin/* Êó∂Ë¶ÅÊ±ÇÊê∫Â∏¶ÊúâÊïà Token„ÄÇ</li>
<li>Êñá‰ª∂ÂÆâÂÖ®‰∏ãËΩΩÔºöÊñá‰ª∂Êé•Âè£Ôºà/file/*ÔºâÈÄöËøá Cookie ‰º†ÈÄí TokenÔºåÁ°Æ‰øùÂè™ÊúâÁôªÂΩïÁî®Êà∑ÂèØËÆøÈóÆ„ÄÇ</li>
<li>ÊùÉÈôêÊéßÂà∂Êâ©Â±ïÔºöÂèØÂú® preHandle() ‰∏≠Ëøõ‰∏ÄÊ≠•Ê£ÄÊü•Áî®Êà∑ËßíËâ≤ÔºàÂ¶Ç‰ªé sessionObj Ëß£ÊûêÊùÉÈôêÔºâ„ÄÇ</li>
</ul>
<hr>
<h3 id="ÊÄªÁªì-2">ÊÄªÁªì
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Á±ªÂêç</th>
          <th>ËÅåË¥£</th>
          <th>Ê†∏ÂøÉÊñπÊ≥ï</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>AppInterceptor</td>
          <td>Êã¶Êà™ËØ∑Ê±ÇÂπ∂È™åËØÅ Token</td>
          <td>preHandle()</td>
      </tr>
      <tr>
          <td>WebAppConfigurer</td>
          <td>Ê≥®ÂÜåÊã¶Êà™Âô®Âà∞ Spring MVC</td>
          <td>addInterceptors()</td>
      </tr>
  </tbody>
</table></div>
<p>ÈÄöËøáËøô‰∏§‰∏™Á±ªÔºåÁ≥ªÁªüÂÆûÁé∞‰∫ÜÁªü‰∏Ä„ÄÅÂèØÊâ©Â±ïÁöÑËÆ§ËØÅÂ±ÇÔºåÁ°Æ‰øùÂè™ÊúâÂêàÊ≥ïËØ∑Ê±ÇËÉΩËÆøÈóÆÂèó‰øùÊä§ËµÑÊ∫ê„ÄÇ</p>
<hr>
<h2 id="‰∏∫‰ªÄ‰πàÊñá‰ª∂ËØ∑Ê±ÇÂíåÂÖ∂‰ªñËØ∑Ê±ÇÂàÜÂºÄÂ§ÑÁêÜ-token-ÁöÑËé∑ÂèñÊñπÂºè">‰∏∫‰ªÄ‰πàÊñá‰ª∂ËØ∑Ê±ÇÂíåÂÖ∂‰ªñËØ∑Ê±ÇÂàÜÂºÄÂ§ÑÁêÜ Token ÁöÑËé∑ÂèñÊñπÂºèÔºü
</h2><h3 id="1-ÊäÄÊúØÈôêÂà∂ÊµèËßàÂô®ÂØπÊñá‰ª∂ËØ∑Ê±ÇÁöÑ-header-Â§ÑÁêÜ">1. ÊäÄÊúØÈôêÂà∂ÔºöÊµèËßàÂô®ÂØπÊñá‰ª∂ËØ∑Ê±ÇÁöÑ Header Â§ÑÁêÜ
</h3><p><strong>(1) ÊôÆÈÄö API ËØ∑Ê±ÇÔºà‰ΩøÁî® Header ‰º†ÈÄí TokenÔºâ</strong></p>
<ul>
<li>Âú∫ÊôØÔºöÂâçÂêéÁ´ØÂàÜÁ¶ªÊû∂ÊûÑ‰∏≠ÔºåÂâçÁ´ØÔºàÂ¶Ç Vue/ReactÔºâÈÄöËøá AJAX/Fetch Ë∞ÉÁî® API„ÄÇ</li>
<li>Token ‰º†ÈÄíÊñπÂºèÔºöÈÄöËøá HTTP ËØ∑Ê±ÇÂ§¥ÔºàÂ¶Ç Authorization: Bearer ÊàñËá™ÂÆö‰πâÂ§¥ TOKEN_ADMINÔºâ‰º†ÈÄí„ÄÇ</li>
<li>‰ºòÂäøÔºö
<ul>
<li>ÂÆâÂÖ®ÊÄßÈ´òÔºöHeader ‰∏ç‰ºöË¢´ÊµèËßàÂô®Ëá™Âä®ÁºìÂ≠òÊàñËÆ∞ÂΩïÂú®Êó•Âøó‰∏≠„ÄÇ</li>
<li>ÈÄÇÂêà RESTful APIÔºöÁ¨¶ÂêàÊó†Áä∂ÊÄÅËÆ§ËØÅÁöÑÊúÄ‰Ω≥ÂÆûË∑µ„ÄÇ</li>
</ul>
</li>
</ul>
<p><strong>(2) Êñá‰ª∂ËØ∑Ê±ÇÔºà‰ΩøÁî® Cookie ‰º†ÈÄí TokenÔºâ</strong></p>
<ul>
<li>Âú∫ÊôØÔºöÊµèËßàÂô®Áõ¥Êé•ËÆøÈóÆÊñá‰ª∂‰∏ãËΩΩÈìæÊé•ÔºàÂ¶Ç <a> Êàñ <img> Ê†áÁ≠æÔºâ„ÄÇ</li>
<li>ÈóÆÈ¢òÔºö
<ul>
<li>ÊµèËßàÂô®Âú®ÂèëËµ∑Èùû AJAX ÁöÑÊñá‰ª∂ËØ∑Ê±ÇÔºàÂ¶ÇÁõ¥Êé•ËÆøÈóÆ URL„ÄÅ<a>„ÄÅ<img> Ê†áÁ≠æÔºâÊó∂Ôºö
<ul>
<li>Êó†Ê≥ïËá™ÂÆö‰πâ HeaderÔºöÊµèËßàÂô®‰∏ç‰ºöÂÖÅËÆ∏ÈÄöËøáÊôÆÈÄö HTML Ê†áÁ≠æÊàñË∑≥ËΩ¨ËÆæÁΩÆËá™ÂÆö‰πâÂ§¥„ÄÇ</li>
<li>Ëá™Âä®Êê∫Â∏¶ CookieÔºöÊµèËßàÂô®‰ºöËá™Âä®Âú®ËØ∑Ê±Ç‰∏≠ÈôÑÂä†ÂΩìÂâçÂüüÁöÑ CookieÔºàÂ¶ÇÊûú Cookie ÁöÑ Path Âíå Domain ÂåπÈÖçÔºâ„ÄÇ</li>
</ul>
</li>
</ul>
</li>
<li>Ëß£ÂÜ≥ÊñπÊ°àÔºö
<ul>
<li>ÂØπ‰∫éÊñá‰ª∂ËØ∑Ê±ÇÔºåÊîπÁî® Cookie ‰º†ÈÄí TokenÔºåÂõ†‰∏∫Ôºö
<ul>
<li>ÊµèËßàÂô®‰ºöËá™Âä®ÁÆ°ÁêÜ Cookie ÁöÑÂèëÈÄÅ„ÄÇ</li>
<li>Êó†ÈúÄÂâçÁ´Ø‰ª£Á†ÅÊòæÂºèËÆæÁΩÆ Header„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÁ§∫‰æã">2. ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÁ§∫‰æã
</h3><p><strong>(1) ÊôÆÈÄö API ËØ∑Ê±Ç</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// ÂâçÁ´ØË∞ÉÁî® APIÔºàÂèØËá™ÂÆö‰πâ HeaderÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&#34;/api/data&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;TOKEN_ADMIN&#34;</span><span class="o">:</span> <span class="s2">&#34;xyz123&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÊúçÂä°Á´ØÔºö‰ªé Header ÊèêÂèñ Token„ÄÇ</li>
</ul>
<p><strong>(2) Êñá‰ª∂‰∏ãËΩΩËØ∑Ê±Ç</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- ÊµèËßàÂô®Áõ¥Êé•ËÆøÈóÆÊñá‰ª∂ÈìæÊé• --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/file/123.pdf&#34;</span><span class="p">&gt;</span>‰∏ãËΩΩPDF<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- ÊàñÂõæÁâáÂä†ËΩΩ --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;/file/456.jpg&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÊúçÂä°Á´ØÔºö‰ªé Cookie ÊèêÂèñ TokenÔºàÂõ†‰∏∫ÊµèËßàÂô®‰∏ç‰ºö‰∏∫Ëøô‰∫õËØ∑Ê±ÇËÆæÁΩÆËá™ÂÆö‰πâ HeaderÔºâ„ÄÇ</li>
</ul>
<h2 id="savecategory-ÊñπÊ≥ï‰∏≠ÁöÑ-if-Âà§Êñ≠ÂØπÂ∫îÂ¢ûÂä†Âíå‰øÆÊîπËØ¶Ëß£">saveCategory ÊñπÊ≥ï‰∏≠ÁöÑ if Âà§Êñ≠ÔºàÂØπÂ∫îÂ¢ûÂä†Âíå‰øÆÊîπÔºâËØ¶Ëß£
</h2><p>Ëøô‰∏™Âà§Êñ≠ÈÄªËæëÁî®‰∫éÈò≤Ê≠¢ÂàÜÁ±ªÁºñÂè∑ÔºàcategoryCodeÔºâÈáçÂ§çÔºåË¶ÜÁõñ‰∫Ü‰∏§Áßç‰∏öÂä°Âú∫ÊôØÔºöÊñ∞Â¢ûÂàÜÁ±ªÊó∂Ê£ÄÊü•ÁºñÂè∑ÊòØÂê¶Â∑≤Â≠òÂú®Ôºå‰øÆÊîπÂàÜÁ±ªÊó∂Ê£ÄÊü•ÁºñÂè∑ÊòØÂê¶Ë¢´ÂÖ∂‰ªñÂàÜÁ±ªÂç†Áî®„ÄÇ</p>
<h3 id="1-Âà§Êñ≠Êù°‰ª∂ÂàÜËß£">1. Âà§Êñ≠Êù°‰ª∂ÂàÜËß£
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Âú∫ÊôØ1ÔºöÊñ∞Â¢ûÊó∂ÂèëÁé∞ÂàÜÁ±ªÁºñÂè∑Â∑≤Â≠òÂú®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">bean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">dbBean</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">||</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Âú∫ÊôØ2Ôºö‰øÆÊîπÊó∂ÂèëÁé∞ÂàÜÁ±ªÁºñÂè∑Ë¢´ÂÖ∂‰ªñÂàÜÁ±ªÂç†Áî®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">bean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dbBean</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">bean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">dbBean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;ÂàÜÁ±ªÁºñÂè∑Â∑≤ÁªèÂ≠òÂú®&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-Âú∫ÊôØ1Êñ∞Â¢ûÂàÜÁ±ªÊó∂ÁöÑÊ£ÄÊü•">2. Âú∫ÊôØ1ÔºöÊñ∞Â¢ûÂàÜÁ±ªÊó∂ÁöÑÊ£ÄÊü•
</h3><ul>
<li>Êù°‰ª∂Ôºö<code>bean.getCategoryId() == null &amp;&amp; null != dbBean</code></li>
<li>ÈÄªËæëÔºöÂΩìÂâçÊìç‰ΩúÊòØÊñ∞Â¢ûÂàÜÁ±ªÔºàcategoryId Â∞öÊú™ÁîüÊàêÔºâÔºådbBean ÈùûÁ©∫ËØ¥ÊòéËØ• categoryCode Â∑≤Ë¢´ÂÖ∂‰ªñÂàÜÁ±ªÂç†Áî®„ÄÇ</li>
<li>Á§∫‰æãÔºöÁî®Êà∑Â∞ùËØïÊñ∞Â¢û categoryCode = &ldquo;ELECTRONICS&rdquo;Ôºå‰ΩÜÊï∞ÊçÆÂ∫ìÂ∑≤Â≠òÂú®ËØ•ÁºñÂè∑ÔºåÊäõÂá∫ÂºÇÂ∏∏„ÄÇ</li>
</ul>
<h3 id="3-Âú∫ÊôØ2‰øÆÊîπÂàÜÁ±ªÊó∂ÁöÑÊ£ÄÊü•">3. Âú∫ÊôØ2Ôºö‰øÆÊîπÂàÜÁ±ªÊó∂ÁöÑÊ£ÄÊü•
</h3><ul>
<li>Êù°‰ª∂Ôºö<code>bean.getCategoryId() != null &amp;&amp; dbBean != null &amp;&amp; !bean.getCategoryId().equals(dbBean.getCategoryId())</code></li>
<li>ÈÄªËæëÔºöÂΩìÂâçÊìç‰ΩúÊòØ‰øÆÊîπÂ∑≤ÊúâÂàÜÁ±ªÔºå‰∏îÊï∞ÊçÆÂ∫ì‰∏≠Â≠òÂú®‰∏é categoryCode ÂåπÈÖçÁöÑÂàÜÁ±ªÔºå‰ΩÜ‰∏çÊòØÂΩìÂâçÂàÜÁ±ªÊú¨Ë∫´ÔºåËØ¥ÊòéÁºñÂè∑Ë¢´ÂÖ∂‰ªñÂàÜÁ±ªÂç†Áî®„ÄÇ</li>
<li>Á§∫‰æãÔºöÁî®Êà∑Â∞ùËØïÂ∞Ü categoryId = 1 ÁöÑÂàÜÁ±ªÁºñÂè∑Êîπ‰∏∫Â∑≤Ë¢´ categoryId = 2 Âç†Áî®ÁöÑÁºñÂè∑ÔºåÊäõÂá∫ÂºÇÂ∏∏„ÄÇ</li>
</ul>
<h3 id="4-‰∏∫‰ªÄ‰πàÈúÄË¶Å‰∏§‰∏™Âú∫ÊôØÂàÜÂºÄÂà§Êñ≠">4. ‰∏∫‰ªÄ‰πàÈúÄË¶Å‰∏§‰∏™Âú∫ÊôØÂàÜÂºÄÂà§Êñ≠Ôºü
</h3><ul>
<li>Êñ∞Â¢ûÊó∂Âè™ÈúÄÊ£ÄÊü• categoryCode ÊòØÂê¶Â≠òÂú®„ÄÇ</li>
<li>‰øÆÊîπÊó∂ÈúÄÈ¢ùÂ§ñÊ£ÄÊü• categoryCode ÊòØÂê¶Ë¢´ÂÖ∂‰ªñÂàÜÁ±ªÂç†Áî®ÔºàÂÖÅËÆ∏‰øÆÊîπ‰∏∫Ëá™Â∑±ÁöÑÂéüÂÄºÔºâ„ÄÇ</li>
</ul>
<h3 id="5-ÈÄªËæë‰ºòÂåñÂª∫ËÆÆ">5. ÈÄªËæë‰ºòÂåñÂª∫ËÆÆ
</h3><p><strong>Êõ¥Ê∏ÖÊô∞ÁöÑÂÜôÊ≥ïÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">boolean</span><span class="w"> </span><span class="n">isAdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">bean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">boolean</span><span class="w"> </span><span class="n">isUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isAdd</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isAdd</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dbBean</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;ÂàÜÁ±ªÁºñÂè∑Â∑≤Â≠òÂú®&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUpdate</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dbBean</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">bean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">dbBean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;ÂàÜÁ±ªÁºñÂè∑Â∑≤Ë¢´ÂÖ∂‰ªñÂàÜÁ±ª‰ΩøÁî®&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÊèêÂâçËøîÂõûÂáèÂ∞ëÂµåÂ•óÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dbBean</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Êó†ÂÜ≤Á™ÅÔºåÁõ¥Êé•ÁªßÁª≠ÂêéÁª≠ÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;ÂàÜÁ±ªÁºñÂè∑Â∑≤Â≠òÂú®&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">bean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">dbBean</span><span class="p">.</span><span class="na">getCategoryId</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;ÂàÜÁ±ªÁºñÂè∑Â∑≤Ë¢´ÂÖ∂‰ªñÂàÜÁ±ª‰ΩøÁî®&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-ÊÄªÁªì-2">6. ÊÄªÁªì
</h3><ul>
<li>ÁõÆÁöÑÔºöÁ°Æ‰øùÂàÜÁ±ªÁºñÂè∑ÁöÑÂîØ‰∏ÄÊÄßÔºåÈÅøÂÖçÊï∞ÊçÆÂÜ≤Á™Å„ÄÇ</li>
<li>Êñ∞Â¢ûÊó∂ÔºöÁ¶ÅÊ≠¢‰ΩøÁî®Â∑≤Â≠òÂú®ÁöÑ categoryCode„ÄÇ</li>
<li>‰øÆÊîπÊó∂ÔºöÁ¶ÅÊ≠¢Â∞Ü categoryCode Êîπ‰∏∫ÂÖ∂‰ªñÂàÜÁ±ªÁöÑÁºñÂè∑„ÄÇ</li>
<li>ÂÖ≥ÈîÆÊäÄÂ∑ßÔºöÈÄöËøá categoryId ÊòØÂê¶‰∏∫ null Âå∫ÂàÜÊìç‰ΩúÁ±ªÂûãÔºåÁªìÂêàÊü•ËØ¢ÁªìÊûú dbBean Âà§Êñ≠ÂÜ≤Á™Å„ÄÇ</li>
</ul>
<hr>
<h2 id="filetransfertonew-filefilepath-‰ª£Á†ÅËß£Êûê">file.transferTo(new File(filePath)) ‰ª£Á†ÅËß£Êûê
</h2><p><strong>‰ΩúÁî®</strong></p>
<ul>
<li>ËøôË°å‰ª£Á†ÅÊòØÂ∞ÜÂÆ¢Êà∑Á´Ø‰∏ä‰º†ÁöÑ MultipartFile Êñá‰ª∂‰øùÂ≠òÂà∞ÊúçÂä°Âô®ÁöÑÊåáÂÆöË∑ØÂæÑ„ÄÇ</li>
<li>fileÔºöSpring MVC Êé•Êî∂Âà∞ÁöÑ‰∏ä‰º†Êñá‰ª∂ÂØπË±°ÔºàMultipartFile Á±ªÂûãÔºâ„ÄÇ</li>
<li>transferTo()ÔºöÂ∞ÜÊñá‰ª∂ÂÜÖÂÆπ‰ªéÂÜÖÂ≠òÊàñ‰∏¥Êó∂ÁõÆÂΩïÊ∞∏‰πÖ‰øùÂ≠òÂà∞ÁõÆÊ†áË∑ØÂæÑ„ÄÇ</li>
<li>new File(filePath)ÔºöÊåáÂÆöÊñá‰ª∂Âú®ÊúçÂä°Âô®‰∏äÁöÑÂ≠òÂÇ®‰ΩçÁΩÆÔºàÁªùÂØπË∑ØÂæÑÔºâ„ÄÇ</li>
</ul>
<h3 id="ËØ¶ÁªÜÊâßË°åÊµÅÁ®ã">ËØ¶ÁªÜÊâßË°åÊµÅÁ®ã
</h3><ol>
<li><strong>Êñá‰ª∂Êé•Êî∂</strong>ÔºöÁî®Êà∑ÈÄöËøá HTTP ËØ∑Ê±Ç‰∏ä‰º†Êñá‰ª∂ÔºåSpring MVC Â∞ÜÂÖ∂Â∞ÅË£Ö‰∏∫ MultipartFile ÂØπË±°„ÄÇ</li>
<li><strong>Ë∑ØÂæÑÂáÜÂ§á</strong>Ôºö‰ª£Á†Å‰∏≠ÈÄöËøá folder Âíå realFileName ÊãºÊé•Âá∫ÂÆåÊï¥ÁöÑÂ≠òÂÇ®Ë∑ØÂæÑÔºåÁ°Æ‰øùÁõÆÊ†áÁõÆÂΩïÂ≠òÂú®ÔºàÈÄöËøá mkdirs() ÂàõÂª∫Ôºâ„ÄÇ</li>
<li><strong>Êñá‰ª∂‰øùÂ≠ò</strong>ÔºötransferTo() ÊñπÊ≥ïÂ∞ÜÊñá‰ª∂ÊµÅÂÜôÂÖ•Âà∞ filePath ÂØπÂ∫îÁöÑÁâ©ÁêÜÊñá‰ª∂‰∏≠„ÄÇ</li>
</ol>
<h3 id="ÂÖ≥ÈîÆÊ≥®ÊÑè‰∫ãÈ°π">ÂÖ≥ÈîÆÊ≥®ÊÑè‰∫ãÈ°π
</h3><ul>
<li><strong>Êñá‰ª∂Ë¶ÜÁõñÈ£éÈô©</strong>ÔºöfilePath Â∑≤Â≠òÂú®ÂêåÂêçÊñá‰ª∂‰ºöË¢´Ë¶ÜÁõñÔºåÂª∫ËÆÆËøΩÂä†ÈöèÊú∫Â≠óÁ¨¶‰∏≤ÊàñÊó∂Èó¥Êà≥ÈÅøÂÖçÂÜ≤Á™Å„ÄÇ</li>
<li><strong>ÂºÇÂ∏∏Â§ÑÁêÜ</strong>ÔºötransferTo() ÂèØËÉΩÊäõÂá∫ IOExceptionÔºåÈúÄÊçïËé∑ÂºÇÂ∏∏Âπ∂ËøîÂõûÂèãÂ•ΩÊèêÁ§∫„ÄÇ</li>
<li><strong>ÊÄßËÉΩ‰ºòÂåñ</strong>ÔºöÂ§ßÊñá‰ª∂‰∏ä‰º†Âª∫ËÆÆÂàÜÂùóÊàñÂºÇÊ≠•Â§ÑÁêÜÔºåÈÅøÂÖçÈòªÂ°ûËØ∑Ê±ÇÁ∫øÁ®ã„ÄÇ</li>
</ul>
<h3 id="Á§∫‰æãÂÆåÊï¥ÂÆâÂÖ®Áâà‰ª£Á†Å">Á§∫‰æãÔºöÂÆåÊï¥ÂÆâÂÖ®Áâà‰ª£Á†Å
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/uploadImage&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseVO</span><span class="w"> </span><span class="nf">uploadImage</span><span class="p">(</span><span class="nd">@NotNull</span><span class="w"> </span><span class="n">MultipartFile</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="nd">@NotNull</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">createThumbnail</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;‰∏ä‰º†Êñá‰ª∂‰∏çËÉΩ‰∏∫Á©∫&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateUtil</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;yyyyMM&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">folder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appConfig</span><span class="p">.</span><span class="na">getProjectFolder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/upload/cover/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">month</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="n">folderFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">folder</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">folderFile</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">folderFile</span><span class="p">.</span><span class="na">mkdirs</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">originalName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="na">getOriginalFilename</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">originalName</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">originalName</span><span class="p">.</span><span class="na">lastIndexOf</span><span class="p">(</span><span class="s">&#34;.&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">newFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">suffix</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">folder</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">newFileName</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">file</span><span class="p">.</span><span class="na">transferTo</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">filePath</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;Êñá‰ª∂‰øùÂ≠òÂ§±Ë¥•: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">createThumbnail</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">fFmpegUtils</span><span class="p">.</span><span class="na">createImageThumbnail</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">getSuccessResponseVO</span><span class="p">(</span><span class="s">&#34;/upload/cover/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">newFileName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Â∏∏ËßÅÈóÆÈ¢òËß£Á≠î">Â∏∏ËßÅÈóÆÈ¢òËß£Á≠î
</h3><ul>
<li><strong>‰∏∫‰ªÄ‰πà‰∏çÁî® file.getBytes() ÂÜçÊâãÂä®ÂÜôÂÖ•Ôºü</strong> transferTo() Â∑≤‰ºòÂåñÊñá‰ª∂ÊµÅÂ§ÑÁêÜÔºåÁõ¥Êé•Êìç‰ΩúÊñá‰ª∂Á≥ªÁªüÔºåÊõ¥È´òÊïà„ÄÇ</li>
<li><strong>Êñá‰ª∂‰øùÂ≠òÂêéÂ¶Ç‰ΩïËÆ©Â§ñÈÉ®ËÆøÈóÆÔºü</strong> ËøîÂõûÁõ∏ÂØπË∑ØÂæÑÔºåÈÖçÂêàÈùôÊÄÅËµÑÊ∫êÊò†Â∞Ñ„ÄÇ</li>
</ul>
<hr>
<h2 id="ÂàÜÁâá‰∏ä‰º†ËßÜÈ¢ëÊñá‰ª∂-uploadvideo-ÊñπÊ≥ïËØ¶Ëß£">ÂàÜÁâá‰∏ä‰º†ËßÜÈ¢ëÊñá‰ª∂ uploadVideo ÊñπÊ≥ïËØ¶Ëß£
</h2><p>ËØ•ÊñπÊ≥ïÂÆûÁé∞‰∫ÜÂàÜÁâá‰∏ä‰º†ËßÜÈ¢ëÊñá‰ª∂ÁöÑÂäüËÉΩÔºå‰∏ªË¶ÅÁî®‰∫éÂ§ÑÁêÜÂ§ßÊñá‰ª∂‰∏ä‰º†„ÄÇ‰ª•‰∏ãÊòØÈÄêË°åËß£ÊûêÔºö</p>
<h3 id="1-ÊñπÊ≥ïÁ≠æÂêç">1. ÊñπÊ≥ïÁ≠æÂêç
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/uploadVideo&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@GlobalInterceptor</span><span class="p">(</span><span class="n">checkLogin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseVO</span><span class="w"> </span><span class="nf">uploadVideo</span><span class="p">(</span><span class="nd">@NotNull</span><span class="w"> </span><span class="n">MultipartFile</span><span class="w"> </span><span class="n">chunkFile</span><span class="p">,</span><span class="w"> </span><span class="nd">@NotNull</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">chunkIndex</span><span class="p">,</span><span class="w"> </span><span class="nd">@NotEmpty</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">uploadId</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>chunkFileÔºöÂΩìÂâç‰∏ä‰º†ÁöÑÊñá‰ª∂ÂàÜÁâá„ÄÇ</li>
<li>chunkIndexÔºöÂΩìÂâçÂàÜÁâáÁöÑÁ¥¢Âºï„ÄÇ</li>
<li>uploadIdÔºöÊú¨Ê¨°‰∏ä‰º†ÁöÑÂîØ‰∏ÄÊ†áËØÜ„ÄÇ</li>
</ul>
<h3 id="2-Áî®Êà∑Ë∫´‰ªΩÈ™åËØÅ">2. Áî®Êà∑Ë∫´‰ªΩÈ™åËØÅ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">TokenUserInfoDto</span><span class="w"> </span><span class="n">tokenUserInfoDto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTokenUserInfoDto</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ªéËØ∑Ê±ÇÂ§¥Êàñ Cookie Ëé∑ÂèñÂΩìÂâçÁôªÂΩïÁî®Êà∑ÁöÑ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="3-Ê£ÄÊü•‰∏ä‰º†‰ªªÂä°ÊòØÂê¶Â≠òÂú®">3. Ê£ÄÊü•‰∏ä‰º†‰ªªÂä°ÊòØÂê¶Â≠òÂú®
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">UploadingFileDto</span><span class="w"> </span><span class="n">fileDto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getUploadVideoFile</span><span class="p">(</span><span class="n">tokenUserInfoDto</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span><span class="w"> </span><span class="n">uploadId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileDto</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;Êñá‰ª∂‰∏çÂ≠òÂú®ËØ∑ÈáçÊñ∞‰∏ä‰º†&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Redis ‰∏≠Ê≤°ÊúâÊâæÂà∞ÂØπÂ∫îÁöÑ‰∏ä‰º†‰ªªÂä°ÔºåÈúÄÈáçÊñ∞‰∏ä‰º†„ÄÇ</li>
</ul>
<h3 id="4-Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞èÈôêÂà∂">4. Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞èÈôêÂà∂
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">SysSettingDto</span><span class="w"> </span><span class="n">sysSettingDto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getSysSettingDto</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileDto</span><span class="p">.</span><span class="na">getFileSize</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">sysSettingDto</span><span class="p">.</span><span class="na">getVideoSize</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">MB_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;Êñá‰ª∂Ë∂ÖËøáÊúÄÂ§ßÊñá‰ª∂ÈôêÂà∂&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ë∂ÖËøáÁ≥ªÁªüÂÖÅËÆ∏ÁöÑÊúÄÂ§ßËßÜÈ¢ëÊñá‰ª∂Â§ßÂ∞èÂàôÊãíÁªù„ÄÇ</li>
</ul>
<h3 id="5-Ê£ÄÊü•ÂàÜÁâáÂ∫èÂè∑ÂêàÊ≥ïÊÄß">5. Ê£ÄÊü•ÂàÜÁâáÂ∫èÂè∑ÂêàÊ≥ïÊÄß
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">chunkIndex</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">fileDto</span><span class="p">.</span><span class="na">getChunkIndex</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">chunkIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">fileDto</span><span class="p">.</span><span class="na">getChunks</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_600</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Èò≤Ê≠¢‰π±Â∫è‰∏ä‰º†ÊàñÊÅ∂ÊÑè‰º†Ë∂ÖÂá∫ËåÉÂõ¥ÁöÑÂàÜÁâá„ÄÇ</li>
</ul>
<h3 id="6-‰øùÂ≠òÂàÜÁâáÊñá‰ª∂">6. ‰øùÂ≠òÂàÜÁâáÊñá‰ª∂
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">folder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appConfig</span><span class="p">.</span><span class="na">getProjectFolder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_FOLDER</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_FOLDER_TEMP</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fileDto</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">File</span><span class="w"> </span><span class="n">targetFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">folder</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chunkIndex</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">chunkFile</span><span class="p">.</span><span class="na">transferTo</span><span class="p">(</span><span class="n">targetFile</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂàÜÁâáÊñá‰ª∂‰øùÂ≠òÂà∞‰∏¥Êó∂ÁõÆÂΩï„ÄÇ</li>
</ul>
<h3 id="7-Êõ¥Êñ∞‰∏ä‰º†ËøõÂ∫¶">7. Êõ¥Êñ∞‰∏ä‰º†ËøõÂ∫¶
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">fileDto</span><span class="p">.</span><span class="na">setChunkIndex</span><span class="p">(</span><span class="n">chunkIndex</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">fileDto</span><span class="p">.</span><span class="na">setFileSize</span><span class="p">(</span><span class="n">fileDto</span><span class="p">.</span><span class="na">getFileSize</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chunkFile</span><span class="p">.</span><span class="na">getSize</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">redisComponent</span><span class="p">.</span><span class="na">updateVideoFileInfo</span><span class="p">(</span><span class="n">tokenUserInfoDto</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span><span class="w"> </span><span class="n">fileDto</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ËÆ∞ÂΩïÂΩìÂâç‰∏ä‰º†ËøõÂ∫¶ÔºåÁ°Æ‰øùÊñ≠ÁÇπÁª≠‰º†„ÄÇ</li>
</ul>
<h3 id="8-ËøîÂõûÊàêÂäüÂìçÂ∫î">8. ËøîÂõûÊàêÂäüÂìçÂ∫î
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">return</span><span class="w"> </span><span class="n">getSuccessResponseVO</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ë°®Á§∫ÂΩìÂâçÂàÜÁâá‰∏ä‰º†ÊàêÂäü„ÄÇ</li>
</ul>
<h3 id="ÂÆåÊï¥ÊµÅÁ®ãÊÄªÁªì">ÂÆåÊï¥ÊµÅÁ®ãÊÄªÁªì
</h3><ul>
<li>ÂÆ¢Êà∑Á´ØÂ∞ÜÂ§ßÊñá‰ª∂ÂàáÂàÜ‰∏∫Â§ö‰∏™ÂàÜÁâáÔºå‰æùÊ¨°‰∏ä‰º†„ÄÇ</li>
<li>ÊúçÂä°Á´ØÊ£ÄÊü•ÂàÜÁâáÈ°∫Â∫è„ÄÅÂ§ßÂ∞èÈôêÂà∂Ôºå‰øùÂ≠òÂàÜÁâáÂà∞‰∏¥Êó∂ÁõÆÂΩïÔºåÊõ¥Êñ∞ Redis ‰∏ä‰º†ËøõÂ∫¶„ÄÇ</li>
<li>ÊâÄÊúâÂàÜÁâá‰∏ä‰º†ÂÆåÊàêÂêéÔºåË∞ÉÁî®ÂêàÂπ∂Êé•Âè£Â∞Ü‰∏¥Êó∂Êñá‰ª∂ÊãºÊé•‰∏∫ÂÆåÊï¥ËßÜÈ¢ë„ÄÇ</li>
</ul>
<h3 id="‰ºòÂåñÂª∫ËÆÆ">‰ºòÂåñÂª∫ËÆÆ
</h3><ul>
<li>Êñ≠ÁÇπÁª≠‰º†„ÄÅÂàÜÁâáÊ†°È™å„ÄÅÊ∏ÖÁêÜ‰∏¥Êó∂Êñá‰ª∂„ÄÅÂπ∂ÂèëÊéßÂà∂„ÄÇ</li>
<li>ÈÄÇÁî®Âú∫ÊôØÔºöËßÜÈ¢ëÁΩëÁ´ô„ÄÅ‰∫ëÂ≠òÂÇ®ÊúçÂä°„ÄÅÂ§ßÊñá‰ª∂‰∏ä‰º†„ÄÇ</li>
</ul>
<hr>
<h2 id="savevideoinfo-ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê">saveVideoInfo ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê
</h2><p>saveVideoInfo ÊñπÊ≥ïÁî®‰∫é‰øùÂ≠òËßÜÈ¢ë‰ø°ÊÅØÂèäÂÖ∂ÂÖ≥ËÅîÊñá‰ª∂ÔºåÂ§ÑÁêÜËßÜÈ¢ë‰ø°ÊÅØÁöÑÂàõÂª∫„ÄÅÊõ¥Êñ∞‰ª•ÂèäÊñá‰ª∂ÁÆ°ÁêÜ„ÄÇ</p>
<h3 id="1-ÊñπÊ≥ïÊ¶ÇËø∞">1. ÊñπÊ≥ïÊ¶ÇËø∞
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Transactional</span><span class="p">(</span><span class="n">rollbackFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Exception</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveVideoInfo</span><span class="p">(</span><span class="n">VideoInfoPost</span><span class="w"> </span><span class="n">videoInfoPost</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>@TransactionalÔºöÈÅáÂà∞‰ªª‰ΩïÂºÇÂ∏∏ÈÉΩ‰ºöÂõûÊªö„ÄÇ</li>
<li>videoInfoPostÔºöËßÜÈ¢ë‰∏ª‰ø°ÊÅØ„ÄÇ</li>
<li>uploadFileListÔºöËßÜÈ¢ëÂÖ≥ËÅîÁöÑÊñá‰ª∂ÂàóË°®„ÄÇ</li>
</ul>
<h3 id="2-ÂàÜpÊï∞Ê†°È™å">2. ÂàÜPÊï∞Ê†°È™å
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uploadFileList</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getSysSettingDto</span><span class="p">().</span><span class="na">getVideoPCount</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_600</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ê£ÄÊü•‰∏ä‰º†ÁöÑËßÜÈ¢ëÂàÜPÊï∞ÊòØÂê¶Ë∂ÖËøáÁ≥ªÁªüËÆæÁΩÆÁöÑÊúÄÂ§ßÈôêÂà∂„ÄÇ</li>
</ul>
<h3 id="3-ËßÜÈ¢ëidÂ≠òÂú®ÊÄßÊ†°È™å">3. ËßÜÈ¢ëIDÂ≠òÂú®ÊÄßÊ†°È™å
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">StringTools</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">())){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">VideoInfoPost</span><span class="w"> </span><span class="n">videoInfoPostDb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoPostMapper</span><span class="p">.</span><span class="na">selectByVideoId</span><span class="p">(</span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">videoInfoPostDb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_600</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ArrayUtils</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Integer</span><span class="o">[]</span><span class="p">{</span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">STATUS0</span><span class="p">.</span><span class="na">getStatus</span><span class="p">(),</span><span class="w"> </span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">STATUS2</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()},</span><span class="w"> </span><span class="n">videoInfoPostDb</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_600</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ê£ÄÊü•ËßÜÈ¢ëÊòØÂê¶Â≠òÂú®ÂèäÁä∂ÊÄÅÊòØÂê¶ÂÖÅËÆ∏‰øÆÊîπ„ÄÇ</li>
</ul>
<h3 id="4-ÂàùÂßãÂåñÂèòÈáè">4. ÂàùÂßãÂåñÂèòÈáè
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Date</span><span class="w"> </span><span class="n">curDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">deleteFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">addFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>curDateÔºöÂΩìÂâçÊó∂Èó¥„ÄÇ</li>
<li>videoIdÔºöËßÜÈ¢ëID„ÄÇ</li>
<li>deleteFileListÔºöÂæÖÂà†Èô§ÁöÑÊñá‰ª∂ÂàóË°®„ÄÇ</li>
<li>addFileListÔºöÂæÖÊ∑ªÂä†ÁöÑÊñá‰ª∂ÂàóË°®„ÄÇ</li>
</ul>
<h3 id="5-Êñ∞Â¢ûËßÜÈ¢ëÈÄªËæë">5. Êñ∞Â¢ûËßÜÈ¢ëÈÄªËæë
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringTools</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">videoId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringTools</span><span class="p">.</span><span class="na">getRandomString</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">LENGTH_10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">setCreateTime</span><span class="p">(</span><span class="n">curDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">setLastUpdateTime</span><span class="p">(</span><span class="n">curDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">STATUS0</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoPostMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">videoInfoPost</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>videoId ‰∏∫Á©∫Ë°®Á§∫Êñ∞Â¢ûËßÜÈ¢ë„ÄÇ</li>
<li>ÁîüÊàêÈöèÊú∫ videoIdÔºåËÆæÁΩÆÂàõÂª∫/Êõ¥Êñ∞Êó∂Èó¥„ÄÅÂàùÂßãÁä∂ÊÄÅÔºåÊèíÂÖ•Êï∞ÊçÆÂ∫ì„ÄÇ</li>
</ul>
<h3 id="6-Êõ¥Êñ∞ËßÜÈ¢ëÈÄªËæë">6. Êõ¥Êñ∞ËßÜÈ¢ëÈÄªËæë
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">VideoInfoFilePostQuery</span><span class="w"> </span><span class="n">fileQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePostQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fileQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fileQuery</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dbInfoFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="n">fileQuery</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">uploadFileMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toMap</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getUploadId</span><span class="p">(),</span><span class="w"> </span><span class="n">Function</span><span class="p">.</span><span class="na">identity</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="w"> </span><span class="n">data2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data2</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Boolean</span><span class="w"> </span><span class="n">updateFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">fileInfo</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">dbInfoFileList</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">updateFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uploadFileMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">fileInfo</span><span class="p">.</span><span class="na">getUploadId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">updateFile</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">deleteFileList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">fileInfo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">updateFile</span><span class="p">.</span><span class="na">getFileName</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">fileInfo</span><span class="p">.</span><span class="na">getFileName</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">updateFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">addFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">item</span><span class="p">.</span><span class="na">getFileId</span><span class="p">()</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">setLastUpdateTime</span><span class="p">(</span><span class="n">curDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Boolean</span><span class="w"> </span><span class="n">changeVideoInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">changeVideoInfo</span><span class="p">(</span><span class="n">videoInfoPost</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addFileList</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">addFileList</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">STATUS0</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">changeVideoInfo</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">updateFileName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">STATUS2</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoPostMapper</span><span class="p">.</span><span class="na">updateByVideoId</span><span class="p">(</span><span class="n">videoInfoPost</span><span class="p">,</span><span class="w"> </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Êü•ËØ¢Êï∞ÊçÆÂ∫ì‰∏≠ËØ•ËßÜÈ¢ëÂ∑≤ÊúâÁöÑÊñá‰ª∂ÂàóË°®„ÄÇ</li>
<li>ÊØîËæÉÊï∞ÊçÆÂ∫ìÊñá‰ª∂Âíå‰∏ä‰º†Êñá‰ª∂ÔºåËØÜÂà´Êñ∞Â¢û„ÄÅÂà†Èô§Âíå‰øÆÊîπÁöÑÊñá‰ª∂„ÄÇ</li>
<li>Ê†πÊçÆÊÉÖÂÜµËÆæÁΩÆËßÜÈ¢ëÁä∂ÊÄÅÔºåÊõ¥Êñ∞‰∏ªË°®‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="7-Â§ÑÁêÜÂæÖÂà†Èô§Êñá‰ª∂">7. Â§ÑÁêÜÂæÖÂà†Èô§Êñá‰ª∂
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">deleteFileList</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deleteFileList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">item</span><span class="p">.</span><span class="na">getFileId</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">deleteBatchByFileId</span><span class="p">(</span><span class="n">delFileList</span><span class="p">,</span><span class="w"> </span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delFilePathList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deleteFileList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">item</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">addFile2DelQueue</span><span class="p">(</span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">delFilePathList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÊâπÈáèÂà†Èô§Êï∞ÊçÆÂ∫ìËÆ∞ÂΩïÔºåÂ∞ÜÂæÖÂà†Èô§Êñá‰ª∂Ë∑ØÂæÑÂä†ÂÖ• Redis ÈòüÂàó„ÄÇ</li>
</ul>
<h3 id="8-Â§ÑÁêÜÊñá‰ª∂Á¥¢ÂºïÂíåÊñ∞Â¢ûÊñá‰ª∂">8. Â§ÑÁêÜÊñá‰ª∂Á¥¢ÂºïÂíåÊñ∞Â¢ûÊñá‰ª∂
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Integer</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">videoInfoFile</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoFile</span><span class="p">.</span><span class="na">setFileIndex</span><span class="p">(</span><span class="n">index</span><span class="o">++</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoFile</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoFile</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">videoInfoFile</span><span class="p">.</span><span class="na">getFileId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoInfoFile</span><span class="p">.</span><span class="na">setFileId</span><span class="p">(</span><span class="n">StringTools</span><span class="p">.</span><span class="na">getRandomString</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">LENGTH_20</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoInfoFile</span><span class="p">.</span><span class="na">setUpdateType</span><span class="p">(</span><span class="n">VideoFileUpdateTypeEnum</span><span class="p">.</span><span class="na">UPDATE</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoInfoFile</span><span class="p">.</span><span class="na">setTransferResult</span><span class="p">(</span><span class="n">VideoFileTransferResultEnum</span><span class="p">.</span><span class="na">TRANSFER</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">insertOrUpdateBatch</span><span class="p">(</span><span class="n">uploadFileList</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰∏∫ÊØè‰∏™Êñá‰ª∂ËÆæÁΩÆÁ¥¢Âºï„ÄÅËßÜÈ¢ëID„ÄÅÁî®Êà∑ID„ÄÇ</li>
<li>ÂØπÊñ∞Êñá‰ª∂ÁîüÊàê fileId Âπ∂ËÆæÁΩÆÂ±ûÊÄß„ÄÇ</li>
<li>ÊâπÈáèÊèíÂÖ•ÊàñÊõ¥Êñ∞Êñá‰ª∂Ë°®„ÄÇ</li>
</ul>
<h3 id="9-Â§ÑÁêÜÊñ∞Â¢ûÊñá‰ª∂‰º†Ëæì">9. Â§ÑÁêÜÊñ∞Â¢ûÊñá‰ª∂‰º†Ëæì
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addFileList</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">addFileList</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">addFileList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">file</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">file</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">addFile2TransferQueue</span><span class="p">(</span><span class="n">addFileList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â∞ÜÊñ∞Â¢ûÊñá‰ª∂Âä†ÂÖ•‰º†ËæìÈòüÂàóÔºàÂ¶ÇËΩ¨Á†Å„ÄÅËΩ¨Â≠òÁ≠âÂºÇÊ≠•Â§ÑÁêÜÔºâ„ÄÇ</li>
</ul>
<h3 id="ÊñπÊ≥ïÊÄªÁªì">ÊñπÊ≥ïÊÄªÁªì
</h3><ul>
<li>ÂèÇÊï∞Ê†°È™åÔºöÊ£ÄÊü•ÂàÜPÊï∞ÈôêÂà∂„ÄÅËßÜÈ¢ëÁä∂ÊÄÅÊòØÂê¶ÂÖÅËÆ∏‰øÆÊîπ„ÄÇ</li>
<li>Êñ∞Â¢ûËßÜÈ¢ëÔºöÁîüÊàêID„ÄÅËÆæÁΩÆÂàùÂßãÁä∂ÊÄÅ„ÄÅÊèíÂÖ•Êï∞ÊçÆÂ∫ì„ÄÇ</li>
<li>Êõ¥Êñ∞ËßÜÈ¢ëÔºöÊØîËæÉÊñ∞ÊóßÊñá‰ª∂ÂàóË°®ÔºåËØÜÂà´Êñ∞Â¢û„ÄÅÂà†Èô§Âíå‰øÆÊîπÁöÑÊñá‰ª∂ÔºåÊ†πÊçÆ‰øÆÊîπÊÉÖÂÜµËÆæÁΩÆËßÜÈ¢ëÁä∂ÊÄÅÔºåÊõ¥Êñ∞‰∏ª‰ø°ÊÅØ„ÄÇ</li>
<li>Êñá‰ª∂Â§ÑÁêÜÔºöÂà†Èô§‰∏çÂÜçÈúÄË¶ÅÁöÑÊñá‰ª∂ËÆ∞ÂΩïÂíåÂÆûÈôÖÊñá‰ª∂Ôºå‰∏∫Êñ∞Â¢ûÊñá‰ª∂ÁîüÊàêIDÂπ∂ËÆæÁΩÆÂ±ûÊÄßÔºåÊâπÈáè‰øùÂ≠òÊñá‰ª∂‰ø°ÊÅØÔºåÂ∞ÜÊñ∞Â¢ûÊñá‰ª∂Âä†ÂÖ•Â§ÑÁêÜÈòüÂàó„ÄÇ</li>
<li>ÈÄöËøáÁ≤æÁªÜÁöÑÁä∂ÊÄÅÁÆ°ÁêÜÂíåÊñá‰ª∂ÊØîËæÉÔºåÂÆûÁé∞‰∫ÜËßÜÈ¢ë‰ø°ÊÅØÁöÑÂÆåÊï¥‰øùÂ≠òÊµÅÁ®ãÔºåÂêåÊó∂ËÄÉËôë‰∫Ü‰∫ãÂä°‰∏ÄËá¥ÊÄßÂíåÂºÇÊ≠•Â§ÑÁêÜÁöÑÈúÄÊ±Ç„ÄÇ</li>
</ul>
<h2 id="savevideoinfo-ÊñπÊ≥ï‰∏≠-stream-ÁöÑËØ¶ÁªÜÁî®Ê≥ïËß£Êûê">saveVideoInfo ÊñπÊ≥ï‰∏≠ stream() ÁöÑËØ¶ÁªÜÁî®Ê≥ïËß£Êûê
</h2><p>Âú® saveVideoInfo ÊñπÊ≥ï‰∏≠Ôºå<code>stream()</code> ÊñπÊ≥ïË¢´Â§öÊ¨°Áî®‰∫éÂØπÈõÜÂêàËøõË°åÂáΩÊï∞ÂºèÊìç‰Ωú„ÄÇ‰∏ãÈù¢ËØ¶ÁªÜËß£ÊûêÊØè‰∏™ stream() ÁöÑ‰ΩøÁî®Âú∫ÊôØÂíåÂÆûÁé∞ÈÄªËæë„ÄÇ</p>
<h3 id="1-Â∞Ü‰∏ä‰º†Êñá‰ª∂ÂàóË°®ËΩ¨‰∏∫-map">1. Â∞Ü‰∏ä‰º†Êñá‰ª∂ÂàóË°®ËΩ¨‰∏∫ Map
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">uploadFileMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toMap</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getUploadId</span><span class="p">(),</span><span class="w">  </span><span class="c1">// Key Êò†Â∞ÑÂáΩÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Function</span><span class="p">.</span><span class="na">identity</span><span class="p">(),</span><span class="w">         </span><span class="c1">// Value Êò†Â∞ÑÂáΩÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="w"> </span><span class="n">data2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data2</span><span class="w">      </span><span class="c1">// ÂêàÂπ∂ÂáΩÊï∞ÔºàËß£ÂÜ≥ÈîÆÂÜ≤Á™ÅÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÊûêÔºö</strong></p>
<ul>
<li>ÁõÆÁöÑÔºöÂ∞Ü <code>List&lt;VideoInfoFilePost&gt;</code> ËΩ¨Êç¢‰∏∫ <code>Map&lt;String, VideoInfoFilePost&gt;</code>Ôºå‰ª•‰æøÈÄöËøá uploadId Âø´ÈÄüÊü•ÊâæÊñá‰ª∂„ÄÇ</li>
<li>ÂàÜËß£Ôºö
<ol>
<li><code>uploadFileList.stream()</code> - Â∞ÜÂàóË°®ËΩ¨‰∏∫ÊµÅ„ÄÇ</li>
<li><code>Collectors.toMap()</code> - Êî∂ÈõÜÂô®ÔºåÂ∞ÜÊµÅÂÖÉÁ¥†ËΩ¨‰∏∫ Map„ÄÇ
<ul>
<li>Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ <code>item -&gt; item.getUploadId()</code>ÔºöÊåáÂÆö‰ΩøÁî® uploadId ‰Ωú‰∏∫ Map ÁöÑÈîÆ„ÄÇ</li>
<li>Á¨¨‰∫å‰∏™ÂèÇÊï∞ <code>Function.identity()</code>Ôºö‰ΩøÁî®ÂÖÉÁ¥†Êú¨Ë∫´‰Ωú‰∏∫ Map ÁöÑÂÄº„ÄÇ</li>
<li>Á¨¨‰∏â‰∏™ÂèÇÊï∞ <code>(data1, data2) -&gt; data2</code>ÔºöÂ¶ÇÊûúÈîÆÂÜ≤Á™ÅÔºàÁõ∏Âêå uploadIdÔºâÔºå‰øùÁïôÂêéÈù¢ÁöÑÂÄº„ÄÇ</li>
</ul>
</li>
</ol>
</li>
</ul>
<p><strong>Á≠â‰ª∑‰º†ÁªüÂÜôÊ≥ïÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">uploadFileMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">uploadFileMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getUploadId</span><span class="p">(),</span><span class="w"> </span><span class="n">item</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="2-Á≠õÈÄâÊñ∞Â¢ûÊñá‰ª∂">2. Á≠õÈÄâÊñ∞Â¢ûÊñá‰ª∂
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">addFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getFileId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÊûêÔºö</strong></p>
<ul>
<li>ÁõÆÁöÑÔºö‰ªé‰∏ä‰º†Êñá‰ª∂ÂàóË°®‰∏≠Á≠õÈÄâÂá∫Êñ∞Â¢ûÁöÑÊñá‰ª∂ÔºàfileId ‰∏∫ null ÁöÑÊñá‰ª∂Ôºâ„ÄÇ</li>
<li>ÂàÜËß£Ôºö
<ol>
<li><code>uploadFileList.stream()</code> - ÂàõÂª∫ÊµÅ„ÄÇ</li>
<li><code>.filter(item -&gt; item.getFileId() == null)</code> - ËøáÊª§Êù°‰ª∂„ÄÇ</li>
<li><code>.collect(Collectors.toList())</code> - Êî∂ÈõÜ‰∏∫ List„ÄÇ</li>
</ol>
</li>
</ul>
<p><strong>Á≠â‰ª∑‰º†ÁªüÂÜôÊ≥ïÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">addFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getFileId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">addFileList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="3-ÊèêÂèñÂæÖÂà†Èô§Êñá‰ª∂ÁöÑ-id-ÂàóË°®">3. ÊèêÂèñÂæÖÂà†Èô§Êñá‰ª∂ÁöÑ ID ÂàóË°®
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deleteFileList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getFileId</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÊûêÔºö</strong></p>
<ul>
<li>ÁõÆÁöÑÔºö‰ªéÂæÖÂà†Èô§Êñá‰ª∂ÂàóË°®‰∏≠ÊèêÂèñÊâÄÊúâ fileId ÁªÑÊàêÊñ∞ÂàóË°®„ÄÇ</li>
<li>ÂàÜËß£Ôºö
<ol>
<li><code>deleteFileList.stream()</code> - ÂàõÂª∫ÊµÅ„ÄÇ</li>
<li><code>.map(item -&gt; item.getFileId())</code> - Êò†Â∞ÑËΩ¨Êç¢Ôºå‰ªéÂØπË±°‰∏≠ÊèêÂèñ fileId„ÄÇ</li>
<li><code>.collect(Collectors.toList())</code> - Êî∂ÈõÜ‰∏∫ List„ÄÇ</li>
</ol>
</li>
</ul>
<p><strong>Á≠â‰ª∑‰º†ÁªüÂÜôÊ≥ïÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">deleteFileList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">delFileList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getFileId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="4-ÊèêÂèñÂæÖÂà†Èô§Êñá‰ª∂ÁöÑË∑ØÂæÑÂàóË°®">4. ÊèêÂèñÂæÖÂà†Èô§Êñá‰ª∂ÁöÑË∑ØÂæÑÂàóË°®
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delFilePathList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deleteFileList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÊûêÔºö</strong></p>
<ul>
<li>ÁõÆÁöÑÔºö‰ªéÂæÖÂà†Èô§Êñá‰ª∂ÂàóË°®‰∏≠ÊèêÂèñÊâÄÊúâ filePath ÁªÑÊàêÊñ∞ÂàóË°®„ÄÇ</li>
<li>ÂÆûÁé∞Ôºö‰∏é‰∏ä‰∏Ä‰∏™‰æãÂ≠êÁ±ª‰ººÔºåÂè™ÊòØÊèêÂèñÁöÑÊòØ filePath ËÄåÈùû fileId„ÄÇ</li>
</ul>
<p><strong>Á≠â‰ª∑‰º†ÁªüÂÜôÊ≥ïÔºö</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delFilePathList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">deleteFileList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">delFilePathList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="stream-api-Ê†∏ÂøÉÊ¶ÇÂøµÊÄªÁªì">Stream API Ê†∏ÂøÉÊ¶ÇÂøµÊÄªÁªì
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Êìç‰ΩúÁ±ªÂûã</th>
          <th>ÊñπÊ≥ï</th>
          <th>ËØ¥Êòé</th>
          <th>Á§∫‰æã</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÂàõÂª∫ÊµÅ</td>
          <td>stream()</td>
          <td>‰ªéÈõÜÂêàÂàõÂª∫ÊµÅ</td>
          <td>list.stream()</td>
      </tr>
      <tr>
          <td>‰∏≠Èó¥Êìç‰Ωú</td>
          <td>filter()</td>
          <td>ËøáÊª§ÂÖÉÁ¥†</td>
          <td>.filter(x -&gt; x &gt; 0)</td>
      </tr>
      <tr>
          <td></td>
          <td>map()</td>
          <td>ËΩ¨Êç¢ÂÖÉÁ¥†</td>
          <td>.map(x -&gt; x.getName())</td>
      </tr>
      <tr>
          <td>ÁªàÊ≠¢Êìç‰Ωú</td>
          <td>collect()</td>
          <td>Êî∂ÈõÜÁªìÊûú</td>
          <td>.collect(Collectors.toList())</td>
      </tr>
      <tr>
          <td></td>
          <td>forEach()</td>
          <td>ÈÅçÂéÜÂÖÉÁ¥†</td>
          <td>.forEach(System.out::println)</td>
      </tr>
  </tbody>
</table></div>
<hr>
<h3 id="‰∏∫‰ªÄ‰πà‰ΩøÁî®-stream-api">‰∏∫‰ªÄ‰πà‰ΩøÁî® Stream APIÔºü
</h3><ul>
<li><strong>‰ª£Á†ÅÁÆÄÊ¥Å</strong>ÔºöÁî®Â£∞ÊòéÂºèÁöÑÊñπÂºèË°®ËææÂ§çÊùÇÁöÑÊï∞ÊçÆÂ§ÑÁêÜÈÄªËæë„ÄÇ</li>
<li><strong>ÂèØËØªÊÄßÂº∫</strong>ÔºöÈìæÂºèË∞ÉÁî®Êõ¥Áõ¥ËßÇË°®ËææÊï∞ÊçÆÂ§ÑÁêÜÊµÅÁ®ã„ÄÇ</li>
<li><strong>Âπ∂Ë°åÂ§ÑÁêÜ</strong>ÔºöÂè™ÈúÄÂ∞Ü stream() Êîπ‰∏∫ parallelStream() Âç≥ÂèØÂÆûÁé∞Âπ∂Ë°å„ÄÇ</li>
<li><strong>ÊÉ∞ÊÄßÊ±ÇÂÄº</strong>Ôºö‰∏≠Èó¥Êìç‰Ωú‰∏ç‰ºöÁ´ãÂç≥ÊâßË°åÔºåÊèêÈ´òÊïàÁéá„ÄÇ</li>
</ul>
<h3 id="ÊÄßËÉΩËÄÉËôë">ÊÄßËÉΩËÄÉËôë
</h3><p>ËôΩÁÑ∂ Stream API ÂæàÂº∫Â§ßÔºå‰ΩÜÂú®ÁÆÄÂçïÂæ™ÁéØÂ∞±ËÉΩÂÆåÊàêÁöÑ‰ªªÂä°‰∏≠Ôºå‰º†Áªü for Âæ™ÁéØÂèØËÉΩÊõ¥È´òÊïà„ÄÇStream ÈÄÇÂêàÂ§ÑÁêÜÂ§çÊùÇÁöÑÊï∞ÊçÆËΩ¨Êç¢ÂíåËøáÊª§Âú∫ÊôØ„ÄÇ</p>
<hr>
<h3 id="ÂÆåÊï¥ÊµÅÁ®ãÁ§∫‰æã">ÂÆåÊï¥ÊµÅÁ®ãÁ§∫‰æã
</h3><p>ÂÅáËÆæÊúâ‰ª•‰∏ãÊï∞ÊçÆÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">uploadFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="p">(</span><span class="s">&#34;f1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;u1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;p1&#34;</span><span class="p">),</span><span class="w"> </span><span class="c1">// fileId ‰∏ç‰∏∫ nullÔºåËßÜ‰∏∫Â∑≤ÊúâÊñá‰ª∂</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;u2&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;p2&#34;</span><span class="p">),</span><span class="w">   </span><span class="c1">// fileId ‰∏∫ nullÔºåËßÜ‰∏∫Êñ∞Â¢ûÊñá‰ª∂</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;u3&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;p3&#34;</span><span class="p">)</span><span class="w">    </span><span class="c1">// fileId ‰∏∫ nullÔºåËßÜ‰∏∫Êñ∞Â¢ûÊñá‰ª∂</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâßË°åÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">addFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uploadFileList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getFileId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÁªìÊûúÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">addFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">VideoInfoFilePost</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;u2&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;p2&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">VideoInfoFilePost</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;u3&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;p3&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">]</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÄöËøá Stream APIÔºåÊàë‰ª¨ÁÆÄÊ¥ÅÂú∞ÂÆûÁé∞‰∫ÜÊï∞ÊçÆÁ≠õÈÄâÂíåËΩ¨Êç¢Ôºå‰ª£Á†ÅÊõ¥Âä†Ê∏ÖÊô∞ÊòìËØª„ÄÇ</p>
<h2 id="mybatis-ÊâπÈáèÊèíÂÖ•ÊàñÊõ¥Êñ∞ËØ≠Âè•-insertorupdatebatch-Ëß£Êûê">MyBatis ÊâπÈáèÊèíÂÖ•ÊàñÊõ¥Êñ∞ËØ≠Âè• insertOrUpdateBatch Ëß£Êûê
</h2><p>ËøôÊÆµ‰ª£Á†ÅÊòØ‰∏Ä‰∏™ MyBatis ÁöÑ Mapper XML ÈÖçÁΩÆÔºåÂÆûÁé∞‰∫ÜÊâπÈáèÊèíÂÖ•ÊàñÊõ¥Êñ∞ËßÜÈ¢ëÊñá‰ª∂‰ø°ÊÅØÁöÑÂäüËÉΩ„ÄÇ‰∏ãÈù¢ËØ¶ÁªÜËß£ÊûêËøô‰∏™ SQL ËØ≠Âè•ÁöÑÂêÑ‰∏™ÈÉ®ÂàÜÔºö</p>
<h3 id="1-Âü∫Êú¨ÁªìÊûÑ">1. Âü∫Êú¨ÁªìÊûÑ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&#34;insertOrUpdateBatch&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;com.easylive.entity.po.VideoInfoFilePost&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    INSERT INTO video_info_file_post(...) VALUES (...)
</span></span><span class="line"><span class="cl">    ON DUPLICATE KEY UPDATE ...
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/insert&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ËøôÊòØ‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑ MyBatis ÊâπÈáèÊìç‰ΩúËØ≠Âè•Ôºå‰ΩøÁî®‰∫Ü MySQL ÁöÑ <code>INSERT ... ON DUPLICATE KEY UPDATE</code> ËØ≠Ê≥ï„ÄÇ</li>
</ul>
<h3 id="2-ÊèíÂÖ•ÈÉ®ÂàÜËØ¶Ëß£">2. ÊèíÂÖ•ÈÉ®ÂàÜËØ¶Ëß£
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">INSERT INTO video_info_file_post(
</span></span><span class="line"><span class="cl">    file_id,
</span></span><span class="line"><span class="cl">    upload_id,
</span></span><span class="line"><span class="cl">    user_id,
</span></span><span class="line"><span class="cl">    video_id,
</span></span><span class="line"><span class="cl">    file_index,
</span></span><span class="line"><span class="cl">    file_name,
</span></span><span class="line"><span class="cl">    file_size,
</span></span><span class="line"><span class="cl">    file_path,
</span></span><span class="line"><span class="cl">    update_type,
</span></span><span class="line"><span class="cl">    transfer_result,
</span></span><span class="line"><span class="cl">    duration
</span></span><span class="line"><span class="cl">) VALUES
</span></span><span class="line"><span class="cl"><span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&#34;list&#34;</span> <span class="na">item=</span><span class="s">&#34;item&#34;</span> <span class="na">separator=</span><span class="s">&#34;,&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    (
</span></span><span class="line"><span class="cl">    #{item.fileId},
</span></span><span class="line"><span class="cl">    #{item.uploadId},
</span></span><span class="line"><span class="cl">    #{item.userId},
</span></span><span class="line"><span class="cl">    #{item.videoId},
</span></span><span class="line"><span class="cl">    #{item.fileIndex},
</span></span><span class="line"><span class="cl">    #{item.fileName},
</span></span><span class="line"><span class="cl">    #{item.fileSize},
</span></span><span class="line"><span class="cl">    #{item.filePath},
</span></span><span class="line"><span class="cl">    #{item.updateType},
</span></span><span class="line"><span class="cl">    #{item.transferResult},
</span></span><span class="line"><span class="cl">    #{item.duration}
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/foreach&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂÖ≥ÈîÆÁÇπÔºö</strong></p>
<ul>
<li><code>&lt;foreach&gt;</code> Ê†áÁ≠æÔºöMyBatis ÁöÑÂæ™ÁéØÊ†áÁ≠æÔºåÁî®‰∫éÂ§ÑÁêÜÈõÜÂêà</li>
<li><code>collection=&quot;list&quot;</code>ÔºöË°®Á§∫ÂèÇÊï∞ÊòØ‰∏Ä‰∏™ List ÈõÜÂêà</li>
<li><code>item=&quot;item&quot;</code>ÔºöÂÆö‰πâÂæ™ÁéØÂèòÈáèÂêç</li>
<li><code>separator=&quot;,&quot;</code>ÔºöÊØèÊ¨°Âæ™ÁéØÂêéÁî®ÈÄóÂè∑ÂàÜÈöî</li>
<li><code>#{}</code> Ë°®ËææÂºèÔºöMyBatis ÁöÑÂèÇÊï∞Âç†‰ΩçÁ¨¶Ôºå‰ºöÈ¢ÑÁºñËØëÈò≤Ê≠¢ SQL Ê≥®ÂÖ•</li>
<li>‰ΩøÁî® <code>item.Â±ûÊÄßÂêç</code> ËÆøÈóÆÈõÜÂêàÂÖÉÁ¥†ÁöÑÂ±ûÊÄß</li>
</ul>
<h3 id="3-ÂÜ≤Á™ÅÊõ¥Êñ∞ÈÉ®ÂàÜËØ¶Ëß£">3. ÂÜ≤Á™ÅÊõ¥Êñ∞ÈÉ®ÂàÜËØ¶Ëß£
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">ON DUPLICATE KEY UPDATE
</span></span><span class="line"><span class="cl">file_index = VALUES(file_index),
</span></span><span class="line"><span class="cl">file_name = VALUES(file_name)
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂÖ≥ÈîÆÁÇπÔºö</strong></p>
<ul>
<li><code>ON DUPLICATE KEY UPDATE</code>ÔºöMySQL ÁâπÊúâËØ≠Ê≥ïÔºåÂΩì‰∏ªÈîÆÊàñÂîØ‰∏ÄÈîÆÂÜ≤Á™ÅÊó∂ÊâßË°åÊõ¥Êñ∞</li>
<li><code>VALUES()</code> ÂáΩÊï∞ÔºöÂºïÁî® INSERT ËØ≠Âè•‰∏≠Â∞ùËØïÊèíÂÖ•ÁöÑÂÄº</li>
<li>ËøôÈáåÂè™Êõ¥Êñ∞‰∫Ü file_index Âíå file_name ‰∏§‰∏™Â≠óÊÆµÔºåÂÖ∂‰ªñÂ≠óÊÆµ‰øùÊåÅ‰∏çÂèò</li>
</ul>
<h3 id="4-ÂÆåÊï¥ÈÄªËæëÊµÅÁ®ã">4. ÂÆåÊï¥ÈÄªËæëÊµÅÁ®ã
</h3><ul>
<li>Â∞ùËØïÊâπÈáèÊèíÂÖ•Â§öÊù°ËÆ∞ÂΩïÂà∞ video_info_file_post Ë°®</li>
<li>Â¶ÇÊûúÊüêÊù°ËÆ∞ÂΩïÁöÑ file_idÔºàÂÅáËÆæÊòØ‰∏ªÈîÆÔºâÂ∑≤Â≠òÂú®ÔºåÂàôÊâßË°åÊõ¥Êñ∞Êìç‰Ωú</li>
<li>Êõ¥Êñ∞Êó∂Âè™‰øÆÊîπ file_index Âíå file_name Â≠óÊÆµ</li>
<li>ÂÖ∂‰ªñÂ≠óÊÆµ‰øùÊåÅÂéüÂÄº‰∏çÂèò</li>
</ul>
<h3 id="5-ÂÆûÈôÖÊâßË°åÁ§∫‰æã">5. ÂÆûÈôÖÊâßË°åÁ§∫‰æã
</h3><p>ÂÅáËÆæ‰º†ÂÖ•ÁöÑ List ÂåÖÂê´‰∏§‰∏™ÂÖÉÁ¥†Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="p">(</span><span class="s">&#34;id1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;up1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;vid1&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;name1&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">100</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;path1&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">100</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="p">(</span><span class="s">&#34;id2&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;up2&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;user1&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;vid1&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">2</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;name2&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">200</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;path2&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">200</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÁîüÊàêÁöÑ SQL ËØ≠Âè•Á±ª‰ººÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">video_info_file_post</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">file_id</span><span class="p">,</span><span class="w"> </span><span class="n">upload_id</span><span class="p">,</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">video_id</span><span class="p">,</span><span class="w"> </span><span class="n">file_index</span><span class="p">,</span><span class="w"> </span><span class="n">file_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">file_size</span><span class="p">,</span><span class="w"> </span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">update_type</span><span class="p">,</span><span class="w"> </span><span class="n">transfer_result</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;id1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;up1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;user1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;vid1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;path1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;id2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;up2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;user1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;vid1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;path2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">DUPLICATE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">UPDATE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">file_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="n">file_index</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-ËÆæËÆ°ËÄÉËôë">6. ËÆæËÆ°ËÄÉËôë
</h3><ul>
<li><strong>ÊÄßËÉΩ‰ºòÂåñ</strong>ÔºöÊâπÈáèÊìç‰ΩúÂáèÂ∞ëÊï∞ÊçÆÂ∫ìÂæÄËøîÊ¨°Êï∞</li>
<li><strong>ÂéüÂ≠êÊÄß</strong>ÔºöÊï¥‰∏™Êìç‰ΩúÂú®‰∏Ä‰∏™‰∫ãÂä°‰∏≠ÂÆåÊàê</li>
<li><strong>ÁÅµÊ¥ªÊÄß</strong>ÔºöÂè™Êõ¥Êñ∞ÈúÄË¶ÅÂèòÊõ¥ÁöÑÂ≠óÊÆµ</li>
<li><strong>ÂπÇÁ≠âÊÄß</strong>ÔºöÈáçÂ§çÊâßË°å‰∏ç‰ºö‰∫ßÁîüÂâØ‰ΩúÁî®</li>
</ul>
<h3 id="7-‰ΩøÁî®Âú∫ÊôØ">7. ‰ΩøÁî®Âú∫ÊôØ
</h3><p>ËøôÁßçÊâπÈáèÊèíÂÖ•ÊàñÊõ¥Êñ∞Êìç‰ΩúÁâπÂà´ÈÄÇÂêàÔºö</p>
<ul>
<li>ÂàùÂßãÂåñÊï∞ÊçÆ</li>
<li>ÊâπÈáèÂØºÂÖ•</li>
<li>Êï∞ÊçÆÂêåÊ≠•</li>
<li>ÈúÄË¶ÅÂ§ÑÁêÜÂ§ßÈáèËÆ∞ÂΩïÁöÑÂÆöÊó∂‰ªªÂä°</li>
</ul>
<h3 id="8-Ê≥®ÊÑè‰∫ãÈ°π">8. Ê≥®ÊÑè‰∫ãÈ°π
</h3><ul>
<li>Á°Æ‰øùË°®Êúâ‰∏ªÈîÆÊàñÂîØ‰∏ÄÈîÆÁ∫¶ÊùüÔºåÂê¶Âàô <code>ON DUPLICATE KEY UPDATE</code> ‰∏ç‰ºöÁîüÊïà</li>
<li>Â§ßÊâπÈáèÊìç‰ΩúÊó∂ÂèØËÉΩÈúÄË¶ÅÂàÜÊâπÂ§ÑÁêÜÔºåÈÅøÂÖçÂçïÊù° SQL ËøáÂ§ß</li>
<li>Âú®È´òÂπ∂ÂèëÁéØÂ¢É‰∏ãÊ≥®ÊÑèÈîÅÁ´û‰∫âÈóÆÈ¢ò</li>
</ul>
<hr>
<h2 id="transfervideofile-ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê">transferVideoFile ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê
</h2><p>transferVideoFile ÊñπÊ≥ïÊòØ‰∏Ä‰∏™ËßÜÈ¢ëÊñá‰ª∂ËΩ¨Á†ÅÂíåÂ§ÑÁêÜÁöÑÊ†∏ÂøÉÊñπÊ≥ïÔºå‰∏ªË¶ÅÂÆåÊàêËßÜÈ¢ëÊñá‰ª∂‰ªé‰∏¥Êó∂ÁõÆÂΩïËΩ¨ÁßªÂà∞Ê≠£ÂºèÁõÆÂΩï„ÄÅÂêàÂπ∂ÂàÜÁâá„ÄÅËé∑ÂèñËßÜÈ¢ë‰ø°ÊÅØ„ÄÅÊõ¥Êñ∞Áä∂ÊÄÅÁ≠â‰∏ÄÁ≥ªÂàóÊìç‰Ωú„ÄÇ‰∏ãÈù¢ËØ¶ÁªÜËß£ÊûêËøô‰∏™ÊñπÊ≥ïÁöÑÊØè‰∏™ÈÉ®ÂàÜ„ÄÇ<br>
¬†¬†¬†¬†¬†¬†È¶ñÂÖàÔºåÊñπÊ≥ïË¢´@OverrideÊ≥®Ëß£Ê†áËÆ∞ÔºåËØ¥ÊòéËøôÊòØ‰∏Ä‰∏™ÈáçÂÜôÁöÑÊñπÊ≥ï„ÄÇÊñπÊ≥ïÊé•Êî∂‰∏Ä‰∏™VideoInfoFilePostÂØπË±°‰Ωú‰∏∫ÂèÇÊï∞ÔºåËøôÂ∫îËØ•ÊòØ‰∏Ä‰∏™ÂåÖÂê´ËßÜÈ¢ëÊñá‰ª∂Áõ∏ÂÖ≥‰ø°ÊÅØÁöÑÂÆû‰ΩìÁ±ª„ÄÇÊñπÊ≥ïÂÜÖÈÉ®È¶ñÂÖàÂàõÂª∫‰∫Ü‰∏Ä‰∏™updateFilePostÂØπË±°ÔºåÁî®‰∫éÂêéÁª≠Êõ¥Êñ∞Êï∞ÊçÆÂ∫ì‰∏≠ÁöÑÊñá‰ª∂‰ø°ÊÅØ„ÄÇÊé•ÁùÄËøõÂÖ•‰∏Ä‰∏™tryÂùóÔºåÂºÄÂßã‰∏ªË¶ÅÁöÑ‰∏öÂä°ÈÄªËæë„ÄÇ
Âú®tryÂùó‰∏≠ÔºåÈ¶ñÂÖàÈÄöËøáredisComponent.getUploadVideoFileÊñπÊ≥ï‰ªéRedisËé∑Âèñ‰∏ä‰º†Êñá‰ª∂ÁöÑ‰ø°ÊÅØÔºåËøôÈáåÈúÄË¶Å‰º†ÂÖ•Áî®Êà∑IDÂíå‰∏ä‰º†ID„ÄÇËøôË°®ÊòéÁ≥ªÁªü‰ΩøÁî®RedisÊù•‰∏¥Êó∂Â≠òÂÇ®‰∏ä‰º†ËøáÁ®ã‰∏≠ÁöÑÊñá‰ª∂‰ø°ÊÅØÔºåÂèØËÉΩÊòØ‰∏∫‰∫ÜÊîØÊåÅÊñ≠ÁÇπÁª≠‰º†ÊàñÂàÜÁâá‰∏ä‰º†„ÄÇ
Êé•‰∏ãÊù•ÔºåÊûÑÂª∫‰∫Ü‰∏¥Êó∂Êñá‰ª∂Ë∑ØÂæÑtempFilePathÂíåÁõÆÊ†áÊñá‰ª∂Ë∑ØÂæÑtargetFilePath„ÄÇËøôÈáåÁî®Âà∞‰∫ÜappConfig.getProjectFolder()Ëé∑ÂèñÈ°πÁõÆÊ†πÁõÆÂΩïÔºåÁÑ∂ÂêéÊãºÊé•‰∏äÂ∏∏ÈáèFILE_FOLDER„ÄÅFILE_FOLDER_TEMPÂíåFILE_VIDEOÔºå‰ª•Âèä‰ªéRedisËé∑ÂèñÁöÑfileDto.getFilePath()„ÄÇËøôËØ¥ÊòéÁ≥ªÁªüÊúâÊòéÁ°ÆÁöÑÁõÆÂΩïÁªìÊûÑÊù•ÁÆ°ÁêÜ‰∏¥Êó∂Êñá‰ª∂ÂíåÊúÄÁªàÂ≠òÂÇ®ÁöÑËßÜÈ¢ëÊñá‰ª∂„ÄÇ
Ê£ÄÊü•ÁõÆÊ†áÁõÆÂΩïÊòØÂê¶Â≠òÂú®ÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®ÂàôÂàõÂª∫ÔºåÁ°Æ‰øùÁõÆÂΩïÁªìÊûÑÊ≠£Á°Æ„ÄÇÁÑ∂Âêé‰ΩøÁî®FileUtils.copyDirectoryÂ∞Ü‰∏¥Êó∂ÁõÆÂΩï‰∏ãÁöÑÊñá‰ª∂Â§çÂà∂Âà∞ÁõÆÊ†áÁõÆÂΩï„ÄÇËøô‰∏ÄÊ≠•ÂèØËÉΩÊòØÂ∞Ü‰∏ä‰º†ÂÆåÊàêÁöÑÊñá‰ª∂‰ªé‰∏¥Êó∂‰ΩçÁΩÆÁßªÂä®Âà∞Ê≠£ÂºèÂ≠òÂÇ®‰ΩçÁΩÆ„ÄÇ‰πãÂêéÔºåÂà†Èô§‰∏¥Êó∂ÁõÆÂΩïÔºåÈáäÊîæÂ≠òÂÇ®Á©∫Èó¥ÔºåÂπ∂‰ªéRedis‰∏≠Âà†Èô§ÂØπÂ∫îÁöÑÊñá‰ª∂‰ø°ÊÅØÔºåÈÅøÂÖçÊï∞ÊçÆÂÜó‰Ωô„ÄÇ
Êé•‰∏ãÊù•Ë∞ÉÁî®this.unionÊñπÊ≥ïÂêàÂπ∂Êñá‰ª∂ÔºåÁîüÊàêÂÆåÊï¥ÁöÑËßÜÈ¢ëÊñá‰ª∂Ë∑ØÂæÑcompleteVideo„ÄÇunionÊñπÊ≥ïÂèØËÉΩË¥üË¥£Â∞ÜÂàÜÁâá‰∏ä‰º†ÁöÑËßÜÈ¢ëÊñá‰ª∂ÂêàÂπ∂Êàê‰∏Ä‰∏™ÂÆåÊï¥ÁöÑÊñá‰ª∂„ÄÇÂêàÂπ∂ÂÆåÊàêÂêéÔºå‰ΩøÁî®fFmpegUtils.getVideoInfoDurationËé∑ÂèñËßÜÈ¢ëÊó∂ÈïøÔºåÂπ∂Êõ¥Êñ∞updateFilePostÁöÑÁõ∏ÂÖ≥Â±ûÊÄßÔºåÂåÖÊã¨Êó∂Èïø„ÄÅÊñá‰ª∂Â§ßÂ∞è„ÄÅÊñá‰ª∂Ë∑ØÂæÑÂíåËΩ¨Á†ÅÁªìÊûúÁä∂ÊÄÅ‰∏∫ÊàêÂäü„ÄÇ
ÁÑ∂ÂêéË∞ÉÁî®this.convertVideo2TsÊñπÊ≥ïÂ∞ÜËßÜÈ¢ëËΩ¨Êç¢‰∏∫TSÊ†ºÂºèÔºåÂèØËÉΩÊòØ‰∏∫‰∫ÜÊîØÊåÅÊµÅÂ™í‰ΩìÊí≠ÊîæÔºåÊØîÂ¶ÇHLSÂçèËÆÆ„ÄÇËΩ¨Êç¢ÂÆåÊàêÂêéÂà†Èô§ÂéüÂßãËßÜÈ¢ëÊñá‰ª∂Ôºå‰øùÁïôËΩ¨Êç¢ÂêéÁöÑTSÂàÜÁâá„ÄÇ
Â¶ÇÊûúÂú®‰∏äËø∞ËøáÁ®ã‰∏≠Âá∫Áé∞ÂºÇÂ∏∏ÔºåcatchÂùó‰ºöÊçïËé∑ÂºÇÂ∏∏Âπ∂ËÆ∞ÂΩïÈîôËØØÊó•ÂøóÔºåÂêåÊó∂Â∞ÜËΩ¨Á†ÅÁªìÊûúÁä∂ÊÄÅËÆæÁΩÆ‰∏∫Â§±Ë¥•„ÄÇÊó†ËÆ∫ÊàêÂäüÊàñÂ§±Ë¥•ÔºåfinallyÂùóÈÉΩ‰ºöÊâßË°åÔºåÊõ¥Êñ∞Êï∞ÊçÆÂ∫ì‰∏≠ÁöÑÊñá‰ª∂Áä∂ÊÄÅ„ÄÇ
Âú®finallyÂùó‰∏≠ÔºåÈ¶ñÂÖàÈÄöËøávideoInfoFilePostMapper.updateByUploadIdAndUserIdÊõ¥Êñ∞Êñá‰ª∂‰ø°ÊÅØ„ÄÇÊé•ÁùÄÔºåÊûÑÂª∫Êü•ËØ¢Êù°‰ª∂ÔºåÊ£ÄÊü•ÊòØÂê¶Â≠òÂú®ËΩ¨Á†ÅÂ§±Ë¥•ÁöÑÊñá‰ª∂„ÄÇÂ¶ÇÊûúÊúâÂ§±Ë¥•ÁöÑÊñá‰ª∂ÔºåÊõ¥Êñ∞Êï¥‰∏™ËßÜÈ¢ëÁöÑÁä∂ÊÄÅ‰∏∫STATUS1ÔºàÂèØËÉΩË°®Á§∫ËΩ¨Á†ÅÂ§±Ë¥•Ôºâ„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÂ§±Ë¥•ÁöÑÊñá‰ª∂ÔºåÂÜçÊ£ÄÊü•ÊòØÂê¶ËøòÊúâÊ≠£Âú®ËΩ¨Á†Å‰∏≠ÁöÑÊñá‰ª∂„ÄÇÂ¶ÇÊûúÊâÄÊúâÊñá‰ª∂ÈÉΩÂ∑≤Â§ÑÁêÜÂÆåÊàêÔºåËÆ°ÁÆóËßÜÈ¢ëÊÄªÊó∂ÈïøÂπ∂Êõ¥Êñ∞ËßÜÈ¢ëÁä∂ÊÄÅ‰∏∫STATUS2ÔºàËΩ¨Á†ÅÂÆåÊàêÔºâÔºåÂêåÊó∂ËÆ∞ÂΩïÊÄªÊó∂Èïø„ÄÇ</p>
<h3 id="ÊñπÊ≥ïÊ¶ÇËø∞">ÊñπÊ≥ïÊ¶ÇËø∞
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transferVideoFile</span><span class="p">(</span><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">videoInfoFilePost</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÊñπÊ≥ïÂÆûÁé∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂäüËÉΩÔºö</strong> Â§ÑÁêÜËßÜÈ¢ëÊñá‰ª∂ËΩ¨Á†ÅÂíåËΩ¨ÁßªÊµÅÁ®ãÔºåÂåÖÊã¨Ôºö</p>
<ul>
<li>‰ªé‰∏¥Êó∂ÁõÆÂΩïËΩ¨ÁßªËßÜÈ¢ëÂà∞Ê≠£ÂºèÁõÆÂΩï</li>
<li>ÂêàÂπ∂ËßÜÈ¢ëÂàÜÁâáÔºàÂ¶ÇÊûúÊúâÔºâ</li>
<li>Ëé∑ÂèñËßÜÈ¢ëÂÖÉ‰ø°ÊÅØÔºàÊó∂ÈïøÁ≠âÔºâ</li>
<li>Êõ¥Êñ∞Êï∞ÊçÆÂ∫ìÁä∂ÊÄÅ</li>
<li>Â§ÑÁêÜËΩ¨Á†ÅÂ§±Ë¥•ÊÉÖÂÜµ</li>
<li>Ê£ÄÊü•Âπ∂Êõ¥Êñ∞ËßÜÈ¢ëÊï¥‰ΩìÁä∂ÊÄÅ</li>
</ul>
<h3 id="1-ÂàùÂßãÂåñ‰∏éÂáÜÂ§á">1. ÂàùÂßãÂåñ‰∏éÂáÜÂ§á
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">updateFilePost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ‰ªéRedisËé∑Âèñ‰∏ä‰º†Êñá‰ª∂‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UploadingFileDto</span><span class="w"> </span><span class="n">fileDto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getUploadVideoFile</span><span class="p">(</span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span><span class="w"> </span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getUploadId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ËÆæÁΩÆ‰∏¥Êó∂Êñá‰ª∂Ë∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">tempFilePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appConfig</span><span class="p">.</span><span class="na">getProjectFolder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_FOLDER</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_FOLDER_TEMP</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fileDto</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="n">tempFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">tempFilePath</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ËÆæÁΩÆÁõÆÊ†áÊñá‰ª∂Ë∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">targetFilePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appConfig</span><span class="p">.</span><span class="na">getProjectFolder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_FOLDER</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_VIDEO</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fileDto</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="n">targetFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">targetFilePath</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">targetFile</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">targetFile</span><span class="p">.</span><span class="na">mkdirs</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÊûêÔºö</strong></p>
<ul>
<li>ÂàõÂª∫ updateFilePost ÂØπË±°Áî®‰∫éÂêéÁª≠Êõ¥Êñ∞Êï∞ÊçÆÂ∫ì</li>
<li>‰ªé Redis Ëé∑Âèñ‰∏ä‰º†Êñá‰ª∂‰ø°ÊÅØÔºàÂåÖÂê´Êñá‰ª∂Ë∑ØÂæÑÁ≠âÔºâ</li>
<li>ÊûÑÈÄ†‰∏¥Êó∂Êñá‰ª∂Ë∑ØÂæÑÂíåÁõÆÊ†áÊñá‰ª∂Ë∑ØÂæÑ</li>
<li>Á°Æ‰øùÁõÆÊ†áÁõÆÂΩïÂ≠òÂú®Ôºà‰∏çÂ≠òÂú®ÂàôÂàõÂª∫Ôºâ</li>
</ul>
<h3 id="2-Êñá‰ª∂ËΩ¨Áßª‰∏éÂ§ÑÁêÜ">2. Êñá‰ª∂ËΩ¨Áßª‰∏éÂ§ÑÁêÜ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Â∞ÜÊñá‰ª∂‰ªé‰∏¥Êó∂ÁõÆÂΩïÂ§çÂà∂Âà∞Ê≠£ÂºèÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FileUtils</span><span class="p">.</span><span class="na">copyDirectory</span><span class="p">(</span><span class="n">tempFile</span><span class="p">,</span><span class="w"> </span><span class="n">targetFile</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Âà†Èô§‰∏¥Êó∂ÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FileUtils</span><span class="p">.</span><span class="na">forceDelete</span><span class="p">(</span><span class="n">tempFile</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ‰ªéRedisÂà†Èô§Êñá‰ª∂‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">delVideoFileInfo</span><span class="p">(</span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span><span class="w"> </span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getUploadId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÂêàÂπ∂Êñá‰ª∂ÔºàÂ¶ÇÊûúÊòØÂàÜÁâá‰∏ä‰º†Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">completeVideo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">targetFilePath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">TEMP_VIDEO_NAME</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">union</span><span class="p">(</span><span class="n">targetFilePath</span><span class="p">,</span><span class="w"> </span><span class="n">completeVideo</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÊûêÔºö</strong></p>
<ul>
<li>‰ΩøÁî® FileUtils.copyDirectory Â∞ÜÊñá‰ª∂‰ªé‰∏¥Êó∂ÁõÆÂΩïÂ§çÂà∂Âà∞Ê≠£ÂºèÁõÆÂΩï</li>
<li>Âà†Èô§‰∏¥Êó∂ÁõÆÂΩïÔºàÊ∏ÖÁêÜÁ©∫Èó¥Ôºâ</li>
<li>‰ªé Redis Âà†Èô§Â∑≤Â§ÑÁêÜÁöÑÊñá‰ª∂‰ø°ÊÅØ</li>
<li>Ë∞ÉÁî® union ÊñπÊ≥ïÂêàÂπ∂ËßÜÈ¢ëÂàÜÁâáÔºàÂ¶ÇÊûúÊúâÔºâ</li>
</ul>
<h3 id="3-Ëé∑ÂèñËßÜÈ¢ë‰ø°ÊÅØ">3. Ëé∑ÂèñËßÜÈ¢ë‰ø°ÊÅØ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ëé∑ÂèñËßÜÈ¢ëÊó∂Èïø</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fFmpegUtils</span><span class="p">.</span><span class="na">getVideoInfoDuration</span><span class="p">(</span><span class="n">completeVideo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">updateFilePost</span><span class="p">.</span><span class="na">setDuration</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">updateFilePost</span><span class="p">.</span><span class="na">setFileSize</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">completeVideo</span><span class="p">).</span><span class="na">length</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">updateFilePost</span><span class="p">.</span><span class="na">setFilePath</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_VIDEO</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fileDto</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">updateFilePost</span><span class="p">.</span><span class="na">setTransferResult</span><span class="p">(</span><span class="n">VideoFileTransferResultEnum</span><span class="p">.</span><span class="na">SUCCESS</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Â∞ÜËßÜÈ¢ëËΩ¨Êç¢‰∏∫TSÊ†ºÂºèÔºàÁî®‰∫éHLSÊµÅÂ™í‰ΩìÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">convertVideo2Ts</span><span class="p">(</span><span class="n">completeVideo</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÊûêÔºö</strong></p>
<ul>
<li>‰ΩøÁî® fFmpegUtils Ëé∑ÂèñËßÜÈ¢ëÊó∂Èïø</li>
<li>ËÆæÁΩÆÊñá‰ª∂Â§ßÂ∞è„ÄÅË∑ØÂæÑÂíåËΩ¨Á†ÅÁªìÊûú‰∏∫ÊàêÂäü</li>
<li>Ë∞ÉÁî® convertVideo2Ts Â∞ÜËßÜÈ¢ëËΩ¨Êç¢‰∏∫ TS Ê†ºÂºèÔºàÁî®‰∫é HTTP Live StreamingÔºâ</li>
</ul>
<h3 id="4-ÂºÇÂ∏∏Â§ÑÁêÜ">4. ÂºÇÂ∏∏Â§ÑÁêÜ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Êñá‰ª∂ËΩ¨Á†ÅÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">updateFilePost</span><span class="p">.</span><span class="na">setTransferResult</span><span class="p">(</span><span class="n">VideoFileTransferResultEnum</span><span class="p">.</span><span class="na">FAIL</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÊûêÔºö</strong></p>
<ul>
<li>ÊçïËé∑ÊâÄÊúâÂºÇÂ∏∏Âπ∂ËÆ∞ÂΩïÊó•Âøó</li>
<li>ËÆæÁΩÆËΩ¨Á†ÅÁªìÊûú‰∏∫Â§±Ë¥•Áä∂ÊÄÅ</li>
</ul>
<h3 id="5-Áä∂ÊÄÅÊõ¥Êñ∞‰∏éÊ£ÄÊü•">5. Áä∂ÊÄÅÊõ¥Êñ∞‰∏éÊ£ÄÊü•
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Êõ¥Êñ∞Êñá‰ª∂Áä∂ÊÄÅ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">updateByUploadIdAndUserId</span><span class="p">(</span><span class="n">updateFilePost</span><span class="p">,</span><span class="w"> </span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getUploadId</span><span class="p">(),</span><span class="w"> </span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ê£ÄÊü•ÊòØÂê¶ÊúâËΩ¨Á†ÅÂ§±Ë¥•ÁöÑËßÜÈ¢ëÊñá‰ª∂</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">VideoInfoFilePostQuery</span><span class="w"> </span><span class="n">fileQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePostQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fileQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fileQuery</span><span class="p">.</span><span class="na">setTransferResult</span><span class="p">(</span><span class="n">VideoFileTransferResultEnum</span><span class="p">.</span><span class="na">FAIL</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">failCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">selectCount</span><span class="p">(</span><span class="n">fileQuery</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">failCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Â¶ÇÊûúÊúâÂ§±Ë¥•ÁöÑÔºåËÆæÁΩÆËßÜÈ¢ëÁä∂ÊÄÅ‰∏∫STATUS1ÔºàÂèØËÉΩÊòØ&#34;ËΩ¨Á†ÅÂ§±Ë¥•&#34;Áä∂ÊÄÅÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">VideoInfoPost</span><span class="w"> </span><span class="n">videoUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoPost</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoUpdate</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">STATUS1</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoInfoPostMapper</span><span class="p">.</span><span class="na">updateByVideoId</span><span class="p">(</span><span class="n">videoUpdate</span><span class="p">,</span><span class="w"> </span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ê£ÄÊü•ÊòØÂê¶ËøòÊúâËΩ¨Á†Å‰∏≠ÁöÑËßÜÈ¢ëÊñá‰ª∂</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fileQuery</span><span class="p">.</span><span class="na">setTransferResult</span><span class="p">(</span><span class="n">VideoFileTransferResultEnum</span><span class="p">.</span><span class="na">TRANSFER</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">transferCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">selectCount</span><span class="p">(</span><span class="n">fileQuery</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">transferCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Â¶ÇÊûúÊ≤°ÊúâËΩ¨Á†Å‰∏≠ÁöÑÊñá‰ª∂ÔºåËÆ°ÁÆóÊÄªÊó∂ÈïøÂπ∂Êõ¥Êñ∞ËßÜÈ¢ëÁä∂ÊÄÅ‰∏∫STATUS2ÔºàÂèØËÉΩÊòØ&#34;ËΩ¨Á†ÅÂÆåÊàê&#34;Áä∂ÊÄÅÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">sumDuration</span><span class="p">(</span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">VideoInfoPost</span><span class="w"> </span><span class="n">videoUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoPost</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoUpdate</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">STATUS2</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoUpdate</span><span class="p">.</span><span class="na">setDuration</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoInfoPostMapper</span><span class="p">.</span><span class="na">updateByVideoId</span><span class="p">(</span><span class="n">videoUpdate</span><span class="p">,</span><span class="w"> </span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ëß£ÊûêÔºö</strong></p>
<ul>
<li>Êõ¥Êñ∞Êñá‰ª∂Áä∂ÊÄÅÔºöÊó†ËÆ∫ÊàêÂäüÂ§±Ë¥•ÔºåÈÉΩÊõ¥Êñ∞ÂΩìÂâçÊñá‰ª∂Áä∂ÊÄÅ</li>
<li>Ê£ÄÊü•Â§±Ë¥•ÊÉÖÂÜµÔºö
<ul>
<li>Êü•ËØ¢ËØ•ËßÜÈ¢ë‰∏ãÊòØÂê¶ÊúâËΩ¨Á†ÅÂ§±Ë¥•ÁöÑÊñá‰ª∂</li>
<li>Â¶ÇÊûúÊúâÔºåËÆæÁΩÆËßÜÈ¢ëÊï¥‰ΩìÁä∂ÊÄÅ‰∏∫Â§±Ë¥•ÔºàSTATUS1Ôºâ</li>
</ul>
</li>
<li>Ê£ÄÊü•ËΩ¨Á†ÅÂÆåÊàêÊÉÖÂÜµÔºö
<ul>
<li>Êü•ËØ¢ÊòØÂê¶ËøòÊúâËΩ¨Á†Å‰∏≠ÁöÑÊñá‰ª∂</li>
<li>Â¶ÇÊûúÊ≤°ÊúâÔºåËÆ°ÁÆóËßÜÈ¢ëÊÄªÊó∂ÈïøÂπ∂Êõ¥Êñ∞Áä∂ÊÄÅ‰∏∫ÂÆåÊàêÔºàSTATUS2Ôºâ</li>
</ul>
</li>
</ul>
<h3 id="Áä∂ÊÄÅÊûö‰∏æËØ¥Êòé">Áä∂ÊÄÅÊûö‰∏æËØ¥Êòé
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Êûö‰∏æÂÄº</th>
          <th>ÂèØËÉΩÂê´‰πâ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>STATUS0</td>
          <td>ÂæÖÂÆ°Ê†∏/ÂæÖÂ§ÑÁêÜ</td>
      </tr>
      <tr>
          <td>STATUS1</td>
          <td>ËΩ¨Á†ÅÂ§±Ë¥•</td>
      </tr>
      <tr>
          <td>STATUS2</td>
          <td>ËΩ¨Á†ÅÂÆåÊàê</td>
      </tr>
      <tr>
          <td>TRANSFER</td>
          <td>ËΩ¨Á†Å‰∏≠</td>
      </tr>
      <tr>
          <td>SUCCESS</td>
          <td>ËΩ¨Á†ÅÊàêÂäü</td>
      </tr>
      <tr>
          <td>FAIL</td>
          <td>ËΩ¨Á†ÅÂ§±Ë¥•</td>
      </tr>
  </tbody>
</table></div>
<h3 id="ÊñπÊ≥ïÊµÅÁ®ãÂõæ">ÊñπÊ≥ïÊµÅÁ®ãÂõæ
</h3><ol>
<li>‰ªé‰∏¥Êó∂ÁõÆÂΩï ‚Üí Ê≠£ÂºèÁõÆÂΩï</li>
<li>Ê∏ÖÁêÜ‰∏¥Êó∂Êñá‰ª∂„ÄÅÂà†Èô§ Redis ÁºìÂ≠ò</li>
<li>ÂêàÂπ∂ÂàÜÁâá„ÄÅËé∑ÂèñÂÖÉ‰ø°ÊÅØ„ÄÅËΩ¨Á†Å</li>
<li>Êõ¥Êñ∞Âçï‰∏™Êñá‰ª∂Áä∂ÊÄÅ</li>
<li>Ê£ÄÊü•Âπ∂Êõ¥Êñ∞Êï¥‰ΩìËßÜÈ¢ëÁä∂ÊÄÅ</li>
</ol>
<h3 id="ÂÖ≥ÈîÆÁÇπÊÄªÁªì">ÂÖ≥ÈîÆÁÇπÊÄªÁªì
</h3><ul>
<li><strong>Êñá‰ª∂ËΩ¨ÁßªÊµÅÁ®ã</strong>Ôºö‰ªé‰∏¥Êó∂ÁõÆÂΩï ‚Üí Ê≠£ÂºèÁõÆÂΩïÔºåÊ∏ÖÁêÜ‰∏¥Êó∂Êñá‰ª∂ÔºåÂà†Èô§ Redis ÁºìÂ≠ò</li>
<li><strong>ËßÜÈ¢ëÂ§ÑÁêÜ</strong>ÔºöÂêàÂπ∂ÂàÜÁâáÔºàÂ¶ÇÈúÄË¶ÅÔºâ„ÄÅËé∑ÂèñÂÖÉ‰ø°ÊÅØÔºàÊó∂Èïø„ÄÅÂ§ßÂ∞èÔºâ„ÄÅËΩ¨Êç¢‰∏∫ TS Ê†ºÂºèÔºàÁî®‰∫éÊµÅÂ™í‰ΩìÔºâ</li>
<li><strong>Áä∂ÊÄÅÁÆ°ÁêÜ</strong>ÔºöÂçï‰∏™Êñá‰ª∂Áä∂ÊÄÅÊõ¥Êñ∞„ÄÅÊï¥‰ΩìËßÜÈ¢ëÁä∂ÊÄÅÊ£ÄÊü•„ÄÅÂ§±Ë¥•Â§ÑÁêÜÂíåÊàêÂäüÁä∂ÊÄÅÊõ¥Êñ∞</li>
<li><strong>‰∫ãÂä°ÂÆåÊï¥ÊÄß</strong>Ôºötry-catch Á°Æ‰øùÂºÇÂ∏∏Ë¢´ÊçïËé∑Ôºåfinally ÂùóÁ°Æ‰øùÁä∂ÊÄÅ‰∏ÄÂÆö‰ºöÊõ¥Êñ∞ÔºåÂÖ®Èù¢ÁöÑÁä∂ÊÄÅÊ£ÄÊü•Êú∫Âà∂</li>
</ul>
<h3 id="‰ºòÂåñÁÇπ">‰ºòÂåñÁÇπ
</h3><ul>
<li><strong>ÂºÇÊ≠•Â§ÑÁêÜ</strong>ÔºöËßÜÈ¢ëËΩ¨Á†ÅÊòØËÄóÊó∂Êìç‰ΩúÔºåÂèØ‰ª•ËÄÉËôë‰ΩøÁî®Ê∂àÊÅØÈòüÂàóÂºÇÊ≠•Â§ÑÁêÜ</li>
<li><strong>ËøõÂ∫¶ÂèçÈ¶à</strong>ÔºöÂèØ‰ª•Â¢ûÂä†ËΩ¨Á†ÅËøõÂ∫¶ÂèçÈ¶àÊú∫Âà∂</li>
<li><strong>ÈáçËØïÊú∫Âà∂</strong>ÔºöÂØπ‰∫éÂ§±Ë¥•ÁöÑËΩ¨Á†Å‰ªªÂä°ÂèØ‰ª•Âä†ÂÖ•ÈáçËØïÈÄªËæë</li>
<li><strong>ËµÑÊ∫êÊ∏ÖÁêÜ</strong>ÔºöÁ°Æ‰øùÂú®‰ªª‰ΩïÂºÇÂ∏∏ÊÉÖÂÜµ‰∏ãÈÉΩËÉΩÊ≠£Á°ÆÊ∏ÖÁêÜ‰∏¥Êó∂ËµÑÊ∫ê</li>
<li><strong>Áä∂ÊÄÅÊûö‰∏æ</strong>ÔºöÂª∫ËÆÆ‰ΩøÁî®Êõ¥ÂÖ∑ÊèèËø∞ÊÄßÁöÑÊûö‰∏æÂêçÁß∞ÔºåÂ¶Ç &ldquo;TRANSCODE_COMPLETED&rdquo; ËÄåÈùû &ldquo;STATUS2&rdquo;</li>
</ul>
<hr>
<h2 id="convertvideo2ts-Âíå-union-ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê">convertVideo2Ts Âíå union ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê
</h2><p>Ëøô‰∏§‰∏™ÊñπÊ≥ïÊòØ transferVideoFile ‰∏≠Áî®‰∫éËßÜÈ¢ëÊñá‰ª∂Â§ÑÁêÜÁöÑÊ†∏ÂøÉËæÖÂä©ÊñπÊ≥ïÔºå‰∏ãÈù¢ÁªìÂêàÂÆÉ‰ª¨Âú® transferVideoFile ‰∏≠ÁöÑ‰ΩøÁî®Âú∫ÊôØËøõË°åËØ¶ÁªÜËß£Èáä„ÄÇ</p>
<h3 id="1-convertvideo2ts-ÊñπÊ≥ïËß£Êûê">1. convertVideo2Ts ÊñπÊ≥ïËß£Êûê
</h3><p><strong>ÊñπÊ≥ïÁ≠æÂêç</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">convertVideo2Ts</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">videoFilePath</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂäüËÉΩËØ¥Êòé</strong></p>
<ul>
<li>Ë¥üË¥£Â∞ÜËßÜÈ¢ëÊñá‰ª∂ËΩ¨Êç¢‰∏∫ TSÔºàTransport StreamÔºâÊ†ºÂºèÔºå‰∏ªË¶ÅÁî®‰∫é HLSÔºàHTTP Live StreamingÔºâËßÜÈ¢ëÊµÅÁöÑÂàÜÁâáÂ§ÑÁêÜ„ÄÇ</li>
</ul>
<p><strong>ÊâßË°åÊµÅÁ®ã</strong></p>
<ol>
<li><strong>Ëé∑ÂèñËßÜÈ¢ëÊñá‰ª∂‰ø°ÊÅØ</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">File</span><span class="w"> </span><span class="n">videoFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">videoFilePath</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">File</span><span class="w"> </span><span class="n">tsFolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoFile</span><span class="p">.</span><span class="na">getParentFile</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">codec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fFmpegUtils</span><span class="p">.</span><span class="na">getVideoCodec</span><span class="p">(</span><span class="n">videoFilePath</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>HEVC ÁºñÁ†ÅËΩ¨Êç¢</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">VIDEO_CODE_HEVC</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">codec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">tempFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoFilePath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">VIDEO_CODE_TEMP_FILE_SUFFIX</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">videoFilePath</span><span class="p">).</span><span class="na">renameTo</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">tempFileName</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fFmpegUtils</span><span class="p">.</span><span class="na">convertHevc2Mp4</span><span class="p">(</span><span class="n">tempFileName</span><span class="p">,</span><span class="w"> </span><span class="n">videoFilePath</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">tempFileName</span><span class="p">).</span><span class="na">delete</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â¶ÇÊûúËßÜÈ¢ëÊòØ HEVC ÁºñÁ†ÅÔºàH.265ÔºâÔºåÂÖàËΩ¨Êç¢‰∏∫ MP4 Ê†ºÂºèÔºàH.264Ôºâ„ÄÇ</li>
<li>‰ΩøÁî®‰∏¥Êó∂Êñá‰ª∂ËøõË°åËΩ¨Êç¢ÔºåÂÆåÊàêÂêéÂà†Èô§‰∏¥Êó∂Êñá‰ª∂„ÄÇ</li>
</ul>
</li>
<li><strong>ËΩ¨Êç¢‰∏∫ TS Ê†ºÂºè</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">fFmpegUtils</span><span class="p">.</span><span class="na">convertVideo2Ts</span><span class="p">(</span><span class="n">tsFolder</span><span class="p">,</span><span class="w"> </span><span class="n">videoFilePath</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>Âà†Èô§ÂéüÂßãËßÜÈ¢ëÊñá‰ª∂</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">videoFile</span><span class="p">.</span><span class="na">delete</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><strong>Âú® transferVideoFile ‰∏≠ÁöÑ‰ΩøÁî®</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">this</span><span class="p">.</span><span class="na">convertVideo2Ts</span><span class="p">(</span><span class="n">completeVideo</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âú®Êñá‰ª∂ËΩ¨ÁßªÂÆåÊàêÂêéË∞ÉÁî®ÔºåÁ°Æ‰øùËßÜÈ¢ëÊ†ºÂºèÈÄÇÂêàÊµÅÂ™í‰ΩìÊí≠ÊîæÔºåÂ§ÑÁêÜÁâπÊÆäÁºñÁ†ÅÊ†ºÂºèÁöÑÂÖºÂÆπÊÄßÈóÆÈ¢ò„ÄÇ</li>
</ul>
<hr>
<h3 id="2-union-ÊñπÊ≥ïËß£Êûê">2. union ÊñπÊ≥ïËß£Êûê
</h3><p><strong>ÊñπÊ≥ïÁ≠æÂêç</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">union</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">dirPath</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">toFilePath</span><span class="p">,</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">delSource</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂäüËÉΩËØ¥Êòé</strong></p>
<ul>
<li>Áî®‰∫éÂêàÂπ∂ÂàÜÁâáËßÜÈ¢ëÊñá‰ª∂ÔºåÂ∞ÜÂ§ö‰∏™ÂàÜÁâáÊñá‰ª∂ÂêàÂπ∂‰∏∫‰∏Ä‰∏™ÂÆåÊï¥ÁöÑËßÜÈ¢ëÊñá‰ª∂„ÄÇ</li>
</ul>
<p><strong>ÊâßË°åÊµÅÁ®ã</strong></p>
<ol>
<li><strong>ÂèÇÊï∞È™åËØÅ</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">File</span><span class="w"> </span><span class="n">dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">dirPath</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">dir</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;ÁõÆÂΩï‰∏çÂ≠òÂú®&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>Ëé∑ÂèñÂàÜÁâáÊñá‰ª∂ÂàóË°®</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">File</span><span class="w"> </span><span class="n">fileList</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dir</span><span class="p">.</span><span class="na">listFiles</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>ÂàõÂª∫ÁõÆÊ†áÊñá‰ª∂</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">File</span><span class="w"> </span><span class="n">targetFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">toFilePath</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>ÂêàÂπ∂Êñá‰ª∂ÂÜÖÂÆπ</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">RandomAccessFile</span><span class="w"> </span><span class="n">writeFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RandomAccessFile</span><span class="p">(</span><span class="n">targetFile</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;rw&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="n">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">10</span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="c1">// 10KBÁºìÂÜ≤Âå∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fileList</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">File</span><span class="w"> </span><span class="n">chunkFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">dirPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="na">separator</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">RandomAccessFile</span><span class="w"> </span><span class="n">readFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RandomAccessFile</span><span class="p">(</span><span class="n">chunkFile</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;r&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readFile</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">writeFile</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩøÁî®ÈöèÊú∫ËÆøÈóÆÊñá‰ª∂È´òÊïàËØªÂÜôÔºåÊåâÈ°∫Â∫èÂêàÂπ∂ÊâÄÊúâÂàÜÁâá„ÄÇ</li>
<li>‰ΩøÁî® try-with-resources Á°Æ‰øùËµÑÊ∫êÈáäÊîæ„ÄÇ</li>
</ul>
</li>
<li><strong>Ê∏ÖÁêÜÊ∫êÊñá‰ª∂ÔºàÂèØÈÄâÔºâ</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delSource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">fileList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">file</span><span class="p">.</span><span class="na">delete</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><strong>Âú® transferVideoFile ‰∏≠ÁöÑ‰ΩøÁî®</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">this</span><span class="p">.</span><span class="na">union</span><span class="p">(</span><span class="n">targetFilePath</span><span class="p">,</span><span class="w"> </span><span class="n">completeVideo</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Áî®‰∫éÂêàÂπ∂ÂàÜÁâá‰∏ä‰º†ÁöÑËßÜÈ¢ëÊñá‰ª∂ÔºådelSource=true Ë°®Á§∫ÂêàÂπ∂ÂêéÂà†Èô§ÂàÜÁâáÊñá‰ª∂ÔºåÁîüÊàêÂÆåÊï¥ÁöÑËßÜÈ¢ëÊñá‰ª∂‰æõÂêéÁª≠Â§ÑÁêÜ„ÄÇ</li>
</ul>
<hr>
<h3 id="3-‰∏§‰∏™ÊñπÊ≥ïÁöÑÂçè‰ΩúÂÖ≥Á≥ª">3. ‰∏§‰∏™ÊñπÊ≥ïÁöÑÂçè‰ΩúÂÖ≥Á≥ª
</h3><ul>
<li>transferVideoFile ‰∏≠ÁöÑÂ§ÑÁêÜÈ°∫Â∫èÔºö
<ol>
<li>Êñá‰ª∂ËΩ¨ÁßªÔºö‰ªé‰∏¥Êó∂ÁõÆÂΩïÁßªÂä®Âà∞Ê≠£ÂºèÁõÆÂΩï</li>
<li>Êñá‰ª∂ÂêàÂπ∂Ôºàunion ÊñπÊ≥ïÔºâÔºöÂ∞ÜÂàÜÁâáÂêàÂπ∂‰∏∫ÂÆåÊï¥ËßÜÈ¢ëÔºåÂà†Èô§ÂàÜÁâáÊñá‰ª∂</li>
<li>Ê†ºÂºèËΩ¨Êç¢ÔºàconvertVideo2Ts ÊñπÊ≥ïÔºâÔºöÊ£ÄÊü•Âπ∂ËΩ¨Êç¢ÁºñÁ†ÅÊ†ºÂºèÔºåËΩ¨Êç¢‰∏∫ TS Ê†ºÂºèÁî®‰∫éÊµÅÂ™í‰ΩìÔºåÂà†Èô§ÂéüÂßãÊñá‰ª∂</li>
</ol>
</li>
</ul>
<hr>
<h3 id="4-ËÆæËÆ°ËÄÉËôë">4. ËÆæËÆ°ËÄÉËôë
</h3><ul>
<li><strong>ÂàÜÁâáÂ§ÑÁêÜ</strong>ÔºöÊîØÊåÅÂ§ßÊñá‰ª∂ÂàÜÁâá‰∏ä‰º†ÔºåÂêàÂπ∂Êó∂Á°Æ‰øùÊñá‰ª∂È°∫Â∫èÊ≠£Á°Æ</li>
<li><strong>Ê†ºÂºèÂÖºÂÆπÊÄß</strong>ÔºöÂ§ÑÁêÜ HEVC Á≠âÁâπÊÆäÁºñÁ†ÅÔºåËΩ¨Êç¢‰∏∫ÂπøÊ≥õÊîØÊåÅÁöÑÊ†ºÂºè</li>
<li><strong>ËµÑÊ∫êÁÆ°ÁêÜ</strong>ÔºöÂèäÊó∂Ê∏ÖÁêÜ‰∏¥Êó∂Êñá‰ª∂Ôºå‰ΩøÁî®ÁºìÂÜ≤Âå∫ÊèêÈ´ò IO ÊïàÁéáÔºåÁ°Æ‰øùÊñá‰ª∂Âè•ÊüÑÊ≠£Á°ÆÈáäÊîæ</li>
<li><strong>ÈîôËØØÂ§ÑÁêÜ</strong>ÔºöÊòéÁ°ÆÁöÑÂºÇÂ∏∏ÊäõÂá∫ÔºåËµÑÊ∫êÊ∏ÖÁêÜÊîæÂú® finally Âùó</li>
</ul>
<hr>
<h3 id="5-ÂÖ∏Âûã‰ΩøÁî®Âú∫ÊôØ">5. ÂÖ∏Âûã‰ΩøÁî®Âú∫ÊôØ
</h3><ul>
<li>ÂàÜÁâá‰∏ä‰º†Â§ÑÁêÜÊµÅÁ®ãÔºö
<ul>
<li>Áî®Êà∑‰∏ä‰º†ËßÜÈ¢ëÂàÜÁâá</li>
<li>ÊâÄÊúâÂàÜÁâá‰∏ä‰º†ÂÆåÊàêÂêéËß¶Âèë transferVideoFile</li>
<li>ÂêàÂπ∂ÂàÜÁâá ‚Üí ËΩ¨Á†Å ‚Üí ÁîüÊàêÊµÅÂ™í‰ΩìÊ†ºÂºè</li>
</ul>
</li>
<li>ËßÜÈ¢ëÂ§ÑÁêÜÊµÅÁ®ãÔºö
<ul>
<li>ÂéüÂßãËßÜÈ¢ë ‚Üí Ê£ÄÊü•ÁºñÁ†Å ‚Üí ËΩ¨Êç¢ ‚Üí TS ÂàáÁâáÔºå‰∏∫ HLS ÊµÅÂ™í‰ΩìÂÅöÂáÜÂ§á</li>
</ul>
</li>
</ul>
<hr>
<h3 id="6-ÊΩúÂú®‰ºòÂåñÁÇπ">6. ÊΩúÂú®‰ºòÂåñÁÇπ
</h3><ul>
<li><strong>Âπ∂Ë°åÂ§ÑÁêÜ</strong>ÔºöÂàÜÁâáÂêàÂπ∂ÂèØ‰ª•‰ΩøÁî®Â§öÁ∫øÁ®ãÂä†ÈÄü</li>
<li><strong>ËøõÂ∫¶ÂèçÈ¶à</strong>ÔºöÊ∑ªÂä†ËΩ¨Á†ÅËøõÂ∫¶ÂõûË∞É</li>
<li><strong>ÈîôËØØÊÅ¢Â§ç</strong>ÔºöËÆ∞ÂΩïÂ§ÑÁêÜËøõÂ∫¶ÔºåÊîØÊåÅÊñ≠ÁÇπÁª≠Â§ÑÁêÜ</li>
<li><strong>ËµÑÊ∫êÊéßÂà∂</strong>ÔºöÈôêÂà∂Âπ∂ÂèëËΩ¨Á†Å‰ªªÂä°Êï∞ÔºåÁõëÊéßÁ≥ªÁªüË¥üËΩΩ</li>
</ul>
<p>Ëøô‰∏§‰∏™ÊñπÊ≥ïÂÖ±ÂêåÊûÑÊàê‰∫ÜËßÜÈ¢ëÂ§ÑÁêÜÁÆ°ÈÅìÁöÑÊ†∏ÂøÉÁéØËäÇÔºåÂ∞Ü‰∏ä‰º†ÁöÑËßÜÈ¢ëÊñá‰ª∂ÊúÄÁªàËΩ¨Êç¢‰∏∫ÂèØÊµÅÂºè‰º†ËæìÁöÑÊ†áÂáÜÊ†ºÂºè„ÄÇ</p>
<hr>
<h2 id="auditvideo-ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê">auditVideo ÊñπÊ≥ïËØ¶ÁªÜËß£Êûê
</h2><p>auditVideo ÊñπÊ≥ïÊòØËßÜÈ¢ëÂÆ°Ê†∏ÁöÑÊ†∏ÂøÉÊñπÊ≥ïÔºåË¥üË¥£Â§ÑÁêÜËßÜÈ¢ëÂÆ°Ê†∏Áä∂ÊÄÅÁöÑÂèòÊõ¥„ÄÅÁî®Êà∑ÁßØÂàÜÂ•ñÂä±„ÄÅÊï∞ÊçÆÂêåÊ≠•‰ª•ÂèäÊñá‰ª∂Ê∏ÖÁêÜÁ≠âÊìç‰Ωú„ÄÇ‰∏ãÈù¢‰ªéÂäüËÉΩ„ÄÅÊµÅÁ®ã„ÄÅËÆæËÆ°ÊÄùË∑ØÁ≠âÊñπÈù¢ËøõË°åÂÖ®Èù¢Ëß£Êûê„ÄÇ</p>
<h3 id="1-ÊñπÊ≥ïÊ¶ÇËø∞-1">1. ÊñπÊ≥ïÊ¶ÇËø∞
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Transactional</span><span class="p">(</span><span class="n">rollbackFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Exception</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">auditVideo</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÊñπÊ≥ïÂÆûÁé∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÂäüËÉΩÔºö</strong> Â§ÑÁêÜËßÜÈ¢ëÂÆ°Ê†∏ÊµÅÁ®ãÔºåÂåÖÊã¨Ôºö</p>
<ul>
<li>È™åËØÅÂÆ°Ê†∏Áä∂ÊÄÅÂêàÊ≥ïÊÄß</li>
<li>Êõ¥Êñ∞ËßÜÈ¢ëÂÆ°Ê†∏Áä∂ÊÄÅ</li>
<li>Â§ÑÁêÜÂÆ°Ê†∏ÈÄöËøá/‰∏çÈÄöËøáÁöÑÈÄªËæëÂàÜÊîØ</li>
<li>Áî®Êà∑ÁßØÂàÜÂ•ñÂä±ÔºàÈ¶ñÊ¨°ÂèëÂ∏ÉÔºâ</li>
<li>Êï∞ÊçÆÂêåÊ≠•Âà∞Ê≠£ÂºèË°®</li>
<li>Ê∏ÖÁêÜÂæÖÂà†Èô§Êñá‰ª∂</li>
<li>ÂêåÊ≠•Êï∞ÊçÆÂà∞ÊêúÁ¥¢ÂºïÊìé</li>
</ul>
<p><strong>ÂèÇÊï∞Ôºö</strong></p>
<ul>
<li>videoIdÔºöËßÜÈ¢ëÂîØ‰∏ÄÊ†áËØÜ</li>
<li>statusÔºöÁõÆÊ†áÂÆ°Ê†∏Áä∂ÊÄÅ</li>
<li>reasonÔºöÂÆ°Ê†∏ÂéüÂõ†ÔºàÂ¶Ç‰∏çÈÄöËøáÂéüÂõ†Ôºâ</li>
</ul>
<p><strong>‰∫ãÂä°ÊéßÂà∂Ôºö</strong> <code>@Transactional(rollbackFor = Exception.class)</code> Á°Æ‰øùÊñπÊ≥ïÂÜÖÊâÄÊúâÊï∞ÊçÆÂ∫ìÊìç‰ΩúË¶Å‰πàÂÖ®ÈÉ®ÊàêÂäüÔºåË¶Å‰πàÂÖ®ÈÉ®ÂõûÊªö</p>
<hr>
<h3 id="2-ÊñπÊ≥ïÊµÅÁ®ãËØ¶Ëß£">2. ÊñπÊ≥ïÊµÅÁ®ãËØ¶Ëß£
</h3><h4 id="21-Áä∂ÊÄÅÈ™åËØÅ">2.1 Áä∂ÊÄÅÈ™åËØÅ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">VideoStatusEnum</span><span class="w"> </span><span class="n">videoStatusEnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">getByStatus</span><span class="p">(</span><span class="n">status</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">videoStatusEnum</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_600</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>È™åËØÅ‰º†ÂÖ•ÁöÑÂÆ°Ê†∏Áä∂ÊÄÅÊòØÂê¶ÂêàÊ≥ïÔºåÈùûÊ≥ïÁä∂ÊÄÅÁõ¥Êé•ÊäõÂá∫‰∏öÂä°ÂºÇÂ∏∏„ÄÇ</li>
<li>‰ΩøÁî®Êûö‰∏æ VideoStatusEnum ÁÆ°ÁêÜÊâÄÊúâÂèØËÉΩÁöÑËßÜÈ¢ëÁä∂ÊÄÅ„ÄÇ</li>
</ul>
<h4 id="22-Êõ¥Êñ∞ËßÜÈ¢ëÁä∂ÊÄÅÂ∏¶Êù°‰ª∂">2.2 Êõ¥Êñ∞ËßÜÈ¢ëÁä∂ÊÄÅÔºàÂ∏¶Êù°‰ª∂Ôºâ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">VideoInfoPost</span><span class="w"> </span><span class="n">videoInfoPost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoPost</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoPost</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">status</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">VideoInfoPostQuery</span><span class="w"> </span><span class="n">videoInfoPostQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoPostQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoPostQuery</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">STATUS2</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoPostQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Integer</span><span class="w"> </span><span class="n">auditCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoPostMapper</span><span class="p">.</span><span class="na">updateByParam</span><span class="p">(</span><span class="n">videoInfoPost</span><span class="p">,</span><span class="w"> </span><span class="n">videoInfoPostQuery</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">auditCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;ÂÆ°Ê†∏Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â∞ÜËßÜÈ¢ë‰ªé&quot;ÂæÖÂÆ°Ê†∏&quot;Áä∂ÊÄÅÊõ¥Êñ∞‰∏∫ÁõÆÊ†áÂÆ°Ê†∏Áä∂ÊÄÅ„ÄÇ</li>
<li>‰πêËßÇÈîÅÊú∫Âà∂ÔºöÊõ¥Êñ∞Êù°‰ª∂ÂåÖÂê´ÂΩìÂâçÁä∂ÊÄÅÔºàSTATUS2 Ë°®Á§∫ÂæÖÂÆ°Ê†∏ÔºâÔºåÈò≤Ê≠¢Âπ∂Âèë‰øÆÊîπÂØºËá¥Áä∂ÊÄÅÊ∑∑‰π±„ÄÇ</li>
<li>Â¶ÇÊûúÂΩ±ÂìçË°åÊï∞‰∏∫ 0ÔºåËØ¥ÊòéËßÜÈ¢ë‰∏çÊª°Ë∂≥Êõ¥Êñ∞Êù°‰ª∂ÔºàÂèØËÉΩÂ∑≤Ë¢´ÂÖ∂‰ªñÂÆ°Ê†∏ÂëòÂ§ÑÁêÜÔºâ„ÄÇ</li>
</ul>
<h4 id="23-Êõ¥Êñ∞ÂÖ≥ËÅîÊñá‰ª∂Áä∂ÊÄÅ">2.3 Êõ¥Êñ∞ÂÖ≥ËÅîÊñá‰ª∂Áä∂ÊÄÅ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">VideoInfoFilePost</span><span class="w"> </span><span class="n">videoInfoFilePost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePost</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoFilePost</span><span class="p">.</span><span class="na">setUpdateType</span><span class="p">(</span><span class="n">VideoFileUpdateTypeEnum</span><span class="p">.</span><span class="na">NO_UPDATE</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">VideoInfoFilePostQuery</span><span class="w"> </span><span class="n">filePostQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePostQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">filePostQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">updateByParam</span><span class="p">(</span><span class="n">videoInfoFilePost</span><span class="p">,</span><span class="w"> </span><span class="n">filePostQuery</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â∞ÜÊâÄÊúâÂÖ≥ËÅîÊñá‰ª∂ÁöÑ updateType Ê†áËÆ∞‰∏∫&quot;Êó†ÈúÄÊõ¥Êñ∞&quot;ÔºåË°®Á§∫Ëøô‰∫õÊñá‰ª∂Â∑≤ÁªèÂÆåÊàêÂÆ°Ê†∏ÊµÅÁ®ã„ÄÇ</li>
</ul>
<h4 id="24-Â§ÑÁêÜÂÆ°Ê†∏‰∏çÈÄöËøáÊÉÖÂÜµ">2.4 Â§ÑÁêÜÂÆ°Ê†∏‰∏çÈÄöËøáÊÉÖÂÜµ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">VideoStatusEnum</span><span class="p">.</span><span class="na">STATUS4</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">videoStatusEnum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// ÂÆ°Ê†∏‰∏çÈÄöËøá</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â¶ÇÊûúÂÆ°Ê†∏Áä∂ÊÄÅ‰∏∫&quot;‰∏çÈÄöËøá&quot;(STATUS4)ÔºåÁõ¥Êé•ËøîÂõûÔºå‰∏çÊâßË°åÂêéÁª≠ÁöÑÁßØÂàÜÂ•ñÂä±„ÄÅÊï∞ÊçÆÂêåÊ≠•Á≠âÊìç‰Ωú„ÄÇ</li>
</ul>
<h4 id="25-È¶ñÊ¨°ÂèëÂ∏ÉÂ•ñÂä±ÁßØÂàÜ">2.5 È¶ñÊ¨°ÂèëÂ∏ÉÂ•ñÂä±ÁßØÂàÜ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">VideoInfoPost</span><span class="w"> </span><span class="n">infoPost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoPostMapper</span><span class="p">.</span><span class="na">selectByVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">VideoInfo</span><span class="w"> </span><span class="n">dbVideoInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoMapper</span><span class="p">.</span><span class="na">selectByVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dbVideoInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SysSettingDto</span><span class="w"> </span><span class="n">sysSettingDto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getSysSettingDto</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">userInfoMapper</span><span class="p">.</span><span class="na">updateCoinCountInfo</span><span class="p">(</span><span class="n">infoPost</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span><span class="w"> </span><span class="n">sysSettingDto</span><span class="p">.</span><span class="na">getPostVideoCoinCount</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ê£ÄÊü•ËßÜÈ¢ëÊòØÂê¶È¶ñÊ¨°ÂèëÂ∏ÉÔºàÊ≠£ÂºèË°®‰∏≠‰∏çÂ≠òÂú®ËÆ∞ÂΩïÔºâÔºåÂ¶ÇÊûúÊòØÈ¶ñÊ¨°ÂèëÂ∏ÉÔºåÁªôËßÜÈ¢ë‰ΩúËÄÖÂ¢ûÂä†Áõ∏Â∫îÁßØÂàÜ„ÄÇ</li>
<li>Â•ñÂä±Êú∫Âà∂ÈºìÂä±Áî®Êà∑ÂèëÂ∏ÉÂÜÖÂÆπÔºåÁßØÂàÜÊï∞ÈáèÈÖçÁΩÆÂú®Á≥ªÁªüËÆæÁΩÆ‰∏≠Ôºå‰æø‰∫éÁÅµÊ¥ªË∞ÉÊï¥„ÄÇ</li>
</ul>
<h4 id="26-ÂêåÊ≠•Êï∞ÊçÆÂà∞Ê≠£ÂºèË°®">2.6 ÂêåÊ≠•Êï∞ÊçÆÂà∞Ê≠£ÂºèË°®
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Â∞ÜÂèëÂ∏É‰ø°ÊÅØÂ§çÂà∂Âà∞Ê≠£ÂºèË°®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">VideoInfo</span><span class="w"> </span><span class="n">videoInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CopyTools</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">infoPost</span><span class="p">,</span><span class="w"> </span><span class="n">VideoInfo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoMapper</span><span class="p">.</span><span class="na">insertOrUpdate</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÂÖàÂà†Èô§ÊóßÊñá‰ª∂‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">VideoInfoFileQuery</span><span class="w"> </span><span class="n">videoInfoFileQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFileQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoFileQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoFileMapper</span><span class="p">.</span><span class="na">deleteByParam</span><span class="p">(</span><span class="n">videoInfoFileQuery</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ‰ªéÂèëÂ∏ÉË°®Êü•ËØ¢Âπ∂ÊèíÂÖ•Âà∞Ê≠£ÂºèË°®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">VideoInfoFilePostQuery</span><span class="w"> </span><span class="n">videoInfoFilePostQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePostQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoFilePostQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFilePost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoInfoFilePostList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="n">videoInfoFilePostQuery</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFile</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoInfoFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CopyTools</span><span class="p">.</span><span class="na">copyList</span><span class="p">(</span><span class="n">videoInfoFilePostList</span><span class="p">,</span><span class="w"> </span><span class="n">VideoInfoFile</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoFileMapper</span><span class="p">.</span><span class="na">insertBatch</span><span class="p">(</span><span class="n">videoInfoFileList</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰∏ªË°®ÂêåÊ≠•ÔºöÂ∞ÜÂèëÂ∏ÉË°®ÔºàVideoInfoPostÔºâÊï∞ÊçÆÊã∑Ë¥ùÂà∞Ê≠£ÂºèË°®ÔºàVideoInfoÔºâ„ÄÇ</li>
<li>Êñá‰ª∂Ë°®ÂêåÊ≠•ÔºöÂÖàÂà†Èô§Ê≠£ÂºèÊñá‰ª∂Ë°®‰∏≠ËØ•ËßÜÈ¢ëÁöÑÊâÄÊúâËÆ∞ÂΩïÔºåÂÜç‰ªéÂèëÂ∏ÉÊñá‰ª∂Ë°®Êü•ËØ¢ÊâÄÊúâÁõ∏ÂÖ≥Êñá‰ª∂ÔºåÊâπÈáèÊèíÂÖ•Âà∞Ê≠£ÂºèÊñá‰ª∂Ë°®„ÄÇ</li>
<li>‰ΩøÁî® CopyTools ÂÆûÁé∞ÂØπË±°Ê∑±Êã∑Ë¥ùÔºåÂÖàÂà†Èô§ÂêéÊèíÂÖ•Á°Æ‰øùÊï∞ÊçÆ‰∏ÄËá¥ÊÄß„ÄÇ</li>
</ul>
<h4 id="27-Ê∏ÖÁêÜÂæÖÂà†Èô§Êñá‰ª∂">2.7 Ê∏ÖÁêÜÂæÖÂà†Èô§Êñá‰ª∂
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filePathList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getDelFileList</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">filePathList</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">filePathList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">appConfig</span><span class="p">.</span><span class="na">getProjectFolder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_FOLDER</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">path</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">FileUtils</span><span class="p">.</span><span class="na">deleteDirectory</span><span class="p">(</span><span class="n">file</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Âà†Èô§Êñá‰ª∂Â§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">redisComponent</span><span class="p">.</span><span class="na">cleanDelFileList</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ªé Redis Ëé∑ÂèñËØ•ËßÜÈ¢ëÁöÑÂæÖÂà†Èô§Êñá‰ª∂ÂàóË°®ÔºåÈÅçÂéÜÂàóË°®Âà†Èô§ÂÆûÈôÖÊñá‰ª∂ÔºåÊ∏ÖÁêÜ Redis ‰∏≠ÁöÑËÆ∞ÂΩï„ÄÇ</li>
<li>‰∏öÂä°Âú∫ÊôØÔºöÁî®Êà∑ÁºñËæëËßÜÈ¢ëÊó∂Âà†Èô§ÁöÑÊóßÊñá‰ª∂„ÄÅËΩ¨Á†ÅËøáÁ®ã‰∏≠ÁîüÊàêÁöÑ‰∏¥Êó∂Êñá‰ª∂„ÄÅÂÆ°Ê†∏ÈÄöËøáÂêé‰∏çÂÜçÈúÄË¶ÅÁöÑ‰∏≠Èó¥Êñá‰ª∂„ÄÇ</li>
</ul>
<h4 id="28-ÂêåÊ≠•Âà∞ÊêúÁ¥¢ÂºïÊìé">2.8 ÂêåÊ≠•Âà∞ÊêúÁ¥¢ÂºïÊìé
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">esSearchComponent</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â∞ÜËßÜÈ¢ë‰ø°ÊÅØÁ¥¢ÂºïÂà∞ ElasticsearchÔºå‰ΩøËßÜÈ¢ëÂèØË¢´ÊêúÁ¥¢ÔºåÊîØÊåÅÂ§çÊùÇÁöÑÊêúÁ¥¢Êù°‰ª∂ÂíåÊéíÂ∫è„ÄÇ</li>
</ul>
<hr>
<h3 id="3-Áä∂ÊÄÅÊú∫ËÆæËÆ°">3. Áä∂ÊÄÅÊú∫ËÆæËÆ°
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Áä∂ÊÄÅÊûö‰∏æ</th>
          <th>Áä∂ÊÄÅÂê´‰πâ</th>
          <th>ÂèØÊµÅËΩ¨Ëá≥</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>STATUS0</td>
          <td>ÂæÖÂ§ÑÁêÜ/ÂàùÂßãÁä∂ÊÄÅ</td>
          <td>STATUS2</td>
      </tr>
      <tr>
          <td>STATUS2</td>
          <td>ÂæÖÂÆ°Ê†∏</td>
          <td>STATUS3/STATUS4</td>
      </tr>
      <tr>
          <td>STATUS3</td>
          <td>ÂÆ°Ê†∏ÈÄöËøá</td>
          <td>-</td>
      </tr>
      <tr>
          <td>STATUS4</td>
          <td>ÂÆ°Ê†∏‰∏çÈÄöËøá</td>
          <td>-</td>
      </tr>
  </tbody>
</table></div>
<ul>
<li>Âè™Êúâ STATUS2ÔºàÂæÖÂÆ°Ê†∏ÔºâÁä∂ÊÄÅÁöÑËßÜÈ¢ëÊâçËÉΩË¢´ÂÆ°Ê†∏ÔºåÂÆ°Ê†∏ÂêéÂèò‰∏∫ STATUS3ÔºàÈÄöËøáÔºâÊàñ STATUS4Ôºà‰∏çÈÄöËøáÔºâ„ÄÇ</li>
<li>Áä∂ÊÄÅÂèòÊõ¥ÈááÁî®‰πêËßÇÈîÅÊéßÂà∂„ÄÇ</li>
</ul>
<hr>
<h3 id="4-Êï∞ÊçÆË°®ËÆæËÆ°ÂàÜÊûê">4. Êï∞ÊçÆË°®ËÆæËÆ°ÂàÜÊûê
</h3><ul>
<li>
<p>ÂèëÂ∏ÉË°®ÔºàÂæÖÂÆ°Ê†∏Êï∞ÊçÆÔºâÔºö</p>
<ul>
<li>video_info_postÔºöËßÜÈ¢ë‰∏ª‰ø°ÊÅØ</li>
<li>video_info_file_postÔºöËßÜÈ¢ëÊñá‰ª∂‰ø°ÊÅØ</li>
</ul>
</li>
<li>
<p>Ê≠£ÂºèË°®ÔºàÂ∑≤ÂÆ°Ê†∏Êï∞ÊçÆÔºâÔºö</p>
<ul>
<li>video_infoÔºöËßÜÈ¢ë‰∏ª‰ø°ÊÅØ</li>
<li>video_info_fileÔºöËßÜÈ¢ëÊñá‰ª∂‰ø°ÊÅØ</li>
</ul>
</li>
<li>
<p>Áî®Êà∑Ë°®Ôºö</p>
<ul>
<li>user_infoÔºöÂ≠òÂÇ®Áî®Êà∑ÁßØÂàÜ</li>
</ul>
</li>
<li>
<p>ÂèëÂ∏É‰∏éÊ≠£ÂºèÊï∞ÊçÆÈöîÁ¶ªÔºåÈÅøÂÖçÂÆ°Ê†∏‰∏≠Êï∞ÊçÆÊ±°ÊüìÁîü‰∫ßÁéØÂ¢É„ÄÇ</p>
</li>
<li>
<p>‰∏§Â•óË°®ÁªìÊûÑÁõ∏ÂêåÔºå‰æø‰∫é‰ΩøÁî®Â∑•ÂÖ∑Á±ªÊã∑Ë¥ù„ÄÇ</p>
</li>
<li>
<p>ÂÆ°Ê†∏ÈÄöËøáÂêéÊâçÂêåÊ≠•Âà∞Ê≠£ÂºèË°®Ôºå‰øùËØÅÊï∞ÊçÆË¥®Èáè„ÄÇ</p>
</li>
</ul>
<hr>
<h3 id="5-ÂºÇÂ∏∏Â§ÑÁêÜËÆæËÆ°">5. ÂºÇÂ∏∏Â§ÑÁêÜËÆæËÆ°
</h3><ul>
<li>‰∏öÂä°ÂºÇÂ∏∏ÔºöÈùûÊ≥ïÁä∂ÊÄÅÂèÇÊï∞Á´ãÂç≥ÊäõÂá∫ÔºåÊõ¥Êñ∞Ë°åÊï∞‰∏∫ 0 ËßÜ‰∏∫Âπ∂ÂèëÂÜ≤Á™ÅÔºåÊèêÁ§∫ÈáçËØï„ÄÇ</li>
<li>Á≥ªÁªüÂºÇÂ∏∏ÔºöÊñá‰ª∂Âà†Èô§Â§±Ë¥•ËÆ∞ÂΩïÊó•Âøó‰ΩÜ‰∏ç‰∏≠Êñ≠ÊµÅÁ®ãÔºåÂÖ∂‰ªñÂºÇÂ∏∏Áî±‰∫ãÂä°Ê≥®Ëß£Â§ÑÁêÜËá™Âä®ÂõûÊªö„ÄÇ</li>
<li>ÊñπÊ≥ïÁ∫ß‰∫ãÂä°‰øùËØÅÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÔºåÈùûÂÖ≥ÈîÆÊìç‰ΩúÔºàÂ¶ÇÊñá‰ª∂Âà†Èô§ÔºâÂú®‰∫ãÂä°Â§ñÂ§ÑÁêÜ„ÄÇ</li>
</ul>
<hr>
<h3 id="6-ÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ">6. ÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ
</h3><ul>
<li><strong>ÂÆ°Ê†∏Êó•Âøó</strong>ÔºöÂª∫ËÆÆÂ¢ûÂä†ÂÆ°Ê†∏‰∫∫ÂíåÂÆ°Ê†∏ÂéüÂõ†ÁöÑÂÆ°ËÆ°Êó•Âøó„ÄÇ</li>
<li><strong>ÊÄßËÉΩ‰ºòÂåñ</strong>ÔºöÂ§ßÊâπÈáèÊñá‰ª∂Âà†Èô§ÂèØËÄÉËôëÂºÇÊ≠•ÂåñÔºåElasticsearch ÂêåÊ≠•ÂèØÂä†ÂÖ•ÈòüÂàóÂºÇÊ≠•Â§ÑÁêÜ„ÄÇ</li>
<li><strong>Áä∂ÊÄÅÊâ©Â±ï</strong>ÔºöÂèØÂ¢ûÂä†&quot;ÂÆ°Ê†∏‰∏≠&quot;Áä∂ÊÄÅÔºåÈÅøÂÖçÈïøÊó∂Èó¥ÂÆ°Ê†∏ÂØºËá¥ÁöÑÂπ∂ÂèëÈóÆÈ¢ò„ÄÇ</li>
<li><strong>Êñá‰ª∂Ê∏ÖÁêÜ</strong>ÔºöÂ¢ûÂä†Âà†Èô§ÈáçËØïÊú∫Âà∂ÔºåÊèêÈ´òÊñá‰ª∂Ê∏ÖÁêÜÊàêÂäüÁéá„ÄÇ</li>
<li><strong>ÈÖçÁΩÆÁÅµÊ¥ªÊÄß</strong>ÔºöÂÆ°Ê†∏ÈÄöËøáÂêéÁöÑÊìç‰ΩúÔºàÂ¶ÇÁßØÂàÜÂ•ñÂä±ÔºâÂèØÈÄöËøáÁ≠ñÁï•Ê®°ÂºèÂÆûÁé∞Âä®ÊÄÅÈÖçÁΩÆ„ÄÇ</li>
</ul>
<hr>
<h3 id="7-ÊÄªÁªì">7. ÊÄªÁªì
</h3><ul>
<li>auditVideo ÊñπÊ≥ïÊòØ‰∏Ä‰∏™ÂÆåÊï¥ÁöÑËßÜÈ¢ëÂÆ°Ê†∏Ëß£ÂÜ≥ÊñπÊ°àÔºåÂÖ∑Êúâ‰ª•‰∏ãÁâπÁÇπÔºö
<ul>
<li>‰∏•Ë∞®ÁöÑÁä∂ÊÄÅÁÆ°ÁêÜÔºöÈÄöËøáÊûö‰∏æÂíå‰πêËßÇÈîÅÁ°Æ‰øùÁä∂ÊÄÅÊµÅËΩ¨ÂÆâÂÖ®</li>
<li>Êï∞ÊçÆÈöîÁ¶ªËÆæËÆ°ÔºöÂèëÂ∏ÉÊï∞ÊçÆ‰∏éÊ≠£ÂºèÊï∞ÊçÆÁâ©ÁêÜÂàÜÁ¶ª</li>
<li>ÂÆåÊï¥ÁöÑ‰∏öÂä°ÊµÅÁ®ãÔºöÊ∂µÁõñÁä∂ÊÄÅÊõ¥Êñ∞„ÄÅÁßØÂàÜÂ•ñÂä±„ÄÅÊï∞ÊçÆÂêåÊ≠•„ÄÅÊñá‰ª∂Ê∏ÖÁêÜÁ≠â</li>
<li>ËâØÂ•ΩÁöÑÂºÇÂ∏∏Â§ÑÁêÜÔºöÂå∫ÂàÜ‰∏öÂä°ÂºÇÂ∏∏ÂíåÁ≥ªÁªüÂºÇÂ∏∏ÔºåÂÖ≥ÈîÆÊìç‰Ωú‰∫ãÂä°‰øùÈöú</li>
<li>ÂèØÊâ©Â±ïÊÄßÔºöÊ®°ÂùóÂåñËÆæËÆ°‰æø‰∫éÊñ∞Â¢ûÂÆ°Ê†∏ÂêéÊìç‰Ωú</li>
</ul>
</li>
<li>ËØ•ÊñπÊ≥ï‰ΩìÁé∞‰∫ÜÁîü‰∫ßÁ∫ßÂÆ°Ê†∏Á≥ªÁªüÁöÑÊ†∏ÂøÉËÆæËÆ°ÊÄùÊÉ≥ÔºåÂÖºÈ°æ‰∫ÜÂäüËÉΩÊÄß„ÄÅÂÆâÂÖ®ÊÄßÂíåÂèØÁª¥Êä§ÊÄß„ÄÇ</li>
</ul>
<h2 id="mysql‰∏≠left-join‰∏éinner-joinÁöÑ‰ΩøÁî®Âú∫ÊôØ">MySQL‰∏≠LEFT JOIN‰∏éINNER JOINÁöÑ‰ΩøÁî®Âú∫ÊôØ
</h2><p>Âú®MySQLÊï∞ÊçÆÂ∫ìÊü•ËØ¢‰∏≠ÔºåJOINÊìç‰ΩúÊòØÊúÄÂ∏∏Áî®ÁöÑÊìç‰Ωú‰πã‰∏ÄÔºåËÄåLEFT JOINÂíåINNER JOINÊòØ‰∏§ÁßçÊúÄÂü∫Á°ÄÁöÑJOINÁ±ªÂûã„ÄÇÁêÜËß£ÂÆÉ‰ª¨ÁöÑÂå∫Âà´ÂíåÈÄÇÁî®Âú∫ÊôØÂØπ‰∫éÁºñÂÜôÈ´òÊïà„ÄÅÂáÜÁ°ÆÁöÑSQLÊü•ËØ¢Ëá≥ÂÖ≥ÈáçË¶Å„ÄÇ</p>
<h3 id="Ê†∏ÂøÉÂå∫Âà´">Ê†∏ÂøÉÂå∫Âà´
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÁâπÊÄß</th>
          <th>INNER JOIN</th>
          <th>LEFT JOIN</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÁªìÊûúÈõÜ</td>
          <td>Âè™ËøîÂõû‰∏§Ë°®‰∏≠ÂåπÈÖçÁöÑË°å</td>
          <td>ËøîÂõûÂ∑¶Ë°®ÊâÄÊúâË°åÔºåÂè≥Ë°®‰∏çÂåπÈÖçÂàô‰∏∫NULL</td>
      </tr>
      <tr>
          <td>Êï∞ÊçÆ‰∏¢Â§±</td>
          <td>‰∏çÂåπÈÖçÁöÑË°å‰ºöË¢´ËøáÊª§Êéâ</td>
          <td>‰øùÁïôÂ∑¶Ë°®ÊâÄÊúâÊï∞ÊçÆ</td>
      </tr>
      <tr>
          <td>ÊÄßËÉΩ</td>
          <td>ÈÄöÂ∏∏Êõ¥Âø´</td>
          <td>ÈÄöÂ∏∏Á®çÊÖ¢</td>
      </tr>
      <tr>
          <td>‰ΩøÁî®È¢ëÁéá</td>
          <td>È´ò</td>
          <td>È´ò</td>
      </tr>
  </tbody>
</table></div>
<hr>
<h3 id="inner-joinÂÜÖËøûÊé•‰ΩøÁî®Âú∫ÊôØ">INNER JOINÔºàÂÜÖËøûÊé•Ôºâ‰ΩøÁî®Âú∫ÊôØ
</h3><h4 id="1-ÈúÄË¶Å‰∏•Ê†ºÂåπÈÖçÂÖ≥Á≥ªÁöÑÊü•ËØ¢">1. ÈúÄË¶Å‰∏•Ê†ºÂåπÈÖçÂÖ≥Á≥ªÁöÑÊü•ËØ¢
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Êü•ËØ¢ÊúâËÆ¢ÂçïÁöÑÂÆ¢Êà∑‰ø°ÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">customers</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">order_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">customers</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÈÄÇÁî®ÊÉÖÂÜµÔºö</strong></p>
<ul>
<li>Âè™ÂÖ≥ÂøÉ‰∏§‰∏™Ë°®‰∏≠ÈÉΩÂ≠òÂú®ÂÖ≥ËÅîËÆ∞ÂΩïÁöÑÊï∞ÊçÆ</li>
<li>ÈúÄË¶ÅÊéíÈô§‰ªª‰Ωï‰∏ÄËæπÊ≤°ÊúâÂåπÈÖçÈ°πÁöÑÊï∞ÊçÆ</li>
</ul>
<h4 id="2-Â§öË°®ÂÖ≥ËÅî‰∏îÈúÄË¶ÅÊâÄÊúâË°®ÈÉΩÊúâÂåπÈÖç">2. Â§öË°®ÂÖ≥ËÅî‰∏îÈúÄË¶ÅÊâÄÊúâË°®ÈÉΩÊúâÂåπÈÖç
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Êü•ËØ¢ÂêåÊó∂ÊúâËÆ¢ÂçïÂíå‰ªòÊ¨æËÆ∞ÂΩïÁöÑÂÆ¢Êà∑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">payments</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">order_id</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-ÊÄßËÉΩ‰ºòÂÖàÁöÑÊü•ËØ¢">3. ÊÄßËÉΩ‰ºòÂÖàÁöÑÊü•ËØ¢
</h4><ul>
<li>INNER JOIN ÈÄöÂ∏∏ÊØî LEFT JOIN ÊÄßËÉΩÊõ¥Â•ΩÔºåÁâπÂà´ÊòØÂú®Â§ßË°®ÂÖ≥ËÅîÊó∂„ÄÇ</li>
</ul>
<hr>
<h3 id="left-joinÂ∑¶ËøûÊé•‰ΩøÁî®Âú∫ÊôØ">LEFT JOINÔºàÂ∑¶ËøûÊé•Ôºâ‰ΩøÁî®Âú∫ÊôØ
</h3><h4 id="1-ÈúÄË¶ÅÂåÖÂê´Â∑¶Ë°®ÊâÄÊúâËÆ∞ÂΩïÁöÑÊü•ËØ¢">1. ÈúÄË¶ÅÂåÖÂê´Â∑¶Ë°®ÊâÄÊúâËÆ∞ÂΩïÁöÑÊü•ËØ¢
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Êü•ËØ¢ÊâÄÊúâÂÆ¢Êà∑ÂèäÂÖ∂ËÆ¢Âçï(ÂåÖÊã¨Ê≤°ÊúâËÆ¢ÂçïÁöÑÂÆ¢Êà∑)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">customers</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">order_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">customers</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÈÄÇÁî®ÊÉÖÂÜµÔºö</strong></p>
<ul>
<li>ÈúÄË¶Å‰øùÁïôÂ∑¶Ë°®ÊâÄÊúâËÆ∞ÂΩïÔºåÊó†ËÆ∫Âè≥Ë°®ÊòØÂê¶ÊúâÂåπÈÖç</li>
<li>ÈúÄË¶ÅÁªüËÆ°&quot;Êúâ&quot;Âíå&quot;Ê≤°Êúâ&quot;ÁöÑÊÉÖÂÜµ</li>
</ul>
<h4 id="2-Ê£ÄÊµãÁº∫Â§±Êï∞ÊçÆÁöÑÊü•ËØ¢">2. Ê£ÄÊµãÁº∫Â§±Êï∞ÊçÆÁöÑÊü•ËØ¢
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Êü•ÊâæÊ≤°ÊúâËÆ¢ÂçïÁöÑÂÆ¢Êà∑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">customers</span><span class="p">.</span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">customers</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-ÂàÜÁ∫ßÊï∞ÊçÆÊü•ËØ¢">3. ÂàÜÁ∫ßÊï∞ÊçÆÊü•ËØ¢
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Êü•ËØ¢ÈÉ®Èó®ÂèäÂëòÂ∑•(ÂåÖÊã¨Ê≤°ÊúâÂëòÂ∑•ÁöÑÈÉ®Èó®)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">departments</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">employees</span><span class="p">.</span><span class="n">employee_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">departments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">departments</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employees</span><span class="p">.</span><span class="n">dept_id</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="ÈÄâÊã©‰æùÊçÆ">ÈÄâÊã©‰æùÊçÆ
</h3><ul>
<li><strong>‰∏öÂä°ÈúÄÊ±ÇÔºö</strong>
<ul>
<li>ÊòØÂê¶ÈúÄË¶Å‰øùÁïô‰∏çÂåπÈÖçÁöÑËÆ∞ÂΩïÔºü</li>
<li>ÊòØÂê¶Ë¶ÅËÆ°ÁÆóÂ≠òÂú®/‰∏çÂ≠òÂú®ÁöÑËÆ∞ÂΩïÔºü</li>
</ul>
</li>
<li><strong>Êï∞ÊçÆÂÆåÊï¥ÊÄßÔºö</strong>
<ul>
<li>Â¶ÇÊûúÂè≥Ë°®Êï∞ÊçÆÂøÖÈ°ªÂ≠òÂú®ÔºåÁî® INNER JOIN</li>
<li>Â¶ÇÊûúÂè≥Ë°®Êï∞ÊçÆÂèØÈÄâÔºåÁî® LEFT JOIN</li>
</ul>
</li>
<li><strong>ÊÄßËÉΩËÄÉËôëÔºö</strong>
<ul>
<li>Â§ßË°®ÂÖ≥ËÅî‰ºòÂÖàËÄÉËôë INNER JOIN</li>
<li>ÂøÖË¶ÅÊó∂ÂèØ‰ª•Áî® LEFT JOIN ÈÖçÂêàÁ¥¢Âºï‰ºòÂåñ</li>
</ul>
</li>
</ul>
<hr>
<h3 id="ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ">ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ
</h3><ul>
<li><strong>‰∏∫JOINÊù°‰ª∂Âª∫Á´ãÁ¥¢ÂºïÔºö</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>ÈôêÂà∂ÁªìÊûúÈõÜÂ§ßÂ∞èÔºö</strong>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">large_table</span><span class="w"> </span><span class="n">l</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">small_table</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">large_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li><strong>ÈÅøÂÖç‰∏çÂøÖË¶ÅÁöÑLEFT JOINÔºö</strong>
<ul>
<li>Â¶ÇÊûú‰∏öÂä°‰∏äÂè≥Ë°®Êï∞ÊçÆÂøÖÈ°ªÂ≠òÂú®Ôºå‰ΩøÁî® INNER JOIN Êõ¥È´òÊïà</li>
</ul>
</li>
</ul>
<hr>
<h3 id="ÂÆûÈôÖÊ°à‰æãÂØπÊØî">ÂÆûÈôÖÊ°à‰æãÂØπÊØî
</h3><p><strong>Âú∫ÊôØÔºöÁîµÂïÜÁ≥ªÁªü‰∏≠ÁöÑËÆ¢ÂçïÊü•ËØ¢</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- ÊñπÊ°à1: INNER JOIN (Âè™Êü•ËØ¢ÊúâÂÆ¢Êà∑ÁöÑËÆ¢Âçï)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ÊñπÊ°à2: LEFT JOIN (Êü•ËØ¢ÊâÄÊúâËÆ¢ÂçïÔºåÂåÖÊã¨ÂÆ¢Êà∑‰ø°ÊÅØÁº∫Â§±ÁöÑ)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ÊñπÊ°à3: LEFT JOINÊü•ÊâæÂºÇÂ∏∏Êï∞ÊçÆ (ÂÆ¢Êà∑‰ø°ÊÅØÁº∫Â§±ÁöÑËÆ¢Âçï)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="ÊÄªÁªì-3">ÊÄªÁªì
</h3><ul>
<li><strong>‰ΩøÁî® INNER JOINÔºö</strong> ÂΩì‰Ω†Á°ÆÂÆöÂÖ≥ËÅîÊï∞ÊçÆÂøÖÈ°ªÂ≠òÂú®Ôºå‰∏îÂè™ÈúÄË¶ÅÂåπÈÖçÊàêÂäüÁöÑËÆ∞ÂΩïÊó∂</li>
<li><strong>‰ΩøÁî® LEFT JOINÔºö</strong> ÂΩìÈúÄË¶Å‰øùÁïôÂ∑¶Ë°®ÊâÄÊúâËÆ∞ÂΩïÔºåÊó†ËÆ∫ÊòØÂê¶ÂåπÈÖçÔºåÊàñËÄÖÈúÄË¶ÅÊü•ÊâæÁº∫Â§±ÂÖ≥ËÅîÊï∞ÊçÆÊó∂</li>
</ul>
<p>Ê≠£Á°ÆÈÄâÊã© JOIN Á±ªÂûã‰∏ç‰ªÖËÉΩÁ°Æ‰øùÊü•ËØ¢ÁªìÊûúÁöÑÂáÜÁ°ÆÊÄßÔºåËøòËÉΩÊòæËëóÂΩ±ÂìçÊü•ËØ¢ÊÄßËÉΩ„ÄÇÂú®ËÆæËÆ°Êü•ËØ¢Êó∂ÔºåÂ∫îÂÖàÊòéÁ°Æ‰∏öÂä°ÈúÄÊ±ÇÔºåÂÜçÂÜ≥ÂÆö‰ΩøÁî®Âì™Áßç JOIN ÊñπÂºè„ÄÇ</p>
<h2 id="Ë∑®Á≥ªÁªü‰∫ãÂä°Â§ÑÁêÜÁ≠ñÁï•">Ë∑®Á≥ªÁªü‰∫ãÂä°Â§ÑÁêÜÁ≠ñÁï•
</h2><p>Âú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÊàñÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÔºåÂ∏∏Â∏∏ÈúÄË¶ÅÂú®‰∏Ä‰∏™‰∏öÂä°ÊµÅÁ®ã‰∏≠ÂêåÊó∂Êìç‰ΩúÊú¨Âú∞Êï∞ÊçÆÂ∫ìÂíåËøúÁ®ãÁ≥ªÁªüÔºàÂ¶ÇË∞ÉÁî®Â§ñÈÉ®Êé•Âè£ÂÜôÂÖ•ÂÖ∂ÂÆÉÊúçÂä°Âô®Êï∞ÊçÆÂ∫ìÔºâ„ÄÇÂ¶Ç‰Ωï‰øùËØÅÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÂíåÈ´òÂèØÁî®ÔºåÊòØÂÆûÈôÖÂºÄÂèë‰∏≠ÁöÑÂ∏∏ËßÅÈöæÈ¢ò„ÄÇ</p>
<h3 id="ÊâßË°åÈ°∫Â∫èÂª∫ËÆÆÂÖàÊú¨Âú∞ÂêéËøúÁ®ã">ÊâßË°åÈ°∫Â∫èÂª∫ËÆÆÔºöÂÖàÊú¨Âú∞ÂêéËøúÁ®ã
</h3><ul>
<li><strong>ÊÄßËÉΩËÄÉËôëÔºö</strong> Êú¨Âú∞Êìç‰ΩúÈÄöÂ∏∏ÊØîËøúÁ®ãË∞ÉÁî®Êõ¥Âø´ÔºåÂÖàÂÆåÊàêÂø´ÈÄüÊìç‰ΩúÂèØÂáèÂ∞ëËµÑÊ∫êÈîÅÂÆöÊó∂Èó¥„ÄÇ</li>
<li><strong>ÈîôËØØÂ§ÑÁêÜÔºö</strong> Êú¨Âú∞Êìç‰ΩúÂ§±Ë¥•ÂèØÁõ¥Êé•ÂõûÊªöÔºåÈÅøÂÖç‰∏çÂøÖË¶ÅÁöÑËøúÁ®ãË∞ÉÁî®„ÄÇ</li>
<li><strong>Êï∞ÊçÆ‰∏ÄËá¥ÊÄßÔºö</strong> ÂÖà‰øùËØÅÊú¨Âú∞Êï∞ÊçÆ‰∏ÄËá¥ÔºåËøúÁ®ãË∞ÉÁî®‰Ωú‰∏∫ÂêéÁª≠Ë°•ÂÅøÁöÑÂü∫Á°Ä„ÄÇ</li>
</ul>
<hr>
<h3 id="Ë∂ÖÊó∂Â§ÑÁêÜÊñπÊ°à">Ë∂ÖÊó∂Â§ÑÁêÜÊñπÊ°à
</h3><h4 id="1-Êú¨Âú∞‰∫ãÂä°ÂºÇÊ≠•ÈÄöÁü•Êé®Ëçê">1. Êú¨Âú∞‰∫ãÂä°+ÂºÇÊ≠•ÈÄöÁü•ÔºàÊé®ËçêÔºâ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Transactional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processTransaction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. ÂÖàÊâßË°åÊú¨Âú∞Êï∞ÊçÆÂ∫ìÊìç‰Ωú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">localRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 2. Â∞ùËØïÂêåÊ≠•Ë∞ÉÁî®ËøúÁ®ãÊé•Âè£ÔºàËÆæÁΩÆÂêàÁêÜË∂ÖÊó∂Êó∂Èó¥Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">remoteService</span><span class="p">.</span><span class="na">callWithTimeout</span><span class="p">(</span><span class="n">remoteData</span><span class="p">,</span><span class="w"> </span><span class="n">3</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">TimeoutException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 3. Â¶ÇÊûúË∂ÖÊó∂ÔºåÂ∞Ü‰ªªÂä°ÊîæÂÖ•ÈáçËØïÈòüÂàó</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mqService</span><span class="p">.</span><span class="na">sendToRetryQueue</span><span class="p">(</span><span class="n">remoteData</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Êú¨Âú∞‰∫ãÂä°‰ªçÁÑ∂Êèê‰∫§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÂÖ∂‰ªñÊú¨Âú∞Êìç‰Ωú...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ÈÖçÂ•óÊé™ÊñΩÔºö</strong></p>
<ul>
<li>Âª∫Á´ãÊ∂àÊÅØÈòüÂàóÂíåÈáçËØïÊú∫Âà∂</li>
<li>ÁõëÊéßÊú™ÂÆåÊàêÁöÑËøúÁ®ãË∞ÉÁî®</li>
<li>Êèê‰æõ‰∫∫Â∑•Âπ≤È¢ÑÊé•Âè£</li>
</ul>
<h4 id="2-‰∏§Èò∂ÊÆµÊèê‰∫§Ê®°Âºè">2. ‰∏§Èò∂ÊÆµÊèê‰∫§Ê®°Âºè
</h4><p>Âõæ</p>
<ul>
<li>Êú¨Âú∞Êï∞ÊçÆÂ∫ìÈ¢ÑÊèê‰∫§Ôºà‰∏çÂÆûÈôÖÁîüÊïàÔºâ</li>
<li>ËøúÁ®ãÊúçÂä°È¢ÑÊèê‰∫§ÔºàËµÑÊ∫êÈ¢ÑÁïôÔºâ</li>
<li>Á°ÆËÆ§ÈÉΩÊàêÂäüÂêéÊúÄÁªàÊèê‰∫§ÔºåÂê¶ÂàôÂõûÊªö‰∏§Ëæπ</li>
</ul>
<hr>
<h3 id="Ë∂ÖÊó∂ÂÖ∑‰ΩìÂ§ÑÁêÜÁ≠ñÁï•">Ë∂ÖÊó∂ÂÖ∑‰ΩìÂ§ÑÁêÜÁ≠ñÁï•
</h3><h4 id="1-Áü≠Ë∂ÖÊó∂Âø´ÈÄüÂ§±Ë¥•">1. Áü≠Ë∂ÖÊó∂+Âø´ÈÄüÂ§±Ë¥•
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ËÆæÁΩÆÂêàÁêÜÁöÑË∂ÖÊó∂Êó∂Èó¥ÔºàÊ†πÊçÆ‰∏öÂä°ÈúÄÊ±ÇË∞ÉÊï¥Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">HttpClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">.</span><span class="na">create</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">responseTimeout</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofSeconds</span><span class="p">(</span><span class="n">2</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-ÈáçËØïÊú∫Âà∂">2. ÈáçËØïÊú∫Âà∂
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">RetryPolicy</span><span class="w"> </span><span class="n">retryPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RetryPolicy</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">withMaxAttempts</span><span class="p">(</span><span class="n">3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">withDelay</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Failsafe</span><span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="n">retryPolicy</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">get</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">remoteService</span><span class="p">.</span><span class="na">call</span><span class="p">(</span><span class="n">remoteData</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-Ë°•ÂÅø‰∫ãÂä°">3. Ë°•ÂÅø‰∫ãÂä°
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Transactional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mainOperation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ËÆ∞ÂΩïÊìç‰ΩúÊµÅÊ∞¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">auditLogRepository</span><span class="p">.</span><span class="na">logOperationStart</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Êú¨Âú∞Êï∞ÊçÆÂ∫ìÊìç‰Ωú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">localRepository</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ë°•ÂÅø‰ªªÂä°ÔºàÂÆöÊó∂ÊâßË°åÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">compensateOperation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">UnfinishedOperation</span><span class="o">&gt;</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">auditLogRepository</span><span class="p">.</span><span class="na">findUnfinished</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">operations</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">op</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">remoteService</span><span class="p">.</span><span class="na">retry</span><span class="p">(</span><span class="n">op</span><span class="p">.</span><span class="na">getData</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">auditLogRepository</span><span class="p">.</span><span class="na">markAsCompleted</span><span class="p">(</span><span class="n">op</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Êä•Ë≠¶ÈÄöÁü•‰∫∫Â∑•Â§ÑÁêÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">alertService</span><span class="p">.</span><span class="na">notifyAdmin</span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="Êû∂ÊûÑËÆæËÆ°Âª∫ËÆÆ">Êû∂ÊûÑËÆæËÆ°Âª∫ËÆÆ
</h3><h4 id="ÊúÄÁªà‰∏ÄËá¥ÊÄßÊ®°Âºè">ÊúÄÁªà‰∏ÄËá¥ÊÄßÊ®°Âºè
</h4><ul>
<li>‰ΩøÁî®‰∫ã‰ª∂Ê∫ØÊ∫êÔºàEvent SourcingÔºâ</li>
<li>ÂÆûÁé∞ÂèØÈù†‰∫ã‰ª∂ÊÄªÁ∫ø</li>
</ul>
<h4 id="ÊúçÂä°ÈôçÁ∫ßÊñπÊ°à">ÊúçÂä°ÈôçÁ∫ßÊñπÊ°à
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">process</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">remoteService</span><span class="p">.</span><span class="na">call</span><span class="p">(</span><span class="n">remoteData</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÈôçÁ∫ßÂ§ÑÁêÜÔºöËÆ∞ÂΩïÂà∞Êú¨Âú∞ÂæÖÂ§ÑÁêÜË°®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">fallbackRepository</span><span class="p">.</span><span class="na">savePendingTask</span><span class="p">(</span><span class="n">remoteData</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ëß¶ÂèëÂëäË≠¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">monitoringService</span><span class="p">.</span><span class="na">alert</span><span class="p">(</span><span class="s">&#34;Remote call failed&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ÁõëÊéßÊåáÊ†á">ÁõëÊéßÊåáÊ†á
</h4><ul>
<li>ËøúÁ®ãË∞ÉÁî®ÊàêÂäüÁéá</li>
<li>Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥</li>
<li>ÂæÖË°•ÂÅø‰∫ãÂä°Êï∞Èáè</li>
<li>Ë°•ÂÅøÊàêÂäüÁéá</li>
</ul>
<h3 id="ÂÜ≥Á≠ñÊµÅÁ®ãÂõæ">ÂÜ≥Á≠ñÊµÅÁ®ãÂõæ
</h3><h3 id="ÊÄªÁªìÂª∫ËÆÆ">ÊÄªÁªìÂª∫ËÆÆ
</h3><ul>
<li><strong>Â∏∏ËßÑÂú∫ÊôØÔºö</strong> ÈááÁî®&quot;ÂÖàÊú¨Âú∞ÂêéËøúÁ®ã+ÂºÇÊ≠•ÈáçËØï&quot;ÊñπÊ°à</li>
<li><strong>ÈáëËûçÁ≠â‰∏•Ê†ºÂú∫ÊôØÔºö</strong> ËÄÉËôë‰∏§Èò∂ÊÆµÊèê‰∫§ÊàñSagaÊ®°Âºè</li>
<li><strong>ÂøÖÈ°ª‰øùËØÅÔºö</strong>
<ul>
<li>Êú¨Âú∞Êìç‰ΩúÁöÑÂèØÂõûÊªöÊÄß</li>
<li>ËøúÁ®ãË∞ÉÁî®ÁöÑÂπÇÁ≠âÊÄß</li>
<li>ÂÆåÂñÑÁöÑÁõëÊéßÊä•Ë≠¶Êú∫Âà∂</li>
</ul>
</li>
</ul>
<p>ÈÄöËøáËøôÁßçËÆæËÆ°ÔºåÂç≥‰ΩøÂú®ËøúÁ®ãË∞ÉÁî®Ë∂ÖÊó∂ÁöÑÊÉÖÂÜµ‰∏ãÔºåÁ≥ªÁªü‰ªçËÉΩ‰øùÊåÅÊúÄÁªà‰∏ÄËá¥ÊÄßÔºåÂêåÊó∂ÈÅøÂÖçÈïøÊó∂Èó¥ÁöÑËµÑÊ∫êÈîÅÂÆöÂíåÁî®Êà∑Á≠âÂæÖ„ÄÇ</p>
<hr>
<h2 id="ÂÖ≥‰∫éspring‰∫ãÂä°ÂÜÖÈÉ®Ë∞ÉÁî®ÁöÑÈóÆÈ¢ò">ÂÖ≥‰∫éSpring‰∫ãÂä°ÂÜÖÈÉ®Ë∞ÉÁî®ÁöÑÈóÆÈ¢ò
</h2><p>Âú®‰ª£Á†Å‰∏≠ÔºåtopCommentÊñπÊ≥ïË∞ÉÁî®cancelTopCommentÊñπÊ≥ïÔºåËøôÁßçÂÜÖÈÉ®Ë∞ÉÁî®‰∏ç‰ºöÂØºËá¥‰∫ãÂä°Â§±ÊïàÔºåÂõ†‰∏∫Ôºö</p>
<p>topCommentÊñπÊ≥ïÊúâ@TransactionalÊ≥®Ëß£ÔºåÂàõÂª∫‰∫Ü‰∏Ä‰∏™‰∫ãÂä°
cancelTopCommentÊñπÊ≥ïË¢´topCommentË∞ÉÁî®Êó∂ÔºåÊòØÂú®Âêå‰∏Ä‰∏™Á±ªÂÜÖÈÉ®ÁöÑÊñπÊ≥ïË∞ÉÁî®
SpringÁöÑ‰∫ãÂä°‰ª£ÁêÜÊòØÂü∫‰∫éAOPÂÆûÁé∞ÁöÑÔºåÂÜÖÈÉ®Ë∞ÉÁî®‰∏ç‰ºöÁªèËøá‰ª£ÁêÜÂØπË±°</p>
<h4 id="1-ÊñπÊ≥ïÂÜÖÈÉ®Ë∞ÉÁî®ÊúÄÂ∏∏ËßÅ">1. ÊñπÊ≥ïÂÜÖÈÉ®Ë∞ÉÁî®ÔºàÊúÄÂ∏∏ËßÅÔºâ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">outerMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">innerMethod</span><span class="p">();</span><span class="w"> </span><span class="c1">// ‰∫ãÂä°Â§±Êïà</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Transactional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">innerMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Êï∞ÊçÆÂ∫ìÊìç‰Ωú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â§±ÊïàÂéüÂõ†ÔºöÂÜÖÈÉ®Ë∞ÉÁî®ÁªïËøá‰∫ÜSpringÁöÑ‰ª£ÁêÜÊú∫Âà∂„ÄÇ</li>
</ul>
<h4 id="2-‰∫ãÂä°ÊñπÊ≥ï‰∏çÊòØpublic">2. ‰∫ãÂä°ÊñπÊ≥ï‰∏çÊòØpublic
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Transactional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">myMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// ‰∫ãÂä°Â§±Êïà</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â§±ÊïàÂéüÂõ†ÔºöSpring AOPÊó†Ê≥ï‰ª£ÁêÜÈùûpublicÊñπÊ≥ï„ÄÇ</li>
</ul>
<h4 id="3-ÂºÇÂ∏∏Ë¢´ÊçïËé∑Êú™ÊäõÂá∫">3. ÂºÇÂ∏∏Ë¢´ÊçïËé∑Êú™ÊäõÂá∫
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Transactional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">myMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Êï∞ÊçÆÂ∫ìÊìç‰Ωú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÊçïËé∑ÂºÇÂ∏∏‰ΩÜ‰∏çÊäõÂá∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â§±ÊïàÂéüÂõ†Ôºö‰∫ãÂä°ÂõûÊªöÈúÄË¶ÅÂºÇÂ∏∏‰º†Êí≠Âà∞‰∫ãÂä°ÁÆ°ÁêÜÂô®„ÄÇ</li>
</ul>
<h4 id="4-ÂºÇÂ∏∏Á±ªÂûã‰∏çÂåπÈÖç">4. ÂºÇÂ∏∏Á±ªÂûã‰∏çÂåπÈÖç
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Transactional</span><span class="p">(</span><span class="n">rollbackFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">myMethod</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Exception</span><span class="p">();</span><span class="w"> </span><span class="c1">// ‰∫ãÂä°‰∏ç‰ºöÂõûÊªö</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â§±ÊïàÂéüÂõ†ÔºöÊäõÂá∫ÁöÑÂºÇÂ∏∏Á±ªÂûã‰∏çÂú®rollbackForÊåáÂÆöÁöÑËåÉÂõ¥ÂÜÖ„ÄÇ</li>
</ul>
<h4 id="5-Â§öÁ∫øÁ®ãË∞ÉÁî®">5. Â§öÁ∫øÁ®ãË∞ÉÁî®
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Transactional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">myMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Êï∞ÊçÆÂ∫ìÊìç‰Ωú - ‰∫ãÂä°Â§±Êïà</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}).</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â§±ÊïàÂéüÂõ†Ôºö‰∫ãÂä°‰ø°ÊÅØÁªëÂÆöÂú®Á∫øÁ®ãÊú¨Âú∞ÂèòÈáè(ThreadLocal)‰∏≠ÔºåÊñ∞Á∫øÁ®ãÊó†Ê≥ïËé∑Âèñ„ÄÇ</li>
</ul>
<h4 id="6-Êï∞ÊçÆÂ∫ìÂºïÊìé‰∏çÊîØÊåÅ‰∫ãÂä°">6. Êï∞ÊçÆÂ∫ìÂºïÊìé‰∏çÊîØÊåÅ‰∫ãÂä°
</h4><ul>
<li>‰æãÂ¶Ç‰ΩøÁî®MyISAMÂºïÊìéÁöÑMySQLË°®ÔºåÂ§©ÁÑ∂‰∏çÊîØÊåÅ‰∫ãÂä°„ÄÇ</li>
</ul>
<p><strong>Â¶Ç‰ΩïÁ°Æ‰øù‰∫ãÂä°ÊúâÊïà</strong>
Â∞ÜÈúÄË¶Å‰∫ãÂä°ÁöÑÊñπÊ≥ïÊèêÂèñÂà∞ÂçïÁã¨ÁöÑServiceÁ±ª‰∏≠
ÈÄöËøáÊ≥®ÂÖ•ÁöÑService‰ª£ÁêÜÂØπË±°Ë∞ÉÁî®ÊñπÊ≥ïÔºàËÄå‰∏çÊòØÂÜÖÈÉ®Ë∞ÉÁî®Ôºâ
Á°Æ‰øùÊñπÊ≥ï‰∏∫public
Ê≠£Á°ÆÂ§ÑÁêÜÂºÇÂ∏∏
‰ΩøÁî®ÊîØÊåÅ‰∫ãÂä°ÁöÑÊï∞ÊçÆÂ∫ìÂºïÊìé</p>
<h2 id="ËßÜÈ¢ëÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°Á≥ªÁªüÂÆûÁé∞ËØ¶Ëß£">ËßÜÈ¢ëÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°Á≥ªÁªüÂÆûÁé∞ËØ¶Ëß£
</h2><h3 id="1-Á≥ªÁªüÊû∂ÊûÑÊ¶ÇËø∞">1. Á≥ªÁªüÊû∂ÊûÑÊ¶ÇËø∞
</h3><p>Êú¨Á≥ªÁªüÂü∫‰∫é Redis ÂÆûÁé∞Ôºå‰∏ªË¶ÅÂåÖÂê´Ôºö</p>
<ul>
<li>ÂøÉË∑≥‰∏äÊä•Êé•Âè£ÔºöÂÆ¢Êà∑Á´ØÂÆöÊúüË∞ÉÁî®‰ª•Áª¥ÊåÅÂú®Á∫øÁä∂ÊÄÅ</li>
<li>Redis Â≠òÂÇ®ÁªìÊûÑÔºö‰ΩøÁî®‰∏§ÁßçÈîÆÂ≠òÂÇ®Âú®Á∫ø‰ø°ÊÅØ</li>
<li>ËøáÊúüÁõëÂê¨Êú∫Âà∂ÔºöÈÄöËøá Redis ÁöÑÈîÆËøáÊúü‰∫ã‰ª∂Ëá™Âä®ÂáèÂ∞ëÂú®Á∫ø‰∫∫Êï∞</li>
<li>ËÆ°Êï∞Áª¥Êä§ÈÄªËæëÔºöÁ°Æ‰øùÂú®Á∫ø‰∫∫Êï∞ÁöÑÂáÜÁ°ÆÊÄß</li>
</ul>
<h3 id="2-Ê†∏ÂøÉÂÆûÁé∞ÁªÜËäÇ">2. Ê†∏ÂøÉÂÆûÁé∞ÁªÜËäÇ
</h3><h4 id="21-Êï∞ÊçÆÁªìÊûÑËÆæËÆ°">2.1 Êï∞ÊçÆÁªìÊûÑËÆæËÆ°
</h4><ul>
<li>Áî®Êà∑Êí≠ÊîæÈîÆ (userPlayOnlineKey)
<ul>
<li>Ê†ºÂºèÔºövideo:play:user:{fileId}:{deviceId}</li>
<li>‰ΩúÁî®ÔºöÊ†áËÆ∞ÁâπÂÆöËÆæÂ§áÊòØÂê¶Âú®Á∫ø</li>
<li>ËøáÊúüÊó∂Èó¥Ôºö8Áßí</li>
</ul>
</li>
<li>Âú®Á∫øËÆ°Êï∞ÈîÆ (playOnlineCountKey)
<ul>
<li>Ê†ºÂºèÔºövideo:play:online:{fileId}</li>
<li>‰ΩúÁî®ÔºöÂ≠òÂÇ®ÂΩìÂâçËßÜÈ¢ëÁöÑÂú®Á∫ø‰∫∫Êï∞</li>
<li>ËøáÊúüÊó∂Èó¥Ôºö10Áßí</li>
</ul>
</li>
</ul>
<h4 id="22-ÂøÉË∑≥‰∏äÊä•ÊµÅÁ®ã">2.2 ÂøÉË∑≥‰∏äÊä•ÊµÅÁ®ã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="nf">reportVideoPlayOnline</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">fileId</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">deviceId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userPlayOnlineKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_VIDEO_PLAY_COUNT_USER</span><span class="p">,</span><span class="w"> </span><span class="n">fileId</span><span class="p">,</span><span class="w"> </span><span class="n">deviceId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">playOnlineCountKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_VIDEO_PLAY_COUNT_ONLINE</span><span class="p">,</span><span class="w"> </span><span class="n">fileId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">redisUtils</span><span class="p">.</span><span class="na">keyExists</span><span class="p">(</span><span class="n">userPlayOnlineKey</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">redisUtils</span><span class="p">.</span><span class="na">setex</span><span class="p">(</span><span class="n">userPlayOnlineKey</span><span class="p">,</span><span class="w"> </span><span class="n">fileId</span><span class="p">,</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_EXPIRES_ONE_SECONDS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">8</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">redisUtils</span><span class="p">.</span><span class="na">incrementex</span><span class="p">(</span><span class="n">playOnlineCountKey</span><span class="p">,</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_EXPIRES_ONE_SECONDS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">10</span><span class="p">).</span><span class="na">intValue</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">redisUtils</span><span class="p">.</span><span class="na">expire</span><span class="p">(</span><span class="n">playOnlineCountKey</span><span class="p">,</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_EXPIRES_ONE_SECONDS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">redisUtils</span><span class="p">.</span><span class="na">expire</span><span class="p">(</span><span class="n">userPlayOnlineKey</span><span class="p">,</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_EXPIRES_ONE_SECONDS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">8</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span><span class="w"> </span><span class="n">redisUtils</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">playOnlineCountKey</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÆ¢Êà∑Á´ØÊØè5-7ÁßíË∞ÉÁî®‰∏ÄÊ¨°Êé•Âè£</li>
<li>Êñ∞Áî®Êà∑ÔºöÂàõÂª∫Áî®Êà∑ÈîÆÂπ∂Â¢ûÂä†ËÆ°Êï∞</li>
<li>Â∑≤ÊúâÁî®Êà∑ÔºöÁª≠Êúü‰∏§‰∏™ÈîÆ</li>
<li>ËøîÂõûÂΩìÂâçÂú®Á∫ø‰∫∫Êï∞</li>
</ul>
<h4 id="23-ËøáÊúüÁõëÂê¨Êú∫Âà∂">2.3 ËøáÊúüÁõëÂê¨Êú∫Âà∂
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onMessage</span><span class="p">(</span><span class="n">Message</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">pattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">key</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_VIDEO_PLAY_COUNT_ONLINE_PREIFX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_VIDEO_PLAY_COUNT_USER_PREFIX</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">userKeyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_VIDEO_PLAY_COUNT_USER_PREFIX</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_VIDEO_PLAY_COUNT_USER_PREFIX</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">fileId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">userKeyIndex</span><span class="p">,</span><span class="w"> </span><span class="n">userKeyIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">LENGTH_20</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">decrementPlayOnlineCount</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_VIDEO_PLAY_COUNT_ONLINE</span><span class="p">,</span><span class="w"> </span><span class="n">fileId</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Áî®Êà∑ÈîÆËøáÊúüÊó∂Ëá™Âä®ÂáèÂ∞ëÂØπÂ∫îËßÜÈ¢ëÁöÑÂú®Á∫ø‰∫∫Êï∞</li>
</ul>
<h4 id="24-ËÆ°Êï∞ÈÄíÂáèÈÄªËæë">2.4 ËÆ°Êï∞ÈÄíÂáèÈÄªËæë
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">decrementPlayOnlineCount</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">redisUtils</span><span class="p">.</span><span class="na">decrement</span><span class="p">(</span><span class="n">key</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-ÂÖ≥ÈîÆËÆæËÆ°ÂéüÁêÜ">3. ÂÖ≥ÈîÆËÆæËÆ°ÂéüÁêÜ
</h3><ul>
<li>ÂèåÈîÆËÆæËÆ°ÔºöÁî®Êà∑ÈîÆ‰Ωú‰∏∫ÂøÉË∑≥ÔºåËÆ°Êï∞ÈîÆÈõÜ‰∏≠Â≠òÂÇ®‰∫∫Êï∞ÔºåËøáÊúüÊó∂Èó¥ÈîôÂºÄÈò≤Ê≠¢Á´ûÊÄÅ</li>
<li>Êó∂Èó¥ÂèÇÊï∞Ôºö8ÁßíÁî®Êà∑ÈîÆÔºå10ÁßíËÆ°Êï∞ÈîÆÔºåÂÆ¢Êà∑Á´ØÂª∫ËÆÆ5-7Áßí‰∏äÊä•</li>
<li>ÂÆπÈîôÊú∫Âà∂ÔºöËÆ°Êï∞ÈîÆÁª≠ÊúüÔºåÁ©∫ÂÄºÂ§ÑÁêÜÔºåÁ≤æÁ°ÆÈÄíÂáè</li>
</ul>
<h3 id="4-Á≥ªÁªü‰ºòÂäø">4. Á≥ªÁªü‰ºòÂäø
</h3><ul>
<li>ÂÆûÊó∂ÊÄßÈ´òÔºöÁßíÁ∫ßÊ£ÄÊµãÁî®Êà∑Á¶ªÁ∫ø</li>
<li>ÊÄßËÉΩ‰ºòÂºÇÔºöÂÆåÂÖ®Âü∫‰∫éRedisÂÜÖÂ≠òÊìç‰Ωú</li>
<li>Êâ©Â±ïÊÄßÂº∫ÔºöÊîØÊåÅÂ§ßÈáèÂπ∂ÂèëÁî®Êà∑</li>
<li>ËµÑÊ∫êËäÇÁ∫¶ÔºöËá™Âä®Ê∏ÖÁêÜ‰∏çÊ¥ªË∑ÉÁî®Êà∑</li>
</ul>
<h3 id="5-ÊΩúÂú®‰ºòÂåñÊñπÂêë">5. ÊΩúÂú®‰ºòÂåñÊñπÂêë
</h3><ul>
<li>ÊâπÈáè‰∏äÊä•„ÄÅÂàÜÂ∏ÉÂºèÈîÅ„ÄÅÂºÇÂ∏∏ÈáçËØï„ÄÅÁõëÊéßÊä•Ë≠¶„ÄÅÂä®ÊÄÅËøáÊúü</li>
</ul>
<hr>
<h2 id="websocketÂèäÂÖ∂Âú®Âú®Á∫ø‰∫∫Êï∞ÁªüËÆ°‰∏≠ÁöÑÂ∫îÁî®">WebSocketÂèäÂÖ∂Âú®Âú®Á∫ø‰∫∫Êï∞ÁªüËÆ°‰∏≠ÁöÑÂ∫îÁî®
</h2><h3 id="1-websocket-Âü∫Á°Ä‰ªãÁªç">1. WebSocket Âü∫Á°Ä‰ªãÁªç
</h3><ul>
<li>WebSocket ÊòØ‰∏ÄÁßçÂÖ®ÂèåÂ∑•ÈÄö‰ø°ÂçèËÆÆÔºåÊîØÊåÅÊúçÂä°Á´Ø‰∏ªÂä®Êé®ÈÄÅÊï∞ÊçÆ„ÄÇ</li>
<li>‰∏é HTTP ËΩÆËØ¢Áõ∏ÊØîÔºåWebSocket ËøûÊé•ÊåÅ‰πÖ„ÄÅÂÆûÊó∂ÊÄßÈ´ò„ÄÅËµÑÊ∫êÊ∂àËÄó‰Ωé„ÄÇ</li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÁâπÊÄß</th>
          <th>WebSocket</th>
          <th>HTTP ËΩÆËØ¢</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ËøûÊé•ÊñπÂºè</td>
          <td>ÊåÅ‰πÖÂåñËøûÊé•</td>
          <td>ÊØèÊ¨°Êñ∞Âª∫ËøûÊé•</td>
      </tr>
      <tr>
          <td>ÈÄö‰ø°ÊñπÂêë</td>
          <td>ÂÖ®ÂèåÂ∑•</td>
          <td>ÂçäÂèåÂ∑•</td>
      </tr>
      <tr>
          <td>ÂÆûÊó∂ÊÄß</td>
          <td>ÊØ´ÁßíÁ∫ß</td>
          <td>ÁßíÁ∫ß</td>
      </tr>
      <tr>
          <td>ÊúçÂä°Âô®Êé®ÈÄÅ</td>
          <td>ÊîØÊåÅ</td>
          <td>‰∏çÊîØÊåÅ</td>
      </tr>
      <tr>
          <td>ËµÑÊ∫êÊ∂àËÄó</td>
          <td>ÂàùÊúüÂºÄÈîÄÂ§ßÔºåÂêéÊúüÂ∞è</td>
          <td>ÊØèÊ¨°ËØ∑Ê±ÇÈÉΩÈ´ò</td>
      </tr>
  </tbody>
</table></div>
<h3 id="2-Âü∫‰∫é-websocket-ÁöÑÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ÂÆûÁé∞">2. Âü∫‰∫é WebSocket ÁöÑÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ÂÆûÁé∞
</h3><h4 id="21-ÊúçÂä°Á´ØÂÆûÁé∞spring-boot">2.1 ÊúçÂä°Á´ØÂÆûÁé∞ÔºàSpring BootÔºâ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@ServerEndpoint</span><span class="p">(</span><span class="s">&#34;/online/{videoId}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VideoOnlineEndpoint</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ConcurrentMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">videoSessions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRedisTemplate</span><span class="p">(</span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">VideoOnlineEndpoint</span><span class="p">.</span><span class="na">redisTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@OnOpen</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onOpen</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="nd">@PathParam</span><span class="p">(</span><span class="s">&#34;videoId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoSessions</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="p">.</span><span class="na">newKeySet</span><span class="p">()).</span><span class="na">add</span><span class="p">(</span><span class="n">session</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">redisKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;video:online:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">videoId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">increment</span><span class="p">(</span><span class="n">redisKey</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">expire</span><span class="p">(</span><span class="n">redisKey</span><span class="p">,</span><span class="w"> </span><span class="n">10</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MINUTES</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">broadcastOnlineCount</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@OnClose</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClose</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="nd">@PathParam</span><span class="p">(</span><span class="s">&#34;videoId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoSessions</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessions</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sessions</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">session</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">redisKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;video:online:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">videoId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">decrement</span><span class="p">(</span><span class="n">redisKey</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">broadcastOnlineCount</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@OnError</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onError</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">error</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">broadcastOnlineCount</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisTemplate</span><span class="p">.</span><span class="na">opsForValue</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;video:online:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;ONLINE_COUNT:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&#34;0&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoSessions</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sessions</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sessions</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">session</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">session</span><span class="p">.</span><span class="na">getBasicRemote</span><span class="p">().</span><span class="na">sendText</span><span class="p">(</span><span class="n">message</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="22-ÂÆ¢Êà∑Á´ØÂÆûÁé∞javascript">2.2 ÂÆ¢Êà∑Á´ØÂÆûÁé∞ÔºàJavaScriptÔºâ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">videoId</span> <span class="o">=</span> <span class="s1">&#39;12345&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="sb">`wss://yourdomain.com/online/</span><span class="si">${</span><span class="nx">videoId</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">socket</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;WebSocketËøûÊé•Â∑≤Âª∫Á´ã&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&#34;ONLINE_COUNT:&#34;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nx">updateOnlineCountDisplay</span><span class="p">(</span><span class="nx">count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">socket</span><span class="p">.</span><span class="nx">onclose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">wasClean</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`ËøûÊé•Ê≠£Â∏∏ÂÖ≥Èó≠Ôºåcode=</span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">code</span><span class="si">}</span><span class="sb"> reason=</span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">reason</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">connectWebSocket</span><span class="p">(),</span> <span class="mi">5000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">socket</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`WebSocketÈîôËØØ: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">updateOnlineCountDisplay</span><span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;online-count&#39;</span><span class="p">).</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="23-ÂøÉË∑≥Êú∫Âà∂">2.3 ÂøÉË∑≥Êú∫Âà∂
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">socket</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&#34;HEARTBEAT&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">30000</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊúçÂä°Á´ØÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@OnMessage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onMessage</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="s">&#34;HEARTBEAT&#34;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">message</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">session</span><span class="p">.</span><span class="na">getAsyncRemote</span><span class="p">().</span><span class="na">sendText</span><span class="p">(</span><span class="s">&#34;HEARTBEAT_ACK&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-ÊñπÊ°à‰ºòÂäøÂàÜÊûê">3. ÊñπÊ°à‰ºòÂäøÂàÜÊûê
</h3><ul>
<li>ÂÆûÊó∂ÊÄßÊûÅ‰Ω≥ÔºåÁ≤æÁ°ÆËÆ°Êï∞ÔºåÊâ©Â±ïÂäüËÉΩÂÆπÊòìÔºåÂáèÂ∞ëÊó†ÊïàËØ∑Ê±Ç</li>
<li>ÊîØÊåÅËá™Âä®ÈáçËøû„ÄÅÂøÉË∑≥Ê£ÄÊµã„ÄÅÈõÜÁæ§Êâ©Â±ï„ÄÅÂçèËÆÆ‰ºòÂåñ„ÄÅËµÑÊ∫êÊéßÂà∂„ÄÅÁõëÊéß‰ΩìÁ≥ª„ÄÅ‰ºòÈõÖÈôçÁ∫ß</li>
</ul>
<h3 id="4-ÈÄÇÁî®Âú∫ÊôØÂª∫ËÆÆ">4. ÈÄÇÁî®Âú∫ÊôØÂª∫ËÆÆ
</h3><ul>
<li>WebSocketÈÄÇÂêàÈ´òÂÆûÊó∂ÊÄß„ÄÅÁ≤æÁ°ÆËÆ°Êï∞„ÄÅ‰∫íÂä®Âú∫ÊôØ</li>
<li>RedisÊñπÊ°àÈÄÇÂêàÁÆÄÂçï„ÄÅÂÖºÂÆπÊÄßÂº∫„ÄÅÂØπÂÆûÊó∂ÊÄßË¶ÅÊ±Ç‰∏çÈ´òÁöÑÂú∫ÊôØ</li>
<li>ÂèØÈááÁî®Ê∑∑ÂêàÊñπÊ°àÔºöWebSocketÂÆ¢Êà∑Á´ØÁî®Êú¨Âú∞ËÆ°Êï∞ÔºåÈùûWebSocketÂÆ¢Êà∑Á´ØÁî®RedisËÆ°Êï∞</li>
</ul>
<hr>
<h2 id="netty‰∏éËßÜÈ¢ëÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ÁöÑÁªìÂêà">Netty‰∏éËßÜÈ¢ëÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ÁöÑÁªìÂêà
</h2><h3 id="1-nettyÂü∫Á°Ä‰ªãÁªç">1. NettyÂü∫Á°Ä‰ªãÁªç
</h3><ul>
<li>NettyÊòØÈ´òÊÄßËÉΩ„ÄÅÂºÇÊ≠•‰∫ã‰ª∂È©±Âä®ÁöÑÁΩëÁªúÂ∫îÁî®Ê°ÜÊû∂ÔºåÈÄÇÂêàÈ´òÂπ∂Âèë„ÄÅ‰ΩéÂª∂ËøüÂú∫ÊôØ„ÄÇ</li>
<li>ÊîØÊåÅTCP/UDP„ÄÅWebSocketÁ≠âÂçèËÆÆÔºåÈÄÇÂêàÂÆûÁé∞ÈïøËøûÊé•„ÄÅÂÆûÊó∂ÈÄö‰ø°„ÄÇ</li>
</ul>
<h3 id="2-‰∏∫‰ªÄ‰πàÁî®nettyÂÆûÁé∞Âú®Á∫ø‰∫∫Êï∞ÁªüËÆ°">2. ‰∏∫‰ªÄ‰πàÁî®NettyÂÆûÁé∞Âú®Á∫ø‰∫∫Êï∞ÁªüËÆ°Ôºü
</h3><ul>
<li>HTTPËΩÆËØ¢ÂºÄÈîÄÂ§ß„ÄÅÂÆûÊó∂ÊÄßÊúâÈôê„ÄÅÊúçÂä°Âô®ÂéãÂäõÂ§ß</li>
<li>NettyÊîØÊåÅÈïøËøûÊé•„ÄÅÊØ´ÁßíÁ∫ßÂÆûÊó∂„ÄÅ‰ΩéÂçèËÆÆÂºÄÈîÄ„ÄÅË∂ÖÈ´òÂπ∂Âèë</li>
</ul>
<h3 id="3-Âü∫‰∫énettyÁöÑÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ËÆæËÆ°">3. Âü∫‰∫éNettyÁöÑÂú®Á∫ø‰∫∫Êï∞ÁªüËÆ°ËÆæËÆ°
</h3><h4 id="31-Á≥ªÁªüÊû∂ÊûÑ">3.1 Á≥ªÁªüÊû∂ÊûÑ
</h4><ul>
<li>ÂÆ¢Êà∑Á´ØApp/Web ‚Üí NettyÊúçÂä°Âô®ÈõÜÁæ§ ‚Üí RedisÈõÜÁæ§</li>
<li>WebSocket/TCPÈïøËøûÊé•ÔºåÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆÂÆûÊó∂‰∏äÊä•</li>
</ul>
<h4 id="32-Ê†∏ÂøÉÁªÑ‰ª∂ÂÆûÁé∞">3.2 Ê†∏ÂøÉÁªÑ‰ª∂ÂÆûÁé∞
</h4><ul>
<li>NettyÊúçÂä°Âô®ÂàùÂßãÂåñ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VideoOnlineServer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">EventLoopGroup</span><span class="w"> </span><span class="n">bossGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NioEventLoopGroup</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">EventLoopGroup</span><span class="w"> </span><span class="n">workerGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NioEventLoopGroup</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ServerBootstrap</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServerBootstrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">b</span><span class="p">.</span><span class="na">group</span><span class="p">(</span><span class="n">bossGroup</span><span class="p">,</span><span class="w"> </span><span class="n">workerGroup</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">.</span><span class="na">channel</span><span class="p">(</span><span class="n">NioServerSocketChannel</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">.</span><span class="na">childHandler</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ChannelInitializer</span><span class="o">&lt;</span><span class="n">SocketChannel</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initChannel</span><span class="p">(</span><span class="n">SocketChannel</span><span class="w"> </span><span class="n">ch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">ChannelPipeline</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch</span><span class="p">.</span><span class="na">pipeline</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">pipeline</span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="s">&#34;idleStateHandler&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IdleStateHandler</span><span class="p">(</span><span class="n">15</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">pipeline</span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="s">&#34;decoder&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OnlineMessageDecoder</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">pipeline</span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="s">&#34;encoder&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OnlineMessageEncoder</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">pipeline</span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="s">&#34;handler&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OnlineMessageHandler</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ChannelFuture</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="na">bind</span><span class="p">(</span><span class="n">port</span><span class="p">).</span><span class="na">sync</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">f</span><span class="p">.</span><span class="na">channel</span><span class="p">().</span><span class="na">closeFuture</span><span class="p">().</span><span class="na">sync</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">workerGroup</span><span class="p">.</span><span class="na">shutdownGracefully</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bossGroup</span><span class="p">.</span><span class="na">shutdownGracefully</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ê∂àÊÅØÂ§ÑÁêÜÂô®ÂÆûÁé∞</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OnlineMessageHandler</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SimpleChannelInboundHandler</span><span class="o">&lt;</span><span class="n">OnlineMessage</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelGroup</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">channelRead0</span><span class="p">(</span><span class="n">ChannelHandlerContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">OnlineMessage</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">getType</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">CONNECT</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">handleConnect</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">getDeviceId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">HEARTBEAT</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">handleHeartbeat</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">getDeviceId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">DISCONNECT</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">handleDisconnect</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">getDeviceId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleConnect</span><span class="p">(</span><span class="n">ChannelHandlerContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">deviceId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ChannelGroup</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoGroups</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultChannelGroup</span><span class="p">(</span><span class="n">GlobalEventExecutor</span><span class="p">.</span><span class="na">INSTANCE</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">group</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="na">channel</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedisUtils</span><span class="p">.</span><span class="na">increment</span><span class="p">(</span><span class="s">&#34;video:online:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">broadcastCount</span><span class="p">(</span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleHeartbeat</span><span class="p">(</span><span class="n">ChannelHandlerContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">deviceId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RedisUtils</span><span class="p">.</span><span class="na">setex</span><span class="p">(</span><span class="s">&#34;device:active:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">videoId</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">deviceId</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;1&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">15</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ctx</span><span class="p">.</span><span class="na">writeAndFlush</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OnlineMessage</span><span class="p">(</span><span class="n">HEARTBEAT_ACK</span><span class="p">,</span><span class="w"> </span><span class="n">getOnlineCount</span><span class="p">(</span><span class="n">videoId</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÆ¢Êà∑Á´ØÊñ≠ËøûÂ§ÑÁêÜ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">channelInactive</span><span class="p">(</span><span class="n">ChannelHandlerContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoGroups</span><span class="p">.</span><span class="na">values</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">group</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="na">channel</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">deviceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getDeviceId</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="na">channel</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getVideoId</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="na">channel</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedisUtils</span><span class="p">.</span><span class="na">decrement</span><span class="p">(</span><span class="s">&#34;video:online:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">broadcastCount</span><span class="p">(</span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">userEventTriggered</span><span class="p">(</span><span class="n">ChannelHandlerContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">evt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">evt</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">IdleStateEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ctx</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-‰∏é‰º†ÁªüÊñπÊ°àÁöÑÂØπÊØî">4. ‰∏é‰º†ÁªüÊñπÊ°àÁöÑÂØπÊØî
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÁâπÊÄß</th>
          <th>NettyÂÆûÁé∞ÊñπÊ°à</th>
          <th>HTTPËΩÆËØ¢+RedisÊñπÊ°à</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÂÆûÊó∂ÊÄß</td>
          <td>ÊØ´ÁßíÁ∫ß</td>
          <td>ÁßíÁ∫ß</td>
      </tr>
      <tr>
          <td>ÂçèËÆÆÂºÄÈîÄ</td>
          <td>‰Ωé</td>
          <td>È´ò</td>
      </tr>
      <tr>
          <td>Âπ∂ÂèëËÉΩÂäõ</td>
          <td>10‰∏á+</td>
          <td>ÂèóÈôê‰∫éHTTPÊúçÂä°Âô®</td>
      </tr>
      <tr>
          <td>ÂÆûÁé∞Â§çÊùÇÂ∫¶</td>
          <td>ËæÉÈ´ò</td>
          <td>ÁÆÄÂçï</td>
      </tr>
  </tbody>
</table></div>
<h3 id="5-ÈÄÇÁî®Âú∫ÊôØÂª∫ËÆÆ">5. ÈÄÇÁî®Âú∫ÊôØÂª∫ËÆÆ
</h3><ul>
<li>NettyÈÄÇÂêàÈ´òÂÆûÊó∂‰∫íÂä®„ÄÅË∂ÖÈ´òÂπ∂Âèë„ÄÅÈïøËøûÊé•Âú∫ÊôØ</li>
<li>HTTPËΩÆËØ¢ÈÄÇÂêàÂÆûÊó∂ÊÄßË¶ÅÊ±Ç‰∏çÈ´ò„ÄÅÂºÄÂèëËµÑÊ∫êÊúâÈôê„ÄÅÂÖºÂÆπÊÄßË¶ÅÊ±ÇÈ´òÁöÑÂú∫ÊôØ</li>
</ul>
<hr>
<h2 id="netty‰∏éwebsocketÁöÑÂÖ≥Á≥ªÂèäÂú®ÂÆûÊó∂ÁªüËÆ°‰∏≠ÁöÑÂ∫îÁî®">Netty‰∏éWebSocketÁöÑÂÖ≥Á≥ªÂèäÂú®ÂÆûÊó∂ÁªüËÆ°‰∏≠ÁöÑÂ∫îÁî®
</h2><h3 id="1-netty‰∏éwebsocketÁöÑÂü∫Á°ÄÂÖ≥Á≥ª">1. Netty‰∏éWebSocketÁöÑÂü∫Á°ÄÂÖ≥Á≥ª
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Áª¥Â∫¶</th>
          <th>Netty</th>
          <th>WebSocket</th>
          <th>‰∫åËÄÖÂÖ≥Á≥ª</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÂÆö‰Ωç</td>
          <td>ÁΩëÁªúÂ∫îÁî®Ê°ÜÊû∂</td>
          <td>ÈÄö‰ø°ÂçèËÆÆ</td>
          <td>NettyÊòØÂÆûÁé∞WebSocketÂçèËÆÆÁöÑÂ∫ïÂ±ÇÊ°ÜÊû∂‰πã‰∏Ä</td>
      </tr>
      <tr>
          <td>Â±ÇÁ∫ß</td>
          <td>‰º†ËæìÂ±Ç/Â∫îÁî®Â±ÇÊ°ÜÊû∂</td>
          <td>Â∫îÁî®Â±ÇÂçèËÆÆ</td>
          <td>NettyÊèê‰æõ‰∫ÜÂØπWebSocketÂçèËÆÆÁöÑÊîØÊåÅ</td>
      </tr>
      <tr>
          <td>ÂäüËÉΩ</td>
          <td>Â§ÑÁêÜTCP/UDPËøûÊé•„ÄÅÁºñËß£Á†Å„ÄÅÂπ∂ÂèëÁ≠â</td>
          <td>Êèê‰æõÂÖ®ÂèåÂ∑•ÈÄö‰ø°ËÉΩÂäõ</td>
          <td>NettyÂ∏ÆÂä©È´òÊïàÂÆûÁé∞WebSocketÁöÑÈÄö‰ø°ËÉΩÂäõ</td>
      </tr>
      <tr>
          <td>ÂÖ∏Âûã‰ΩøÁî®</td>
          <td>ÂèØ‰Ωú‰∏∫WebSocketÊúçÂä°Âô®ÁöÑÂü∫Á°ÄÂÆûÁé∞</td>
          <td>ËøêË°åÂú®NettyÁ≠âÊ°ÜÊû∂‰πã‰∏ä</td>
          <td>ÂºÄÂèëËÄÖÈÄöËøáNetty APIÊûÑÂª∫WebSocketÊúçÂä°</td>
      </tr>
  </tbody>
</table></div>
<h3 id="2-ÊäÄÊúØÊ†àÁªÑÂêàÂéüÁêÜ">2. ÊäÄÊúØÊ†àÁªÑÂêàÂéüÁêÜ
</h3><ul>
<li>WebSocketÂÆ¢Êà∑Á´Ø ‚ÜêWebSocketÂçèËÆÆ‚Üí Netty WebSocketÊúçÂä°Á´Ø ‚ÜêTCP‚Üí Êìç‰ΩúÁ≥ªÁªüÁΩëÁªúÊ†à</li>
<li>NettyÂÜÖÁΩÆWebSocketServerProtocolHandlerÁ≠âÁªÑ‰ª∂ÔºåËá™Âä®Â§ÑÁêÜÊè°Êâã„ÄÅÂ∏ßÁºñËß£Á†Å</li>
<li>NettyÁöÑReactorÁ∫øÁ®ãÊ®°Âûã‰ºòÂåñWebSocketËøûÊé•ÁÆ°ÁêÜ</li>
</ul>
<h3 id="3-Âú®ËßÜÈ¢ëÂú®Á∫øÁªüËÆ°‰∏≠ÁöÑËÅîÂêàÂÆûÁé∞">3. Âú®ËßÜÈ¢ëÂú®Á∫øÁªüËÆ°‰∏≠ÁöÑËÅîÂêàÂÆûÁé∞
</h3><ul>
<li>Âü∫‰∫éNettyÁöÑWebSocketÊúçÂä°Á´ØÁ§∫‰æã</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VideoWebSocketServer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">EventLoopGroup</span><span class="w"> </span><span class="n">bossGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NioEventLoopGroup</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">EventLoopGroup</span><span class="w"> </span><span class="n">workerGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NioEventLoopGroup</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ServerBootstrap</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServerBootstrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">b</span><span class="p">.</span><span class="na">group</span><span class="p">(</span><span class="n">bossGroup</span><span class="p">,</span><span class="w"> </span><span class="n">workerGroup</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">.</span><span class="na">channel</span><span class="p">(</span><span class="n">NioServerSocketChannel</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">.</span><span class="na">childHandler</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ChannelInitializer</span><span class="o">&lt;</span><span class="n">SocketChannel</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initChannel</span><span class="p">(</span><span class="n">SocketChannel</span><span class="w"> </span><span class="n">ch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">ChannelPipeline</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch</span><span class="p">.</span><span class="na">pipeline</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">pipeline</span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HttpServerCodec</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">pipeline</span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HttpObjectAggregator</span><span class="p">(</span><span class="n">65536</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">pipeline</span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">WebSocketServerProtocolHandler</span><span class="p">(</span><span class="s">&#34;/ws&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="n">pipeline</span><span class="p">.</span><span class="na">addLast</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OnlineStatsHandler</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ChannelFuture</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="na">bind</span><span class="p">(</span><span class="n">port</span><span class="p">).</span><span class="na">sync</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">f</span><span class="p">.</span><span class="na">channel</span><span class="p">().</span><span class="na">closeFuture</span><span class="p">().</span><span class="na">sync</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">workerGroup</span><span class="p">.</span><span class="na">shutdownGracefully</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">bossGroup</span><span class="p">.</span><span class="na">shutdownGracefully</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âú®Á∫øÁªüËÆ°‰∏öÂä°Â§ÑÁêÜÂô®</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OnlineStatsHandler</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SimpleChannelInboundHandler</span><span class="o">&lt;</span><span class="n">TextWebSocketFrame</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelGroup</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">channelRead0</span><span class="p">(</span><span class="n">ChannelHandlerContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">TextWebSocketFrame</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">JsonObject</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseJson</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">text</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;videoId&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ChannelGroup</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoGroups</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultChannelGroup</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="na">executor</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&#34;action&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&#34;join&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">group</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="na">channel</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">broadcastCount</span><span class="p">(</span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">.</span><span class="na">size</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&#34;heartbeat&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">redis</span><span class="p">.</span><span class="na">incr</span><span class="p">(</span><span class="s">&#34;active:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">videoId</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">channel</span><span class="p">().</span><span class="na">id</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">channelInactive</span><span class="p">(</span><span class="n">ChannelHandlerContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoGroups</span><span class="p">.</span><span class="na">values</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">group</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="na">channel</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">broadcastCount</span><span class="p">(</span><span class="n">getVideoId</span><span class="p">(</span><span class="n">ctx</span><span class="p">),</span><span class="w"> </span><span class="n">group</span><span class="p">.</span><span class="na">size</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-ÂÖ∏ÂûãÊ∂àÊÅØÊµÅÁ®ã">4. ÂÖ∏ÂûãÊ∂àÊÅØÊµÅÁ®ã
</h3><ul>
<li>ËøûÊé•Âª∫Á´ãÔºöÂÆ¢Êà∑Á´Ø ‚Üí HTTP UpgradeËØ∑Ê±Ç ‚Üí Netty(ÂÆåÊàêWebSocketÊè°Êâã) ‚Üí Âª∫Á´ãÊåÅ‰πÖËøûÊé•</li>
<li>ÂøÉË∑≥Áª¥ÊåÅÔºöÂÆ¢Êà∑Á´ØÂÆöÊúüÂèëÈÄÅÂøÉË∑≥ÔºåÊúçÂä°Á´ØÂìçÂ∫îack</li>
<li>‰∫∫Êï∞Êé®ÈÄÅÔºöÊúçÂä°Á´Ø‰∏ªÂä®Êé®ÈÄÅÊúÄÊñ∞Âú®Á∫ø‰∫∫Êï∞</li>
</ul>
<h3 id="5-‰ºòÂåñÁÇπ">5. ‰ºòÂåñÁÇπ
</h3><ul>
<li>ËøûÊé•ÁÆ°ÁêÜÔºöChannelGroupÁÆ°ÁêÜÊàøÈó¥ÔºåIdleStateHandlerÊ£ÄÊµãÊ≠ªËøûÊé•</li>
<li>Â∫èÂàóÂåñ‰ºòÂåñÔºöÂèØÁî®‰∫åËøõÂà∂ÂçèËÆÆ‰ª£ÊõøJSON</li>
<li>ÈõÜÁæ§Êâ©Â±ïÔºöRedis Pub/SubÂêåÊ≠•ÂêÑËäÇÁÇπÁä∂ÊÄÅ</li>
<li>ÁõëÊéßÊåáÊ†áÔºöË∑üË∏™ÊØè‰∏™ËßÜÈ¢ëÈ¢ëÈÅìÁöÑËøûÊé•Êï∞„ÄÅÊ∂àÊÅØÂêûÂêêÈáèÂíåÂª∂Ëøü</li>
</ul>
<hr>
<h2 id="ËßÜÈ¢ëÂà†Èô§ÊñπÊ≥ïËØ¶Ëß£">ËßÜÈ¢ëÂà†Èô§ÊñπÊ≥ïËØ¶Ëß£
</h2><h3 id="1-ÊñπÊ≥ïÊï¥‰ΩìÂäüËÉΩ">1. ÊñπÊ≥ïÊï¥‰ΩìÂäüËÉΩ
</h3><p>ËØ• deleteVideo ÊñπÊ≥ïÊòØ‰∏Ä‰∏™ÁªºÂêàÊÄßÁöÑËßÜÈ¢ëÂà†Èô§Êìç‰ΩúÔºå‰∏ªË¶ÅÂÆåÊàê‰ª•‰∏ãÂäüËÉΩÔºö</p>
<ul>
<li>ÊùÉÈôêÈ™åËØÅÔºöÊ£ÄÊü•ËßÜÈ¢ëÊòØÂê¶Â≠òÂú®ÂèäÁî®Êà∑ÊòØÂê¶ÊúâÊùÉÈôêÂà†Èô§</li>
<li>Ê†∏ÂøÉÊï∞ÊçÆÂà†Èô§ÔºöÂà†Èô§ËßÜÈ¢ë‰∏ª‰ø°ÊÅØ„ÄÅÊäïÁ®ø‰ø°ÊÅØ</li>
<li>ÁªèÊµéÁ≥ªÁªüË∞ÉÊï¥ÔºöÊâ£Èô§Áî®Êà∑ÂèëÂ∏ÉËßÜÈ¢ëËé∑ÂæóÁöÑÁ°¨Â∏Å</li>
<li>ÊêúÁ¥¢Á¥¢ÂºïÊ∏ÖÁêÜÔºö‰ªé Elasticsearch ‰∏≠ÁßªÈô§ÊñáÊ°£</li>
<li>ÂºÇÊ≠•Ê∏ÖÁêÜÂÖ≥ËÅîÊï∞ÊçÆÔºö‰ΩøÁî®Á∫øÁ®ãÊ±†ÂºÇÊ≠•Âà†Èô§ÂàÜPËßÜÈ¢ë„ÄÅÂºπÂπï„ÄÅËØÑËÆ∫Á≠âÂÖ≥ËÅîÊï∞ÊçÆÂèäÁâ©ÁêÜÊñá‰ª∂</li>
</ul>
<h3 id="2-ÂºÇÊ≠•Á∫øÁ®ãÊ±†ÈÉ®ÂàÜËØ¶Ëß£">2. ÂºÇÊ≠•Á∫øÁ®ãÊ±†ÈÉ®ÂàÜËØ¶Ëß£
</h3><h4 id="21-Á∫øÁ®ãÊ±†ÂàùÂßãÂåñ">2.1 Á∫øÁ®ãÊ±†ÂàùÂßãÂåñ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executorService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="n">10</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âõ∫ÂÆöÂ§ßÂ∞èÁ∫øÁ®ãÊ±†Ôºà10‰∏™Á∫øÁ®ãÔºâ</li>
<li>ÈÄÇÂêàÂ∑≤Áü•Âπ∂ÂèëÈáèÁöÑÁ®≥ÂÆöË¥üËΩΩÂú∫ÊôØ</li>
<li>Ë∂ÖÂá∫Á∫øÁ®ãÊï∞ÁöÑ‰ªªÂä°‰ºöÂú®ÈòüÂàó‰∏≠Á≠âÂæÖ</li>
<li>ÊΩúÂú®ÈóÆÈ¢òÔºöÊó†ÁïåÈòüÂàóÂèØËÉΩÂØºËá¥ OOMÔºåÈùôÊÄÅÂèòÈáèÁîüÂëΩÂë®ÊúüÈïøÂèØËÉΩÁ∫øÁ®ãÊ≥ÑÊºè</li>
</ul>
<h4 id="22-ÂºÇÊ≠•‰ªªÂä°ÊâßË°åÈÄªËæë">2.2 ÂºÇÊ≠•‰ªªÂä°ÊâßË°åÈÄªËæë
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">executorService</span><span class="p">.</span><span class="na">execute</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÂºÇÊ≠•‰ªªÂä°‰ª£Á†ÅÂùó</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩøÁî® Lambda Â∞ÅË£Ö Runnable ‰ªªÂä°</li>
<li>execute() ÊñπÊ≥ïÊèê‰∫§‰ªªÂä°Âà∞Á∫øÁ®ãÊ±†</li>
<li>ÂºÇÊ≠•‰ªªÂä°Âú®Êñ∞Á∫øÁ®ã‰∏≠ÊâßË°åÔºå‰∏çÂèó‰∏ªÊñπÊ≥ï @Transactional ÂΩ±Âìç</li>
<li>Ëã•ÂºÇÊ≠•Êìç‰ΩúÈúÄË¶Å‰∫ãÂä°ÔºåÈúÄÂú®‰ªªÂä°ÂÜÖÈÉ®Ê∑ªÂä†‰∫ãÂä°Ê≥®Ëß£</li>
</ul>
<h4 id="23-ÂºÇÊ≠•‰ªªÂä°ÂÖ∑‰ΩìÊìç‰Ωú">2.3 ÂºÇÊ≠•‰ªªÂä°ÂÖ∑‰ΩìÊìç‰Ωú
</h4><ul>
<li>Êü•ËØ¢ÂíåÂà†Èô§ÂàÜPËßÜÈ¢ë</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">VideoInfoFileQuery</span><span class="w"> </span><span class="n">videoInfoFileQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFileQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoFileQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFile</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoInfoFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoFileMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="n">videoInfoFileQuery</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoFileMapper</span><span class="p">.</span><span class="na">deleteByParam</span><span class="p">(</span><span class="n">videoInfoFileQuery</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âà†Èô§ÂÖ≥ËÅîÊäïÁ®ø‰ø°ÊÅØ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">VideoInfoFilePostQuery</span><span class="w"> </span><span class="n">videoInfoFilePostQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFilePostQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoFilePostQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoInfoFilePostMapper</span><span class="p">.</span><span class="na">deleteByParam</span><span class="p">(</span><span class="n">videoInfoFilePostQuery</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âà†Èô§ÂºπÂπïÊï∞ÊçÆ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">VideoDanmuQuery</span><span class="w"> </span><span class="n">videoDanmuQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoDanmuQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoDanmuQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoDanmuMapper</span><span class="p">.</span><span class="na">deleteByParam</span><span class="p">(</span><span class="n">videoDanmuQuery</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âà†Èô§ËØÑËÆ∫Êï∞ÊçÆ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">VideoCommentQuery</span><span class="w"> </span><span class="n">videoCommentQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoCommentQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoCommentQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoCommentMapper</span><span class="p">.</span><span class="na">deleteByParam</span><span class="p">(</span><span class="n">videoCommentQuery</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Áâ©ÁêÜÊñá‰ª∂Âà†Èô§</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VideoInfoFile</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">videoInfoFileList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">FileUtils</span><span class="p">.</span><span class="na">deleteDirectory</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">appConfig</span><span class="p">.</span><span class="na">getProjectFolder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Âà†Èô§Êñá‰ª∂Â§±Ë¥•ÔºåÊñá‰ª∂Ë∑ØÂæÑ:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-ÂºÇÊ≠•ËÆæËÆ°‰ºòÁº∫ÁÇπÂàÜÊûê">3. ÂºÇÊ≠•ËÆæËÆ°‰ºòÁº∫ÁÇπÂàÜÊûê
</h3><ul>
<li>‰ºòÁÇπÔºö
<ul>
<li>ÂìçÂ∫îÈÄüÂ∫¶Âø´Ôºå‰∏ªÁ∫øÁ®ãÂø´ÈÄüËøîÂõû</li>
<li>IOÂØÜÈõÜÂûãÊìç‰Ωú‰∏çÂΩ±ÂìçÊ†∏ÂøÉ‰∏öÂä°</li>
<li>ÈîôËØØÈöîÁ¶ªÔºåÊñá‰ª∂Âà†Èô§Â§±Ë¥•‰∏çÂΩ±Âìç‰∏ªÊµÅÁ®ã</li>
</ul>
</li>
<li>Áº∫ÁÇπÂèäÈ£éÈô©Ôºö
<ul>
<li>‰∫ãÂä°‰∏ç‰∏ÄËá¥Ôºö‰∏ª‰∫ãÂä°Êèê‰∫§ÂêéÂºÇÊ≠•‰ªªÂä°ÊâçÊâßË°åÔºåÂ§±Ë¥•ÂèØËÉΩÂØºËá¥Á≥ªÁªü‰∏ç‰∏ÄËá¥</li>
<li>ÈîôËØØÂ§ÑÁêÜÁº∫Â§±ÔºöÂΩìÂâçÂÆûÁé∞Ê≤°ÊúâËÆ∞ÂΩï‰ªªÂä°ÊâßË°åÁªìÊûúÔºåÊó†Ê≥ïËøΩË∏™ÂºÇÊ≠•Êìç‰ΩúÊòØÂê¶ÊàêÂäü</li>
<li>ËµÑÊ∫êÁ´û‰∫âÔºöÂõ∫ÂÆöÁ∫øÁ®ãÊï∞ÂèØËÉΩÊàê‰∏∫Áì∂È¢àÔºåÊñá‰ª∂Âà†Èô§Êìç‰ΩúÂèØËÉΩÈòªÂ°ûÂÖ∂‰ªñ‰ªªÂä°</li>
</ul>
</li>
</ul>
<h3 id="4-ÊîπËøõÂª∫ËÆÆ">4. ÊîπËøõÂª∫ËÆÆ
</h3><ul>
<li>Â¢ûÂº∫ÂûãÁ∫øÁ®ãÊ±†ÈÖçÁΩÆ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executorService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">5</span><span class="p">,</span><span class="w"> </span><span class="c1">// Ê†∏ÂøÉÁ∫øÁ®ãÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">20</span><span class="p">,</span><span class="w"> </span><span class="c1">// ÊúÄÂ§ßÁ∫øÁ®ãÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">60</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">,</span><span class="w"> </span><span class="c1">// Á©∫Èó≤Á∫øÁ®ãÂ≠òÊ¥ªÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayBlockingQueue</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">1000</span><span class="p">),</span><span class="w"> </span><span class="c1">// ÊúâÁïåÈòüÂàó</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">CallerRunsPolicy</span><span class="p">()</span><span class="w"> </span><span class="c1">// ÊãíÁªùÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ê∑ªÂä†‰ªªÂä°ÁªìÊûúÂ§ÑÁêÜ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Future</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">executorService</span><span class="p">.</span><span class="na">submit</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ‰ªªÂä°‰ª£Á†Å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">future</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">10</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span><span class="w"> </span><span class="c1">// Â∏¶Ë∂ÖÊó∂ÁöÑÁ≠âÂæÖ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰∫ãÂä°Ë°•ÂÅøÊú∫Âà∂</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@TransactionalEventListener</span><span class="p">(</span><span class="n">phase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AFTER_COMMIT</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleAfterCommit</span><span class="p">(</span><span class="n">VideoDeleteEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">asyncCleanService</span><span class="p">.</span><span class="na">cleanVideoResources</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÆåÂñÑÊó•ÂøóÁõëÊéß</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">executorService</span><span class="p">.</span><span class="na">execute</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MDC</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;traceId&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ‰ªªÂä°‰ª£Á†Å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;ËßÜÈ¢ëËµÑÊ∫êÊ∏ÖÁêÜÂÆåÊàê: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;ËßÜÈ¢ëËµÑÊ∫êÊ∏ÖÁêÜÂ§±Ë¥•: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ÂèëÈÄÅÂëäË≠¶ÊàñËÆ∞ÂΩïÂ§±Ë¥•Áä∂ÊÄÅ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">MDC</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-ÊÄªÁªì-2">5. ÊÄªÁªì
</h3><ul>
<li>ËØ•ÊñπÊ≥ïÈÄöËøáÁ∫øÁ®ãÊ±†ÂÆûÁé∞‰∫ÜÊ†∏ÂøÉÊï∞ÊçÆÂêåÊ≠•Âà†Èô§ÂíåËµÑÊ∫êÂºÇÊ≠•Ê∏ÖÁêÜÔºåÊèêÂçá‰∫ÜÂìçÂ∫îÈÄüÂ∫¶ÂíåÁ≥ªÁªüÂèØÊâ©Â±ïÊÄß„ÄÇ</li>
<li>ÂÖ≥ÈîÆÊîπËøõÊñπÂêëÔºöÁ∫øÁ®ãÊ±†ÂèÇÊï∞‰ºòÂåñ„ÄÅÂÆåÂñÑÈîôËØØÂ§ÑÁêÜÂíåÁä∂ÊÄÅË∑üË∏™„ÄÅÂºïÂÖ•‰∫ãÂä°‰∫ã‰ª∂Êú∫Âà∂„ÄÅÂ¢ûÂä†ÁõëÊéßÂíåÂëäË≠¶ËÉΩÂäõ„ÄÇ</li>
<li>ÈÄÇÂêàÂØπÂÆûÊó∂ÊÄßË¶ÅÊ±ÇÈ´ò‰ΩÜÂÖÅËÆ∏ÊúÄÁªà‰∏ÄËá¥ÊÄßÁöÑÂú∫ÊôØÔºåÊòØÂÖ∏ÂûãÁöÑ&quot;Âø´ÈÄüÂìçÂ∫î+ÂêéÂè∞Ê∏ÖÁêÜ&quot;Êû∂ÊûÑÊ®°Âºè„ÄÇ</li>
</ul>
<hr>
<h2 id="ÂºÇÊ≠•Á∫øÁ®ãÊ±†Âèä-executorserviceexecute-ËØ¶Ëß£">ÂºÇÊ≠•Á∫øÁ®ãÊ±†Âèä executorService.execute ËØ¶Ëß£
</h2><h3 id="‰∏ÄÂºÇÊ≠•Á∫øÁ®ãÊ±†Âü∫Á°Ä">‰∏Ä„ÄÅÂºÇÊ≠•Á∫øÁ®ãÊ±†Âü∫Á°Ä
</h3><h4 id="1-Á∫øÁ®ãÊ±†Ê†∏ÂøÉÊ¶ÇÂøµ">1. Á∫øÁ®ãÊ±†Ê†∏ÂøÉÊ¶ÇÂøµ
</h4><ul>
<li>Á∫øÁ®ãÊ±†ÊòØ‰∏ÄÁßçÁ∫øÁ®ãÁÆ°ÁêÜÊú∫Âà∂ÔºåÁª¥Êä§Â§ö‰∏™Á∫øÁ®ãÔºåÈÅøÂÖçÈ¢ëÁπÅÂàõÂª∫ÂíåÈîÄÊØÅÁ∫øÁ®ãÂ∏¶Êù•ÁöÑÊÄßËÉΩÂºÄÈîÄ„ÄÇ</li>
<li>Java‰∏≠‰∏ªË¶ÅÈÄöËøá ExecutorService ÂèäÂÖ∂ÂÆûÁé∞Á±ªÊù•‰ΩøÁî®Á∫øÁ®ãÊ±†„ÄÇ</li>
</ul>
<h4 id="2-Á∫øÁ®ãÊ±†ÂÖ≥ÈîÆÂèÇÊï∞">2. Á∫øÁ®ãÊ±†ÂÖ≥ÈîÆÂèÇÊï∞
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÂèÇÊï∞</th>
          <th>ËØ¥Êòé</th>
          <th>Á§∫‰æãÂÄº</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>corePoolSize</td>
          <td>Ê†∏ÂøÉÁ∫øÁ®ãÊï∞</td>
          <td>10</td>
      </tr>
      <tr>
          <td>maximumPoolSize</td>
          <td>ÊúÄÂ§ßÁ∫øÁ®ãÊï∞</td>
          <td>50</td>
      </tr>
      <tr>
          <td>keepAliveTime</td>
          <td>Á©∫Èó≤Á∫øÁ®ãÂ≠òÊ¥ªÊó∂Èó¥</td>
          <td>60Áßí</td>
      </tr>
      <tr>
          <td>workQueue</td>
          <td>‰ªªÂä°ÈòüÂàó</td>
          <td>new LinkedBlockingQueue(1000)</td>
      </tr>
      <tr>
          <td>threadFactory</td>
          <td>Á∫øÁ®ãÂàõÂª∫Â∑•ÂéÇ</td>
          <td>Executors.defaultThreadFactory()</td>
      </tr>
      <tr>
          <td>handler</td>
          <td>ÊãíÁªùÁ≠ñÁï•</td>
          <td>AbortPolicy</td>
      </tr>
  </tbody>
</table></div>
<h4 id="3-Á∫øÁ®ãÊ±†Â∑•‰ΩúÊµÅÁ®ã">3. Á∫øÁ®ãÊ±†Â∑•‰ΩúÊµÅÁ®ã
</h4><ul>
<li>Êèê‰∫§‰ªªÂä°Êó∂Ôºå‰ºòÂÖà‰ΩøÁî®Ê†∏ÂøÉÁ∫øÁ®ãÂ§ÑÁêÜ</li>
<li>Ê†∏ÂøÉÁ∫øÁ®ãÂÖ®ÂøôÊó∂Ôºå‰ªªÂä°ËøõÂÖ•ÈòüÂàó</li>
<li>ÈòüÂàóÊª°Êó∂ÔºåÂàõÂª∫Êñ∞Á∫øÁ®ãÔºà‰∏çË∂ÖËøáÊúÄÂ§ßÁ∫øÁ®ãÊï∞Ôºâ</li>
<li>Á∫øÁ®ãÊï∞ËææÊúÄÂ§ßÂÄº‰∏îÈòüÂàóÊª°Êó∂ÔºåËß¶ÂèëÊãíÁªùÁ≠ñÁï•</li>
</ul>
<h3 id="‰∫åexecutorserviceexecute-ÊñπÊ≥ïËØ¶Ëß£">‰∫å„ÄÅexecutorService.execute ÊñπÊ≥ïËØ¶Ëß£
</h3><h4 id="1-ÊñπÊ≥ïÁ≠æÂêç-1">1. ÊñπÊ≥ïÁ≠æÂêç
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">void</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">Runnable</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-Ê†∏ÂøÉÁâπÁÇπ">2. Ê†∏ÂøÉÁâπÁÇπ
</h4><ul>
<li>ÂºÇÊ≠•ÊâßË°åÔºåÁ´ãÂç≥ËøîÂõûÔºå‰∏çÈòªÂ°ûË∞ÉÁî®Á∫øÁ®ã</li>
<li>Êó†ËøîÂõûÂÄºÔºåÈÄÇÁî®‰∫é‰∏çÈúÄË¶ÅËé∑ÂèñÁªìÊûúÁöÑÂú∫ÊôØ</li>
<li>ÂºÇÂ∏∏Â§ÑÁêÜÔºö‰ªªÂä°ÂºÇÂ∏∏‰ºö‰º†ÈÄíÁªôÊú™ÊçïËé∑ÂºÇÂ∏∏Â§ÑÁêÜÂô®</li>
</ul>
<h4 id="3-ÊâßË°åÊµÅÁ®ã‰∏éÁ§∫‰æã">3. ÊâßË°åÊµÅÁ®ã‰∏éÁ§∫‰æã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">executorService</span><span class="p">.</span><span class="na">execute</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. Êü•ËØ¢ÂíåÂà†Èô§ÂàÜPËßÜÈ¢ë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">VideoInfoFileQuery</span><span class="w"> </span><span class="n">videoInfoFileQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoFileQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoFileQuery</span><span class="p">.</span><span class="na">setVideoId</span><span class="p">(</span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfoFile</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoInfoFileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">videoInfoFileMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="n">videoInfoFileQuery</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoInfoFileMapper</span><span class="p">.</span><span class="na">deleteByParam</span><span class="p">(</span><span class="n">videoInfoFileQuery</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. Âà†Èô§ÂÖ∂‰ªñÂÖ≥ËÅîÊï∞ÊçÆ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3. Âà†Èô§Áâ©ÁêÜÊñá‰ª∂</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VideoInfoFile</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">videoInfoFileList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">FileUtils</span><span class="p">.</span><span class="na">deleteDirectory</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">appConfig</span><span class="p">.</span><span class="na">getProjectFolder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Âà†Èô§Êñá‰ª∂Â§±Ë¥•ÔºåÊñá‰ª∂Ë∑ØÂæÑ:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getFilePath</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="4-execute-‰∏é-submit-Âå∫Âà´">4. execute ‰∏é submit Âå∫Âà´
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÂØπÊØîÈ°π</th>
          <th>execute</th>
          <th>submit</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ËøîÂõûÂÄº</td>
          <td>Êó†</td>
          <td>FutureÂØπË±°</td>
      </tr>
      <tr>
          <td>ÂºÇÂ∏∏Â§ÑÁêÜ</td>
          <td>Áõ¥Êé•ÊäõÂá∫</td>
          <td>Â∞ÅË£ÖÂú®Future‰∏≠</td>
      </tr>
      <tr>
          <td>ÈÄÇÁî®Âú∫ÊôØ</td>
          <td>ÁÆÄÂçïÂºÇÊ≠•‰ªªÂä°</td>
          <td>ÈúÄË¶ÅËé∑ÂèñÁªìÊûúÁöÑ‰ªªÂä°</td>
      </tr>
  </tbody>
</table></div>
<ul>
<li>ÂΩìÂâçÂú∫ÊôØÈÄÇÂêà executeÔºö‰∏çÈúÄË¶ÅËé∑ÂèñÊ∏ÖÁêÜÊìç‰ΩúÁöÑÁªìÊûúÔºåÁÆÄÂçïÊó•ÂøóËÆ∞ÂΩïÂ∑≤Ë∂≥Â§ü</li>
</ul>
<h3 id="‰∏âÁ∫øÁ®ãÊ±†ÈÖçÁΩÆ‰ºòÂåñÂª∫ËÆÆ">‰∏â„ÄÅÁ∫øÁ®ãÊ±†ÈÖçÁΩÆ‰ºòÂåñÂª∫ËÆÆ
</h3><h4 id="1-ÂΩìÂâçÂÆûÁé∞ÁöÑÊΩúÂú®ÈóÆÈ¢ò">1. ÂΩìÂâçÂÆûÁé∞ÁöÑÊΩúÂú®ÈóÆÈ¢ò
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executorService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="n">10</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ΩøÁî®Êó†ÁïåÈòüÂàóÔºåÂèØËÉΩÂØºËá¥ OOM</li>
<li>Âõ∫ÂÆöÁ∫øÁ®ãÊï∞Êó†Ê≥ïÂ∫îÂØπÁ™ÅÂèëÊµÅÈáè</li>
<li>Áº∫Â∞ëÂêàÁêÜÁöÑÊãíÁªùÁ≠ñÁï•</li>
</ul>
<h4 id="2-Êé®ËçêÊîπËøõÊñπÊ°à">2. Êé®ËçêÊîπËøõÊñπÊ°à
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">executorService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">5</span><span class="p">,</span><span class="w">                              </span><span class="c1">// Ê†∏ÂøÉÁ∫øÁ®ãÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">20</span><span class="p">,</span><span class="w">                             </span><span class="c1">// ÊúÄÂ§ßÁ∫øÁ®ãÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">60</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">,</span><span class="w">           </span><span class="c1">// Á©∫Èó≤Á∫øÁ®ãÂ≠òÊ¥ªÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayBlockingQueue</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">1000</span><span class="p">),</span><span class="w"> </span><span class="c1">// ÊúâÁïåÈòüÂàó</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">CallerRunsPolicy</span><span class="p">()</span><span class="w"> </span><span class="c1">// ÊãíÁªùÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂêÑÂèÇÊï∞ËØ¥ÊòéÔºö
<ul>
<li>corePoolSize=5Ôºö‰øùÊåÅ5‰∏™Â∏∏È©ªÁ∫øÁ®ã</li>
<li>maxPoolSize=20ÔºöÁ™ÅÂèëÊµÅÈáèÊó∂ÂèØÊâ©Â±ïÂà∞20Á∫øÁ®ã</li>
<li>keepAliveTime=60sÔºöÁ©∫Èó≤Á∫øÁ®ã60ÁßíÂêéÂõûÊî∂</li>
<li>ÊúâÁïåÈòüÂàó(1000)ÔºöÈò≤Ê≠¢ËµÑÊ∫êËÄóÂ∞Ω</li>
<li>CallerRunsPolicyÔºöÈòüÂàóÊª°Êó∂Áî±Ë∞ÉÁî®Á∫øÁ®ãÊâßË°å‰ªªÂä°</li>
</ul>
</li>
</ul>
<h3 id="ÂõõÂºÇÂ∏∏Â§ÑÁêÜÊú∫Âà∂">Âõõ„ÄÅÂºÇÂ∏∏Â§ÑÁêÜÊú∫Âà∂
</h3><h4 id="1-ÂΩìÂâçÂÆûÁé∞ÁöÑÂºÇÂ∏∏Â§ÑÁêÜ">1. ÂΩìÂâçÂÆûÁé∞ÁöÑÂºÇÂ∏∏Â§ÑÁêÜ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FileUtils</span><span class="p">.</span><span class="na">deleteDirectory</span><span class="p">(...);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Âà†Èô§Êñá‰ª∂Â§±Ë¥•...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ªÖËÆ∞ÂΩïÊó•ÂøóÔºåÊó†ÊÅ¢Â§çÊú∫Âà∂</li>
<li>ÂºÇÂ∏∏‰∏ç‰ºö‰º†Êí≠Âà∞‰∏ªÁ∫øÁ®ã</li>
</ul>
<h4 id="2-Â¢ûÂº∫ÂûãÂºÇÂ∏∏Â§ÑÁêÜÊñπÊ°à">2. Â¢ûÂº∫ÂûãÂºÇÂ∏∏Â§ÑÁêÜÊñπÊ°à
</h4><ul>
<li>ÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜÂô®</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">executorService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ...ÂÖ∂‰ªñÂèÇÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">AbortPolicy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">rejectedExecution</span><span class="p">(</span><span class="n">Runnable</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&#34;Task rejected: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">super</span><span class="p">.</span><span class="na">rejectedExecution</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Thread</span><span class="p">.</span><span class="na">setDefaultUncaughtExceptionHandler</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Uncaught exception in thread: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â∞ÅË£Ö‰ªªÂä°</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SafeRunnable</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="n">task</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SafeRunnable</span><span class="p">(</span><span class="n">Runnable</span><span class="w"> </span><span class="n">task</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">task</span><span class="p">.</span><span class="na">run</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Task execution failed&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// ÂèØÊ∑ªÂä†ÈáçËØïÊàñË°•ÂÅøÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ‰ΩøÁî®ÊñπÂºè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">executorService</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SafeRunnable</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ‰ªªÂä°‰ª£Á†Å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰∫îÊÄßËÉΩÁõëÊéßÂª∫ËÆÆ">‰∫î„ÄÅÊÄßËÉΩÁõëÊéßÂª∫ËÆÆ
</h3><h4 id="1-Ê∑ªÂä†Á∫øÁ®ãÊ±†ÁõëÊéß">1. Ê∑ªÂä†Á∫øÁ®ãÊ±†ÁõëÊéß
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ScheduledExecutorService</span><span class="w"> </span><span class="n">monitor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newSingleThreadScheduledExecutor</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">monitor</span><span class="p">.</span><span class="na">scheduleAtFixedRate</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ThreadPoolExecutor</span><span class="w"> </span><span class="n">tpe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ThreadPoolExecutor</span><span class="p">)</span><span class="w"> </span><span class="n">executorService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;Pool stats: active={}, queue={}/{}, completed={}&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">tpe</span><span class="p">.</span><span class="na">getActiveCount</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">tpe</span><span class="p">.</span><span class="na">getQueue</span><span class="p">().</span><span class="na">size</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">tpe</span><span class="p">.</span><span class="na">getQueue</span><span class="p">().</span><span class="na">remainingCapacity</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">tpe</span><span class="p">.</span><span class="na">getCompletedTaskCount</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">},</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MINUTES</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÖ≥ÈîÆÁõëÊéßÊåáÊ†áÔºö
<ul>
<li>activeCountÔºöÊ¥ªÂä®Á∫øÁ®ãÊï∞</li>
<li>queueSizeÔºöÈòüÂàóÂ§ßÂ∞è</li>
<li>completedTaskCountÔºöÂ∑≤ÂÆåÊàê‰ªªÂä°</li>
<li>rejectedCountÔºöË¢´ÊãíÁªù‰ªªÂä°</li>
</ul>
</li>
</ul>
<h3 id="ÂÖ≠ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÂàÜÊûê">ÂÖ≠„ÄÅÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÂàÜÊûê
</h3><ul>
<li>ÂΩìÂâçËßÜÈ¢ëÂà†Èô§Âú∫ÊôØÁâπÁÇπÔºö
<ul>
<li>ËÄóÊó∂Êìç‰ΩúÔºåÂÖÅËÆ∏Âª∂ËøüÔºåÊúÄÁªà‰∏ÄËá¥ÊÄßÂç≥ÂèØ</li>
<li>ÈùûÂÖ≥ÈîÆË∑ØÂæÑÔºå‰∏ªÁ∫øÁ®ãÂø´ÈÄüËøîÂõû</li>
<li>ÂèØËÉΩÂ§±Ë¥•ÔºåÈúÄÊó•ÂøóËÆ∞ÂΩï</li>
</ul>
</li>
<li>ÈÄÇÂêà‰ΩøÁî®Á∫øÁ®ãÊ±†Ôºö
<ul>
<li>Ëß£ËÄ¶‰∏ª‰∏öÂä°‰∏éÊ∏ÖÁêÜÊìç‰ΩúÔºåÊèêÂçáÂìçÂ∫îÈÄüÂ∫¶</li>
<li>ÈÄöËøáÁ∫øÁ®ãÊ±†ÈôêÂà∂ËµÑÊ∫ê‰ΩøÁî®ÔºåÊñπ‰æøÊâ©Â±ïÈáçËØïÊú∫Âà∂</li>
</ul>
</li>
<li>ÊΩúÂú®È£éÈô©ÂèäÂ∫îÂØπÔºö
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>È£éÈô©</th>
          <th>Â∫îÂØπÊé™ÊñΩ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Á∫øÁ®ãÊ≥ÑÊºè</td>
          <td>ÊúâÁïåÈòüÂàóÔºåÂêàÁêÜÈÖçÁΩÆÂ≠òÊ¥ªÊó∂Èó¥</td>
      </tr>
      <tr>
          <td>‰ªªÂä°‰∏¢Â§±</td>
          <td>Ê∑ªÂä†ÊåÅ‰πÖÂåñÈòüÂàóÊàñ‰ªªÂä°ËÆ∞ÂΩï</td>
      </tr>
      <tr>
          <td>ËµÑÊ∫êÁ´û‰∫â</td>
          <td>ÁõëÊéßÂíåÂä®ÊÄÅË∞ÉÊï¥Á∫øÁ®ãÊ±†ÂèÇÊï∞</td>
      </tr>
      <tr>
          <td>ÂºÇÂ∏∏‰º†Êí≠</td>
          <td>ÂÆåÂñÑ‰ªªÂä°Á∫ßÂà´ÁöÑÂºÇÂ∏∏Â§ÑÁêÜ</td>
      </tr>
  </tbody>
</table></div>
</li>
</ul>
<h3 id="‰∏ÉÊÄªÁªì">‰∏É„ÄÅÊÄªÁªì
</h3><ul>
<li>ÈÄâÊã©ÂêàÈÄÇÁöÑÁ∫øÁ®ãÊ±†Á±ªÂûãÔºàfixed/cached/customÔºâ</li>
<li>‰ΩøÁî®ÊúâÁïåÈòüÂàóÔºåÈò≤Ê≠¢ËµÑÊ∫êËÄóÂ∞Ω</li>
<li>ÈÖçÁΩÆÂêàÁêÜÁöÑÊãíÁªùÁ≠ñÁï•ÔºàÂ¶Ç CallerRunsPolicyÔºâ</li>
<li>ÂÆåÂñÑÂºÇÂ∏∏Â§ÑÁêÜÔºà‰ªªÂä°Á∫ßÂà´ÂíåÂÖ®Â±ÄÁ∫ßÂà´Ôºâ</li>
<li>Ê∑ªÂä†ÁõëÊéßÔºåÂÆûÊó∂‰∫ÜËß£Á∫øÁ®ãÊ±†Áä∂ÊÄÅ</li>
<li>ÂÖ≥ÈîÆ‰ªªÂä°Âª∫ËÆÆ‰ΩøÁî®Â∏¶ËøîÂõûÂÄºÁöÑ submit</li>
<li>Âú®ËßÜÈ¢ëÂà†Èô§Âú∫ÊôØ‰∏≠ÔºåÁ∫øÁ®ãÊ±†ÂºÇÊ≠•Â§ÑÁêÜÊ∏ÖÁêÜ‰ªªÂä°ÊòØ‰∏ÄÁßçÂêàÁêÜËÆæËÆ°Ôºå‰ΩÜÈúÄÊ≥®ÊÑèÂèÇÊï∞ÈÖçÁΩÆ„ÄÅÂºÇÂ∏∏Â§ÑÁêÜ„ÄÅÊó•ÂøóËÆ∞ÂΩïÂíåËµÑÊ∫êÁõëÊéß„ÄÇ</li>
</ul>
<hr>
<h2 id="elasticsearchÊêúÁ¥¢ÁªÑ‰ª∂ËØ¶Ëß£">ElasticsearchÊêúÁ¥¢ÁªÑ‰ª∂ËØ¶Ëß£
</h2><h3 id="‰∏ÄelasticsearchÂü∫Á°Ä‰ªãÁªç">‰∏Ä„ÄÅElasticsearchÂü∫Á°Ä‰ªãÁªç
</h3><p>ElasticsearchÔºàÁÆÄÁß∞ESÔºâÊòØ‰∏Ä‰∏™ÂàÜÂ∏ÉÂºè„ÄÅRESTfulÈ£éÊ†ºÁöÑÊêúÁ¥¢ÂíåÂàÜÊûêÂºïÊìéÔºåÂü∫‰∫éApache LuceneÊûÑÂª∫„ÄÇÂú®ËßÜÈ¢ëÂπ≥Âè∞‰∏≠Ôºå‰∏ªË¶ÅÁî®‰∫éÔºö</p>
<ul>
<li>ÂÖ®ÊñáÊêúÁ¥¢ÔºöÂø´ÈÄüÊ£ÄÁ¥¢ËßÜÈ¢ëÊ†áÈ¢ò„ÄÅÊ†áÁ≠æÁ≠âÂÜÖÂÆπ</li>
<li>ÁªìÊûÑÂåñÊü•ËØ¢ÔºöÊîØÊåÅÂ§öÁßçÊù°‰ª∂ÁªÑÂêàÊü•ËØ¢</li>
<li>È´ò‰∫ÆÊòæÁ§∫ÔºöÁ™ÅÂá∫ÊòæÁ§∫ÂåπÈÖçÁöÑÂÖ≥ÈîÆËØç</li>
<li>ËÅöÂêàÁªüËÆ°ÔºöÂØπÊí≠ÊîæÈáè„ÄÅÂºπÂπïÊï∞Á≠âËøõË°åÁªüËÆ°ÂàÜÊûê</li>
</ul>
<p><strong>Ê†∏ÂøÉÁâπÊÄßÔºö</strong></p>
<ul>
<li>ËøëÂÆûÊó∂ÊêúÁ¥¢ÔºöÊï∞ÊçÆÂèòÊõ¥Âêé1ÁßíÂÜÖÂèØÊêúÁ¥¢</li>
<li>ÂàÜÂ∏ÉÂºèÊû∂ÊûÑÔºöÊîØÊåÅÊ∞¥Âπ≥Êâ©Â±ï</li>
<li>‰∏∞ÂØåÁöÑAPIÔºöRESTfulÊé•Âè£ÂíåÂ§öÁßçÂÆ¢Êà∑Á´Ø</li>
<li>Âº∫Â§ßÁöÑÊü•ËØ¢DSLÔºöÁÅµÊ¥ªÁöÑÊü•ËØ¢ËØ≠Ê≥ï</li>
</ul>
<h3 id="‰∫åÁªÑ‰ª∂ÈÖçÁΩÆËß£Êûê">‰∫å„ÄÅÁªÑ‰ª∂ÈÖçÁΩÆËß£Êûê
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${es.host.port:127.0.0.1:9200}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">esHostPort</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${es.index.video.name:easylive_video}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">esIndexVideoName</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>esHostPortÔºöESÊúçÂä°Âô®Âú∞ÂùÄÔºåÈªòËÆ§Êú¨Âú∞9200Á´ØÂè£</li>
<li>esIndexVideoNameÔºöËßÜÈ¢ëÁ¥¢ÂºïÂêçÁß∞ÔºåÈªòËÆ§&quot;easylive_video&quot;</li>
</ul>
<h3 id="‰∏âÊ†∏ÂøÉÊñπÊ≥ïËØ¶Ëß£">‰∏â„ÄÅÊ†∏ÂøÉÊñπÊ≥ïËØ¶Ëß£
</h3><h4 id="1-Á¥¢ÂºïÂàùÂßãÂåñÊñπÊ≥ï-createindex">1. Á¥¢ÂºïÂàùÂßãÂåñÊñπÊ≥ï createIndex()
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createIndex</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Boolean</span><span class="w"> </span><span class="n">existIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isExistIndex</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">existIndex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CreateIndexRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateIndexRequest</span><span class="p">(</span><span class="n">appConfig</span><span class="p">.</span><span class="na">getEsIndexVideoName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">request</span><span class="p">.</span><span class="na">settings</span><span class="p">(</span><span class="s">&#34;{\&#34;analysis\&#34;: {\&#34;analyzer\&#34;: {\&#34;comma\&#34;: {\&#34;type\&#34;: \&#34;pattern\&#34;,\&#34;pattern\&#34;: \&#34;,\&#34;}}}}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">XContentType</span><span class="p">.</span><span class="na">JSON</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">request</span><span class="p">.</span><span class="na">mapping</span><span class="p">(</span><span class="s">&#34;{\&#34;properties\&#34;: {...}}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">XContentType</span><span class="p">.</span><span class="na">JSON</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CreateIndexResponse</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restHighLevelClient</span><span class="p">.</span><span class="na">indices</span><span class="p">().</span><span class="na">create</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">RequestOptions</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">response</span><span class="p">.</span><span class="na">isAcknowledged</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;ÂàùÂßãÂåñesÂ§±Ë¥•&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;ÂàùÂßãÂåñesÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;ÂàùÂßãÂåñesÂ§±Ë¥•&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â≠óÊÆµÊò†Â∞ÑËØ¥ÊòéÔºö
<ul>
<li>videoId/userIdÔºö‰ªÖÂ≠òÂÇ®‰∏çÁ¥¢Âºï</li>
<li>videoNameÔºö‰ΩøÁî®ik‰∏≠ÊñáÂàÜËØçÂô®</li>
<li>tagsÔºö‰ΩøÁî®Ëá™ÂÆö‰πâÈÄóÂè∑ÂàÜÊûêÂô®</li>
<li>Êï∞ÂÄº/Êó•ÊúüÂ≠óÊÆµÔºö‰ªÖÂ≠òÂÇ®‰∏çÁ¥¢Âºï</li>
</ul>
</li>
</ul>
<h4 id="2-ÊñáÊ°£Êìç‰ΩúÊñπÊ≥ï">2. ÊñáÊ°£Êìç‰ΩúÊñπÊ≥ï
</h4><ul>
<li>‰øùÂ≠òÊñáÊ°£ saveDoc()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveDoc</span><span class="p">(</span><span class="n">VideoInfo</span><span class="w"> </span><span class="n">videoInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">docExist</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">updateDoc</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">VideoInfoEsDto</span><span class="w"> </span><span class="n">dto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CopyTools</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">,</span><span class="w"> </span><span class="n">VideoInfoEsDto</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">dto</span><span class="p">.</span><span class="na">setCollectCount</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">dto</span><span class="p">.</span><span class="na">setPlayCount</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">dto</span><span class="p">.</span><span class="na">setDanmuCount</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">IndexRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IndexRequest</span><span class="p">(</span><span class="n">appConfig</span><span class="p">.</span><span class="na">getEsIndexVideoName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="p">.</span><span class="na">source</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">convertObj2Json</span><span class="p">(</span><span class="n">dto</span><span class="p">),</span><span class="w"> </span><span class="n">XContentType</span><span class="p">.</span><span class="na">JSON</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">restHighLevelClient</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">RequestOptions</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Êñ∞Â¢ûËßÜÈ¢ëÂà∞esÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;‰øùÂ≠òÂ§±Ë¥•&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Êõ¥Êñ∞ÊñáÊ°£ updateDoc()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateDoc</span><span class="p">(</span><span class="n">VideoInfo</span><span class="w"> </span><span class="n">videoInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoInfo</span><span class="p">.</span><span class="na">setLastUpdateTime</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoInfo</span><span class="p">.</span><span class="na">setCreateTime</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dataMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="o">[]</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getDeclaredFields</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Field</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">fields</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Method</span><span class="w"> </span><span class="n">getter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getMethod</span><span class="p">(</span><span class="s">&#34;get&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">StringTools</span><span class="p">.</span><span class="na">upperCaseFirstLetter</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="na">getName</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getter</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">((</span><span class="n">String</span><span class="p">)</span><span class="n">value</span><span class="p">).</span><span class="na">isEmpty</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">dataMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">dataMap</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">UpdateRequest</span><span class="w"> </span><span class="n">updateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateRequest</span><span class="p">(</span><span class="n">appConfig</span><span class="p">.</span><span class="na">getEsIndexVideoName</span><span class="p">(),</span><span class="w"> </span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">updateRequest</span><span class="p">.</span><span class="na">doc</span><span class="p">(</span><span class="n">dataMap</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">restHighLevelClient</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">updateRequest</span><span class="p">,</span><span class="w"> </span><span class="n">RequestOptions</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Êõ¥Êñ∞ËßÜÈ¢ëÂà∞esÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;‰øùÂ≠òÂ§±Ë¥•&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Êõ¥Êñ∞ÁªüËÆ°Â≠óÊÆµ updateDocCount()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateDocCount</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fieldName</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">UpdateRequest</span><span class="w"> </span><span class="n">updateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateRequest</span><span class="p">(</span><span class="n">appConfig</span><span class="p">.</span><span class="na">getEsIndexVideoName</span><span class="p">(),</span><span class="w"> </span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Script</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Script</span><span class="p">(</span><span class="n">ScriptType</span><span class="p">.</span><span class="na">INLINE</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;painless&#34;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;ctx._source.&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fieldName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; += params.count&#34;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonMap</span><span class="p">(</span><span class="s">&#34;count&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">updateRequest</span><span class="p">.</span><span class="na">script</span><span class="p">(</span><span class="n">script</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">restHighLevelClient</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">updateRequest</span><span class="p">,</span><span class="w"> </span><span class="n">RequestOptions</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Êõ¥Êñ∞Êï∞ÈáèÂà∞esÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;‰øùÂ≠òÂ§±Ë¥•&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âà†Èô§ÊñáÊ°£ delDoc()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">delDoc</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DeleteRequest</span><span class="w"> </span><span class="n">deleteRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeleteRequest</span><span class="p">(</span><span class="n">appConfig</span><span class="p">.</span><span class="na">getEsIndexVideoName</span><span class="p">(),</span><span class="w"> </span><span class="n">videoId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">restHighLevelClient</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">deleteRequest</span><span class="p">,</span><span class="w"> </span><span class="n">RequestOptions</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;‰ªéesÂà†Èô§ËßÜÈ¢ëÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;Âà†Èô§ËßÜÈ¢ëÂ§±Ë¥•&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-ÊêúÁ¥¢ÊñπÊ≥ï-search">3. ÊêúÁ¥¢ÊñπÊ≥ï search()
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">PaginationResultVO</span><span class="o">&lt;</span><span class="n">VideoInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="n">Boolean</span><span class="w"> </span><span class="n">highlight</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">orderType</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">pageNo</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">pageSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SearchSourceBuilder</span><span class="w"> </span><span class="n">sourceBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchSourceBuilder</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">sourceBuilder</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">QueryBuilders</span><span class="p">.</span><span class="na">multiMatchQuery</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;videoName&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;tags&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">highlight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">HighlightBuilder</span><span class="w"> </span><span class="n">highlightBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HighlightBuilder</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">highlightBuilder</span><span class="p">.</span><span class="na">field</span><span class="p">(</span><span class="s">&#34;videoName&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                          </span><span class="p">.</span><span class="na">preTags</span><span class="p">(</span><span class="s">&#34;&lt;span class=&#39;highlight&#39;&gt;&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                          </span><span class="p">.</span><span class="na">postTags</span><span class="p">(</span><span class="s">&#34;&lt;/span&gt;&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sourceBuilder</span><span class="p">.</span><span class="na">highlighter</span><span class="p">(</span><span class="n">highlightBuilder</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SearchOrderTypeEnum</span><span class="w"> </span><span class="n">orderEnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SearchOrderTypeEnum</span><span class="p">.</span><span class="na">getByType</span><span class="p">(</span><span class="n">orderType</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">orderType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sourceBuilder</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">orderEnum</span><span class="p">.</span><span class="na">getField</span><span class="p">(),</span><span class="w"> </span><span class="n">SortOrder</span><span class="p">.</span><span class="na">DESC</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sourceBuilder</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="s">&#34;_score&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">SortOrder</span><span class="p">.</span><span class="na">DESC</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">pageNo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pageNo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">pageNo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">pageSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pageSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">PageSize</span><span class="p">.</span><span class="na">SIZE20</span><span class="p">.</span><span class="na">getSize</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">pageSize</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">sourceBuilder</span><span class="p">.</span><span class="na">from</span><span class="p">((</span><span class="n">pageNo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pageSize</span><span class="p">).</span><span class="na">size</span><span class="p">(</span><span class="n">pageSize</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SearchRequest</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="n">appConfig</span><span class="p">.</span><span class="na">getEsIndexVideoName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">searchRequest</span><span class="p">.</span><span class="na">source</span><span class="p">(</span><span class="n">sourceBuilder</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SearchResponse</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">restHighLevelClient</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">,</span><span class="w"> </span><span class="n">RequestOptions</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SearchHits</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">getHits</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">hits</span><span class="p">.</span><span class="na">getHits</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">hit</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">VideoInfo</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">convertJson2Obj</span><span class="p">(</span><span class="n">hit</span><span class="p">.</span><span class="na">getSourceAsString</span><span class="p">(),</span><span class="w"> </span><span class="n">VideoInfo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hit</span><span class="p">.</span><span class="na">getHighlightFields</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;videoName&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">info</span><span class="p">.</span><span class="na">setVideoName</span><span class="p">(</span><span class="n">hit</span><span class="p">.</span><span class="na">getHighlightFields</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;videoName&#34;</span><span class="p">).</span><span class="na">getFragments</span><span class="p">()</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">.</span><span class="na">string</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">info</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">UserInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userInfoMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">UserInfoQuery</span><span class="p">().</span><span class="na">setUserIdList</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">videoList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">map</span><span class="p">(</span><span class="n">VideoInfo</span><span class="p">::</span><span class="n">getUserId</span><span class="p">).</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">).</span><span class="na">stream</span><span class="p">().</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toMap</span><span class="p">(</span><span class="n">UserInfo</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">Function</span><span class="p">.</span><span class="na">identity</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoList</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">video</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">UserInfo</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">video</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="n">video</span><span class="p">.</span><span class="na">setNickName</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getNickName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PaginationResultVO</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">hits</span><span class="p">.</span><span class="na">getTotalHits</span><span class="p">().</span><span class="na">value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">pageSize</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">pageNo</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">ceil</span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">hits</span><span class="p">.</span><span class="na">getTotalHits</span><span class="p">().</span><span class="na">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pageSize</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">videoList</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Êü•ËØ¢ËßÜÈ¢ëÂ§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;Êü•ËØ¢Â§±Ë¥•&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂõõËÆæËÆ°‰∫ÆÁÇπÂàÜÊûê">Âõõ„ÄÅËÆæËÆ°‰∫ÆÁÇπÂàÜÊûê
</h3><ul>
<li>‰ºòÈõÖÁöÑÂºÇÂ∏∏Â§ÑÁêÜÔºöÁªü‰∏ÄÊçïËé∑ÂºÇÂ∏∏Âπ∂ËΩ¨Êç¢‰∏∫‰∏öÂä°ÂºÇÂ∏∏ÔºåËÆ∞ÂΩïËØ¶ÁªÜÈîôËØØÊó•Âøó</li>
<li>Êô∫ËÉΩÁöÑÊñáÊ°£Êìç‰ΩúÔºöËá™Âä®Âà§Êñ≠ÊñáÊ°£Â≠òÂú®ÊÄßÔºåÂ¢ûÈáèÊõ¥Êñ∞ÈùûÁ©∫Â≠óÊÆµ</li>
<li>È´òÊïàÁöÑÁªüËÆ°Êõ¥Êñ∞Ôºö‰ΩøÁî® painless ËÑöÊú¨ÂÆûÁé∞ÂéüÂ≠êÊìç‰Ωú</li>
<li>ÂÆåÊï¥ÁöÑÂàÜÈ°µÊîØÊåÅÔºöÊîØÊåÅËá™ÂÆö‰πâÈ°µÁ†ÅÂíåÂ§ßÂ∞èÔºåËøîÂõûÊÄªÈ°µÊï∞Á≠âÂÖÉ‰ø°ÊÅØ</li>
<li>ÂÖ≥ËÅîÊï∞ÊçÆË°•ÂÖÖÔºöÊêúÁ¥¢ÂêéÊâπÈáèÊü•ËØ¢Áî®Êà∑‰ø°ÊÅØÔºåÂáèÂ∞ëN+1Êü•ËØ¢ÈóÆÈ¢ò</li>
</ul>
<h3 id="‰∫îÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ">‰∫î„ÄÅÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ
</h3><ul>
<li>ÊâπÈáèÊìç‰ΩúÊîØÊåÅ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">BulkRequest</span><span class="w"> </span><span class="n">bulkRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BulkRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ê∑ªÂä†Â§ö‰∏™Êìç‰Ωú</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">restHighLevelClient</span><span class="p">.</span><span class="na">bulk</span><span class="p">(</span><span class="n">bulkRequest</span><span class="p">,</span><span class="w"> </span><span class="n">RequestOptions</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁºìÂ≠òÁî®Êà∑‰ø°ÊÅØÔºö‰ΩøÁî®RedisÁºìÂ≠òÈ¢ëÁπÅËÆøÈóÆÁöÑÁî®Êà∑Êï∞ÊçÆ</li>
<li>ÊêúÁ¥¢Âª∫ËÆÆÂäüËÉΩ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">SearchSourceBuilder</span><span class="p">.</span><span class="na">suggest</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SuggestBuilder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">addSuggestion</span><span class="p">(</span><span class="s">&#34;video-suggest&#34;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SuggestBuilders</span><span class="p">.</span><span class="na">completionSuggestion</span><span class="p">(</span><span class="s">&#34;videoName.suggest&#34;</span><span class="p">)));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Êõ¥Â§çÊùÇÁöÑÈ´ò‰∫ÆÁ≠ñÁï•ÔºöÊîØÊåÅÂ§öÂ≠óÊÆµÈ´ò‰∫ÆÔºåËá™ÂÆö‰πâÈ´ò‰∫ÆÁâáÊÆµÈïøÂ∫¶</li>
<li>Á¥¢ÂºïÂà´ÂêçÊîØÊåÅÔºö‰ΩøÁî®Âà´ÂêçÂÆûÁé∞Èõ∂ÂÅúÊú∫Á¥¢ÂºïÈáçÂª∫</li>
</ul>
<h3 id="ÂÖ≠ÂàùÂßãÂåñÊµÅÁ®ãinitrun">ÂÖ≠„ÄÅÂàùÂßãÂåñÊµÅÁ®ãÔºàInitRunÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="p">(</span><span class="s">&#34;initRun&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">InitRun</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ApplicationRunner</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">ApplicationArguments</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">redisUtils</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&#34;test&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">esSearchComponent</span><span class="p">.</span><span class="na">createIndex</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;ÊúçÂä°ÂêØÂä®ÊàêÂäü&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;ÊúçÂä°ÂêØÂä®Â§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂêØÂä®È™åËØÅÈÄªËæëÔºö
<ul>
<li>Êï∞ÊçÆÂ∫ìËøûÊé•ÊµãËØï</li>
<li>RedisËøûÈÄöÊÄßÊµãËØï</li>
<li>ESÁ¥¢ÂºïÂàùÂßãÂåñ</li>
<li>‰ªª‰∏ÄÂ§±Ë¥•ÂàôÁªàÊ≠¢Â∫îÁî®ÂêØÂä®</li>
</ul>
</li>
</ul>
<p>ËØ•ESÊêúÁ¥¢ÁªÑ‰ª∂‰∏∫ËßÜÈ¢ëÂπ≥Âè∞Êèê‰æõ‰∫ÜÂÆåÊï¥„ÄÅÈ´òÊïàÁöÑÊêúÁ¥¢ËÉΩÂäõÔºå‰ªéÂü∫Á°ÄÁ¥¢ÂºïÁÆ°ÁêÜÂà∞Â§çÊùÇÁöÑÊêúÁ¥¢ÂäüËÉΩÈÉΩÊúâËâØÂ•ΩÂÆûÁé∞ÔºåÊòØÁ≥ªÁªüÊ†∏ÂøÉÂäüËÉΩÁöÑÈáçË¶ÅÊîØÊíë„ÄÇ</p>
<hr>
<h2 id="javaÂèçÂ∞ÑÊú∫Âà∂ÂèäÂÖ∂Âú®‰ª£Á†Å‰∏≠ÁöÑÂ∫îÁî®">JavaÂèçÂ∞ÑÊú∫Âà∂ÂèäÂÖ∂Âú®‰ª£Á†Å‰∏≠ÁöÑÂ∫îÁî®
</h2><h3 id="‰∏ÄÂèçÂ∞ÑÂü∫Á°ÄÊ¶ÇÂøµ">‰∏Ä„ÄÅÂèçÂ∞ÑÂü∫Á°ÄÊ¶ÇÂøµ
</h3><p>ÂèçÂ∞ÑÔºàReflectionÔºâÊòØJavaËØ≠Ë®ÄÁöÑ‰∏ÄÁßçÂä®ÊÄÅËÉΩÂäõÔºåÂÖÅËÆ∏Á®ãÂ∫èÂú®ËøêË°åÊó∂Ôºö</p>
<ul>
<li>Ëé∑ÂèñÁ±ªÁöÑÂÆåÊï¥ÁªìÊûÑ‰ø°ÊÅØ</li>
<li>Âä®ÊÄÅÂàõÂª∫ÂØπË±°</li>
<li>ËÆøÈóÆÂíå‰øÆÊîπÂ≠óÊÆµÂÄº</li>
<li>Ë∞ÉÁî®ÊñπÊ≥ï</li>
<li>Êìç‰ΩúÊï∞ÁªÑ</li>
</ul>
<p><strong>Ê†∏ÂøÉÂèçÂ∞ÑÁ±ªÔºö</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Á±ª</th>
          <th>‰ΩúÁî®</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Class</td>
          <td>Ë°®Á§∫Á±ªÂíåÊé•Âè£</td>
      </tr>
      <tr>
          <td>Field</td>
          <td>Ë°®Á§∫Á±ªÁöÑÂ≠óÊÆµ</td>
      </tr>
      <tr>
          <td>Method</td>
          <td>Ë°®Á§∫Á±ªÁöÑÊñπÊ≥ï</td>
      </tr>
      <tr>
          <td>Constructor</td>
          <td>Ë°®Á§∫Á±ªÁöÑÊûÑÈÄ†ÊñπÊ≥ï</td>
      </tr>
  </tbody>
</table></div>
<h3 id="‰∫å‰ª£Á†Å‰∏≠ÁöÑÂèçÂ∞ÑËß£Êûê">‰∫å„ÄÅ‰ª£Á†Å‰∏≠ÁöÑÂèçÂ∞ÑËß£Êûê
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dataMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Field</span><span class="o">[]</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getDeclaredFields</span><span class="p">();</span><span class="w"> </span><span class="c1">// Ëé∑ÂèñÊâÄÊúâÂ≠óÊÆµ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Field</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">fields</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÊûÑÈÄ†getterÊñπÊ≥ïÂêçÔºàÂ¶ÇÔºögetVideoNameÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">methodName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;get&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">StringTools</span><span class="p">.</span><span class="na">upperCaseFirstLetter</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ëé∑ÂèñMethodÂØπË±°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getMethod</span><span class="p">(</span><span class="n">methodName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ë∞ÉÁî®getterÊñπÊ≥ïËé∑ÂèñÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ËøáÊª§ÈùûÁ©∫ÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">object</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">object</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">StringTools</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">object</span><span class="p">.</span><span class="na">toString</span><span class="p">()))</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">object</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">dataMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">object</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰∏âÂèçÂ∞ÑÂú®Ê≠§Â§ÑÁöÑÂÖ∑‰Ωì‰ΩúÁî®">‰∏â„ÄÅÂèçÂ∞ÑÂú®Ê≠§Â§ÑÁöÑÂÖ∑‰Ωì‰ΩúÁî®
</h3><ol>
<li>Âä®ÊÄÅËé∑ÂèñÂØπË±°Â±ûÊÄß
<ul>
<li>ÈÄöËøá getDeclaredFields() Ëé∑ÂèñÊâÄÊúâÂ≠óÊÆµ</li>
<li>Êó†ÈúÄÁ°¨ÁºñÁ†ÅÊØè‰∏™Â≠óÊÆµÂêçÔºåËá™Âä®ÈÄÇÂ∫îÁ±ªÁªìÊûÑÂèòÂåñ</li>
</ul>
</li>
<li>ÈÄöÁî®Â±ûÊÄßÊã∑Ë¥ù
<ul>
<li>Â∞ÜÂØπË±°Â±ûÊÄßËΩ¨Êç¢‰∏∫ Map ÁªìÊûÑ</li>
<li>‰∏∫ÂêéÁª≠ ES ÊñáÊ°£Êõ¥Êñ∞Êèê‰æõÊï∞ÊçÆÊ∫ê</li>
</ul>
</li>
<li>Á©∫ÂÄºËøáÊª§
<ul>
<li>Ë∑≥Ëøá null ÂÄº</li>
<li>ÂØπ String Á±ªÂûãÈ¢ùÂ§ñÊ£ÄÊü•Á©∫Â≠óÁ¨¶‰∏≤</li>
</ul>
</li>
<li>Á±ªÂûãÂÆâÂÖ®Â§ÑÁêÜ
<ul>
<li>Âå∫ÂàÜ String ÂíåÈùû String Á±ªÂûãÁöÑ‰∏çÂêåÂ§ÑÁêÜÈÄªËæë</li>
</ul>
</li>
</ol>
<h3 id="ÂõõÂèçÂ∞ÑÁöÑÂ∑•‰ΩúÊµÅÁ®ã">Âõõ„ÄÅÂèçÂ∞ÑÁöÑÂ∑•‰ΩúÊµÅÁ®ã
</h3><ul>
<li>Ëé∑ÂèñÁ±ªÂØπË±° ‚Üí Ëé∑ÂèñÂ≠óÊÆµÂàóË°® ‚Üí ÊûÑÈÄ† getter ÊñπÊ≥ïÂêç ‚Üí Ëé∑Âèñ Method ‚Üí Ë∞ÉÁî® getter Ëé∑ÂèñÂÄº ‚Üí ËøáÊª§Á©∫ÂÄº ‚Üí Â°´ÂÖÖ Map</li>
</ul>
<h3 id="‰∫îÂèçÂ∞ÑÁöÑ‰ºòÁº∫ÁÇπ">‰∫î„ÄÅÂèçÂ∞ÑÁöÑ‰ºòÁº∫ÁÇπ
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>‰ºòÁÇπ</th>
          <th>ËØ¥Êòé</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÁÅµÊ¥ªÊÄß</td>
          <td>Âä®ÊÄÅÂ§ÑÁêÜÊú™Áü•Á±ªÁªìÊûÑ</td>
      </tr>
      <tr>
          <td>ÈÄöÁî®ÊÄß</td>
          <td>ÂèØÁºñÂÜôÈÄöÁî®Â∑•ÂÖ∑ÊñπÊ≥ï</td>
      </tr>
      <tr>
          <td>Ëß£ËÄ¶</td>
          <td>‰∏ç‰æùËµñÂÖ∑‰ΩìÂÆûÁé∞Á±ª</td>
      </tr>
      <tr>
          <td>Áº∫ÁÇπ</td>
          <td>ËØ¥Êòé</td>
      </tr>
      <tr>
          <td>ÊÄßËÉΩÂºÄÈîÄ</td>
          <td>ÊØîÁõ¥Êé•Ë∞ÉÁî®ÊÖ¢Á∫¶50-100ÂÄç</td>
      </tr>
      <tr>
          <td>ÂÆâÂÖ®ÈôêÂà∂</td>
          <td>ÈúÄË¶ÅËøêË°åÊó∂ÊùÉÈôê</td>
      </tr>
      <tr>
          <td>‰ª£Á†ÅÂ§çÊùÇÂ∫¶</td>
          <td>ÈîôËØØÈöæ‰ª•Âú®ÁºñËØëÊúüÂèëÁé∞</td>
      </tr>
  </tbody>
</table></div>
<h3 id="ÂÖ≠ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ">ÂÖ≠„ÄÅÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ
</h3><ol>
<li>ÁºìÂ≠òÂèçÂ∞ÑÁªìÊûú</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Á±ªÁ∫ßÂà´ÁºìÂ≠ò</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">methodCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodCache</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Â°´ÂÖÖmethodÂà∞map</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}).</span><span class="na">get</span><span class="p">(</span><span class="n">methodName</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>‰ΩøÁî®È´òÊÄßËÉΩÂèçÂ∞ÑÂ∑•ÂÖ∑</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ‰æãÂ¶ÇSpringÁöÑBeanWrapperÊàñApache BeanUtils</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">BeanWrapper</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BeanWrapperImpl</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wrapper</span><span class="p">.</span><span class="na">getPropertyValue</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>Êõø‰ª£ÊñπÊ°àÊØîËæÉ
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÊñπÊ°à</th>
          <th>ÊÄßËÉΩ</th>
          <th>ÊòìÁî®ÊÄß</th>
          <th>ÁÅµÊ¥ªÊÄß</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Áõ¥Êé•Ë∞ÉÁî®</td>
          <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
          <td>‚òÖ‚òÖ‚òÖ</td>
          <td>‚òÖ</td>
      </tr>
      <tr>
          <td>ÂèçÂ∞Ñ</td>
          <td>‚òÖ‚òÖ</td>
          <td>‚òÖ‚òÖ‚òÖ</td>
          <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
      </tr>
      <tr>
          <td>MethodHandle</td>
          <td>‚òÖ‚òÖ‚òÖ‚òÖ</td>
          <td>‚òÖ‚òÖ</td>
          <td>‚òÖ‚òÖ‚òÖ‚òÖ</td>
      </tr>
      <tr>
          <td>BytecodeÁîüÊàê</td>
          <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
          <td>‚òÖ</td>
          <td>‚òÖ‚òÖ‚òÖ</td>
      </tr>
  </tbody>
</table></div>
</li>
</ol>
<h3 id="‰∏ÉÂú®Ê≠§Âú∫ÊôØ‰∏ãÁöÑÂøÖË¶ÅÊÄßÂàÜÊûê">‰∏É„ÄÅÂú®Ê≠§Âú∫ÊôØ‰∏ãÁöÑÂøÖË¶ÅÊÄßÂàÜÊûê
</h3><ul>
<li>ESÊñáÊ°£ÁªìÊûÑÂä®ÊÄÅÔºåÂ≠óÊÆµÂèØËÉΩÈ¢ëÁπÅÂèòÂåñ</li>
<li>ÈÄöÁî®Êõ¥Êñ∞ÈÄªËæëÔºå‰∏çÂêåÂÆû‰ΩìÂèØÂ§çÁî®Áõ∏Âêå‰ª£Á†Å</li>
<li>ÈÅøÂÖç‰∏∫ÊØè‰∏™Â≠óÊÆµÁºñÂÜô set/getÔºåÊèêÈ´òÂºÄÂèëÊïàÁéá</li>
<li>ÊÄßËÉΩÂΩ±ÂìçÂèØÊé•ÂèóÔºàESÊõ¥Êñ∞È¢ëÁéá‰ΩéÔºâ</li>
<li>‰ªÖË∞ÉÁî® getter ÊñπÊ≥ïÔºåÊó†ÂÆâÂÖ®È£éÈô©</li>
<li>Âª∫ËÆÆÊ∑ªÂä†Ê≥®ÈáäËØ¥ÊòéÊÑèÂõæÔºå‰æø‰∫éÁª¥Êä§</li>
</ul>
<h3 id="ÂÖ´ÂÆåÊï¥ÊµÅÁ®ãÁ§∫‰æã">ÂÖ´„ÄÅÂÆåÊï¥ÊµÅÁ®ãÁ§∫‰æã
</h3><p>ÂÅáËÆæ VideoInfo Á±ªÊúâÂ¶Ç‰∏ãÂ≠óÊÆµÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VideoInfo</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">;</span><span class="w">    </span><span class="c1">// &#34;123&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">videoName</span><span class="p">;</span><span class="w"> </span><span class="c1">// &#34;JavaÊïôÁ®ã&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w">   </span><span class="c1">// 1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">createTime</span><span class="p">;</span><span class="w">  </span><span class="c1">// new Date()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">desc</span><span class="p">;</span><span class="w">      </span><span class="c1">// &#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèçÂ∞ÑÂ§ÑÁêÜÂêéÁöÑ dataMap Â∞ÜÊòØÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;videoId&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;123&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;videoName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;JavaÊïôÁ®ã&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;status&#34;</span><span class="p">:</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;createTime&#34;</span><span class="p">:</span><span class="w"> </span><span class="n">DateÂØπË±°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>desc Â≠óÊÆµÂõ†ÊòØÁ©∫Â≠óÁ¨¶‰∏≤Ë¢´ËøáÊª§</li>
<li>ÊâÄÊúâÈùûÁ©∫Èùû String Â≠óÊÆµÈÉΩË¢´ÂåÖÂê´</li>
</ul>
<p>ËøôÁßçÂèçÂ∞ÑÂÆûÁé∞‰∏∫ ES ÊñáÊ°£Êõ¥Êñ∞Êèê‰æõ‰∫ÜÁÅµÊ¥ª„ÄÅËá™Âä®ÂåñÁöÑÂ±ûÊÄßÊî∂ÈõÜÊú∫Âà∂ÔºåÊòØÂÖ∏Âûã‰∏îÂêàÁêÜÁöÑÂèçÂ∞Ñ‰ΩøÁî®Âú∫ÊôØ„ÄÇ</p>
<hr>
<h2 id="aopÈù¢ÂêëÂàáÈù¢ÁºñÁ®ãÂü∫Á°ÄËØ¶Ëß£">AOPÔºàÈù¢ÂêëÂàáÈù¢ÁºñÁ®ãÔºâÂü∫Á°ÄËØ¶Ëß£
</h2><p>Èù¢ÂêëÂàáÈù¢ÁºñÁ®ãÔºàAspect-Oriented ProgrammingÔºåAOPÔºâÊòØ‰∏ÄÁßçÁºñÁ®ãËåÉÂºèÔºåÁî®‰∫éÂ∞ÜÊ®™ÂàáÂÖ≥Ê≥®ÁÇπÔºàcross-cutting concernsÔºâ‰∏éÊ†∏ÂøÉ‰∏öÂä°ÈÄªËæëÂàÜÁ¶ª„ÄÇ‰ª•‰∏ãÊòØAOPÁöÑÊ†∏ÂøÉÊ¶ÇÂøµÂíåÂÆûÁé∞ÁªÜËäÇÔºö</p>
<h3 id="‰∏ÄaopÊ†∏ÂøÉÊ¶ÇÂøµ">‰∏Ä„ÄÅAOPÊ†∏ÂøÉÊ¶ÇÂøµ
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Ê¶ÇÂøµ</th>
          <th>ËØ¥Êòé</th>
          <th>Á§∫‰æã</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÂàáÈù¢(Aspect)</td>
          <td>Â∞ÅË£ÖÊ®™ÂàáÈÄªËæëÁöÑÊ®°Âùó</td>
          <td>Êó•ÂøóËÆ∞ÂΩï„ÄÅÊùÉÈôêÊ†°È™å„ÄÅ‰∫ãÂä°ÁÆ°ÁêÜ</td>
      </tr>
      <tr>
          <td>ËøûÊé•ÁÇπ(JoinPoint)</td>
          <td>Á®ãÂ∫èÊâßË°å‰∏≠ÁöÑÁâπÂÆöÁÇπ</td>
          <td>ÊñπÊ≥ïË∞ÉÁî®„ÄÅÂºÇÂ∏∏ÊäõÂá∫„ÄÅÂ≠óÊÆµ‰øÆÊîπ</td>
      </tr>
      <tr>
          <td>ÈÄöÁü•(Advice)</td>
          <td>ÂàáÈù¢Âú®ËøûÊé•ÁÇπÁöÑÂä®‰Ωú</td>
          <td>@Before„ÄÅ@After„ÄÅ@Around</td>
      </tr>
      <tr>
          <td>ÂàáÁÇπ(Pointcut)</td>
          <td>ÂåπÈÖçËøûÊé•ÁÇπÁöÑË°®ËææÂºè</td>
          <td>execution(* com.service.<em>.</em>(..))</td>
      </tr>
      <tr>
          <td>ÁõÆÊ†áÂØπË±°(Target)</td>
          <td>Ë¢´Â¢ûÂº∫ÁöÑÂØπË±°</td>
          <td>ÊôÆÈÄöÁöÑServiceÂÆû‰æã</td>
      </tr>
      <tr>
          <td>ÁªáÂÖ•(Weaving)</td>
          <td>Â∞ÜÂàáÈù¢Â∫îÁî®Âà∞ÁõÆÊ†áÂØπË±°ÁöÑËøáÁ®ã</td>
          <td>ÁºñËØëÊúü„ÄÅÁ±ªÂä†ËΩΩÊúü„ÄÅËøêË°åÊúü</td>
      </tr>
  </tbody>
</table></div>
<h3 id="‰∫åspring-aopÂÆûÁé∞Êú∫Âà∂">‰∫å„ÄÅSpring AOPÂÆûÁé∞Êú∫Âà∂
</h3><h4 id="1-‰ª£ÁêÜÊ®°Âºè">1. ‰ª£ÁêÜÊ®°Âºè
</h4><ul>
<li>Spring AOPÈªòËÆ§‰ΩøÁî®Âä®ÊÄÅ‰ª£ÁêÜÔºö
<ul>
<li>JDKÂä®ÊÄÅ‰ª£ÁêÜÔºöÂü∫‰∫éÊé•Âè£ÔºàÈªòËÆ§Ôºâ</li>
<li>CGLIB‰ª£ÁêÜÔºöÂü∫‰∫éÁ±ªÁªßÊâøÔºàÈúÄÂêØÁî®Ôºâ</li>
</ul>
</li>
</ul>
<h4 id="2-ÈÄöÁü•Á±ªÂûã">2. ÈÄöÁü•Á±ªÂûã
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÈÄöÁü•Á±ªÂûã</th>
          <th>Ê≥®Ëß£</th>
          <th>ÊâßË°åÊó∂Êú∫</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÂâçÁΩÆÈÄöÁü•</td>
          <td>@Before</td>
          <td>ÊñπÊ≥ïÊâßË°åÂâç</td>
      </tr>
      <tr>
          <td>ÂêéÁΩÆÈÄöÁü•</td>
          <td>@AfterReturning</td>
          <td>ÊñπÊ≥ïÊ≠£Â∏∏ËøîÂõûÂêé</td>
      </tr>
      <tr>
          <td>ÂºÇÂ∏∏ÈÄöÁü•</td>
          <td>@AfterThrowing</td>
          <td>ÊñπÊ≥ïÊäõÂá∫ÂºÇÂ∏∏Âêé</td>
      </tr>
      <tr>
          <td>ÊúÄÁªàÈÄöÁü•</td>
          <td>@After</td>
          <td>ÊñπÊ≥ïÊâßË°åÂêéÔºàÊó†ËÆ∫ÊàêË¥•Ôºâ</td>
      </tr>
      <tr>
          <td>ÁéØÁªïÈÄöÁü•</td>
          <td>@Around</td>
          <td>ÂåÖË£πÊï¥‰∏™ÊñπÊ≥ïÊâßË°å</td>
      </tr>
  </tbody>
</table></div>
<h3 id="‰∏âspring-aopÂÆûÊàò">‰∏â„ÄÅSpring AOPÂÆûÊàò
</h3><h4 id="1-Âü∫Êú¨ÈÖçÁΩÆ">1. Âü∫Êú¨ÈÖçÁΩÆ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableAspectJAutoProxy</span><span class="w"> </span><span class="c1">// ÂêØÁî®AOP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-ÂàáÈù¢ÂÆö‰πâÁ§∫‰æã">2. ÂàáÈù¢ÂÆö‰πâÁ§∫‰æã
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Aspect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LogAspect</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÂÆö‰πâÂàáÁÇπÔºàÂåπÈÖçserviceÂåÖ‰∏ãÊâÄÊúâÊñπÊ≥ïÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&#34;execution(* com.example.service.*.*(..))&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">servicePointcut</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Before</span><span class="p">(</span><span class="s">&#34;servicePointcut()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">beforeLog</span><span class="p">(</span><span class="n">JoinPoint</span><span class="w"> </span><span class="n">jp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">methodName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jp</span><span class="p">.</span><span class="na">getSignature</span><span class="p">().</span><span class="na">getName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Ë∞ÉÁî®ÊñπÊ≥ïÂâç: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">methodName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;servicePointcut()&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">aroundLog</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span><span class="w"> </span><span class="n">pjp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;ÊñπÊ≥ïÊâßË°åËÄóÊó∂: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;ms&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂõõÂàáÁÇπË°®ËææÂºèËØ≠Ê≥ï">Âõõ„ÄÅÂàáÁÇπË°®ËææÂºèËØ≠Ê≥ï
</h3><h4 id="1-Âü∫Êú¨ËØ≠Ê≥ï">1. Âü∫Êú¨ËØ≠Ê≥ï
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">execution</span><span class="p">(</span><span class="o">[</span><span class="n">‰øÆÈ•∞Á¨¶</span><span class="o">]</span><span class="w"> </span><span class="n">ËøîÂõûÁ±ªÂûã</span><span class="w"> </span><span class="o">[</span><span class="n">Á±ªÂêç</span><span class="o">]</span><span class="p">.</span><span class="na">ÊñπÊ≥ïÂêç</span><span class="p">(</span><span class="n">ÂèÇÊï∞</span><span class="p">)</span><span class="w"> </span><span class="o">[</span><span class="n">ÂºÇÂ∏∏</span><span class="o">]</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-Â∏∏Áî®Ë°®ËææÂºèÁ§∫‰æã">2. Â∏∏Áî®Ë°®ËææÂºèÁ§∫‰æã
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Ë°®ËææÂºè</th>
          <th>ËØ¥Êòé</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>execution(public * *(..))</td>
          <td>ÊâÄÊúâpublicÊñπÊ≥ï</td>
      </tr>
      <tr>
          <td>execution(* set*(..))</td>
          <td>ÊâÄÊúâsetÂºÄÂ§¥ÁöÑÊñπÊ≥ï</td>
      </tr>
      <tr>
          <td>execution(* com.service.<em>.</em>(..))</td>
          <td>serviceÂåÖ‰∏ãÊâÄÊúâÊñπÊ≥ï</td>
      </tr>
      <tr>
          <td>execution(* com.service..<em>.</em>(..))</td>
          <td>serviceÂåÖÂèäÂÖ∂Â≠êÂåÖ‰∏ãÊâÄÊúâÊñπÊ≥ï</td>
      </tr>
      <tr>
          <td>@annotation(com.example.Log)</td>
          <td>Â∏¶Êúâ@LogÊ≥®Ëß£ÁöÑÊñπÊ≥ï</td>
      </tr>
  </tbody>
</table></div>
<h3 id="‰∫îËé∑Âèñ‰∏ä‰∏ãÊñá‰ø°ÊÅØ">‰∫î„ÄÅËé∑Âèñ‰∏ä‰∏ãÊñá‰ø°ÊÅØ
</h3><h4 id="1-ÊñπÊ≥ï‰ø°ÊÅØËé∑Âèñ">1. ÊñπÊ≥ï‰ø°ÊÅØËé∑Âèñ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Before</span><span class="p">(</span><span class="s">&#34;execution(* com.service.*.*(..))&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">before</span><span class="p">(</span><span class="n">JoinPoint</span><span class="w"> </span><span class="n">jp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ëé∑ÂèñÊñπÊ≥ïÁ≠æÂêç</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MethodSignature</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MethodSignature</span><span class="p">)</span><span class="w"> </span><span class="n">jp</span><span class="p">.</span><span class="na">getSignature</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ëé∑ÂèñÂèÇÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jp</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ëé∑ÂèñÁõÆÊ†áÂØπË±°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jp</span><span class="p">.</span><span class="na">getTarget</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-ËøîÂõûÂÄºËé∑Âèñ">2. ËøîÂõûÂÄºËé∑Âèñ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@AfterReturning</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">pointcut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;execution(* com.service.*.*(..))&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">returning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;result&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterReturning</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;ËøîÂõûÁªìÊûú: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-ÂºÇÂ∏∏Ëé∑Âèñ">3. ÂºÇÂ∏∏Ëé∑Âèñ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@AfterThrowing</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">pointcut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;execution(* com.service.*.*(..))&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">throwing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;ex&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterThrowing</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">err</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;ÂèëÁîüÂºÇÂ∏∏: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂÖ≠aopÂ∫îÁî®Âú∫ÊôØ">ÂÖ≠„ÄÅAOPÂ∫îÁî®Âú∫ÊôØ
</h3><ul>
<li>Êó•ÂøóËÆ∞ÂΩïÔºöËá™Âä®ËÆ∞ÂΩïÊñπÊ≥ïË∞ÉÁî®‰ø°ÊÅØ</li>
<li>ÊÄßËÉΩÁõëÊéßÔºöÁªüËÆ°ÊñπÊ≥ïÊâßË°åÊó∂Èó¥</li>
<li>‰∫ãÂä°ÁÆ°ÁêÜÔºöÂ£∞ÊòéÂºè‰∫ãÂä°</li>
<li>ÊùÉÈôêÊéßÂà∂ÔºöÊñπÊ≥ïÁ∫ßÊùÉÈôêÊ†°È™å</li>
<li>ÁºìÂ≠òÁÆ°ÁêÜÔºöËá™Âä®ÁºìÂ≠òÊñπÊ≥ïÁªìÊûú</li>
<li>ÂºÇÂ∏∏Â§ÑÁêÜÔºöÁªü‰∏ÄÂºÇÂ∏∏ÊçïËé∑ÂíåÂ§ÑÁêÜ</li>
</ul>
<h3 id="‰∏Éspring-aop‰∏éaspectjÂØπÊØî">‰∏É„ÄÅSpring AOP‰∏éAspectJÂØπÊØî
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÁâπÊÄß</th>
          <th>Spring AOP</th>
          <th>AspectJ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÂÆûÁé∞ÊñπÂºè</td>
          <td>Âä®ÊÄÅ‰ª£ÁêÜ</td>
          <td>Â≠óËäÇÁ†ÅÂ¢ûÂº∫</td>
      </tr>
      <tr>
          <td>ÁªáÂÖ•Êó∂Êú∫</td>
          <td>ËøêË°åÊó∂</td>
          <td>ÁºñËØëÊúü/Á±ªÂä†ËΩΩÊúü</td>
      </tr>
      <tr>
          <td>ÊÄßËÉΩ</td>
          <td>ËæÉÊÖ¢</td>
          <td>Êõ¥Âø´</td>
      </tr>
      <tr>
          <td>ÂäüËÉΩ</td>
          <td>‰ªÖÊîØÊåÅÊñπÊ≥ïÁ∫ß</td>
          <td>ÊîØÊåÅÂ≠óÊÆµ„ÄÅÊûÑÈÄ†Âô®Á≠â</td>
      </tr>
      <tr>
          <td>Â§çÊùÇÂ∫¶</td>
          <td>ÁÆÄÂçï</td>
          <td>Â§çÊùÇ</td>
      </tr>
      <tr>
          <td>‰æùËµñ</td>
          <td>‰ªÖÈúÄSpring</td>
          <td>ÈúÄÁâπÊÆäÁºñËØëÂô®</td>
      </tr>
  </tbody>
</table></div>
<h3 id="ÂÖ´ÊúÄ‰Ω≥ÂÆûË∑µÂª∫ËÆÆ">ÂÖ´„ÄÅÊúÄ‰Ω≥ÂÆûË∑µÂª∫ËÆÆ
</h3><ul>
<li>ÂàáÈù¢Á≤íÂ∫¶ÊéßÂà∂Ôºö‰∏Ä‰∏™ÂàáÈù¢Âè™ÂÖ≥Ê≥®‰∏Ä‰∏™Ê®™ÂàáÂÖ≥Ê≥®ÁÇπ</li>
<li>ÂàáÁÇπË°®ËææÂºè‰ºòÂåñÔºöÈÅøÂÖçËøá‰∫éÂÆΩÊ≥õÁöÑÂåπÈÖç</li>
<li>Ê≥®ÊÑè‰ª£ÁêÜÈôêÂà∂Ôºö
<ul>
<li>Ëá™Ë∞ÉÁî®ÈóÆÈ¢òÔºàÂÜÖÈÉ®ÊñπÊ≥ïË∞ÉÁî®‰∏çËµ∞‰ª£ÁêÜÔºâ</li>
<li>finalÊñπÊ≥ï‰∏çËÉΩË¢´‰ª£ÁêÜ</li>
</ul>
</li>
<li>ÊÄßËÉΩËÄÉÈáèÔºö
<ul>
<li>Â∞ΩÈáèÂáèÂ∞ëÂàáÈù¢ÈÄªËæëÁöÑÂ§çÊùÇÂ∫¶</li>
<li>ÁéØÁªïÈÄöÁü•‰∏≠ÁöÑËÄóÊó∂Êìç‰ΩúËÄÉËôëÂºÇÊ≠•</li>
</ul>
</li>
<li>Ë∞ÉËØïÊäÄÂ∑ßÔºö
<ul>
<li>‰ΩøÁî®AopContext.currentProxy()Ëé∑ÂèñÂΩìÂâç‰ª£ÁêÜ</li>
<li>ÈÄöËøá@OrderÊéßÂà∂Â§ö‰∏™ÂàáÈù¢ÁöÑÊâßË°åÈ°∫Â∫è</li>
</ul>
</li>
</ul>
<h3 id="‰πùÂÆåÊï¥Á§∫‰æãÊñπÊ≥ïÁ∫ßÊùÉÈôêÊéßÂà∂">‰πù„ÄÅÂÆåÊï¥Á§∫‰æãÔºöÊñπÊ≥ïÁ∫ßÊùÉÈôêÊéßÂà∂
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Ëá™ÂÆö‰πâÊùÉÈôêÊ≥®Ëß£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Target</span><span class="p">(</span><span class="n">ElementType</span><span class="p">.</span><span class="na">METHOD</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">RequiresPermission</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="nf">value</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÂàáÈù¢ÂÆûÁé∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Aspect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PermissionAspect</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AuthService</span><span class="w"> </span><span class="n">authService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;@annotation(requiresPermission)&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">checkPermission</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span><span class="w"> </span><span class="n">pjp</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">RequiresPermission</span><span class="w"> </span><span class="n">requiresPermission</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ëé∑ÂèñÂΩìÂâçÁî®Êà∑</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CurrentUser</span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ê£ÄÊü•ÊùÉÈôê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">authService</span><span class="p">.</span><span class="na">hasPermissions</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">requiresPermission</span><span class="p">.</span><span class="na">value</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AccessDeniedException</span><span class="p">(</span><span class="s">&#34;ÊùÉÈôê‰∏çË∂≥&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ‰ΩøÁî®Á§∫‰æã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequiresPermission</span><span class="p">(</span><span class="s">&#34;order:create&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createOrder</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ‰∏öÂä°ÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÄöËøáAOPÔºåÂèØ‰ª•Â∞ÜÊùÉÈôêÊ†°È™åÈÄªËæë‰∏é‰∏öÂä°‰ª£Á†ÅÂÆåÂÖ®Ëß£ËÄ¶ÔºåÂÆûÁé∞Â£∞ÊòéÂºèÁöÑÊùÉÈôêÊéßÂà∂„ÄÇ</p>
<hr>
<h2 id="‰ΩøÁî®aopÂÆûÁé∞ÁôªÂΩïÊ†°È™å">‰ΩøÁî®AOPÂÆûÁé∞ÁôªÂΩïÊ†°È™å
</h2><h3 id="‰∏ÄaopÂü∫Á°ÄÊ¶ÇÂøµ">‰∏Ä„ÄÅAOPÂü∫Á°ÄÊ¶ÇÂøµ
</h3><p>AOPÔºàAspect-Oriented ProgrammingÔºåÈù¢ÂêëÂàáÈù¢ÁºñÁ®ãÔºâÊòØ‰∏ÄÁßçÁºñÁ®ãËåÉÂºèÔºåÁî®‰∫éÂ∞ÜÊ®™ÂàáÂÖ≥Ê≥®ÁÇπÔºàÂ¶ÇÊó•Âøó„ÄÅ‰∫ãÂä°„ÄÅÂÆâÂÖ®Á≠âÔºâ‰∏é‰∏öÂä°ÈÄªËæëÂàÜÁ¶ª„ÄÇÊ†∏ÂøÉÊ¶ÇÂøµÂåÖÊã¨Ôºö</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Ê¶ÇÂøµ</th>
          <th>ËØ¥Êòé</th>
          <th>ÂØπÂ∫î‰ª£Á†ÅÁ§∫‰æã</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ÂàáÈù¢(Aspect)</td>
          <td>Â∞ÅË£ÖÊ®™ÂàáÈÄªËæëÁöÑÊ®°Âùó</td>
          <td>GlobalOperationAspectÁ±ª</td>
      </tr>
      <tr>
          <td>ËøûÊé•ÁÇπ(JoinPoint)</td>
          <td>Á®ãÂ∫èÊâßË°å‰∏≠ÁöÑÁâπÂÆöÁÇπ</td>
          <td>interceptorDoÊñπÊ≥ïÁöÑJoinPointÂèÇÊï∞</td>
      </tr>
      <tr>
          <td>ÈÄöÁü•(Advice)</td>
          <td>ÂàáÈù¢Âú®ÁâπÂÆöËøûÊé•ÁÇπÁöÑÂä®‰Ωú</td>
          <td>@BeforeÊ≥®Ëß£ÁöÑÊñπÊ≥ï</td>
      </tr>
      <tr>
          <td>ÂàáÁÇπ(Pointcut)</td>
          <td>ÂåπÈÖçËøûÊé•ÁÇπÁöÑË°®ËææÂºè</td>
          <td>@annotation(com.easylive.web.annotation.GlobalInterceptor)</td>
      </tr>
      <tr>
          <td>ÂºïÂÖ•(Introduction)</td>
          <td>ÂêëÁé∞ÊúâÁ±ªÊ∑ªÂä†Êñ∞ÊñπÊ≥ï/Â±ûÊÄß</td>
          <td>Êú¨‰æãÊú™‰ΩøÁî®</td>
      </tr>
      <tr>
          <td>ÁõÆÊ†áÂØπË±°(Target)</td>
          <td>Ë¢´ÈÄöÁü•ÁöÑÂØπË±°</td>
          <td>Â¶ÇloadAllVideoÊñπÊ≥ïÊâÄÂú®ÁöÑController</td>
      </tr>
  </tbody>
</table></div>
<h3 id="‰∫åÁôªÂΩïÊ†°È™åÂÆûÁé∞ËØ¶Ëß£">‰∫å„ÄÅÁôªÂΩïÊ†°È™åÂÆûÁé∞ËØ¶Ëß£
</h3><h4 id="1-ÂÆö‰πâÊ≥®Ëß£Ê†áËÆ∞ÈúÄË¶ÅÊã¶Êà™ÁöÑÊñπÊ≥ï">1. ÂÆö‰πâÊ≥®Ëß£ÔºàÊ†áËÆ∞ÈúÄË¶ÅÊã¶Êà™ÁöÑÊñπÊ≥ïÔºâ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Target</span><span class="p">({</span><span class="n">ElementType</span><span class="p">.</span><span class="na">METHOD</span><span class="p">,</span><span class="w"> </span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">GlobalInterceptor</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">checkLogin</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰Ωú‰∏∫ÂÖÉÊï∞ÊçÆÊ†áËÆ∞ÈúÄË¶ÅÊã¶Êà™ÁöÑÊñπÊ≥ï</li>
<li>ÈÄöËøácheckLoginÂ±ûÊÄßÁÅµÊ¥ªÊéßÂà∂ÊòØÂê¶ËøõË°åÁôªÂΩïÊ†°È™å</li>
</ul>
<h4 id="2-ÂÆûÁé∞ÂàáÈù¢ÈÄªËæë">2. ÂÆûÁé∞ÂàáÈù¢ÈÄªËæë
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Aspect</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GlobalOperationAspect</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RedisUtils</span><span class="w"> </span><span class="n">redisUtils</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÂÆö‰πâÂàáÁÇπÔºöÊã¶Êà™Â∏¶ÊúâGlobalInterceptorÊ≥®Ëß£ÁöÑÊñπÊ≥ï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Before</span><span class="p">(</span><span class="s">&#34;@annotation(com.easylive.web.annotation.GlobalInterceptor)&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">interceptorDo</span><span class="p">(</span><span class="n">JoinPoint</span><span class="w"> </span><span class="n">point</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">MethodSignature</span><span class="p">)</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="na">getSignature</span><span class="p">()).</span><span class="na">getMethod</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">GlobalInterceptor</span><span class="w"> </span><span class="n">interceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">GlobalInterceptor</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">interceptor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">interceptor</span><span class="p">.</span><span class="na">checkLogin</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">checkLogin</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkLogin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">ServletRequestAttributes</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">RequestContextHolder</span><span class="p">.</span><span class="na">getRequestAttributes</span><span class="p">()).</span><span class="na">getRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TOKEN_WEB</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringTools</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">token</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_901</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TokenUserInfoDto</span><span class="w"> </span><span class="n">userInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TokenUserInfoDto</span><span class="p">)</span><span class="w"> </span><span class="n">redisUtils</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_TOKEN_WEB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">userInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_901</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-‰∏öÂä°ÊñπÊ≥ïÂ∫îÁî®">3. ‰∏öÂä°ÊñπÊ≥ïÂ∫îÁî®
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GlobalInterceptor</span><span class="p">(</span><span class="n">checkLogin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseVO</span><span class="w"> </span><span class="nf">loadAllVideo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">TokenUserInfoDto</span><span class="w"> </span><span class="n">userInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTokenUserInfoDto</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ...‰∏öÂä°ÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰∏âÊâßË°åÊµÅÁ®ãÂàÜÊûê">‰∏â„ÄÅÊâßË°åÊµÅÁ®ãÂàÜÊûê
</h3><ul>
<li>ÊñπÊ≥ïË¢´Ë∞ÉÁî® ‚Üí AOPÂàáÈù¢Êã¶Êà™ ‚Üí Âà§Êñ≠Ê≥®Ëß£Â±ûÊÄß ‚Üí Ê†°È™åÁôªÂΩï ‚Üí ÈÄöËøáÂàôÊâßË°å‰∏öÂä°ÈÄªËæëÔºåÂê¶ÂàôÊäõÂá∫ÂºÇÂ∏∏</li>
</ul>
<h3 id="ÂõõËÆæËÆ°‰ºòÂäøÂàÜÊûê">Âõõ„ÄÅËÆæËÆ°‰ºòÂäøÂàÜÊûê
</h3><ul>
<li>Ëß£ËÄ¶ÊÄßÔºöÂ∞ÜÂÆâÂÖ®Ê†°È™å‰∏é‰∏öÂä°ÈÄªËæëÂàÜÁ¶ª</li>
<li>ÁÅµÊ¥ªÊÄßÔºöÊ≥®Ëß£ÂºÄÂÖ≥ÊéßÂà∂Ê†°È™åÔºåÂèØÊâ©Â±ïÂÖ∂‰ªñËßÑÂàô</li>
<li>‰∏ÄËá¥ÊÄßÔºöÊâÄÊúâControllerÊñπÊ≥ïÁªü‰∏ÄÂ§ÑÁêÜ</li>
<li>ÂèØÁª¥Êä§ÊÄßÔºöÊ†°È™åÈÄªËæëÈõÜ‰∏≠ÁÆ°ÁêÜÔºå‰øÆÊîπÊñπ‰æø</li>
</ul>
<h3 id="‰∫îÊâ©Â±ïÂ∫îÁî®Âú∫ÊôØ">‰∫î„ÄÅÊâ©Â±ïÂ∫îÁî®Âú∫ÊôØ
</h3><ol>
<li>Ê∑ªÂä†ÊùÉÈôêÊ†°È™å</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">GlobalInterceptor</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">checkLogin</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="nf">roles</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">{};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ÂàáÈù¢‰∏≠Ë°•ÂÖÖÊ†°È™å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">interceptor</span><span class="p">.</span><span class="na">roles</span><span class="p">().</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">checkRoles</span><span class="p">(</span><span class="n">interceptor</span><span class="p">.</span><span class="na">roles</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>ÂèÇÊï∞Ê†°È™å</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">validateParams</span><span class="p">(</span><span class="n">JoinPoint</span><span class="w"> </span><span class="n">point</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÂÆûÁé∞ÂèÇÊï∞Ê†°È™åÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>Êìç‰ΩúÊó•ÂøóËÆ∞ÂΩï</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@AfterReturning</span><span class="p">(</span><span class="n">pointcut</span><span class="o">=</span><span class="s">&#34;@annotation(interceptor)&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">returning</span><span class="o">=</span><span class="s">&#34;result&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">logOperation</span><span class="p">(</span><span class="n">JoinPoint</span><span class="w"> </span><span class="n">point</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ËÆ∞ÂΩïÊñπÊ≥ïË∞ÉÁî®Êó•Âøó</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂÖ≠ÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ-1">ÂÖ≠„ÄÅÊÄßËÉΩ‰ºòÂåñÂª∫ËÆÆ
</h3><ul>
<li>ÁºìÂ≠òÊ≥®Ëß£Ëß£ÊûêÁªìÊûú</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ConcurrentMap</span><span class="o">&lt;</span><span class="n">Method</span><span class="p">,</span><span class="w"> </span><span class="n">GlobalInterceptor</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">GlobalInterceptor</span><span class="w"> </span><span class="n">interceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">GlobalInterceptor</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂáèÂ∞ëÈáçÂ§çÊü•ËØ¢</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">request</span><span class="p">.</span><span class="na">setAttribute</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">USER_INFO_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">userInfo</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂºÇÊ≠•Êó•ÂøóËÆ∞ÂΩï</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Async</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">asyncLogOperation</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÂºÇÊ≠•ËÆ∞ÂΩïÊó•Âøó</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰∏ÉÂ∏∏ËßÅÈóÆÈ¢òËß£ÂÜ≥ÊñπÊ°à">‰∏É„ÄÅÂ∏∏ËßÅÈóÆÈ¢òËß£ÂÜ≥ÊñπÊ°à
</h3><ul>
<li>ÂÜÖÈÉ®ÊñπÊ≥ïË∞ÉÁî®‰∏çËµ∞AOPÔºöSpring AOPÂü∫‰∫é‰ª£ÁêÜÔºåÂÜÖÈÉ®Ë∞ÉÁî®‰∏çÁªèËøá‰ª£ÁêÜ„ÄÇËß£ÂÜ≥Ôºö‰ªéApplicationContextËé∑Âèñ‰ª£ÁêÜÂØπË±°Ë∞ÉÁî®</li>
<li>Â§öÂàáÈù¢ÊâßË°åÈ°∫Â∫èÔºö‰ΩøÁî®@OrderÊ≥®Ëß£ÊéßÂà∂È°∫Â∫èÔºåÈªòËÆ§ÊåâÂàáÈù¢ÂêçÁß∞Â≠óÊØçÈ°∫Â∫è</li>
<li>ÂºÇÂ∏∏Â§ÑÁêÜÔºö‰ΩøÁî®@AfterThrowingÂ§ÑÁêÜÁâπÂÆöÂºÇÂ∏∏ÔºåÁªìÂêàÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜÂô®Áªü‰∏ÄÂ§ÑÁêÜ</li>
</ul>
<p>ËøôÁßçÂü∫‰∫éÊ≥®Ëß£ÂíåAOPÁöÑÁôªÂΩïÊ†°È™åÂÆûÁé∞ÔºåÊòØSpringÁîüÊÄÅ‰∏≠ÂÖ∏ÂûãÁöÑÊùÉÈôêÊéßÂà∂ÊñπÊ°àÔºåÊó¢‰øùÊåÅ‰∫Ü‰ª£Á†ÅÁöÑÁÆÄÊ¥ÅÊÄßÔºåÂèàÊèê‰æõ‰∫ÜË∂≥Â§üÁöÑÁÅµÊ¥ªÊÄßÂíåÊâ©Â±ïËÉΩÂäõ„ÄÇ</p>
<hr>
<h2 id="ÁôªÂΩïÊ†°È™åÁöÑÂ§öÁßçÂÆûÁé∞ÊñπÂºè">ÁôªÂΩïÊ†°È™åÁöÑÂ§öÁßçÂÆûÁé∞ÊñπÂºè
</h2><h3 id="1-Êã¶Êà™Âô®interceptorÂÆûÁé∞">1. Êã¶Êà™Âô®(Interceptor)ÂÆûÁé∞
</h3><ul>
<li>Âü∫‰∫éSpring MVCÁöÑÊã¶Êà™Âô®Êú∫Âà∂ÔºåÂú®ÊéßÂà∂Âô®ÊñπÊ≥ïÊâßË°åÂâçÂêéËøõË°åÊã¶Êà™</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AuthInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">HandlerInterceptor</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">preHandle</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">&#34;Authorization&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">checkToken</span><span class="p">(</span><span class="n">token</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">response</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">401</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addInterceptors</span><span class="p">(</span><span class="n">InterceptorRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">addInterceptor</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AuthInterceptor</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">addPathPatterns</span><span class="p">(</span><span class="s">&#34;/api/**&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">excludePathPatterns</span><span class="p">(</span><span class="s">&#34;/api/login&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ºòÁÇπÔºöÈÖçÁΩÆÁÆÄÂçïÔºåÂü∫‰∫éURLÊ®°ÂºèÂåπÈÖçÔºåÊâßË°åÊó∂Êú∫Êó©‰∫éAOPÔºåÊÄßËÉΩÁ®çÂ•Ω</li>
<li>Áº∫ÁÇπÔºöÊó†Ê≥ïÂü∫‰∫éÊñπÊ≥ïÁ≤íÂ∫¶ÊéßÂà∂ÔºåÈöæ‰ª•Ëé∑ÂèñÊñπÊ≥ï‰∏äÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØ</li>
</ul>
<h3 id="2-ËøáÊª§Âô®filterÂÆûÁé∞">2. ËøáÊª§Âô®(Filter)ÂÆûÁé∞
</h3><ul>
<li>Âü∫‰∫éServletËßÑËåÉÁöÑËøáÊª§Âô®ÔºåÂú®ÊúÄÂ§ñÂ±ÇÂØπËØ∑Ê±ÇËøõË°åËøáÊª§</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AuthFilter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Filter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFilter</span><span class="p">(</span><span class="n">ServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">ServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">FilterChain</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="p">)</span><span class="w"> </span><span class="n">request</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">&#34;Authorization&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">checkToken</span><span class="p">(</span><span class="n">token</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">((</span><span class="n">HttpServletResponse</span><span class="p">)</span><span class="n">response</span><span class="p">).</span><span class="na">setStatus</span><span class="p">(</span><span class="n">401</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">chain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FilterConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">FilterRegistrationBean</span><span class="o">&lt;</span><span class="n">AuthFilter</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">authFilter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">FilterRegistrationBean</span><span class="o">&lt;</span><span class="n">AuthFilter</span><span class="o">&gt;</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FilterRegistrationBean</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">reg</span><span class="p">.</span><span class="na">setFilter</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AuthFilter</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">reg</span><span class="p">.</span><span class="na">addUrlPatterns</span><span class="p">(</span><span class="s">&#34;/api/*&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">reg</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ºòÁÇπÔºöÊâßË°åÊó∂Êú∫ÊúÄÊó©ÔºåÊÄßËÉΩÊúÄÂ•ΩÔºåÂèØÂ§ÑÁêÜÈùôÊÄÅËµÑÊ∫êÁ≠âÈùûSpringÁÆ°ÁêÜÁöÑËØ∑Ê±Ç</li>
<li>Áº∫ÁÇπÔºöÊó†Ê≥ïËé∑ÂèñSpring‰∏ä‰∏ãÊñá‰ø°ÊÅØÔºåÈÖçÁΩÆÁ≤íÂ∫¶ËæÉÁ≤ó</li>
</ul>
<h3 id="3-spring-securityÊ°ÜÊû∂">3. Spring SecurityÊ°ÜÊû∂
</h3><ul>
<li>SpringÂÆòÊñπÂÆâÂÖ®Ê°ÜÊû∂ÔºåÊèê‰æõÂÆåÊï¥ËÆ§ËØÅÊéàÊùÉËß£ÂÜ≥ÊñπÊ°à</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableWebSecurity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SecurityConfig</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">WebSecurityConfigurerAdapter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">http</span><span class="p">.</span><span class="na">authorizeRequests</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">antMatchers</span><span class="p">(</span><span class="s">&#34;/api/public/**&#34;</span><span class="p">).</span><span class="na">permitAll</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">anyRequest</span><span class="p">().</span><span class="na">authenticated</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">and</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addFilter</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JwtAuthFilter</span><span class="p">(</span><span class="n">authenticationManager</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JwtAuthFilter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">OncePerRequestFilter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFilterInternal</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="n">FilterChain</span><span class="w"> </span><span class="n">filterChain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// JWTÊ†°È™åÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ºòÁÇπÔºöÂäüËÉΩÂÖ®Èù¢ÔºåÊîØÊåÅÂ§öÁßçËÆ§ËØÅÊñπÂºèÔºåÂÜÖÁΩÆCSRFÈò≤Êä§ÔºåÁ§æÂå∫ÊîØÊåÅÂ•Ω</li>
<li>Áº∫ÁÇπÔºöÂ≠¶‰π†Êõ≤Á∫øÈô°Â≥≠ÔºåÈÖçÁΩÆÂ§çÊùÇ</li>
</ul>
<h3 id="4-ÁΩëÂÖ≥Â±ÇÁªü‰∏ÄÊ†°È™å">4. ÁΩëÂÖ≥Â±ÇÁªü‰∏ÄÊ†°È™å
</h3><ul>
<li>Âú®APIÁΩëÂÖ≥(Â¶ÇSpring Cloud Gateway)Â±ÇÁªü‰∏ÄÂ§ÑÁêÜËÆ§ËØÅ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AuthFilter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">GlobalFilter</span><span class="p">,</span><span class="w"> </span><span class="n">Ordered</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">ServerWebExchange</span><span class="w"> </span><span class="n">exchange</span><span class="p">,</span><span class="w"> </span><span class="n">GatewayFilterChain</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getRequest</span><span class="p">().</span><span class="na">getHeaders</span><span class="p">().</span><span class="na">getFirst</span><span class="p">(</span><span class="s">&#34;Authorization&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">checkToken</span><span class="p">(</span><span class="n">token</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">exchange</span><span class="p">.</span><span class="na">getResponse</span><span class="p">().</span><span class="na">setStatusCode</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNAUTHORIZED</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getResponse</span><span class="p">().</span><span class="na">setComplete</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">exchange</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ºòÁÇπÔºöÁªü‰∏ÄÂÖ•Âè£ÔºåÈÅøÂÖçÊØè‰∏™ÊúçÂä°ÈáçÂ§çÂÆûÁé∞ÔºåÊÄßËÉΩÊçüËÄóÊúÄÂ∞èÂåñ</li>
<li>Áº∫ÁÇπÔºöÈúÄË¶ÅÈ¢ùÂ§ñÁª¥Êä§ÁΩëÂÖ≥ÊúçÂä°Ôºå‰ªÖÈÄÇÁî®‰∫éÂæÆÊúçÂä°Êû∂ÊûÑ</li>
</ul>
<h3 id="5-ÊñπÊ≥ïÂèÇÊï∞Ëß£ÊûêÂô®">5. ÊñπÊ≥ïÂèÇÊï∞Ëß£ÊûêÂô®
</h3><ul>
<li>ÈÄöËøáËá™ÂÆö‰πâÂèÇÊï∞Ëß£ÊûêÂô®Ëá™Âä®Ê≥®ÂÖ•Áî®Êà∑‰ø°ÊÅØ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CurrentUserArgumentResolver</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">HandlerMethodArgumentResolver</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">supportsParameter</span><span class="p">(</span><span class="n">MethodParameter</span><span class="w"> </span><span class="n">parameter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">parameter</span><span class="p">.</span><span class="na">hasParameterAnnotation</span><span class="p">(</span><span class="n">CurrentUser</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">resolveArgument</span><span class="p">(</span><span class="n">MethodParameter</span><span class="w"> </span><span class="n">parameter</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                                 </span><span class="n">ModelAndViewContainer</span><span class="w"> </span><span class="n">mavContainer</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                 </span><span class="n">NativeWebRequest</span><span class="w"> </span><span class="n">webRequest</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                 </span><span class="n">WebDataBinderFactory</span><span class="w"> </span><span class="n">binderFactory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">webRequest</span><span class="p">.</span><span class="na">getNativeRequest</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">&#34;Authorization&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getUserFromToken</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ‰ΩøÁî®Ê≥®Ëß£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/userinfo&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">UserInfo</span><span class="w"> </span><span class="nf">getUserInfo</span><span class="p">(</span><span class="nd">@CurrentUser</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">getInfo</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ºòÁÇπÔºö‰ΩøÁî®ÁÆÄÊ¥ÅÔºåÁõ¥Êé•Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÔºå‰∏é‰∏öÂä°‰ª£Á†ÅËá™ÁÑ∂ÈõÜÊàê</li>
<li>Áº∫ÁÇπÔºöÂè™ÈÄÇÁî®‰∫éËé∑ÂèñÂΩìÂâçÁî®Êà∑Âú∫ÊôØÔºåÈúÄË¶ÅÈÖçÂêàÂÖ∂‰ªñÊ†°È™åÊñπÂºè‰ΩøÁî®</li>
</ul>
<h3 id="6-ÂØπÊØîÊÄªÁªì">6. ÂØπÊØîÊÄªÁªì
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÊñπÂºè</th>
          <th>ÈÄÇÁî®Âú∫ÊôØ</th>
          <th>‰ºòÁÇπ</th>
          <th>Áº∫ÁÇπ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>AOPÊ≥®Ëß£</td>
          <td>ÊñπÊ≥ïÁ≤íÂ∫¶ÁÅµÊ¥ªÊéßÂà∂</td>
          <td>ÁÅµÊ¥ª„ÄÅÂèØÊâ©Â±ïÊÄßÂº∫</td>
          <td>ÊÄßËÉΩÁ®çÂ∑Æ</td>
      </tr>
      <tr>
          <td>Êã¶Êà™Âô®</td>
          <td>URLÁªü‰∏ÄÊ†°È™å</td>
          <td>ÈÖçÁΩÆÁÆÄÂçï„ÄÅÊÄßËÉΩËæÉÂ•Ω</td>
          <td>Á≤íÂ∫¶ËæÉÁ≤ó</td>
      </tr>
      <tr>
          <td>ËøáÊª§Âô®</td>
          <td>ÊúÄÂ§ñÂ±ÇËØ∑Ê±ÇËøáÊª§</td>
          <td>ÊÄßËÉΩÊúÄÂ•Ω</td>
          <td>Êó†Ê≥ïÁî®SpringÁâπÊÄß</td>
      </tr>
      <tr>
          <td>Spring Security</td>
          <td>ÂÆåÊï¥ÂÆâÂÖ®ÊñπÊ°à</td>
          <td>ÂäüËÉΩÂÖ®Èù¢</td>
          <td>Â§çÊùÇ„ÄÅÂ≠¶‰π†ÊàêÊú¨È´ò</td>
      </tr>
      <tr>
          <td>APIÁΩëÂÖ≥</td>
          <td>ÂæÆÊúçÂä°Êû∂ÊûÑ</td>
          <td>Áªü‰∏ÄÁÆ°ÁêÜ„ÄÅÊÄßËÉΩÂ•Ω</td>
          <td>ÈúÄÈ¢ùÂ§ñÂü∫Á°ÄËÆæÊñΩ</td>
      </tr>
      <tr>
          <td>ÂèÇÊï∞Ëß£ÊûêÂô®</td>
          <td>Ëá™Âä®Ê≥®ÂÖ•Áî®Êà∑‰ø°ÊÅØ</td>
          <td>‰ΩøÁî®ÁÆÄÊ¥Å</td>
          <td>ÈúÄÈÖçÂêàÂÖ∂‰ªñÊñπÂºè</td>
      </tr>
  </tbody>
</table></div>
<h3 id="7-ÈÄâÊã©Âª∫ËÆÆ">7. ÈÄâÊã©Âª∫ËÆÆ
</h3><ul>
<li>Âçï‰ΩìÂ∫îÁî®ÔºöAOPÊ≥®Ëß£ + Êã¶Êà™Âô®ÁªÑÂêà</li>
<li>ÂæÆÊúçÂä°Êû∂ÊûÑÔºöÁΩëÂÖ≥Áªü‰∏ÄËÆ§ËØÅ + ÊúçÂä°ÂÜÖAOPË°•ÂÖÖ</li>
<li>È´òÂÆâÂÖ®ÊÄßË¶ÅÊ±ÇÔºöSpring Security</li>
<li>È´òÊÄßËÉΩË¶ÅÊ±ÇÔºöËøáÊª§Âô® + ÂèÇÊï∞Ëß£ÊûêÂô®</li>
<li>Âø´ÈÄüÂºÄÂèëÔºöAOPÊ≥®Ëß£ÊñπÂºèÊúÄÁÆÄÂçïÁõ¥Êé•</li>
</ul>
<p>ÂÆûÈôÖÈ°πÁõÆ‰∏≠ÔºåÈÄöÂ∏∏‰ºöÁªÑÂêà‰ΩøÁî®Â§öÁßçÊñπÂºèÔºåÊØîÂ¶ÇÁî®ËøáÊª§Âô®ÂÅöÂü∫Á°ÄÊ†°È™åÔºåAOPÂÅöÁªÜÁ≤íÂ∫¶ÊéßÂà∂ÔºåÂèÇÊï∞Ëß£ÊûêÂô®Êñπ‰æøËé∑ÂèñÁî®Êà∑‰ø°ÊÅØ„ÄÇ</p>
<hr>
<h2 id="jwtÂÆûÁé∞ÁôªÂΩïÊ†°È™åÁöÑÂÆåÊï¥ÊñπÊ°à">JWTÂÆûÁé∞ÁôªÂΩïÊ†°È™åÁöÑÂÆåÊï¥ÊñπÊ°à
</h2><h3 id="‰∏ÄjwtÂü∫Á°ÄÊ¶ÇÂøµ">‰∏Ä„ÄÅJWTÂü∫Á°ÄÊ¶ÇÂøµ
</h3><h4 id="1-jwtÁªÑÊàêÁªìÊûÑ">1. JWTÁªÑÊàêÁªìÊûÑ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">header</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">signature</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>HeaderÔºöÂåÖÂê´‰ª§ÁâåÁ±ªÂûãÂíåÁ≠æÂêçÁÆóÊ≥ï</li>
<li>PayloadÔºöÂ≠òÊîæÁî®Êà∑‰ø°ÊÅØÂíåÂÖ∂‰ªñÊï∞ÊçÆ</li>
<li>SignatureÔºöÈò≤Ê≠¢‰ª§ÁâåË¢´ÁØ°ÊîπÁöÑÁ≠æÂêç</li>
</ul>
<h4 id="2-Â∑•‰ΩúÊµÅÁ®ã">2. Â∑•‰ΩúÊµÅÁ®ã
</h4><ul>
<li>Áî®Êà∑ÁôªÂΩï ‚Üí ÊúçÂä°Á´ØÁîüÊàêJWT ‚Üí ÂÆ¢Êà∑Á´ØÂ≠òÂÇ®Âπ∂Êê∫Â∏¶JWTËÆøÈóÆAPI ‚Üí ÊúçÂä°Á´ØÊ†°È™åJWT</li>
</ul>
<h3 id="‰∫åspring-bootÂÆûÁé∞ÊñπÊ°à">‰∫å„ÄÅSpring BootÂÆûÁé∞ÊñπÊ°à
</h3><h4 id="1-Ê∑ªÂä†‰æùËµñ">1. Ê∑ªÂä†‰æùËµñ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>io.jsonwebtoken<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>jjwt-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>0.11.5<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>io.jsonwebtoken<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>jjwt-impl<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>0.11.5<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>io.jsonwebtoken<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>jjwt-jackson<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>0.11.5<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-jwtÂ∑•ÂÖ∑Á±ª">2. JWTÂ∑•ÂÖ∑Á±ª
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JwtTokenUtil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${jwt.secret}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">secret</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${jwt.expiration}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">expiration</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÁîüÊàê‰ª§Áâå</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateToken</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Jwts</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setClaims</span><span class="p">(</span><span class="n">claims</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setSubject</span><span class="p">(</span><span class="n">username</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setIssuedAt</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setExpiration</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">expiration</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">1000</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">signWith</span><span class="p">(</span><span class="n">getSigningKey</span><span class="p">(),</span><span class="w"> </span><span class="n">SignatureAlgorithm</span><span class="p">.</span><span class="na">HS256</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">compact</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// È™åËØÅ‰ª§Áâå</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">validateToken</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Jwts</span><span class="p">.</span><span class="na">parserBuilder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setSigningKey</span><span class="p">(</span><span class="n">getSigningKey</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">parseClaimsJws</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ‰ªé‰ª§ÁâåËé∑ÂèñÁî®Êà∑Âêç</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getUsernameFromToken</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Jwts</span><span class="p">.</span><span class="na">parserBuilder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setSigningKey</span><span class="p">(</span><span class="n">getSigningKey</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">parseClaimsJws</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">getBody</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">getSubject</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SecretKey</span><span class="w"> </span><span class="nf">getSigningKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Keys</span><span class="p">.</span><span class="na">hmacShaKeyFor</span><span class="p">(</span><span class="n">secret</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-ÁôªÂΩïÊé•Âè£ÂÆûÁé∞">3. ÁôªÂΩïÊé•Âè£ÂÆûÁé∞
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/auth&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AuthController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JwtTokenUtil</span><span class="w"> </span><span class="n">jwtTokenUtil</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/login&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">login</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">LoginRequest</span><span class="w"> </span><span class="n">loginRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">authenticated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authenticate</span><span class="p">(</span><span class="n">loginRequest</span><span class="p">.</span><span class="na">getUsername</span><span class="p">(),</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                                          </span><span class="n">loginRequest</span><span class="p">.</span><span class="na">getPassword</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">authenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNAUTHORIZED</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwtTokenUtil</span><span class="p">.</span><span class="na">generateToken</span><span class="p">(</span><span class="n">loginRequest</span><span class="p">.</span><span class="na">getUsername</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">response</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;token&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;admin&#34;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s">&#34;123456&#34;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">password</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="4-jwtÊ†°È™åËøáÊª§Âô®">4. JWTÊ†°È™åËøáÊª§Âô®
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JwtAuthFilter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">OncePerRequestFilter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JwtTokenUtil</span><span class="w"> </span><span class="n">jwtTokenUtil</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFilterInternal</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                                  </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                                  </span><span class="n">FilterChain</span><span class="w"> </span><span class="n">filterChain</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">&#34;Authorization&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">token</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">token</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&#34;Bearer &#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">jwt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">token</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">7</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jwtTokenUtil</span><span class="p">.</span><span class="na">validateToken</span><span class="p">(</span><span class="n">jwt</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwtTokenUtil</span><span class="p">.</span><span class="na">getUsernameFromToken</span><span class="p">(</span><span class="n">jwt</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">UsernamePasswordAuthenticationToken</span><span class="w"> </span><span class="n">authentication</span><span class="w"> </span><span class="o">=</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">UsernamePasswordAuthenticationToken</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">SecurityContextHolder</span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">setAuthentication</span><span class="p">(</span><span class="n">authentication</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">filterChain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="5-ÂÆâÂÖ®ÈÖçÁΩÆ">5. ÂÆâÂÖ®ÈÖçÁΩÆ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableWebSecurity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SecurityConfig</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">WebSecurityConfigurerAdapter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JwtAuthFilter</span><span class="w"> </span><span class="n">jwtAuthFilter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">HttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">http</span><span class="p">.</span><span class="na">csrf</span><span class="p">().</span><span class="na">disable</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">authorizeRequests</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">antMatchers</span><span class="p">(</span><span class="s">&#34;/auth/login&#34;</span><span class="p">).</span><span class="na">permitAll</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">anyRequest</span><span class="p">().</span><span class="na">authenticated</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">and</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">sessionManagement</span><span class="p">().</span><span class="na">sessionCreationPolicy</span><span class="p">(</span><span class="n">SessionCreationPolicy</span><span class="p">.</span><span class="na">STATELESS</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">and</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">addFilterBefore</span><span class="p">(</span><span class="n">jwtAuthFilter</span><span class="p">,</span><span class="w"> </span><span class="n">UsernamePasswordAuthenticationFilter</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰∏âÂÆ¢Êà∑Á´Ø‰ΩøÁî®ÊñπÂºè">‰∏â„ÄÅÂÆ¢Êà∑Á´Ø‰ΩøÁî®ÊñπÂºè
</h3><h4 id="1-ÁôªÂΩïËé∑Âèñtoken">1. ÁôªÂΩïËé∑Âèñtoken
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">POST /auth/login
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;username&#34;: &#34;admin&#34;,
</span></span><span class="line"><span class="cl">  &#34;password&#34;: &#34;123456&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂìçÂ∫îÁ§∫‰æãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;token&#34;</span><span class="p">:</span> <span class="s2">&#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTY1...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-ËÆøÈóÆÂèó‰øùÊä§api">2. ËÆøÈóÆÂèó‰øùÊä§API
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET /api/protected
</span></span><span class="line"><span class="cl">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂõõÈ´òÁ∫ßÂäüËÉΩÂÆûÁé∞">Âõõ„ÄÅÈ´òÁ∫ßÂäüËÉΩÂÆûÁé∞
</h3><ol>
<li>‰ª§ÁâåÂà∑Êñ∞Êú∫Âà∂</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/refresh&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">refreshToken</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">oldToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">&#34;Authorization&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oldToken</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">oldToken</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&#34;Bearer &#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwtTokenUtil</span><span class="p">.</span><span class="na">getUsernameFromToken</span><span class="p">(</span><span class="n">oldToken</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">7</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">newToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwtTokenUtil</span><span class="p">.</span><span class="na">generateToken</span><span class="p">(</span><span class="n">username</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ËøîÂõûÊñ∞token...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="p">.</span><span class="na">badRequest</span><span class="p">().</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>ÈªëÂêçÂçïÂÆûÁé∞ÔºàÊ≥®ÈîÄÂäüËÉΩÔºâ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tokenBlacklist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">invalidateToken</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tokenBlacklist</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isTokenValid</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">tokenBlacklist</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">validateToken</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>Â§öËÆæÂ§áÁôªÂΩïÁÆ°ÁêÜ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">userDeviceTokens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateToken</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">deviceId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ...ÁîüÊàêtoken</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">userDeviceTokens</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">()).</span><span class="na">add</span><span class="p">(</span><span class="n">deviceId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">token</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">logoutDevice</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">deviceId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">userDeviceTokens</span><span class="p">.</span><span class="na">getOrDefault</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptySet</span><span class="p">()).</span><span class="na">remove</span><span class="p">(</span><span class="n">deviceId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰∫îÂÆâÂÖ®ÊúÄ‰Ω≥ÂÆûË∑µ">‰∫î„ÄÅÂÆâÂÖ®ÊúÄ‰Ω≥ÂÆûË∑µ
</h3><ul>
<li>‰ΩøÁî®HTTPSÔºöÈò≤Ê≠¢‰ª§ÁâåË¢´Êà™Ëé∑</li>
<li>ËÆæÁΩÆÂêàÁêÜËøáÊúüÊó∂Èó¥ÔºöÈÄöÂ∏∏2Â∞èÊó∂-7Â§©</li>
<li>‰∏çË¶ÅÂ≠òÂÇ®ÊïèÊÑü‰ø°ÊÅØÔºöJWTÂÜÖÂÆπÂèØ‰ª•Ë¢´Ëß£Á†Å</li>
<li>‰ΩøÁî®Âº∫ÂØÜÈí•ÔºöËá≥Â∞ë256‰ΩçÁöÑÂØÜÈí•</li>
<li>ÂÆûÁé∞‰ª§ÁâåÂà∑Êñ∞ÔºöÂáèÂ∞ëÈïøÊúüÊúâÊïàÁöÑÈ£éÈô©</li>
<li>Èò≤ËåÉCSRFÔºöÂç≥‰ΩøJWT‰∏çÊòìÂèóCSRFÂΩ±Âìç‰πüÂ∫îÈò≤ËåÉ</li>
<li>Êó•ÂøóÁõëÊéßÔºöËÆ∞ÂΩïÂºÇÂ∏∏‰ª§ÁâåÂ∞ùËØï</li>
</ul>
<h3 id="ÂÖ≠‰∏éÂÖ∂‰ªñÊñπÊ°àÁöÑÂØπÊØî">ÂÖ≠„ÄÅ‰∏éÂÖ∂‰ªñÊñπÊ°àÁöÑÂØπÊØî
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÁâπÊÄß</th>
          <th>JWT</th>
          <th>‰º†ÁªüSession</th>
          <th>OAuth2</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Áä∂ÊÄÅ</td>
          <td>Êó†Áä∂ÊÄÅ</td>
          <td>ÊúâÁä∂ÊÄÅ</td>
          <td>ÂèØÊó†Áä∂ÊÄÅ</td>
      </tr>
      <tr>
          <td>ÊÄßËÉΩ</td>
          <td>È´ò</td>
          <td>‰∏≠Á≠â</td>
          <td>‰∏≠Á≠â</td>
      </tr>
      <tr>
          <td>Êâ©Â±ïÊÄß</td>
          <td>Âº∫</td>
          <td>Âº±</td>
          <td>Âº∫</td>
      </tr>
      <tr>
          <td>ÈÄÇÁî®Âú∫ÊôØ</td>
          <td>API/ÂæÆÊúçÂä°</td>
          <td>‰º†ÁªüWebÂ∫îÁî®</td>
          <td>Á¨¨‰∏âÊñπÁôªÂΩï</td>
      </tr>
      <tr>
          <td>ÂÆûÁé∞Â§çÊùÇÂ∫¶</td>
          <td>ÁÆÄÂçï</td>
          <td>ÁÆÄÂçï</td>
          <td>Â§çÊùÇ</td>
      </tr>
  </tbody>
</table></div>
<p>JWTÁâπÂà´ÈÄÇÂêàÁé∞‰ª£ÂâçÂêéÁ´ØÂàÜÁ¶ªÊû∂ÊûÑÂíåÂæÆÊúçÂä°Âú∫ÊôØÔºåÂÆÉÁöÑÊó†Áä∂ÊÄÅÁâπÊÄßÂèØ‰ª•ÊòæËëóÂáèËΩªÊúçÂä°Âô®ÂéãÂäõÔºåÁÆÄÂåñÊ®™ÂêëÊâ©Â±ï„ÄÇ‰ΩÜÂØπ‰∫éÈúÄË¶ÅÂç≥Êó∂Êí§ÈîÄ‰ª§ÁâåÁöÑÂú∫ÊôØÔºåÈúÄË¶ÅÈ¢ùÂ§ñÂÆûÁé∞ÈªëÂêçÂçïÊú∫Âà∂„ÄÇ</p>
<hr>
<h2 id="ÈÄöËøáaopÂÆûÁé∞Ê∂àÊÅØÈÄöÁü•">ÈÄöËøáAOPÂÆûÁé∞Ê∂àÊÅØÈÄöÁü•
</h2><h3 id="‰∏ÄÊï¥‰ΩìËÆæËÆ°ÊÄùË∑Ø">‰∏Ä„ÄÅÊï¥‰ΩìËÆæËÆ°ÊÄùË∑Ø
</h3><p>Êú¨ÂÆûÁé∞ÈÄöËøáËá™ÂÆö‰πâÊ≥®Ëß£ <code>@RecordUserMessage</code> Âíå AOP ÂàáÈù¢ <code>UserMessageOperationAspect</code>ÔºåÂú®Áî®Êà∑ÊâßË°åÁâπÂÆöÊìç‰ΩúÔºàÂ¶ÇÁÇπËµû„ÄÅÊî∂ËóèÔºâÂêéËá™Âä®ËÆ∞ÂΩïÊ∂àÊÅØÈÄöÁü•„ÄÇ</p>
<ul>
<li>Ê≥®Ëß£È©±Âä®ÔºöÈÄöËøáÊ≥®Ëß£Ê†áËÆ∞ÈúÄË¶ÅËÆ∞ÂΩïÊ∂àÊÅØÁöÑÊñπÊ≥ï</li>
<li>ÂèÇÊï∞Ëá™Âä®ÊèêÂèñÔºö‰ªéÊñπÊ≥ïÂèÇÊï∞‰∏≠Êô∫ËÉΩÊèêÂèñÊ∂àÊÅØÁõ∏ÂÖ≥ÂÜÖÂÆπ</li>
<li>Á±ªÂûãÂä®ÊÄÅÂà§Êñ≠ÔºöÊ†πÊçÆÊìç‰ΩúÁ±ªÂûãËá™Âä®Ë∞ÉÊï¥Ê∂àÊÅØÁ±ªÂûã</li>
<li>Áî®Êà∑‰ø°ÊÅØËá™Âä®Ëé∑ÂèñÔºö‰ªéËØ∑Ê±ÇÂ§¥‰∏≠Ëß£ÊûêÂΩìÂâçÁî®Êà∑</li>
</ul>
<h3 id="‰∫åÊ†∏ÂøÉÁªÑ‰ª∂ËØ¶Ëß£">‰∫å„ÄÅÊ†∏ÂøÉÁªÑ‰ª∂ËØ¶Ëß£
</h3><h4 id="1-Ëá™ÂÆö‰πâÊ≥®Ëß£-recordusermessage">1. Ëá™ÂÆö‰πâÊ≥®Ëß£ @RecordUserMessage
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Target</span><span class="p">({</span><span class="n">ElementType</span><span class="p">.</span><span class="na">METHOD</span><span class="p">,</span><span class="w"> </span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">RecordUserMessage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MessageTypeEnum</span><span class="w"> </span><span class="nf">messageType</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ê†áËÆ∞ÈúÄË¶ÅËÆ∞ÂΩïÁî®Êà∑Ê∂àÊÅØÁöÑ Controller ÊñπÊ≥ï</li>
<li>ÊåáÂÆöÂü∫Êú¨Ê∂àÊÅØÁ±ªÂûãÔºàÂèØÂú®ÂàáÈù¢‰∏≠Ê†πÊçÆÊù°‰ª∂Ë∞ÉÊï¥Ôºâ</li>
</ul>
<h4 id="2-aopÂàáÈù¢ÂÆûÁé∞-usermessageoperationaspect">2. AOPÂàáÈù¢ÂÆûÁé∞ UserMessageOperationAspect
</h4><ul>
<li>ÁéØÁªïÈÄöÁü•‰∏ª‰Ωì</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;@annotation(com.easylive.annotation.RecordUserMessage)&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseVO</span><span class="w"> </span><span class="nf">interceptorDo</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span><span class="w"> </span><span class="n">point</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ResponseVO</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ResponseVO</span><span class="p">)</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">MethodSignature</span><span class="p">)</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="na">getSignature</span><span class="p">()).</span><span class="na">getMethod</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RecordUserMessage</span><span class="w"> </span><span class="n">recordUserMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">RecordUserMessage</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">recordUserMessage</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">saveUserMessage</span><span class="p">(</span><span class="n">recordUserMessage</span><span class="p">,</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="na">getArgs</span><span class="p">(),</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getParameters</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">BusinessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ...ÂºÇÂ∏∏Â§ÑÁêÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>‰ΩøÁî® @Around Á°Æ‰øùÂú®ÊñπÊ≥ïÊâßË°åÂêéÂ§ÑÁêÜ</p>
</li>
<li>
<p>ÈÄöËøá ProceedingJoinPoint Ëé∑ÂèñÊñπÊ≥ïÂèÇÊï∞ÂíåÊ≥®Ëß£</p>
</li>
<li>
<p>‰øùÊåÅÂéüÊñπÊ≥ïÁöÑËøîÂõûÁªìÊûú‰∏çÂèò</p>
</li>
<li>
<p>Ê∂àÊÅØ‰øùÂ≠òÈÄªËæë</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveUserMessage</span><span class="p">(</span><span class="n">RecordUserMessage</span><span class="w"> </span><span class="n">recordUserMessage</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="n">Parameter</span><span class="o">[]</span><span class="w"> </span><span class="n">parameters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractParameter</span><span class="p">(</span><span class="n">PARAMETERS_VIDEO_ID</span><span class="p">,</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">actionType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractParameter</span><span class="p">(</span><span class="n">PARAMETERS_ACTION_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">replyCommentId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractParameter</span><span class="p">(</span><span class="n">PARAMETERS_REPLY_COMMENT_ID</span><span class="p">,</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extractParameter</span><span class="p">(</span><span class="n">PARAMETERS_CONTENT</span><span class="p">,</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MessageTypeEnum</span><span class="w"> </span><span class="n">messageTypeEnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recordUserMessage</span><span class="p">.</span><span class="na">messageType</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">UserActionTypeEnum</span><span class="p">.</span><span class="na">VIDEO_COLLECT</span><span class="p">.</span><span class="na">getType</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">actionType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">messageTypeEnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageTypeEnum</span><span class="p">.</span><span class="na">COLLECTION</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">TokenUserInfoDto</span><span class="w"> </span><span class="n">userInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTokenUserInfoDto</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">userMessageService</span><span class="p">.</span><span class="na">saveUserMessage</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">videoId</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">userInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">userInfo</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">messageTypeEnum</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">content</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">replyCommentId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂèÇÊï∞ÊèêÂèñÊäÄÂ∑ßÔºöÈÄöËøáÂèÇÊï∞ÂêçÂåπÈÖçÔºà‰æùËµñÁºñËØëÊó∂‰øùÁïôÂèÇÊï∞ÂêçÔºâÔºåÊîØÊåÅÂ§öÁßçÂèÇÊï∞Á±ªÂûã</li>
</ul>
<h4 id="3-Áî®Êà∑‰ø°ÊÅØËé∑Âèñ">3. Áî®Êà∑‰ø°ÊÅØËé∑Âèñ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">TokenUserInfoDto</span><span class="w"> </span><span class="nf">getTokenUserInfoDto</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">ServletRequestAttributes</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RequestContextHolder</span><span class="p">.</span><span class="na">getRequestAttributes</span><span class="p">()).</span><span class="na">getRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TOKEN_WEB</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getTokenInfo</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰∏âÂ∑•‰ΩúÊµÅÁ®ãÂàÜÊûê">‰∏â„ÄÅÂ∑•‰ΩúÊµÅÁ®ãÂàÜÊûê
</h3><ul>
<li>ÊñπÊ≥ïË¢´Ë∞ÉÁî® ‚Üí ÂàáÈù¢Êã¶Êà™ ‚Üí ÊâßË°å‰∏öÂä°ÈÄªËæë ‚Üí ÊèêÂèñÂèÇÊï∞/Áî®Êà∑‰ø°ÊÅØ ‚Üí ‰øùÂ≠òÊ∂àÊÅØÈÄöÁü•</li>
</ul>
<h3 id="ÂõõÂÖ≥ÈîÆÂÆûÁé∞ÁªÜËäÇ">Âõõ„ÄÅÂÖ≥ÈîÆÂÆûÁé∞ÁªÜËäÇ
</h3><h4 id="1-ÂèÇÊï∞ÂêçÂåπÈÖçÊú∫Âà∂">1. ÂèÇÊï∞ÂêçÂåπÈÖçÊú∫Âà∂
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">extractParameter</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">paramName</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">Parameter</span><span class="o">[]</span><span class="w"> </span><span class="n">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">params</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">paramName</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">getName</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÈúÄÁºñËØëÊó∂‰øùÁïôÂèÇÊï∞ÂêçÔºà-parametersÁºñËØëÈÄâÈ°πÔºâ</li>
<li>ÂÆûÈôÖ‰ª£Á†ÅÂ∫îÊ∑ªÂä†Á±ªÂûãÂÆâÂÖ®Ê£ÄÊü•</li>
</ul>
<h4 id="2-Ê∂àÊÅØÁ±ªÂûãÂä®ÊÄÅÂà§Êñ≠">2. Ê∂àÊÅØÁ±ªÂûãÂä®ÊÄÅÂà§Êñ≠
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">UserActionTypeEnum</span><span class="p">.</span><span class="na">VIDEO_COLLECT</span><span class="p">.</span><span class="na">getType</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">actionType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">messageTypeEnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageTypeEnum</span><span class="p">.</span><span class="na">COLLECTION</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÖÅËÆ∏ÈÄöËøáÊ≥®Ëß£ÊåáÂÆöÈªòËÆ§Á±ªÂûãÔºå‰πüÂèØÊ†πÊçÆËøêË°åÊó∂Êù°‰ª∂Ë∞ÉÊï¥Á±ªÂûã</li>
</ul>
<h4 id="3-ÂºÇÂ∏∏Â§ÑÁêÜÁ≠ñÁï•">3. ÂºÇÂ∏∏Â§ÑÁêÜÁ≠ñÁï•
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ‰∏öÂä°ÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">BusinessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;ÂÖ®Â±ÄÊã¶Êà™Âô®ÂºÇÂ∏∏&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;ÂÖ®Â±ÄÊã¶Êà™Âô®ÂºÇÂ∏∏&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_500</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âå∫ÂàÜ‰∏öÂä°ÂºÇÂ∏∏ÂíåÁ≥ªÁªüÂºÇÂ∏∏ÔºåÁªü‰∏ÄÈîôËØØÂ§ÑÁêÜ</li>
</ul>
<h3 id="‰∫î‰ΩøÁî®Á§∫‰æã">‰∫î„ÄÅ‰ΩøÁî®Á§∫‰æã
</h3><h4 id="1-Âü∫Á°ÄÁî®Ê≥ï">1. Âü∫Á°ÄÁî®Ê≥ï
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RecordUserMessage</span><span class="p">(</span><span class="n">messageType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageTypeEnum</span><span class="p">.</span><span class="na">LIKE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseVO</span><span class="w"> </span><span class="nf">likeVideo</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÁÇπËµûÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">success</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-Â∏¶ÂèÇÊï∞Ëá™Âä®ÊèêÂèñ">2. Â∏¶ÂèÇÊï∞Ëá™Âä®ÊèêÂèñ
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RecordUserMessage</span><span class="p">(</span><span class="n">messageType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageTypeEnum</span><span class="p">.</span><span class="na">COMMENT</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseVO</span><span class="w"> </span><span class="nf">addComment</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestParam</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">replyCommentId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ËØÑËÆ∫ÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">success</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂàáÈù¢Â∞ÜËá™Âä®ÊèêÂèñ videoId„ÄÅcontent„ÄÅreplyCommentId Áî®‰∫éÊûÑÂª∫Ê∂àÊÅØËÆ∞ÂΩï</li>
</ul>
<h3 id="ÂÖ≠ËÆæËÆ°‰ºòÂäø">ÂÖ≠„ÄÅËÆæËÆ°‰ºòÂäø
</h3><ul>
<li>‰Ωé‰æµÂÖ•ÊÄßÔºö‰∏öÂä°‰ª£Á†ÅÂè™ÈúÄÊ∑ªÂä†Ê≥®Ëß£</li>
<li>ÈõÜ‰∏≠ÁÆ°ÁêÜÔºöÊâÄÊúâÊ∂àÊÅØËÆ∞ÂΩïÈÄªËæëÂú®ÂàáÈù¢‰∏≠Áª¥Êä§</li>
<li>ÁÅµÊ¥ªÊâ©Â±ïÔºöËΩªÊùæÊîØÊåÅÊñ∞ÁöÑÊ∂àÊÅØÁ±ªÂûã</li>
<li>Ëá™Âä®ÂÖ≥ËÅîÔºöËá™Âä®ÂÖ≥ËÅîÊìç‰ΩúÂÜÖÂÆπÂíåÁî®Êà∑‰ø°ÊÅØ</li>
<li>‰∏ÄËá¥Â§ÑÁêÜÔºöÁªü‰∏ÄÁöÑÊ∂àÊÅØËÆ∞ÂΩïÊñπÂºèÂíåÈîôËØØÂ§ÑÁêÜ</li>
</ul>
<h3 id="‰∏ÉÊΩúÂú®‰ºòÂåñÊñπÂêë">‰∏É„ÄÅÊΩúÂú®‰ºòÂåñÊñπÂêë
</h3><ol>
<li>ÊÄßËÉΩ‰ºòÂåñ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÁºìÂ≠òÊñπÊ≥ïÂèÇÊï∞Á¥¢Âºï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MethodParamCache</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">videoIdParam</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">actionTypeParam</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">videoIdIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">actionTypeIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ConcurrentMap</span><span class="o">&lt;</span><span class="n">Method</span><span class="p">,</span><span class="w"> </span><span class="n">MethodParamCache</span><span class="o">&gt;</span><span class="w"> </span><span class="n">paramCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>ÂºÇÊ≠•Â§ÑÁêÜ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Async</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">asyncSaveUserMessage</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ÂºÇÊ≠•‰øùÂ≠òÊ∂àÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>Êõ¥Êô∫ËÉΩÁöÑÂèÇÊï∞ÊèêÂèñ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÈÄöËøáÊ≥®Ëß£Ê†áËÆ∞ÈáçË¶ÅÂèÇÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseVO</span><span class="w"> </span><span class="nf">addComment</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@MessageParam</span><span class="p">(</span><span class="s">&#34;videoId&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">videoId</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@MessageParam</span><span class="p">(</span><span class="s">&#34;content&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">content</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>Ê∂àÊÅØÂÜÖÂÆπÊ®°ÊùøÂåñ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">message.template.like</span><span class="o">=</span><span class="s">{user}ÁÇπËµû‰∫Ü‰Ω†ÁöÑËßÜÈ¢ë</span>
</span></span><span class="line"><span class="cl"><span class="na">message.template.comment</span><span class="o">=</span><span class="s">{user}ËØÑËÆ∫‰∫Ü‰Ω†ÁöÑËßÜÈ¢ë: {content}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂÖ´‰∏éÂÖ∂‰ªñÊñπÊ°àÁöÑÂØπÊØî">ÂÖ´„ÄÅ‰∏éÂÖ∂‰ªñÊñπÊ°àÁöÑÂØπÊØî
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>ÊñπÊ°à</th>
          <th>‰ºòÁÇπ</th>
          <th>Áº∫ÁÇπ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>AOPÊ≥®Ëß£</td>
          <td>Ëß£ËÄ¶„ÄÅÁÅµÊ¥ª„ÄÅÊòìÊâ©Â±ï</td>
          <td>Â≠¶‰π†Êõ≤Á∫øÁ®çÈ´ò</td>
      </tr>
      <tr>
          <td>ÊâãÂä®Ë∞ÉÁî®</td>
          <td>Áõ¥ËßÇ„ÄÅÁÆÄÂçï</td>
          <td>‰ª£Á†ÅÈáçÂ§ç„ÄÅÊòìÈÅóÊºè</td>
      </tr>
      <tr>
          <td>‰∫ã‰ª∂È©±Âä®</td>
          <td>ÂÆåÂÖ®Ëß£ËÄ¶„ÄÅÂºÇÊ≠•ÂèãÂ•Ω</td>
          <td>Â§çÊùÇÂ∫¶È´ò„ÄÅË∞ÉËØïÂõ∞Èöæ</td>
      </tr>
      <tr>
          <td>Êã¶Êà™Âô®</td>
          <td>ÊâßË°åÊó∂Êú∫Êó©</td>
          <td>Èöæ‰ª•Ëé∑Âèñ‰∏öÂä°ÂèÇÊï∞</td>
      </tr>
  </tbody>
</table></div>
<ul>
<li>ËØ•AOPÂÆûÁé∞ÊñπÊ°àÂú®ÁÅµÊ¥ªÊÄßÂíåÊòìÁî®ÊÄß‰πãÈó¥ÂèñÂæóËâØÂ•ΩÂπ≥Ë°°ÔºåÈÄÇÂêàÂ§ö‰∏öÂä°Êìç‰ΩúÁöÑÊ∂àÊÅØÈÄöÁü•Âú∫ÊôØ„ÄÇ</li>
</ul>
<hr>
<h2 id="ÂÆûÊàòaopÊó∂ÈúÄË¶ÅÈáçÁÇπÂÖ≥Ê≥®ÁöÑÊñπÈù¢">ÂÆûÊàòAOPÊó∂ÈúÄË¶ÅÈáçÁÇπÂÖ≥Ê≥®ÁöÑÊñπÈù¢
</h2><h3 id="‰∏ÄÂàáÈù¢ËÆæËÆ°‰∏éÂÆûÁé∞Ë¶ÅÁÇπ">‰∏Ä„ÄÅÂàáÈù¢ËÆæËÆ°‰∏éÂÆûÁé∞Ë¶ÅÁÇπ
</h3><ol>
<li>Ê≥®Ëß£ËÆæËÆ°ËßÑËåÉ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Target</span><span class="p">({</span><span class="n">ElementType</span><span class="p">.</span><span class="na">METHOD</span><span class="p">,</span><span class="w"> </span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">RecordUserMessage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MessageTypeEnum</span><span class="w"> </span><span class="nf">messageType</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Á°Æ‰øù @Retention(RetentionPolicy.RUNTIME)</li>
<li>ÂèØËÄÉËôëËÆæÁΩÆÈªòËÆ§ÂÄº</li>
<li>Â±ûÊÄßÂëΩÂêçË¶ÅÊ∏ÖÊô∞Ë°®Ëææ‰∏öÂä°ÊÑèÂõæ</li>
</ul>
<ol start="2">
<li>ÂàáÈù¢‰ΩúÁî®ËåÉÂõ¥ÊéßÂà∂</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Around</span><span class="p">(</span><span class="s">&#34;@annotation(com.easylive.annotation.RecordUserMessage)&#34;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Á≤æÁ°ÆÈôêÂÆöÂàáÁÇπË°®ËææÂºèÔºåÈÅøÂÖçÊã¶Êà™‰∏çÈúÄË¶ÅÁöÑÊñπÊ≥ï</li>
<li>ÂèØÁî® within() ÈôêÂÆöÂåÖË∑ØÂæÑ</li>
</ul>
<h3 id="‰∫åÂèÇÊï∞Â§ÑÁêÜÂÖ≥ÈîÆÁÇπ">‰∫å„ÄÅÂèÇÊï∞Â§ÑÁêÜÂÖ≥ÈîÆÁÇπ
</h3><ol>
<li>ÂèÇÊï∞ÂêçÂåπÈÖçÊú∫Âà∂</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveUserMessage</span><span class="p">(...,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">Parameter</span><span class="o">[]</span><span class="w"> </span><span class="n">parameters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">parameters</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PARAMETERS_VIDEO_ID</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">parameters</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">getName</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">videoId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">arguments</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//...ÂÖ∂‰ªñÂèÇÊï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁºñËØëÊó∂‰øùÁïôÂèÇÊï∞ÂêçÔºà-parametersÔºâ</li>
<li>Ê∑ªÂä†Á±ªÂûãÊ£ÄÊü•ÔºåÈÅøÂÖçÁ±ªÂûãËΩ¨Êç¢ÂºÇÂ∏∏</li>
<li>ÂèØÁî®ConcurrentHashMapÁºìÂ≠òÂèÇÊï∞Á¥¢ÂºïÊèêÂçáÊÄßËÉΩ</li>
</ul>
<ol start="2">
<li>ÊïèÊÑüÂèÇÊï∞Â§ÑÁêÜ</li>
</ol>
<ul>
<li>ÂØπcontentÁ≠âÂèÇÊï∞ËøõË°åËÑ±ÊïèÂ§ÑÁêÜ</li>
<li>Â§ßÊñáÊú¨ÂÜÖÂÆπÂèØÊà™Êñ≠ÂêéÂ≠òÂÖ•Ê∂àÊÅØËÆ∞ÂΩï</li>
</ul>
<h3 id="‰∏âÂºÇÂ∏∏Â§ÑÁêÜÁ≠ñÁï•">‰∏â„ÄÅÂºÇÂ∏∏Â§ÑÁêÜÁ≠ñÁï•
</h3><ol>
<li>ÂºÇÂ∏∏ÂàÜÁ±ªÂ§ÑÁêÜ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">BusinessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;ÂÖ®Â±ÄÊã¶Êà™Âô®ÂºÇÂ∏∏&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;ÂÖ®Â±ÄÊã¶Êà™Âô®ÂºÇÂ∏∏&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_500</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Âå∫ÂàÜ‰∏öÂä°ÂºÇÂ∏∏ÂíåÁ≥ªÁªüÂºÇÂ∏∏ÔºåÈÅøÂÖçÂêûÊ≤°ÂéüÂßãÂºÇÂ∏∏Â†ÜÊ†à</li>
<li>ÂèØÊ∑ªÂä†ÈîôËØØÁ†ÅËΩ¨Êç¢ÈÄªËæë</li>
</ul>
<ol start="2">
<li>‰∫ãÂä°ËæπÁïåÊ≥®ÊÑè</li>
</ol>
<ul>
<li>ÂàáÈù¢Âú®ÊñπÊ≥ïÊâßË°åÂêéËÆ∞ÂΩïÊ∂àÊÅØÔºåËã•ÊñπÊ≥ïÊúâ‰∫ãÂä°Ôºö
<ul>
<li>Á°Æ‰øùÊ∂àÊÅØËÆ∞ÂΩï‰∏é‰∏öÂä°Êìç‰ΩúÂú®Âêå‰∏Ä‰∫ãÂä°Ôºà@TransactionalÔºâ</li>
<li>ÊàñÊòéÁ°ÆÂàÜÁ¶ª‰∫ãÂä°ÔºàÂºÇÊ≠•ËÆ∞ÂΩïÊ∂àÊÅØÔºâ</li>
</ul>
</li>
</ul>
<h3 id="ÂõõÊÄßËÉΩ‰ºòÂåñÊñπÂêë">Âõõ„ÄÅÊÄßËÉΩ‰ºòÂåñÊñπÂêë
</h3><ol>
<li>ÂèçÂ∞ÑÊìç‰Ωú‰ºòÂåñ</li>
</ol>
<ul>
<li>ÁºìÂ≠òMethodÂØπË±°ÂíåÂèÇÊï∞Á¥¢Âºï</li>
<li>ÂèØÁî®SpringÁöÑCacheableOperationÊú∫Âà∂</li>
</ul>
<ol start="2">
<li>ÂºÇÊ≠•Â§ÑÁêÜËÄÉËôë</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Async</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">asyncSaveUserMessage</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">userMessageService</span><span class="p">.</span><span class="na">saveUserMessage</span><span class="p">(...);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÈÄÇÁî®‰∫éÂØπÂÆûÊó∂ÊÄßË¶ÅÊ±Ç‰∏çÈ´òÊàñÈ´òÂπ∂ÂèëÂú∫ÊôØ</li>
</ul>
<h3 id="‰∫îÂÆâÂÖ®Ê≥®ÊÑè‰∫ãÈ°π">‰∫î„ÄÅÂÆâÂÖ®Ê≥®ÊÑè‰∫ãÈ°π
</h3><ol>
<li>Áî®Êà∑‰ø°ÊÅØËé∑Âèñ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">TokenUserInfoDto</span><span class="w"> </span><span class="nf">getTokenUserInfoDto</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">ServletRequestAttributes</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RequestContextHolder</span><span class="p">.</span><span class="na">getRequestAttributes</span><span class="p">()).</span><span class="na">getRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TOKEN_WEB</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getTokenInfo</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>È™åËØÅtokenÊúâÊïàÊÄßÔºàÊòØÂê¶ËøáÊúü„ÄÅÊòØÂê¶Ë¢´Êí§ÈîÄÔºâ</li>
<li>ÊïèÊÑüÊìç‰ΩúÂèØ‰∫åÊ¨°È™åËØÅ</li>
</ul>
<ol start="2">
<li>ÊùÉÈôêÊ†°È™åË°•ÂÖÖ</li>
</ol>
<ul>
<li>ÂèØÂú®ÂàáÈù¢‰∏≠Ê∑ªÂä†Âü∫Á°ÄÊùÉÈôêÊ†°È™åÔºå‰∏éSpring SecurityÈõÜÊàê</li>
</ul>
<h3 id="ÂÖ≠ÂèØÁª¥Êä§ÊÄßËÆæËÆ°">ÂÖ≠„ÄÅÂèØÁª¥Êä§ÊÄßËÆæËÆ°
</h3><ol>
<li>Ê∂àÊÅØÁ±ªÂûãÊâ©Â±ï</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">UserActionTypeEnum</span><span class="p">.</span><span class="na">VIDEO_COLLECT</span><span class="p">.</span><span class="na">getType</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">actionType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">messageTypeEnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageTypeEnum</span><span class="p">.</span><span class="na">COLLECTION</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂèØÁî®Á≠ñÁï•Ê®°ÂºèÂ§ÑÁêÜ‰∏çÂêåÁ±ªÂûãÊ∂àÊÅØÁöÑÊûÑÂª∫</li>
<li>ÈÖçÁΩÆÂåñÊ∂àÊÅØÊ®°Êùø</li>
</ul>
<ol start="2">
<li>Êó•ÂøóËÆ∞ÂΩïËßÑËåÉ</li>
</ol>
<ul>
<li>Ê∑ªÂä†Êìç‰ΩúÊµÅÊ∞¥Âè∑ÔºåËÆ∞ÂΩïËØ¶ÁªÜ‰∏ä‰∏ãÊñá‰ø°ÊÅØ</li>
</ul>
<h3 id="‰∏É‰∏éÂÖ∂‰ªñÁªÑ‰ª∂ÁöÑÂçè‰Ωú">‰∏É„ÄÅ‰∏éÂÖ∂‰ªñÁªÑ‰ª∂ÁöÑÂçè‰Ωú
</h3><ol>
<li>‰∏éÊã¶Êà™Âô®ÁöÑÂàÜÂ∑•</li>
</ol>
<ul>
<li>Êã¶Êà™Âô®Â§ÑÁêÜÈÄöÁî®Ê†°È™åÔºàÁôªÂΩï„ÄÅÂü∫Á°ÄÂèÇÊï∞Ôºâ</li>
<li>AOPÂ§ÑÁêÜ‰∏öÂä°Áõ∏ÂÖ≥Ê®™ÂàáÈÄªËæëÔºàÂ¶ÇÊ∂àÊÅØËÆ∞ÂΩïÔºâ</li>
</ul>
<ol start="2">
<li>‰∏é‰∫ãÂä°ÁöÑÈÖçÂêà</li>
</ol>
<ul>
<li>Ê≥®ÊÑè@TransactionalÂíå@AroundÁöÑÊâßË°åÈ°∫Â∫è</li>
<li>ÂèØÁî®@OrderÊ≥®Ëß£ÊòéÁ°ÆÊéßÂà∂</li>
</ul>
<h3 id="ÂÖ´ÊµãËØïÁõ∏ÂÖ≥Âª∫ËÆÆ">ÂÖ´„ÄÅÊµãËØïÁõ∏ÂÖ≥Âª∫ËÆÆ
</h3><ol>
<li>ÂàáÈù¢ÂçïÂÖÉÊµãËØï</li>
</ol>
<ul>
<li>Ê®°ÊãüÂêÑÁßçÂèÇÊï∞ÁªÑÂêàÔºåÊµãËØïÂºÇÂ∏∏Âú∫ÊôØÔºåÈ™åËØÅÊ∂àÊÅØËÆ∞ÂΩïÊ≠£Á°ÆÊÄß</li>
</ul>
<ol start="2">
<li>ÈõÜÊàêÊµãËØïÂÖ≥Ê≥®</li>
</ol>
<ul>
<li>Â§öÂàáÈù¢ÂÖ±Â≠òÊó∂ÁöÑÊâßË°åÈ°∫Â∫èÔºåÈ´òÂπ∂Âèë‰∏ãÁ∫øÁ®ãÂÆâÂÖ®Ôºå‰∏é‰∫ãÂä°ÁöÑ‰∫§‰∫í</li>
</ul>
<h3 id="‰πùÊÇ®ÁöÑÂÆûÁé∞‰∫ÆÁÇπ">‰πù„ÄÅÊÇ®ÁöÑÂÆûÁé∞‰∫ÆÁÇπ
</h3><ul>
<li>ËÅåË¥£ÂàíÂàÜÊ∏ÖÊô∞ÔºåÊ∂àÊÅØËÆ∞ÂΩï‰∏é‰∏öÂä°Ëß£ËÄ¶</li>
<li>ÁÅµÊ¥ªÁ±ªÂûãÂà§Êñ≠ÔºåactionTypeÂä®ÊÄÅË∞ÉÊï¥Ê∂àÊÅØÁ±ªÂûã</li>
<li>ÂÆåÂñÑÂºÇÂ∏∏Â§ÑÁêÜÔºåÂå∫ÂàÜ‰∏öÂä°/Á≥ªÁªüÂºÇÂ∏∏</li>
<li>‰∏ä‰∏ãÊñá‰ø°ÊÅØËá™Âä®Ëé∑Âèñ</li>
</ul>
<h3 id="ÂçÅÊÄªÁªì-checklist">ÂçÅ„ÄÅÊÄªÁªì Checklist
</h3><ul>
<li>‚úÖ Ê≥®Ëß£‰øùÁïôÁ≠ñÁï•Ê≠£Á°Æ</li>
<li>‚úÖ ÂàáÁÇπË°®ËææÂºèÁ≤æÁ°ÆÂåπÈÖçÁõÆÊ†áÊñπÊ≥ï</li>
<li>‚úÖ ÂèÇÊï∞ÂêçÂåπÈÖçËÄÉËôëÁºñËØëÈÄâÈ°π</li>
<li>‚úÖ ÂºÇÂ∏∏Â§ÑÁêÜË¶ÜÁõñÊâÄÊúâÂú∫ÊôØ</li>
<li>‚úÖ ÊÄßËÉΩÊïèÊÑüÊìç‰ΩúÊúâÁºìÂ≠òÊú∫Âà∂</li>
<li>‚úÖ ‰∫ãÂä°ËæπÁïåÊòéÁ°ÆÂàíÂàÜ</li>
<li>‚úÖ ÂÆâÂÖ®Ê†°È™åÂÖÖÂàÜ</li>
<li>‚úÖ Êó•ÂøóËøΩË∏™ÂÆåÂñÑ</li>
<li>‚úÖ Êòì‰∫éÊâ©Â±ïÊñ∞Ê∂àÊÅØÁ±ªÂûã</li>
<li>‚úÖ ÊµãËØïÁî®‰æãË¶ÜÁõñÂêÑÁßçËæπÁïåÊÉÖÂÜµ</li>
</ul>
<p>ÈÄöËøáÂÖ≥Ê≥®Ëøô‰∫õÂÖ≥ÈîÆÁÇπÔºåÂèØÁ°Æ‰øùAOPÂÆûÁé∞Êó¢Êª°Ë∂≥ÈúÄÊ±ÇÔºåÂèàÂÖ∑Â§áËâØÂ•ΩÂèØÁª¥Êä§ÊÄßÂíåÊâ©Â±ïÊÄß„ÄÇ</p>
<hr>
<h2 id="ÂÆöÊó∂‰ªªÂä°-ÊØèÊó•Êï∞ÊçÆÁªüËÆ°Âíå‰∏¥Êó∂Êñá‰ª∂Ê∏ÖÁêÜ">ÂÆöÊó∂‰ªªÂä°-ÊØèÊó•Êï∞ÊçÆÁªüËÆ°Âíå‰∏¥Êó∂Êñá‰ª∂Ê∏ÖÁêÜ
</h2><h3 id="‰∏ÄÁ≥ªÁªüÂäüËÉΩÊ¶ÇËø∞">‰∏Ä„ÄÅÁ≥ªÁªüÂäüËÉΩÊ¶ÇËø∞
</h3><ul>
<li>ÂåÖÂê´ÊØèÊó•Êï∞ÊçÆÁªüËÆ°Âíå‰∏¥Êó∂Êñá‰ª∂Ê∏ÖÁêÜ‰∏§‰∏™Ê†∏ÂøÉÂÆöÊó∂‰ªªÂä°</li>
<li>ÈááÁî®Spring Boot @ScheduledÊ≥®Ëß£ÂÆûÁé∞</li>
<li>‰ªªÂä°ËÅåË¥£ÂàÜÁ¶ªÔºå‰æø‰∫éÁª¥Êä§ÂíåÊâ©Â±ï</li>
</ul>
<h3 id="‰∫åÊØèÊó•Êï∞ÊçÆÁªüËÆ°‰ªªÂä°-statisticsdata">‰∫å„ÄÅÊØèÊó•Êï∞ÊçÆÁªüËÆ°‰ªªÂä° statisticsData()
</h3><ul>
<li>ÊâßË°åÊó∂Êú∫ÔºöÊØèÂ§©ÂáåÊô®0ÁÇπÔºà0 0 0 * * ?Ôºâ</li>
<li>‰∏ªË¶ÅÊµÅÁ®ãÔºö
<ul>
<li>
<ol>
<li>‰ªéRedisËé∑ÂèñÊò®Êó•ÂêÑËßÜÈ¢ëÊí≠ÊîæÈáè</li>
</ol>
</li>
<li>
<ol start="2">
<li>ÂÖ≥ËÅîËßÜÈ¢ë‰∏éÁî®Êà∑‰ø°ÊÅØ</li>
</ol>
</li>
<li>
<ol start="3">
<li>ÊåâÁî®Êà∑ËÅöÂêàÊí≠ÊîæÈáè</li>
</ol>
</li>
<li>
<ol start="4">
<li>ÁªüËÆ°Á≤â‰∏ù„ÄÅËØÑËÆ∫„ÄÅ‰∫íÂä®Á≠âÂ§öÁª¥Â∫¶Êï∞ÊçÆ</li>
</ol>
</li>
<li>
<ol start="5">
<li>ÊâπÈáèÊèíÂÖ•ÊàñÊõ¥Êñ∞ÁªüËÆ°ÁªìÊûúÂà∞Êï∞ÊçÆÂ∫ì</li>
</ol>
</li>
</ul>
</li>
<li>ÂÖ≥ÈîÆ‰ª£Á†ÅÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Scheduled</span><span class="p">(</span><span class="n">cron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;0 0 0 * * ?&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">statisticsData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. ÂáÜÂ§áÊï∞ÊçÆÁªìÊûÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">StatisticsInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">statisticsInfoList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">statisticsDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateUtil</span><span class="p">.</span><span class="na">getBeforeDayDate</span><span class="p">(</span><span class="n">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Êò®Â§©Êó•Êúü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. Êí≠ÊîæÈáèÁªüËÆ°ÔºàRedis ‚Üí DBÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoPlayCountMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redisComponent</span><span class="p">.</span><span class="na">getVideoPlayCount</span><span class="p">(</span><span class="n">statisticsDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">playVideoKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoPlayCountMap</span><span class="p">.</span><span class="na">keySet</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">lastIndexOf</span><span class="p">(</span><span class="s">&#34;:&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">VideoInfoQuery</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VideoInfoQuery</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">query</span><span class="p">.</span><span class="na">setVideoIdArray</span><span class="p">(</span><span class="n">playVideoKeys</span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">VideoInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoInfoList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfoMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="n">query</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoCountMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfoList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">groupingBy</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">VideoInfo</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Collectors</span><span class="p">.</span><span class="na">summingInt</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">redisKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_VIDEO_PLAY_COUNT</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">statisticsDate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoPlayCountMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">redisKey</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">videoCountMap</span><span class="p">.</span><span class="na">forEach</span><span class="p">((</span><span class="n">userId</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">StatisticsInfo</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StatisticsInfo</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">info</span><span class="p">.</span><span class="na">setStatisticsDate</span><span class="p">(</span><span class="n">statisticsDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">info</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">info</span><span class="p">.</span><span class="na">setDataType</span><span class="p">(</span><span class="n">StatisticsTypeEnum</span><span class="p">.</span><span class="na">PLAY</span><span class="p">.</span><span class="na">getType</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">info</span><span class="p">.</span><span class="na">setStatisticsCount</span><span class="p">(</span><span class="n">count</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">statisticsInfoList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">info</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">addFansData</span><span class="p">(</span><span class="n">statisticsDate</span><span class="p">,</span><span class="w"> </span><span class="n">statisticsInfoList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">addCommentData</span><span class="p">(</span><span class="n">statisticsDate</span><span class="p">,</span><span class="w"> </span><span class="n">statisticsInfoList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">addInteractionData</span><span class="p">(</span><span class="n">statisticsDate</span><span class="p">,</span><span class="w"> </span><span class="n">statisticsInfoList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">statisticsInfoMapper</span><span class="p">.</span><span class="na">insertOrUpdateBatch</span><span class="p">(</span><span class="n">statisticsInfoList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÊäÄÊúØË¶ÅÁÇπÔºö
<ul>
<li>È´òÈ¢ëÊï∞ÊçÆÂÖàÂÜôÂÖ•RedisÔºåÂÆöÊó∂ÊâπÈáèÂêåÊ≠•Âà∞DB</li>
<li>Â§öÁª¥Â∫¶ÁªüËÆ°Ôºå‰æø‰∫éÂêéÁª≠Êâ©Â±ï</li>
<li>ÊâπÈáèÊìç‰ΩúÂáèÂ∞ëÊï∞ÊçÆÂ∫ìÂéãÂäõ</li>
</ul>
</li>
</ul>
<h4 id="‰ª£Á†ÅÁªìÊûÑ‰∏éËÅöÂêàÈÄªËæëËß£Êûê">‰ª£Á†ÅÁªìÊûÑ‰∏éËÅöÂêàÈÄªËæëËß£Êûê
</h4><ul>
<li>ÊåâÁî®Êà∑IDÂàÜÁªÑÁªüËÆ°ÊâÄÊúâËßÜÈ¢ëÁöÑÊÄªÊí≠ÊîæÈáèÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">videoCountMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoInfoList</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">groupingBy</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">VideoInfo</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Collectors</span><span class="p">.</span><span class="na">summingInt</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">redisKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">REDIS_KEY_VIDEO_PLAY_COUNT</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">statisticsDate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoPlayCountMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">redisKey</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ËÆæËÆ°‰ºòÂäøÔºö
<ul>
<li>ÂçïÊ¨°ÈÅçÂéÜÂÆåÊàêÂàÜÁªÑ‰∏éÊ±ÇÂíåÔºåÊïàÁéáÈ´ò</li>
<li>ÈÄªËæëÊ∏ÖÊô∞ÔºåÊòì‰∫éÁª¥Êä§ÂíåÊâ©Â±ï</li>
<li>ÂèØÈÄöËøáparallelStreamÂπ∂Ë°åÂ§ÑÁêÜÂ§ßÊï∞ÊçÆÈáè</li>
</ul>
</li>
</ul>
<h3 id="‰∏â‰∏¥Êó∂Êñá‰ª∂Ê∏ÖÁêÜ‰ªªÂä°-deltempfile">‰∏â„ÄÅ‰∏¥Êó∂Êñá‰ª∂Ê∏ÖÁêÜ‰ªªÂä° delTempFile()
</h3><ul>
<li>ÊâßË°åÊó∂Êú∫ÔºöÊØèÂàÜÈíüÊâßË°å‰∏ÄÊ¨°Ôºà0 */1 * * * ?Ôºâ</li>
<li>‰∏ªË¶ÅÊµÅÁ®ãÔºö
<ul>
<li>
<ol>
<li>ÊûÑÂª∫‰∏¥Êó∂Êñá‰ª∂Â§πË∑ØÂæÑ</li>
</ol>
</li>
<li>
<ol start="2">
<li>Ëé∑Âèñ‰∏§Â§©ÂâçÁöÑÊó•Êúü‰Ωú‰∏∫Âü∫ÂáÜ</li>
</ol>
</li>
<li>
<ol start="3">
<li>ÈÅçÂéÜ‰∏¥Êó∂Êñá‰ª∂Â§πÔºåÊåâÊó•ÊúüÂëΩÂêçËßÑÂàôÊ∏ÖÁêÜÊóßÊñá‰ª∂</li>
</ol>
</li>
<li>
<ol start="4">
<li>ÊçïËé∑ÂºÇÂ∏∏Ôºå‰øùËØÅ‰ªªÂä°ÂÅ•Â£ÆÊÄß</li>
</ol>
</li>
</ul>
</li>
<li>ÂÖ≥ÈîÆ‰ª£Á†ÅÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Scheduled</span><span class="p">(</span><span class="n">cron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;0 */1 * * * ?&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">delTempFile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">tempFolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appConfig</span><span class="p">.</span><span class="na">getProjectFolder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_FOLDER</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Constants</span><span class="p">.</span><span class="na">FILE_FOLDER_TEMP</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">twodaysAgo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateUtil</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">DateUtil</span><span class="p">.</span><span class="na">getDayAgo</span><span class="p">(</span><span class="n">2</span><span class="p">),</span><span class="w"> </span><span class="s">&#34;yyyyMMdd&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">thresholdDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">twodaysAgo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">File</span><span class="w"> </span><span class="n">folder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">tempFolder</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">File</span><span class="o">[]</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">folder</span><span class="p">.</span><span class="na">listFiles</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">files</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">files</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Integer</span><span class="w"> </span><span class="n">fileDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileDate</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">thresholdDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">FileUtils</span><span class="p">.</span><span class="na">deleteDirectory</span><span class="p">(</span><span class="n">file</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Âà†Èô§‰∏¥Êó∂Êñá‰ª∂Â§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ËÆæËÆ°Ë¶ÅÁÇπÔºö
<ul>
<li>Êñá‰ª∂ÂêçÂº∫Âà∂‰ΩøÁî®Êó•ÊúüÊ†ºÂºèÔºåÈò≤Ê≠¢ËØØÂà†</li>
<li>Âè™Â§ÑÁêÜÂëΩÂêçÂêàËßÑÁöÑÊñá‰ª∂Â§π</li>
<li>ÂºÇÂ∏∏ÊçïËé∑Ôºå‰øùËØÅÂçïÊ¨°Â§±Ë¥•‰∏çÂΩ±ÂìçÂêéÁª≠</li>
<li>È´òÈ¢ëÊ£ÄÊü•‰ΩÜ‰ΩéË¥üËΩΩÔºåÈÄÇÂêàÂÆöÊó∂Ê∏ÖÁêÜ</li>
</ul>
</li>
</ul>
<h3 id="ÂõõÊû∂ÊûÑËÆæËÆ°‰∫ÆÁÇπ">Âõõ„ÄÅÊû∂ÊûÑËÆæËÆ°‰∫ÆÁÇπ
</h3><ul>
<li>ÁªüËÆ°ÊúçÂä°‰∏é‰∏öÂä°ÈÄªËæëËß£ËÄ¶Ôºå‰æø‰∫éÁª¥Êä§</li>
<li>Êñá‰ª∂Ê∏ÖÁêÜ‰∏é‰∏öÂä°Ê®°ÂùóÈöîÁ¶ªÔºåÊèêÂçáÂÆâÂÖ®ÊÄß</li>
<li>ÂÆûÊó∂Êï∞ÊçÆÂÜôÂÖ•RedisÔºåÂÆöÊó∂ÂêåÊ≠•DBÔºåÂÖºÈ°æÊÄßËÉΩ‰∏é‰∏ÄËá¥ÊÄß</li>
<li>Êñ∞Â¢ûÁªüËÆ°Áª¥Â∫¶ÊàñÊ∏ÖÁêÜÁ≠ñÁï•Êòì‰∫éÊâ©Â±ï</li>
</ul>
<h3 id="‰∫îÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ-1">‰∫î„ÄÅÊΩúÂú®‰ºòÂåñÂª∫ËÆÆ
</h3><ul>
<li>ÁªüËÆ°‰ªªÂä°ÂèØÂàÜÁâáÂ§ÑÁêÜÔºåÈÄÇÂ∫îÂ§ßÁî®Êà∑Èáè</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Scheduled</span><span class="p">(</span><span class="n">cron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;0 0 1 * * ?&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">statsUserShard1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">statisticsService</span><span class="p">.</span><span class="na">processByUserRange</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">10000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Êñá‰ª∂Ê∏ÖÁêÜÂèØÂ¢ûÂä†Êñá‰ª∂Â§ßÂ∞èÁõëÊéß</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">MAX_TEMP_FILE_SIZE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">alertService</span><span class="p">.</span><span class="na">notifyOversizeFile</span><span class="p">(</span><span class="n">file</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁªüËÆ°‰ªªÂä°ÂºÇÂ∏∏Â§ÑÁêÜÂº∫ÂåñÔºåÊîØÊåÅÂª∂ËøüÈáçËØï</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Scheduled</span><span class="p">(...)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">safeStatistics</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">statisticsData</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;ÁªüËÆ°‰ªªÂä°Â§±Ë¥•&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">retryLater</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="gateway-Ë∑ØÁî±ÂàÜÈÖç‰∏éÊé•Âè£Ë∞ÉÁî®Êú∫Âà∂">Gateway Ë∑ØÁî±ÂàÜÈÖç‰∏éÊé•Âè£Ë∞ÉÁî®Êú∫Âà∂
</h2><h3 id="‰∏Ägateway-Ë∑ØÁî±ÂàÜÈÖçÂéüÁêÜ">‰∏Ä„ÄÅGateway Ë∑ØÁî±ÂàÜÈÖçÂéüÁêÜ
</h3><ul>
<li>Ë∑ØÁî±ÂåπÈÖçÊµÅÁ®ãÔºö
<ul>
<li>ËØ∑Ê±ÇÂà∞ËææÁΩëÂÖ≥ÔºàÂ¶Ç7071Á´ØÂè£ÔºâÔºåGatewayÈÅçÂéÜÊâÄÊúâË∑ØÁî±ËßÑÂàôÔºàroutesÔºâÔºåÊåâpredicatesÊù°‰ª∂ÂåπÈÖç</li>
<li>Á§∫‰æãË∑ØÁî±ÈÖçÁΩÆÔºö</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">video</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://easylive-cloud-web </span><span class="w"> </span><span class="c"># ÁõÆÊ†áÊúçÂä°ÂêçÔºàÈÄöËøáNacosÂèëÁé∞Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">Path=/web/**            </span><span class="w"> </span><span class="c"># Ë∑ØÂæÑÂåπÈÖçËßÑÂàô</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">StripPrefix=1           </span><span class="w"> </span><span class="c"># ÂéªÈô§ÂâçÁºÄ&#34;/web&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂåπÈÖçÈÄªËæëÔºö
<ul>
<li>localhost:7071/web/test ‚Üí ÂåπÈÖçPath=/web/** ‚Üí ËΩ¨ÂèëÂà∞easylive-cloud-webÊúçÂä°ÁöÑ/testÊé•Âè£</li>
</ul>
</li>
<li>NacosÊúçÂä°ÂèëÁé∞Ôºö
<ul>
<li>easylive-cloud-webÂ∑≤Âú®NacosÊ≥®ÂÜåÔºàÂ¶Ç7072Á´ØÂè£ÔºâÔºåÁΩëÂÖ≥ÈÄöËøálb://ÂâçÁºÄ‰ªéNacosËé∑ÂèñÊúçÂä°ÂÆû‰æãÂàóË°®</li>
<li>Ëã•ÊúâÂ§ö‰∏™ÂÆû‰æãÔºåRibbon‰ºöËΩÆËØ¢ÈÄâÊã©ÁõÆÊ†áËäÇÁÇπ</li>
</ul>
</li>
</ul>
<h3 id="‰∫åÊé•Âè£ËÆøÈóÆË∑ØÂæÑÂ∑ÆÂºÇËß£Êûê">‰∫å„ÄÅÊé•Âè£ËÆøÈóÆË∑ØÂæÑÂ∑ÆÂºÇËß£Êûê
</h3><ul>
<li>ËÆøÈóÆÊñπÂºè‰∏éË∞ÉÁî®ÈìæË∑ØÔºö
<ul>
<li>localhost:7072/testÔºöÁõ¥Êé•ËÆøÈóÆeasylive-cloud-webÊúçÂä°ÔºåÁªïËøáÁΩëÂÖ≥ÔºåÁõ¥ËøûÊúçÂä°Á´ØÂè£</li>
<li>localhost:7071/web/testÔºöÁΩëÂÖ≥Ë∑ØÁî± ‚Üí easylive-cloud-web:/testÔºåGatewayÁöÑStripPrefix=1ÁîüÊïà</li>
</ul>
</li>
<li>ÂÖ≥ÈîÆÂå∫Âà´Ôºö
<ul>
<li>ÁΩëÂÖ≥Ë∑ØÂæÑÈúÄÊê∫Â∏¶/webÂâçÁºÄÔºàÁî®‰∫éË∑ØÁî±ÂåπÈÖçÔºâÔºåÂÆûÈôÖËΩ¨ÂèëÊó∂‰ºöÂâ•Á¶ª</li>
<li>Áõ¥ËøûÊúçÂä°Ë∑ØÂæÑÊó†ÂâçÁºÄÔºå‰ΩÜ‰ºöÊö¥Èú≤ÊúçÂä°Á´ØÂè£Ôºà‰∏çÁ¨¶ÂêàÂæÆÊúçÂä°ÊúÄ‰Ω≥ÂÆûË∑µÔºâ</li>
</ul>
</li>
</ul>
<h3 id="‰∏âË¥üËΩΩÂùáË°°ÂÆû‰æãÊºîÁ§∫">‰∏â„ÄÅË¥üËΩΩÂùáË°°ÂÆû‰æãÊºîÁ§∫
</h3><ul>
<li>Âú∫ÊôØÂáÜÂ§áÔºö
<ul>
<li>ÂêØÂä®‰∏§‰∏™easylive-cloud-webÂÆû‰æãÔºàÁ´ØÂè£7072Âíå7073Ôºâ</li>
<li>NacosÊúçÂä°ÂàóË°®Ôºö</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">easylive-cloud-web</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">InstanceA</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="p">:</span><span class="m">7072</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">InstanceB</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="p">:</span><span class="m">7073</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ËØ∑Ê±ÇÂàÜÂèëËøáÁ®ãÔºö
<ul>
<li>ËøûÁª≠Ë∞ÉÁî®localhost:7071/web/testÊó∂Ôºö
<ul>
<li>Á¨¨‰∏ÄÊ¨°ËØ∑Ê±Ç ‚Üí ËΩ¨ÂèëÂà∞InstanceA:7072/test</li>
<li>Á¨¨‰∫åÊ¨°ËØ∑Ê±Ç ‚Üí ËΩ¨ÂèëÂà∞InstanceB:7073/test</li>
<li>Á¨¨‰∏âÊ¨°ËØ∑Ê±Ç ‚Üí ÂÜçÊ¨°ËΩ¨Âà∞InstanceAÔºàÈªòËÆ§ËΩÆËØ¢Á≠ñÁï•Ôºâ</li>
</ul>
</li>
</ul>
</li>
<li>Â∫ïÂ±ÇÊú∫Âà∂Ôºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// GatewayÈÄöËøáRibbonÂÆûÁé∞Ë¥üËΩΩÂùáË°°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">LoadBalancerClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpringContext</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">LoadBalancerClient</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ServiceInstance</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">choose</span><span class="p">(</span><span class="s">&#34;easylive-cloud-web&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ËøîÂõûÁöÑÂÆû‰æã‰ºöËΩÆËØ¢ÂèòÂåñ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ÂõõÂÆåÊï¥Ë∞ÉÁî®ÈìæË∑ØÁ§∫‰æã">Âõõ„ÄÅÂÆåÊï¥Ë∞ÉÁî®ÈìæË∑ØÁ§∫‰æã
</h3><ul>
<li>ËØ∑Ê±ÇÁ§∫‰æãÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">GET http://localhost:7071/web/api/videos/1
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÁΩëÂÖ≥Â§ÑÁêÜÊµÅÁ®ãÔºö
<ul>
<li>ÂåπÈÖçË∑ØÁî±id:video ‚Üí Ââ•Á¶ª/webÂâçÁºÄ ‚Üí ÁõÆÊ†áË∑ØÂæÑÂèò‰∏∫/api/videos/1</li>
<li>‰ªéNacosËé∑Âèñeasylive-cloud-webÂÆû‰æãÂú∞ÂùÄÔºàÂ¶Ç127.0.0.1:7072Ôºâ</li>
<li>ÊúÄÁªàËΩ¨ÂèëËØ∑Ê±ÇÔºö</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">GET http://127.0.0.1:7072/api/videos/1
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>- ÊúçÂä°ÂìçÂ∫îÊï∞ÊçÆÈÄöËøáÁΩëÂÖ≥ÂéüË∑ØËøîÂõû
</code></pre>
<ul>
<li>ÊÄªÁªìÔºö
<ul>
<li>ÁΩëÂÖ≥Ë∑ØÁî±ÔºöÈÄöËøáPathË∞ìËØçÂåπÈÖç + StripPrefixËøáÊª§ÂÆûÁé∞Ë∑ØÂæÑËΩ¨Êç¢</li>
<li>ÊúçÂä°ÂèëÁé∞Ôºö‰æùËµñNacosÁª¥Êä§Âä®ÊÄÅÊúçÂä°ÂÆû‰æãÂàóË°®</li>
<li>Ë¥üËΩΩÂùáË°°ÔºöÁî±RibbonËá™Âä®Â§ÑÁêÜÂ§öÂÆû‰æãËΩÆËØ¢</li>
<li>ËÆøÈóÆÂ∑ÆÂºÇÔºöÁΩëÂÖ≥Ë∑ØÂæÑÈúÄ‰øùÁïôË∑ØÁî±ÂâçÁºÄÔºå‰ΩÜÂÆûÈôÖËΩ¨ÂèëÊó∂‰ºöË¢´Ââ•Á¶ª</li>
<li>ËøôÁßçÊû∂ÊûÑÊó¢‰øùËØÅ‰∫ÜÊé•Âè£Ë∞ÉÁî®ÁöÑÁÅµÊ¥ªÊÄßÔºåÂèàÈöêËóè‰∫ÜÂêéÁ´ØÊúçÂä°ÁªÜËäÇÔºåÁ¨¶ÂêàÂæÆÊúçÂä°ËÆæËÆ°ÂéüÂàô</li>
</ul>
</li>
</ul>
<h3 id="‰∫îÁΩëÂÖ≥Â∑•‰ΩúÂéüÁêÜ">‰∫î„ÄÅÁΩëÂÖ≥Â∑•‰ΩúÂéüÁêÜ
</h3><ul>
<li>ÁΩëÂÖ≥Â¶ÇÂêåÂ∞èÂå∫Âø´ÈÄíÈ©øÁ´ôÔºåeasylive-cloud-webÊòØÂÖ∑‰Ωì‰ΩèÊà∑</li>
<li>ÊâÄÊúâËØ∑Ê±ÇÔºàÂø´ÈÄíÔºâÂÖàÂà∞È©øÁ´ôÔºàÁΩëÂÖ≥ÔºâÔºåÁî±È©øÁ´ôÂÜ≥ÂÆöÈÄÅÂà∞Âì™Êà∑</li>
<li>Ë∑ØÁî±ÈÖçÁΩÆÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">7071</span><span class="w">  </span><span class="c"># È©øÁ´ôÈó®ÁâåÂè∑</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">feign</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">okhttp</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">  </span><span class="c"># Êô∫ËÉΩÂàÜÊã£Êú∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">video</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://easylive-cloud-web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">Path=/web/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">StripPrefix=1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â∑•‰ΩúÊµÅÁ®ãÔºö
<ul>
<li>Âø´ÈÄíÂëòÈÄÅÊù•/web/testÔºåÈ©øÁ´ôËØÜÂà´ÂêéÂâ•Á¶ª/webÔºåÈÄÅÂà∞/test</li>
<li>Áõ¥Êé•ËÆøÈóÆ7072Á´ØÂè£Â¶ÇÂêåÂø´ÈÄíÂëòÁªïÂºÄÈ©øÁ´ôÔºåÁõ¥ÈÄÅ‰ΩèÊà∑Ôºå‰∏çËßÑËåÉ</li>
<li>ÈÄöËøáÁΩëÂÖ≥7071Á´ØÂè£Ôºå‰∫´ÂèóÁªü‰∏ÄÁÆ°ÁêÜ„ÄÅÈâ¥ÊùÉ„ÄÅÈôêÊµÅÁ≠âÊúçÂä°</li>
</ul>
</li>
<li>Ë¥üËΩΩÂùáË°°Ôºö
<ul>
<li>Â§ö‰∏™ÂÆû‰æãÂ¶ÇÂêåÂèåËÉûËÉéÔºåÈ©øÁ´ôËΩÆÊµÅÂàÜÈÖçÂø´ÈÄíÔºåÁ°Æ‰øùÂùáË°°</li>
</ul>
</li>
<li>Ê†∏ÂøÉ‰ºòÂäøÔºö
<ul>
<li>Áªü‰∏ÄÁÆ°ÁêÜÔºåÂÆâÂÖ®ÂèØÊéß</li>
<li>ÁÅµÊ¥ªÊâ©Â±ïÔºåÂÆû‰æãËá™Âä®ËØÜÂà´</li>
<li>ÊïÖÈöúÈöîÁ¶ªÔºåÂÆû‰æãÂÆïÊú∫Ëá™Âä®ÂàáÊç¢</li>
</ul>
</li>
</ul>
<hr>
<h2 id="adminfilter-ËØ¶ÁªÜËß£Êûê">AdminFilter ËØ¶ÁªÜËß£Êûê
</h2><h3 id="‰∏ÄÁ±ªÂÆö‰πâ‰∏éÂü∫Á°ÄÁªìÊûÑ">‰∏Ä„ÄÅÁ±ªÂÆö‰πâ‰∏éÂü∫Á°ÄÁªìÊûÑ
</h3><ul>
<li>AdminFilter ÊòØ Spring Cloud Gateway ÁöÑËøáÊª§Âô®ÔºåÁî®‰∫éËØ∑Ê±ÇÂà∞ËææÂæÆÊúçÂä°ÂâçËøõË°åÊùÉÈôêÊ†°È™åÔºàÂ¶ÇÁÆ°ÁêÜÂëò Token È™åËØÅÔºâ</li>
<li>‰∏ªË¶ÅÁªìÊûÑÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AdminFilter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractGatewayFilterFactory</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><pre><code>- @ComponentÔºöÂ£∞Êòé‰∏∫ Spring BeanÔºåÁî± Spring ÁÆ°ÁêÜ
- @Slf4jÔºöÈõÜÊàê LombokÔºåÊèê‰æõÊó•ÂøóÂäüËÉΩ
- AbstractGatewayFilterFactoryÔºöËá™ÂÆö‰πâË∑ØÁî±ËøáÊª§ÈÄªËæëÁöÑÂü∫Á±ª
</code></pre>
<h3 id="‰∫åÂ∏∏ÈáèÂÆö‰πâ">‰∫å„ÄÅÂ∏∏ÈáèÂÆö‰πâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">URL_ACCOUNT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;/account&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">URL_FILE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;/file&#34;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>URL_ACCOUNTÔºöÊîæË°åË∑ØÂæÑÔºåËÆøÈóÆ /account ÁöÑËØ∑Ê±ÇÊó†ÈúÄ TokenÔºàÂ¶ÇÁôªÂΩï„ÄÅÊ≥®ÂÜåÊé•Âè£Ôºâ</li>
<li>URL_FILEÔºöÊñá‰ª∂Áõ∏ÂÖ≥Êé•Âè£‰ªé Cookie ‰∏≠ÊèêÂèñ Token</li>
</ul>
<h3 id="‰∏âÊ†∏ÂøÉËøáÊª§ÈÄªËæëapplyÊñπÊ≥ï">‰∏â„ÄÅÊ†∏ÂøÉËøáÊª§ÈÄªËæëÔºàapplyÊñπÊ≥ïÔºâ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">GatewayFilter</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">exchange</span><span class="p">,</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ServerHttpRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">getRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>applyÔºöË¶ÜÁõñÁà∂Á±ªÊñπÊ≥ïÔºåËøîÂõû GatewayFilter ÂÆû‰æã</li>
<li>exchangeÔºöÂ∞ÅË£Ö HTTP ËØ∑Ê±ÇÂíåÂìçÂ∫î‰∏ä‰∏ãÊñá</li>
<li>chainÔºöËøáÊª§Âô®ÈìæÔºåchain.filter(exchange) ÁªßÁª≠ÂêéÁª≠ËøáÊª§ÊàñË∑ØÁî±</li>
</ul>
<h4 id="1-Ë∑ØÂæÑÂà§Êñ≠‰∏é-token-ÊèêÂèñ">1. Ë∑ØÂæÑÂà§Êñ≠‰∏é Token ÊèêÂèñ
</h4><ul>
<li>ÊîæË°å /account Ë∑ØÂæÑÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getURI</span><span class="p">().</span><span class="na">getRawPath</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="n">URL_ACCOUNT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">exchange</span><span class="p">);</span><span class="w"> </span><span class="c1">// Áõ¥Êé•ÊîæË°å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Êñá‰ª∂Êé•Âè£‰ªé Cookie Âèñ TokenÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getURI</span><span class="p">().</span><span class="na">getRawPath</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="n">URL_FILE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTokenFromCookie</span><span class="p">(</span><span class="n">request</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÈªòËÆ§‰ªé Header Âèñ TokenÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getToken</span><span class="p">(</span><span class="n">request</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-token-Ê†°È™å">2. Token Ê†°È™å
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringTools</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">token</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_901</span><span class="p">);</span><span class="w"> </span><span class="c1">// Êó†ÊùÉÈôê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Token ‰∏∫Á©∫ÊäõÂá∫‰∏öÂä°ÂºÇÂ∏∏ÔºàÂ¶Ç CODE_901 Ë°®Á§∫Êú™ÁôªÂΩï/Token Êó†ÊïàÔºâ</li>
<li>Token ÊúâÊïàÂàôÁªßÁª≠ÂêéÁª≠ÈÄªËæë</li>
</ul>
<h3 id="Âõõtoken-ÊèêÂèñÊñπÊ≥ï">Âõõ„ÄÅToken ÊèêÂèñÊñπÊ≥ï
</h3><ul>
<li>‰ªé Header Ëé∑ÂèñÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getToken</span><span class="p">(</span><span class="n">ServerHttpRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeaders</span><span class="p">().</span><span class="na">getFirst</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TOKEN_ADMIN</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>‰ªé Cookie Ëé∑ÂèñÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getTokenFromCookie</span><span class="p">(</span><span class="n">ServerHttpRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getCookies</span><span class="p">().</span><span class="na">getFirst</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TOKEN_ADMIN</span><span class="p">).</span><span class="na">getValue</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="‰∫îËÆæËÆ°ÊÄùÊÉ≥‰∏é‰ΩøÁî®Âú∫ÊôØ">‰∫î„ÄÅËÆæËÆ°ÊÄùÊÉ≥‰∏é‰ΩøÁî®Âú∫ÊôØ
</h3><ul>
<li>ËÅåË¥£ÂàÜÁ¶ªÔºöÊùÉÈôêÊ†°È™åÈÄªËæëÈõÜ‰∏≠Âú®ÁΩëÂÖ≥Â±ÇÔºåÈÅøÂÖçÊØè‰∏™ÂæÆÊúçÂä°ÈáçÂ§çÂÆûÁé∞</li>
<li>ÁÅµÊ¥ªÊèêÂèñ TokenÔºöÊîØÊåÅ Header Âíå Cookie ‰∏§ÁßçÊñπÂºèÔºåÈÄÇÈÖç API Ë∞ÉÁî®ÂíåÊµèËßàÂô®Êñá‰ª∂‰∏ãËΩΩ</li>
<li>ÁôΩÂêçÂçïË∑ØÂæÑÔºö/account Ë∑ØÂæÑÂÖçÊ†°È™åÔºåÁ°Æ‰øùÁôªÂΩï/Ê≥®ÂÜåÊé•Âè£ÂèØËÆøÈóÆ</li>
<li>ÂºÇÂ∏∏Â§ÑÁêÜÔºöÁõ¥Êé•ÊäõÂá∫‰∏öÂä°ÂºÇÂ∏∏ÔºåÁî±ÁΩëÂÖ≥Áªü‰∏ÄËΩ¨Êç¢‰∏∫ HTTP ÂìçÂ∫îÔºàÂ¶Ç 401 UnauthorizedÔºâ</li>
</ul>
<h4 id="ÂÖ∏Âûã‰ΩøÁî®Âú∫ÊôØ">ÂÖ∏Âûã‰ΩøÁî®Âú∫ÊôØ
</h4><ul>
<li>ÁÆ°ÁêÜÂëòËÆøÈóÆÁî®Êà∑ÂàóË°®Ôºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/admin/users</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">X-Admin-Token</span><span class="o">:</span> <span class="l">valid_token_here</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>- ÁΩëÂÖ≥Ê£ÄÊü•Ë∑ØÂæÑ‰∏çÂåπÈÖç /account Êàñ /fileÔºå‰ªé Header ÊèêÂèñ TokenÔºåÊ†°È™åÈÄöËøáËΩ¨Âèë
</code></pre>
<ul>
<li>Áî®Êà∑‰∏ãËΩΩÊñá‰ª∂Ôºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/file/download/1</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Cookie</span><span class="o">:</span> <span class="l">ADMIN_TOKEN=valid_token_here</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>- ÁΩëÂÖ≥ËØÜÂà´Ë∑ØÂæÑÂåÖÂê´ /fileÔºå‰ªé Cookie ÊèêÂèñ TokenÔºåÊ†°È™åÈÄöËøáËΩ¨Âèë
</code></pre>
<ul>
<li>Êú™Êê∫Â∏¶ Token ÁöÑËØ∑Ê±ÇÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/admin/users</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>- ÊäõÂá∫ CODE_901 ÂºÇÂ∏∏ÔºåËøîÂõû 401 Unauthorized
</code></pre>
<hr>
<h2 id="‰ΩøÁî®seataËß£ÂÜ≥ÂàÜÂ∏ÉÂºè‰∫ãÂä°ÈóÆÈ¢ò">‰ΩøÁî®SeataËß£ÂÜ≥ÂàÜÂ∏ÉÂºè‰∫ãÂä°ÈóÆÈ¢ò
</h2><h3 id="‰∏Ä‰∏∫‰ªÄ‰πàtransactionalÂú®Ë∑®ÊúçÂä°Ë∞ÉÁî®Êó∂‰∏çÁîüÊïà">‰∏Ä„ÄÅ‰∏∫‰ªÄ‰πà@TransactionalÂú®Ë∑®ÊúçÂä°Ë∞ÉÁî®Êó∂‰∏çÁîüÊïà
</h3><ul>
<li>@Transactional Âè™ËÉΩÁÆ°ÁêÜÂΩìÂâçÊúçÂä°ÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•ÔºåÊó†Ê≥ïÊéßÂà∂ËøúÁ®ãÊúçÂä°ÁöÑ‰∫ãÂä°</li>
<li>ÂÖ∏ÂûãÂú∫ÊôØÔºö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Êú¨Âú∞Êï∞ÊçÆÂ∫ìÊìç‰ΩúÔºàÂèØË¢´@TransactionalÁÆ°ÁêÜÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoCommentMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">comment</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Ë∑®ÊúçÂä°Ë∞ÉÁî®Ôºà‰∏çÂèó@TransactionalÊéßÂà∂Ôºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">videoClient</span><span class="p">.</span><span class="na">updateCountInfo</span><span class="p">(</span><span class="n">comment</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">(),</span><span class="w"> </span><span class="p">...);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÈóÆÈ¢òÊ†πÊ∫êÔºö
<ul>
<li>‰∫ãÂä°ÈöîÁ¶ªÊÄßÔºö@Transactional ‰ªÖ‰ΩúÁî®‰∫éÊú¨Âú∞Êï∞ÊçÆÂ∫ìËøûÊé•</li>
<li>Ë∑®ÊúçÂä°Ë∞ÉÁî®ÔºàÂ¶ÇHTTP/FeignÔºâÂ±û‰∫éÁã¨Á´ã‰∫ãÂä°ÔºåÊó†Ê≥ïËá™Âä®ÂõûÊªö</li>
<li>‰∏§Èò∂ÊÆµÈóÆÈ¢òÔºöÊú¨Âú∞insertÊàêÂäüÂêéÔºåËøúÁ®ãË∞ÉÁî®Â§±Ë¥•Êó∂Êú¨Âú∞Êó†Ê≥ïÂõûÊªö</li>
<li>CAPÁêÜËÆ∫ÔºöË∑®ÊúçÂä°Êìç‰ΩúÊ∂âÂèäÁΩëÁªúÂàÜÂå∫Ôºå‰º†Áªü‰∫ãÂä°Êó†Ê≥ï‰øùËØÅCP</li>
</ul>
</li>
<li>ÁîüÊ¥ªÂåñÊØîÂñªÔºö
<ul>
<li>ÂïÜÂÆ∂ÔºàÊúçÂä°AÔºâÁ°ÆËÆ§ÂèëË¥ßÔºàÊú¨Âú∞‰∫ãÂä°Êèê‰∫§Ôºâ</li>
<li>Âø´ÈÄíÔºàÊúçÂä°BÔºâ‰∏¢‰ª∂ÔºàËøúÁ®ãË∞ÉÁî®Â§±Ë¥•Ôºâ</li>
<li>Ê≤°ÊúâÂπ≥Âè∞ÔºàSeataÔºâÂçèË∞ÉÊó∂ÔºåÈí±Ë¥ß‰∏§Â§±</li>
</ul>
</li>
</ul>
<h3 id="‰∫åseataËß£ÂÜ≥ÊñπÊ°àÂÖ®ÊµÅÁ®ã">‰∫å„ÄÅSeataËß£ÂÜ≥ÊñπÊ°àÂÖ®ÊµÅÁ®ã
</h3><ul>
<li>Á¨¨‰∏ÄÊ≠•ÔºöÂêØÂä®SeataÊúçÂä°
<ul>
<li>‰∏ãËΩΩSeata ServerÔºà1.6.1+Ôºâ</li>
<li>ÈÖçÁΩÆÊ≥®ÂÜå‰∏≠ÂøÉÔºàÂ¶ÇNacosÔºâÔºö</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">registry {
</span></span><span class="line"><span class="cl">  type = &#34;nacos&#34;
</span></span><span class="line"><span class="cl">  nacos {
</span></span><span class="line"><span class="cl">    serverAddr = &#34;127.0.0.1:8848&#34;
</span></span><span class="line"><span class="cl">    namespace = &#34;‰Ω†ÁöÑÂëΩÂêçÁ©∫Èó¥&#34; # ÂèØÈÄâ
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>- ÂêØÂä®ÂëΩ‰ª§Ôºöbin/seata-server.sh -p 8091 -h 127.0.0.1
</code></pre>
<ul>
<li>Á¨¨‰∫åÊ≠•ÔºöÊï∞ÊçÆÂ∫ìÂáÜÂ§á
<ul>
<li>ÊØè‰∏™‰∏öÂä°Â∫ìÊâßË°åundo_logË°®Âª∫Ë°®SQLÔºö</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">undo_log</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="w"> </span><span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">context</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">rollback_info</span><span class="o">`</span><span class="w"> </span><span class="n">longblob</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">log_status</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">log_created</span><span class="o">`</span><span class="w"> </span><span class="n">datetime</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">log_modified</span><span class="o">`</span><span class="w"> </span><span class="n">datetime</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">ux_undo_log</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">xid</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">branch_id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><pre><code>- Seata ServerÁã¨Á´ãÂ∫ìÈúÄÂª∫global_table„ÄÅbranch_table„ÄÅlock_tableÁ≠â
</code></pre>
<ul>
<li>Á¨¨‰∏âÊ≠•ÔºöÈ°πÁõÆÈÖçÁΩÆ
<ul>
<li>Ê∑ªÂä†‰æùËµñÔºö</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-seata<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>2.2.6.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre><code>- NacosÈÖçÁΩÆÁ§∫‰æãÔºö
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">alibaba</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">seata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tx-service-group</span><span class="p">:</span><span class="w"> </span><span class="l">video-service-group</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">seata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">registry</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nacos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="p">:</span><span class="m">8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">nacos</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Á¨¨ÂõõÊ≠•Ôºö‰ª£Á†ÅÊîπÈÄ†
<ul>
<li>Âú®‰∏öÂä°ÊñπÊ≥ï‰∏äÊ∑ªÂä†@GlobalTransactional</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@GlobalTransactional</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">rollbackFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Exception</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w">  </span><span class="c1">// ÊâÄÊúâÂºÇÂ∏∏ÈÉΩÂõûÊªö</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">timeoutMills</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">60000</span><span class="p">,</span><span class="w">           </span><span class="c1">// Ë∂ÖÊó∂Êó∂Èó¥ÔºàÊØ´ÁßíÔºâ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;postCommentTx&#34;</span><span class="w">         </span><span class="c1">// ÂÖ®Â±Ä‰∫ãÂä°Âêç</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">postComment</span><span class="p">(</span><span class="n">VideoComment</span><span class="w"> </span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">replyCommentId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Âéü‰∏öÂä°ÈÄªËæë‰∏çÂèò</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Seata‰ºöËá™Âä®Êã¶Êà™‰ª•‰∏ãÊìç‰ΩúÔºö</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. videoCommentMapper.insert()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. videoClient.updateCountInfo()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ÂÖ≥ÈîÆÊú∫Âà∂Ôºö
<ul>
<li>‰∫ãÂä°ID‰º†Êí≠ÔºöSeataÈÄöËøáXIDÔºàÂÖ®Â±Ä‰∫ãÂä°IDÔºâ‰∏≤ËÅîÂêÑÊúçÂä°ÔºåËá™Âä®ÈÄöËøáFeignËØ∑Ê±ÇÂ§¥‰º†ÈÄíseata_xid</li>
<li>‰∫åÈò∂ÊÆµÊèê‰∫§Ôºö
<ul>
<li>Á¨¨‰∏ÄÈò∂ÊÆµÔºöPrepare</li>
<li>Á¨¨‰∫åÈò∂ÊÆµÔºöCommit/Rollback</li>
</ul>
</li>
<li>ÂõûÊªöÂéüÁêÜÔºöundo_logË°®ËÆ∞ÂΩïÂõûÊªöÊó•ÂøóÔºåÂ§±Ë¥•Êó∂Ëá™Âä®Ë°•ÂÅø</li>
</ul>
</li>
</ul>
<h3 id="‰∏âÈ™åËØÅ‰∏éÊéíÊü•ÊäÄÂ∑ß">‰∏â„ÄÅÈ™åËØÅ‰∏éÊéíÊü•ÊäÄÂ∑ß
</h3><ul>
<li>Êü•ÁúãSeataÊéßÂà∂Âè∞ÔºàÂ¶Çhttp://127.0.0.1:7091ÔºâÔºåÊ£ÄÊü•‰∫ãÂä°ÂàóË°®</li>
<li>Âº∫Âà∂Ëß¶ÂèëÂºÇÂ∏∏ÔºåËßÇÂØüÊú¨Âú∞Ë°®ÊòØÂê¶ÂõûÊªö</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Âú®updateCountInfo()‰∏≠Ê®°ÊãüÂ§±Ë¥•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="na">random</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;Ê®°ÊãüËøúÁ®ãË∞ÉÁî®Â§±Ë¥•&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Â∏∏ËßÅÈóÆÈ¢òÔºö
<ul>
<li>No available service for clusterÔºö‰∫ãÂä°ÁªÑÂêç‰∏çÂåπÈÖçÔºåÊ£ÄÊü•tx-service-group‰∏ÄËá¥ÊÄß</li>
<li>Could not register branchÔºöÊï∞ÊçÆÂ∫ìÊú™Âª∫undo_logÔºåÈúÄÊâßË°åÂª∫Ë°®SQL</li>
<li>ÂõûÊªöÂ§±ÊïàÔºöÊñπÊ≥ïÂÜÖÊçïËé∑ÂºÇÂ∏∏ÔºåÈúÄÁ°Æ‰øùÂºÇÂ∏∏ÊäõÂá∫Âà∞@GlobalTransactionalÂ±Ç</li>
</ul>
</li>
</ul>
<h3 id="ÂõõÁîüÊ¥ªÂåñÊÄªÁªì">Âõõ„ÄÅÁîüÊ¥ªÂåñÊÄªÁªì
</h3><ul>
<li>SeataÂ∞±ÂÉèË∑®ÂõΩË¥∏ÊòìÁöÑÊîØ‰ªòÂÆùÔºö
<ul>
<li>‰π∞ÂÆ∂‰ªòÊ¨æÔºàÊú¨Âú∞‰∫ãÂä°Ôºâ‚Üí ËµÑÈáëÊöÇÂ≠òÂπ≥Âè∞ÔºàPhase1Ôºâ</li>
<li>ÂçñÂÆ∂ÂèëË¥ßÔºàËøúÁ®ãË∞ÉÁî®Ôºâ‚Üí Âπ≥Âè∞ÁõëÊéßÁâ©ÊµÅÔºàPhase1Ôºâ</li>
<li>Á°ÆËÆ§Êî∂Ë¥ßÂêéÂèåÊñπÁªìÁÆóÔºàPhase2 CommitÔºâ</li>
<li>ÂçñÂÆ∂‰∏çÂèëË¥ßÔºåÂπ≥Âè∞ÈÄÄÊ¨æÔºàPhase2 RollbackÔºâ</li>
</ul>
</li>
<li>ÈÄöËøáSeataÔºåpostCommentÊñπÊ≥ïÂÆûÁé∞ÂÖ®Ëá™Âä®‰øùÈô©ÔºåËØÑËÆ∫Êï∞ÊçÆÂíåËÆ°Êï∞Êõ¥Êñ∞Ë¶Å‰πàÂÖ®ÈÉ®ÊàêÂäüÔºåË¶Å‰πàÂÖ®ÈÉ®ÂõûÊªö</li>
</ul>
<h3 id="‰∫îÂÖ∏Âûã‰ª£Á†ÅÁ§∫‰æã">‰∫î„ÄÅÂÖ∏Âûã‰ª£Á†ÅÁ§∫‰æã
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@GlobalTransactional</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;postCommentTx&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">rollbackFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Exception</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">postComment</span><span class="p">(</span><span class="n">VideoComment</span><span class="w"> </span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">replyCommentId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 1. Ëé∑ÂèñËßÜÈ¢ë‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">VideoInfo</span><span class="w"> </span><span class="n">videoInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoClient</span><span class="p">.</span><span class="na">getVideoInfoByVideoId</span><span class="p">(</span><span class="n">comment</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">videoInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_600</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 2. Ê£ÄÊü•ËØÑËÆ∫ÊòØÂê¶ÂÖ≥Èó≠</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getInteraction</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getInteraction</span><span class="p">().</span><span class="na">contains</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">ZERO</span><span class="p">.</span><span class="na">toString</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="s">&#34;UP‰∏ªÂ∑≤ÂÖ≥Èó≠ËØÑËÆ∫Âå∫&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 3. Â§ÑÁêÜÂõûÂ§çËØÑËÆ∫ÈÄªËæë</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">replyCommentId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">VideoComment</span><span class="w"> </span><span class="n">replyComment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getVideoCommentByCommentId</span><span class="p">(</span><span class="n">replyCommentId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">replyComment</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">replyComment</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">comment</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessException</span><span class="p">(</span><span class="n">ResponseCodeEnum</span><span class="p">.</span><span class="na">CODE_600</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">replyComment</span><span class="p">.</span><span class="na">getpCommentId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">comment</span><span class="p">.</span><span class="na">setpCommentId</span><span class="p">(</span><span class="n">replyComment</span><span class="p">.</span><span class="na">getCommentId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">comment</span><span class="p">.</span><span class="na">setpCommentId</span><span class="p">(</span><span class="n">replyComment</span><span class="p">.</span><span class="na">getpCommentId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">comment</span><span class="p">.</span><span class="na">setReplyUserId</span><span class="p">(</span><span class="n">replyComment</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">UserInfo</span><span class="w"> </span><span class="n">userInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">videoClient</span><span class="p">.</span><span class="na">getUserInfoByUserId</span><span class="p">(</span><span class="n">replyComment</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">comment</span><span class="p">.</span><span class="na">setReplyNickName</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getNickName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">comment</span><span class="p">.</span><span class="na">setReplyAvatar</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getAvatar</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">comment</span><span class="p">.</span><span class="na">setpCommentId</span><span class="p">(</span><span class="n">0</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 4. ËÆæÁΩÆËØÑËÆ∫‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">comment</span><span class="p">.</span><span class="na">setPostTime</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">comment</span><span class="p">.</span><span class="na">setVideoUserId</span><span class="p">(</span><span class="n">videoInfo</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 5. ÊèíÂÖ•ËØÑËÆ∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">videoCommentMapper</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">comment</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 6. Êõ¥Êñ∞ËØÑËÆ∫ËÆ°Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">comment</span><span class="p">.</span><span class="na">getpCommentId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">videoClient</span><span class="p">.</span><span class="na">updateCountInfo</span><span class="p">(</span><span class="n">comment</span><span class="p">.</span><span class="na">getVideoId</span><span class="p">(),</span><span class="w"> </span><span class="n">UserActionTypeEnum</span><span class="p">.</span><span class="na">VIDEO_COMMENT</span><span class="p">.</span><span class="na">getField</span><span class="p">(),</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p>&lt;/rewritten_file&gt;</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 P
    </section>
    
    <section class="powerby">
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1ad0100d5d3b17f1840a489e493b72e1cbd903545e8f7eee7baa7ba311518c49.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
